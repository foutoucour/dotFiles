function ScribeTransport(e){this.SESSION_BUFFER_KEY="ScribeTransport",this.SCRIBE_API_ENDPOINT="/i/jot",this.options={},e&&(this.updateOptions(e),this.registerEventHandlers(e))}function ClientEvent(e){this.scribeContext={},this.scribeData={},this.scribe=function(t,n){var r=e||window.scribeTransport;if(!r)throw new Error("You must create a global scribeTransport variable or pass one into this constructor.");if(!t||typeof t!="object"||n&&typeof n!="object")throw new Error("Invalid terms or data hash argument when calling ClientEvent.scribe().");if(this.scribeContext){var i=typeof this.scribeContext=="function"?this.scribeContext():this.scribeContext;t=$.extend({},i,t)}for(var s in t)t[s]=t[s]&&(""+t[s]).toLowerCase().replace(/_?[^a-z0-9_]+_?/g,"_");r.options.debug&&$.each(["client","action"],function(e,n){if(!t[n])throw new Error("You must specify a "+n+" term in your client_event.")});var n=$.extend({},n);if(this.scribeData){var o=typeof this.scribeData=="function"?this.scribeData():this.scribeData;n=$.extend({},o,n)}n.event_namespace=t,n.triggered_on=n.triggered_on||+(new Date),n.format_version=n.format_version||2,r.send(n,"client_event")}}window.Modernizr=function(e,t,n){function A(e){f.cssText=e}function O(e,t){return A(p.join(e+";")+(t||""))}function M(e,t){return typeof e===t}function _(e,t){return!!~(""+e).indexOf(t)}function D(e,t){for(var r in e){var i=e[r];if(!_(i,"-")&&f[i]!==n)return t=="pfx"?i:!0}return!1}function P(e,t,r){for(var i in e){var s=t[e[i]];if(s!==n)return r===!1?e[i]:M(s,"function")?s.bind(r||t):s}return!1}function H(e,t,n){var r=e.charAt(0).toUpperCase()+e.slice(1),i=(e+" "+v.join(r+" ")+r).split(" ");return M(t,"string")||M(t,"undefined")?D(i,t):(i=(e+" "+m.join(r+" ")+r).split(" "),P(i,t,n))}function B(){i.input=function(n){for(var r=0,i=n.length;r<i;r++)w[n[r]]=n[r]in l;return w.list&&(w.list=!!t.createElement("datalist")&&!!e.HTMLDataListElement),w}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),i.inputtypes=function(e){for(var r=0,i,s,u,a=e.length;r<a;r++)l.setAttribute("type",s=e[r]),i=l.type!=="text",i&&(l.value=c,l.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(s)&&l.style.WebkitAppearance!==n?(o.appendChild(l),u=t.defaultView,i=u.getComputedStyle&&u.getComputedStyle(l,null).WebkitAppearance!=="textfield"&&l.offsetHeight!==0,o.removeChild(l)):/^(search|tel)$/.test(s)||(/^(url|email)$/.test(s)?i=l.checkValidity&&l.checkValidity()===!1:i=l.value!=c)),b[e[r]]=!!i;return b}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var r="2.6.2",i={},s=!0,o=t.documentElement,u="modernizr",a=t.createElement(u),f=a.style,l=t.createElement("input"),c=":)",h={}.toString,p=" -webkit- -moz- -o- -ms- ".split(" "),d="Webkit Moz O ms",v=d.split(" "),m=d.toLowerCase().split(" "),g={svg:"http://www.w3.org/2000/svg"},y={},b={},w={},E=[],S=E.slice,x,T=function(e,n,r,i){var s,a,f,l,c=t.createElement("div"),h=t.body,p=h||t.createElement("body");if(parseInt(r,10))while(r--)f=t.createElement("div"),f.id=i?i[r]:u+(r+1),c.appendChild(f);return s=["&#173;",'<style id="s',u,'">',e,"</style>"].join(""),c.id=u,(h?c:p).innerHTML+=s,p.appendChild(c),h||(p.style.background="",p.style.overflow="hidden",l=o.style.overflow,o.style.overflow="hidden",o.appendChild(p)),a=n(c,e),h?c.parentNode.removeChild(c):(p.parentNode.removeChild(p),o.style.overflow=l),!!a},N=function(t){var n=e.matchMedia||e.msMatchMedia;if(n)return n(t).matches;var r;return T("@media "+t+" { #"+u+" { position: absolute; } }",function(t){r=(e.getComputedStyle?getComputedStyle(t,null):t.currentStyle)["position"]=="absolute"}),r},C=function(){function r(r,i){i=i||t.createElement(e[r]||"div"),r="on"+r;var s=r in i;return s||(i.setAttribute||(i=t.createElement("div")),i.setAttribute&&i.removeAttribute&&(i.setAttribute(r,""),s=M(i[r],"function"),M(i[r],"undefined")||(i[r]=n),i.removeAttribute(r))),i=null,s}var e={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return r}(),k={}.hasOwnProperty,L;!M(k,"undefined")&&!M(k.call,"undefined")?L=function(e,t){return k.call(e,t)}:L=function(e,t){return t in e&&M(e.constructor.prototype[t],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(t){var n=this;if(typeof n!="function")throw new TypeError;var r=S.call(arguments,1),i=function(){if(this instanceof i){var e=function(){};e.prototype=n.prototype;var s=new e,o=n.apply(s,r.concat(S.call(arguments)));return Object(o)===o?o:s}return n.apply(t,r.concat(S.call(arguments)))};return i}),y.flexbox=function(){return H("flexWrap")},y.flexboxlegacy=function(){return H("boxDirection")},y.canvas=function(){var e=t.createElement("canvas");return!!e.getContext&&!!e.getContext("2d")},y.canvastext=function(){return!!i.canvas&&!!M(t.createElement("canvas").getContext("2d").fillText,"function")},y.webgl=function(){return!!e.WebGLRenderingContext},y.touch=function(){var n;return"ontouchstart"in e||e.DocumentTouch&&t instanceof DocumentTouch?n=!0:T(["@media (",p.join("touch-enabled),("),u,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(e){n=e.offsetTop===9}),n},y.geolocation=function(){return"geolocation"in navigator},y.postmessage=function(){return!!e.postMessage},y.websqldatabase=function(){return!!e.openDatabase},y.indexedDB=function(){return!!H("indexedDB",e)},y.hashchange=function(){return C("hashchange",e)&&(t.documentMode===n||t.documentMode>7)},y.history=function(){return!!e.history&&!!history.pushState},y.draganddrop=function(){var e=t.createElement("div");return"draggable"in e||"ondragstart"in e&&"ondrop"in e},y.websockets=function(){return"WebSocket"in e||"MozWebSocket"in e},y.rgba=function(){return A("background-color:rgba(150,255,150,.5)"),_(f.backgroundColor,"rgba")},y.hsla=function(){return A("background-color:hsla(120,40%,100%,.5)"),_(f.backgroundColor,"rgba")||_(f.backgroundColor,"hsla")},y.multiplebgs=function(){return A("background:url(https://),url(https://),red url(https://)"),/(url\s*\(.*?){3}/.test(f.background)},y.backgroundsize=function(){return H("backgroundSize")},y.borderimage=function(){return H("borderImage")},y.borderradius=function(){return H("borderRadius")},y.boxshadow=function(){return H("boxShadow")},y.textshadow=function(){return t.createElement("div").style.textShadow===""},y.opacity=function(){return O("opacity:.55"),/^0.55$/.test(f.opacity)},y.cssanimations=function(){return H("animationName")},y.csscolumns=function(){return H("columnCount")},y.cssgradients=function(){var e="background-image:",t="gradient(linear,left top,right bottom,from(#9f9),to(white));",n="linear-gradient(left top,#9f9, white);";return A((e+"-webkit- ".split(" ").join(t+e)+p.join(n+e)).slice(0,-e.length)),_(f.backgroundImage,"gradient")},y.cssreflections=function(){return H("boxReflect")},y.csstransforms=function(){return!!H("transform")},y.csstransforms3d=function(){var e=!!H("perspective");return e&&"webkitPerspective"in o.style&&T("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(t,n){e=t.offsetLeft===9&&t.offsetHeight===3}),e},y.csstransitions=function(){return H("transition")},y.fontface=function(){var e;return T('@font-face {font-family:"font";src:url("https://")}',function(n,r){var i=t.getElementById("smodernizr"),s=i.sheet||i.styleSheet,o=s?s.cssRules&&s.cssRules[0]?s.cssRules[0].cssText:s.cssText||"":"";e=/src/i.test(o)&&o.indexOf(r.split(" ")[0])===0}),e},y.generatedcontent=function(){var e;return T(["#",u,"{font:0/0 a}#",u,':after{content:"',c,'";visibility:hidden;font:3px/1 a}'].join(""),function(t){e=t.offsetHeight>=3}),e},y.video=function(){var e=t.createElement("video"),n=!1;try{if(n=!!e.canPlayType)n=new Boolean(n),n.ogg=e.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),n.h264=e.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),n.webm=e.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")}catch(r){}return n},y.audio=function(){var e=t.createElement("audio"),n=!1;try{if(n=!!e.canPlayType)n=new Boolean(n),n.ogg=e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),n.mp3=e.canPlayType("audio/mpeg;").replace(/^no$/,""),n.wav=e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),n.m4a=(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,"")}catch(r){}return n},y.localstorage=function(){try{return localStorage.setItem(u,u),localStorage.removeItem(u),!0}catch(e){return!1}},y.sessionstorage=function(){try{return sessionStorage.setItem(u,u),sessionStorage.removeItem(u),!0}catch(e){return!1}},y.webworkers=function(){return!!e.Worker},y.applicationcache=function(){return!!e.applicationCache},y.svg=function(){return!!t.createElementNS&&!!t.createElementNS(g.svg,"svg").createSVGRect},y.inlinesvg=function(){var e=t.createElement("div");return e.innerHTML="<svg/>",(e.firstChild&&e.firstChild.namespaceURI)==g.svg},y.smil=function(){return!!t.createElementNS&&/SVGAnimate/.test(h.call(t.createElementNS(g.svg,"animate")))},y.svgclippaths=function(){return!!t.createElementNS&&/SVGClipPath/.test(h.call(t.createElementNS(g.svg,"clipPath")))};for(var j in y)L(y,j)&&(x=j.toLowerCase(),i[x]=y[j](),E.push((i[x]?"":"no-")+x));return i.input||B(),i.addTest=function(e,t){if(typeof e=="object")for(var r in e)L(e,r)&&i.addTest(r,e[r]);else{e=e.toLowerCase();if(i[e]!==n)return i;t=typeof t=="function"?t():t,typeof s!="undefined"&&s&&(o.className+=" "+(t?"":"no-")+e),i[e]=t}return i},A(""),a=l=null,function(e,t){function l(e,t){var n=e.createElement("p"),r=e.getElementsByTagName("head")[0]||e.documentElement;return n.innerHTML="x<style>"+t+"</style>",r.insertBefore(n.lastChild,r.firstChild)}function c(){var e=g.elements;return typeof e=="string"?e.split(" "):e}function h(e){var t=a[e[o]];return t||(t={},u++,e[o]=u,a[u]=t),t}function p(e,n,s){n||(n=t);if(f)return n.createElement(e);s||(s=h(n));var o;return s.cache[e]?o=s.cache[e].cloneNode():i.test(e)?o=(s.cache[e]=s.createElem(e)).cloneNode():o=s.createElem(e),o.canHaveChildren&&!r.test(e)?s.frag.appendChild(o):o}function d(e,n){e||(e=t);if(f)return e.createDocumentFragment();n=n||h(e);var r=n.frag.cloneNode(),i=0,s=c(),o=s.length;for(;i<o;i++)r.createElement(s[i]);return r}function v(e,t){t.cache||(t.cache={},t.createElem=e.createElement,t.createFrag=e.createDocumentFragment,t.frag=t.createFrag()),e.createElement=function(n){return g.shivMethods?p(n,e,t):t.createElem(n)},e.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+c().join().replace(/\w+/g,function(e){return t.createElem(e),t.frag.createElement(e),'c("'+e+'")'})+");return n}")(g,t.frag)}function m(e){e||(e=t);var n=h(e);return g.shivCSS&&!s&&!n.hasCSS&&(n.hasCSS=!!l(e,"article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}mark{background:#FF0;color:#000}")),f||v(e,n),e}var n=e.html5||{},r=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,i=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,s,o="_html5shiv",u=0,a={},f;(function(){try{var e=t.createElement("a");e.innerHTML="<xyz></xyz>",s="hidden"in e,f=e.childNodes.length==1||function(){t.createElement("a");var e=t.createDocumentFragment();return typeof e.cloneNode=="undefined"||typeof e.createDocumentFragment=="undefined"||typeof e.createElement=="undefined"}()}catch(n){s=!0,f=!0}})();var g={elements:n.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:n.shivCSS!==!1,supportsUnknownElements:f,shivMethods:n.shivMethods!==!1,type:"default",shivDocument:m,createElement:p,createDocumentFragment:d};e.html5=g,m(t)}(this,t),i._version=r,i._prefixes=p,i._domPrefixes=m,i._cssomPrefixes=v,i.mq=N,i.hasEvent=C,i.testProp=function(e){return D([e])},i.testAllProps=H,i.testStyles=T,i.prefixed=function(e,t,n){return t?H(e,t,n):H(e,"pfx")},o.className=o.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(s?" js "+E.join(" "):""),i}(this,this.document),window.console||(window.console={log:function(){return}});var TD={storage:{},core:{},net:{},mustaches:typeof TD_mustaches=="undefined"?{}:TD_mustaches,templates:{},components:{},services:{},controller:{auth:{}},vo:{},ui:{},sync:{},cache:{}};TD.buildID="d9955aff741236fc87391f127b61eaf1f873614e",TD.buildIDShort="d9955af",TD.version="3.0.5",TD.config={api_root:"https://api.tweetdeck.com",td_create_key:"wDCH6bkOBY1tWlfvFhra",td_create_secret:"/CCPYnccw6SpcCaKf7JdzidTYph13Y5ZZUafFwMBNUU=",client_name:"blackbird",debug_menu:!1,sync_name:"blackbird"},TD.i=function(){var e=/[^A-Za-z0-9_]/g,t={};return function(n,r,i){var s,o,u;return typeof n=="string"&&(n={text:n}),TD.util.i18n.getLocale()==="en_US"?u=n.text:(s=t[n.text],s===undefined&&(s=n.text.replace(e,""),t[n.text]=s),u=TD.util.i18n.getMessage(s)||n.text),i||(u=TD.ui.template.toHtml(u,r)),u}}();var Hogan={};(function(e,t){function n(e,t,n){var r,i;return t&&typeof t=="object"&&(t[e]!=null?r=t[e]:n&&t.get&&typeof t.get=="function"&&(r=t.get(e))),r}function r(e,t,n,r){function i(){}function s(){}i.prototype=e,s.prototype=e.subs;var o,u=new i;u.subs=new s,u.subsText={},u.ib();for(o in t)u.subs[o]=t[o],u.subsText[o]=r;for(o in n)u.partials[o]=n[o];return u}function l(e){return String(e===null||e===undefined?"":e)}function c(e){return e=l(e),f.test(e)?e.replace(i,"&amp;").replace(s,"&lt;").replace(o,"&gt;").replace(u,"&#39;").replace(a,"&quot;"):e}e.Template=function(e,t,n,r){e=e||{},this.r=e.code||this.r,this.c=n,this.options=r||{},this.text=t||"",this.partials=e.partials||{},this.subs=e.subs||{},this.ib()},e.Template.prototype={r:function(e,t,n){return""},v:c,t:l,render:function(t,n,r){return this.ri([t],n||{},r)},ri:function(e,t,n){return this.r(e,t,n)},ep:function(e,t){var n=this.partials[e],i=t[n.name];if(n.instance&&n.base==i)return n.instance;if(typeof i=="string"){if(!this.c)throw new Error("No compiler available.");i=this.c.compile(i,this.options)}return i?(this.partials[e].base=i,n.subs&&(this.activeSub===undefined&&(t.stackText=this.text),i=r(i,n.subs,n.partials,t.stackText||this.text)),this.partials[e].instance=i,i):null},rp:function(e,t,n,r){var i=this.ep(e,n);return i?i.ri(t,n,r):""},rs:function(e,t,n){var r=e[e.length-1];if(!h(r)){n(e,t,this);return}for(var i=0;i<r.length;i++)e.push(r[i]),n(e,t,this),e.pop()},s:function(e,t,n,r,i,s,o){var u;return h(e)&&e.length===0?!1:(typeof e=="function"&&(e=this.ms(e,t,n,r,i,s,o)),u=!!e,!r&&u&&t&&t.push(typeof e=="object"?e:t[t.length-1]),u)},d:function(e,t,r,i){var s,o=e.split("."),u=this.f(o[0],t,r,i),a=this.options.modelGet,f=null;if(e==="."&&h(t[t.length-2]))u=t[t.length-1];else for(var l=1;l<o.length;l++)s=n(o[l],u,a),s!=null?(f=u,u=s):u="";return i&&!u?!1:(!i&&typeof u=="function"&&(t.push(f),u=this.mv(u,t,r),t.pop()),u)},f:function(e,t,r,i){var s=!1,o=null,u=!1,a=this.options.modelGet;for(var f=t.length-1;f>=0;f--){o=t[f],s=n(e,o,a);if(s!=null){u=!0;break}}return u?(!i&&typeof s=="function"&&(s=this.mv(s,t,r)),s):i?!1:""},ls:function(e,t,n,r,i){var s=this.options.delimiters;return this.options.delimiters=i,this.b(this.ct(l(e.call(t,r)),t,n)),this.options.delimiters=s,!1},ct:function(e,t,n){if(this.options.disableLambda)throw new Error("Lambda features disabled.");return this.c.compile(e,this.options).render(t,n)},b:t?function(e){this.buf.push(e)}:function(e){this.buf+=e},fl:t?function(){var e=this.buf.join("");return this.buf=[],e}:function(){var e=this.buf;return this.buf="",e},ib:function(){this.buf=t?[]:""},ms:function(e,t,n,r,i,s,o){var u,a=t[t.length-1],f=e.call(a);return typeof f=="function"?r?!0:(u=this.activeSub&&this.subsText[this.activeSub]?this.subsText[this.activeSub]:this.text,this.ls(f,a,n,u.substring(i,s),o)):f},mv:function(e,t,n){var r=t[t.length-1],i=e.call(r);return typeof i=="function"?this.ct(l(i.call(r)),r,n):i},sub:function(e,t,n,r){var i=this.subs[e];i&&(this.activeSub=e,i(t,n,this,r),this.activeSub=!1)}};var i=/&/g,s=/</g,o=/>/g,u=/\'/g,a=/\"/g,f=/[&<>\"\']/,h=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}})(typeof exports!="undefined"?exports:Hogan),function(e){function o(e){e.n.substr(e.n.length-1)==="}"&&(e.n=e.n.substring(0,e.n.length-1))}function u(e){return e.trim?e.trim():e.replace(/^\s*|\s*$/g,"")}function a(e,t,n){if(t.charAt(n)!=e.charAt(0))return!1;for(var r=1,i=e.length;r<i;r++)if(t.charAt(n+r)!=e.charAt(r))return!1;return!0}function l(t,n,r,i){var s=[],o=null,u=null,a=null;u=r[r.length-1];while(t.length>0){a=t.shift();if(!(!u||u.tag!="<"||a.tag in f))throw new Error("Illegal content in < super tag.");if(e.tags[a.tag]<=e.tags.$||c(a,i))r.push(a),a.nodes=l(t,a.tag,r,i);else{if(a.tag=="/"){if(r.length===0)throw new Error("Closing tag without opener: /"+a.n);o=r.pop();if(a.n!=o.n&&!h(a.n,o.n,i))throw new Error("Nesting error: "+o.n+" vs. "+a.n);return o.end=a.i,s}a.tag=="\n"&&(a.last=t.length==0||t[0].tag=="\n")}s.push(a)}if(r.length>0)throw new Error("missing closing tag: "+r.pop().n);return s}function c(e,t){for(var n=0,r=t.length;n<r;n++)if(t[n].o==e.n)return e.tag="#",!0}function h(e,t,n){for(var r=0,i=n.length;r<i;r++)if(n[r].c==e&&n[r].o==t)return!0}function p(e){var t=[];for(var n in e)t.push('"'+m(n)+'": function(c,p,t,i) {'+e[n]+"}");return"{ "+t.join(",")+" }"}function d(e){var t=[];for(var n in e.partials)t.push('"'+m(n)+'":{name:"'+m(e.partials[n].name)+'", '+d(e.partials[n])+"}");return"partials: {"+t.join(",")+"}, subs: "+p(e.subs)}function m(e){return e.replace(s,"\\\\").replace(n,'\\"').replace(r,"\\n").replace(i,"\\r")}function g(e){return~e.indexOf(".")?"d":"f"}function y(e,t){var n="<"+(t.prefix||""),r=n+e.n+v++;return t.partials[r]={name:e.n,partials:{}},t.code+='t.b(t.rp("'+m(r)+'",c,p,"'+(e.indent||"")+'"));',r}function b(e,t){t.code+="t.b(t.t(t."+g(e.n)+'("'+m(e.n)+'",c,p,0)));'}function w(e){return"t.b("+e+");"}var t=/\S/,n=/\"/g,r=/\n/g,i=/\r/g,s=/\\/g;e.tags={"#":1,"^":2,"<":3,$:4,"/":5,"!":6,">":7,"=":8,_v:9,"{":10,"&":11,_t:12},e.scan=function(r,i){function S(){v.length>0&&(m.push({tag:"_t",text:new String(v)}),v="")}function x(){var n=!0;for(var r=b;r<m.length;r++){n=e.tags[m[r].tag]<e.tags._v||m[r].tag=="_t"&&m[r].text.match(t)===null;if(!n)return!1}return n}function T(e,t){S();if(e&&x())for(var n=b,r;n<m.length;n++)m[n].text&&((r=m[n+1])&&r.tag==">"&&(r.indent=m[n].text.toString()),m.splice(n,1));else t||m.push({tag:"\n"});g=!1,b=m.length}function N(e,t){var n="="+E,r=e.indexOf(n,t),i=u(e.substring(e.indexOf("=",t)+1,r)).split(" ");return w=i[0],E=i[i.length-1],r+n.length-1}var s=r.length,f=0,l=1,c=2,h=f,p=null,d=null,v="",m=[],g=!1,y=0,b=0,w="{{",E="}}";i&&(i=i.split(" "),w=i[0],E=i[1]);for(y=0;y<s;y++)h==f?a(w,r,y)?(--y,S(),h=l):r.charAt(y)=="\n"?T(g):v+=r.charAt(y):h==l?(y+=w.length-1,d=e.tags[r.charAt(y+1)],p=d?r.charAt(y+1):"_v",p=="="?(y=N(r,y),h=f):(d&&y++,h=c),g=y):a(E,r,y)?(m.push({tag:p,n:u(v),otag:w,ctag:E,i:p=="/"?g-w.length:y+E.length}),v="",y+=E.length-1,h=f,p=="{"&&(E=="}}"?y++:o(m[m.length-1]))):v+=r.charAt(y);return T(g,!0),m};var f={_t:!0,"\n":!0,$:!0,"/":!0};e.stringify=function(t,n,r){return"{code: function (c,p,i) { "+e.wrapMain(t.code)+" },"+d(t)+"}"};var v=0;e.generate=function(t,n,r){v=0;var i={code:"",subs:{},partials:{}};return e.walk(t,i),r.asString?this.stringify(i,n,r):this.makeTemplate(i,n,r)},e.wrapMain=function(e){return'var t=this;t.b(i=i||"");'+e+"return t.fl();"},e.template=e.Template,e.makeTemplate=function(e,t,n){var r=this.makePartials(e);return r.code=new Function("c","p","i",this.wrapMain(e.code)),new this.template(r,t,this,n)},e.makePartials=function(e){var t,n={subs:{},partials:e.partials,name:e.name};for(t in n.partials)n.partials[t]=this.makePartials(n.partials[t]);for(t in e.subs)n.subs[t]=new Function("c","p","t","i",e.subs[t]);return n},e.codegen={"#":function(t,n){n.code+="if(t.s(t."+g(t.n)+'("'+m(t.n)+'",c,p,1),'+"c,p,0,"+t.i+","+t.end+',"'+t.otag+" "+t.ctag+'")){'+"t.rs(c,p,"+"function(c,p,t){",e.walk(t.nodes,n),n.code+="});c.pop();}"},"^":function(t,n){n.code+="if(!t.s(t."+g(t.n)+'("'+m(t.n)+'",c,p,1),c,p,1,0,0,"")){',e.walk(t.nodes,n),n.code+="};"},">":y,"<":function(t,n){var r={partials:{},code:"",subs:{},inPartial:!0};e.walk(t.nodes,r);var i=n.partials[y(t,n)];i.subs=r.subs,i.partials=r.partials},$:function(t,n){var r={subs:{},code:"",partials:n.partials,prefix:t.n};e.walk(t.nodes,r),n.subs[t.n]=r.code,n.inPartial||(n.code+='t.sub("'+m(t.n)+'",c,p,i);')},"\n":function(e,t){t.code+=w('"\\n"'+(e.last?"":" + i"))},_v:function(e,t){t.code+="t.b(t.v(t."+g(e.n)+'("'+m(e.n)+'",c,p,0)));'},_t:function(e,t){t.code+=w('"'+m(e.text)+'"')},"{":b,"&":b},e.walk=function(t,n){var r;for(var i=0,s=t.length;i<s;i++)r=e.codegen[t[i].tag],r&&r(t[i],n);return n},e.parse=function(e,t,n){return n=n||{},l(e,"",[],n.sectionTags||[])},e.cache={},e.cacheKey=function(e,t){return[e,!!t.asString,!!t.disableLambda,t.delimiters,!!t.modelGet].join("||")},e.compile=function(t,n){n=n||{};var r=e.cacheKey(t,n),i=this.cache[r];return i?i:(i=this.generate(this.parse(this.scan(t,n.delimiters),t,n),t,n),this.cache[r]=i)}}(typeof exports!="undefined"?exports:Hogan),ScribeTransport.prototype={flush:function(e,t){if(!e||!e.length)return;t===undefined&&(t=!!this.options.sync);if(this.options.useAjax){var n={url:this.options.url,data:$.extend(this.ajaxParams(e),this.options.requestParameters),type:"POST",dataType:"json",async:!t,headers:{"X-Twitter-Polling":!0}};this.options.debug&&(this.options.debugHandler&&(n.success=this.options.debugHandler),n.data.debug="1"),$.ajax(n)}else{var r=this.options.debug?"&debug=1":"";(new Image).src=this.options.url+"?q="+(+(new Date)).toString().slice(-4)+r+"&"+this.imageParams(e)}this.reset()},ajaxParams:function(e){if(typeof e=="string")return{log:"["+e+"]"};var t=this.options.encodeParameters;return t&&typeof t=="function"?t.apply(this,arguments):{log:JSON.stringify(e)}},imageParams:function(e){if(typeof e=="string")return"log=%5B"+e+"%5D";var t=this.options.encodeParameters;return t&&typeof t=="function"?t.apply(this,arguments):"log="+encodeURIComponent(JSON.stringify(e))},reset:function(){this.options.bufferEvents&&(this.skipUnloadFlush=!1,sessionStorage.removeItem(this.options.bufferKey))},getBuffer:function(){return sessionStorage.getItem(this.options.bufferKey)||""},send:function(e,t,n){if(!t||!e||this.options.bufferSize<0)return;e._category_=t;if(n||!this.options.bufferEvents||!this.options.bufferSize)this.flush([e],n);else{var r=JSON.stringify(e);this.options.useAjax||(r=encodeURIComponent(r));var i=this.getBuffer(),s=i+(i?this.SEPARATOR+r:r);this.options.bufferSize&&this.fullBuffer(s)?this.options.useAjax?this.flush(s):(this.flush(i),sessionStorage.setItem(this.options.bufferKey,r)):sessionStorage.setItem(this.options.bufferKey,s)}this.options.debug&&$(document).trigger("scribedata."+this.options.bufferKey,e),this.options.metrics&&e.event_info!="debug"&&$(document).trigger("debugscribe",e)},fullBuffer:function(e){return e.length>=(this.options.useAjax?this.options.bufferSize*2083:2050-this.options.url.length)},updateOptions:function(e){this.options=$.extend({},this.options,e),this.options.requestParameters||(this.options.requestParameters={}),this.options.flushOnUnload===undefined&&(this.options.flushOnUnload=!0),this.options.bufferKey||(this.options.bufferKey=this.SESSION_BUFFER_KEY),this.options.bufferSize===0&&(this.options.bufferEvents=!1),this.options.useAjax===undefined&&(this.options.useAjax=!0);if(this.options.bufferEvents||this.options.bufferEvents==undefined)try{sessionStorage.setItem(this.SESSION_BUFFER_KEY+".init","test");var t=sessionStorage.getItem(this.SESSION_BUFFER_KEY+".init")=="test";sessionStorage.removeItem(this.SESSION_BUFFER_KEY+".init"),this.options.bufferEvents=t}catch(n){this.options.bufferEvents=!1}if(this.options.debug&&!this.options.debugHandler){var r=this;this.options.debugHandler=e.debugHandler||function(e){$(document).trigger("handlescribe."+r.options.bufferKey,e)}}var i=window.location.protocol==="https:"?"https:":"http:";this.options.url===undefined?this.options.useAjax?this.options.url=this.SCRIBE_API_ENDPOINT:this.options.url="https://twitter.com"+this.SCRIBE_API_ENDPOINT:this.options.url=this.options.url.replace(/^[a-z]+:/g,i).replace(/\/$/,""),this.options.bufferEvents&&this.options.bufferSize===undefined&&(this.options.bufferSize=20)},appHost:function(){return window.location.host},registerEventHandlers:function(){var e=this,t=$(document);if(this.options.bufferEvents){t.on("flushscribe."+e.options.bufferKey,function(t){e.flush(e.getBuffer(),!0)});if(this.options.flushOnUnload){var n=function(t){e.skipUnloadFlush=!t||!t.match(/http/)||!!t.match(new RegExp("^https?://"+e.appHost(),"gi")),e.skipUnloadFlush&&window.setTimeout(function(){e.skipUnloadFlush=!1},3e3)};t.on("mouseup."+this.options.bufferKey,"a",function(e){if(this.getAttribute("target")||e.button||e.metaKey||e.shiftKey||e.altKey||e.ctrlKey)return;n(this.getAttribute("href"))}),t.on("submit."+this.options.bufferKey,"form",function(e){n(this.getAttribute("action"))}),t.on("uiNavigate."+this.options.bufferKey,function(e,t){n(t.url)}),$(window).on("unload."+this.options.bufferKey,function(){e.skipUnloadFlush||e.flush(e.getBuffer(),!0),e.skipUnloadFlush=!1})}}this.SEPARATOR=this.options.useAjax?",":encodeURIComponent(",")},destroy:function(){this.flush(this.getBuffer()),$(document).off("flushscribe."+this.options.bufferKey),$(window).off("unload."+this.options.bufferKey),$(document).off("mouseup."+this.options.bufferKey),$(document).off("submit."+this.options.bufferKey),$(document).off("uiNavigate."+this.options.bufferKey)}},function(e,t){function n(e){return B.isWindow(e)?e:e.nodeType===9?e.defaultView||e.parentWindow:!1}function r(e){if(!mn[e]){var t=D.body,n=B("<"+e+">").appendTo(t),r=n.css("display");n.remove();if(r==="none"||r===""){gn||(gn=D.createElement("iframe"),gn.frameBorder=gn.width=gn.height=0),t.appendChild(gn);if(!yn||!gn.createElement)yn=(gn.contentWindow||gn.contentDocument).document,yn.write((D.compatMode==="CSS1Compat"?"<!doctype html>":"")+"<html><body>"),yn.close();n=yn.createElement(e),yn.body.appendChild(n),r=B.css(n,"display"),t.removeChild(gn)}mn[e]=r}return mn[e]}function i(e,t){var n={};return B.each(Sn.concat.apply([],Sn.slice(0,t)),function(){n[this]=e}),n}function s(){xn=t}function o(){return setTimeout(s,0),xn=B.now()}function u(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function a(){try{return new e.XMLHttpRequest}catch(t){}}function f(e,n){e.dataFilter&&(n=e.dataFilter(n,e.dataType));var r=e.dataTypes,i={},s,o,u=r.length,a,f=r[0],l,c,h,p,d;for(s=1;s<u;s++){if(s===1)for(o in e.converters)typeof o=="string"&&(i[o.toLowerCase()]=e.converters[o]);l=f,f=r[s];if(f==="*")f=l;else if(l!=="*"&&l!==f){c=l+" "+f,h=i[c]||i["* "+f];if(!h){d=t;for(p in i){a=p.split(" ");if(a[0]===l||a[0]==="*"){d=i[a[1]+" "+f];if(d){p=i[p],p===!0?h=d:d===!0&&(h=p);break}}}}!h&&!d&&B.error("No conversion from "+c.replace(" "," to ")),h!==!0&&(n=h?h(n):d(p(n)))}}return n}function l(e,n,r){var i=e.contents,s=e.dataTypes,o=e.responseFields,u,a,f,l;for(a in o)a in r&&(n[o[a]]=r[a]);while(s[0]==="*")s.shift(),u===t&&(u=e.mimeType||n.getResponseHeader("content-type"));if(u)for(a in i)if(i[a]&&i[a].test(u)){s.unshift(a);break}if(s[0]in r)f=s[0];else{for(a in r){if(!s[0]||e.converters[a+" "+s[0]]){f=a;break}l||(l=a)}f=f||l}if(f)return f!==s[0]&&s.unshift(f),r[f]}function c(e,t,n,r){if(B.isArray(t))B.each(t,function(t,i){n||zt.test(e)?r(e,i):c(e+"["+(typeof i=="object"||B.isArray(i)?t:"")+"]",i,n,r)});else if(!n&&t!=null&&typeof t=="object")for(var i in t)c(e+"["+i+"]",t[i],n,r);else r(e,t)}function h(e,n){var r,i,s=B.ajaxSettings.flatOptions||{};for(r in n)n[r]!==t&&((s[r]?e:i||(i={}))[r]=n[r]);i&&B.extend(!0,e,i)}function p(e,n,r,i,s,o){s=s||n.dataTypes[0],o=o||{},o[s]=!0;var u=e[s],a=0,f=u?u.length:0,l=e===sn,c;for(;a<f&&(l||!c);a++)c=u[a](n,r,i),typeof c=="string"&&(!l||o[c]?c=t:(n.dataTypes.unshift(c),c=p(e,n,r,i,c,o)));return(l||!c)&&!o["*"]&&(c=p(e,n,r,i,"*",o)),c}function d(e){return function(t,n){typeof t!="string"&&(n=t,t="*");if(B.isFunction(n)){var r=t.toLowerCase().split(en),i=0,s=r.length,o,u,a;for(;i<s;i++)o=r[i],a=/^\+/.test(o),a&&(o=o.substr(1)||"*"),u=e[o]=e[o]||[],u[a?"unshift":"push"](n)}}}function v(e,t,n){var r=t==="width"?e.offsetWidth:e.offsetHeight,i=t==="width"?jt:Ft,s=0,o=i.length;if(r>0){if(n!=="border")for(;s<o;s++)n||(r-=parseFloat(B.css(e,"padding"+i[s]))||0),n==="margin"?r+=parseFloat(B.css(e,n+i[s]))||0:r-=parseFloat(B.css(e,"border"+i[s]+"Width"))||0;return r+"px"}r=It(e,t,t);if(r<0||r==null)r=e.style[t]||0;r=parseFloat(r)||0;if(n)for(;s<o;s++)r+=parseFloat(B.css(e,"padding"+i[s]))||0,n!=="padding"&&(r+=parseFloat(B.css(e,"border"+i[s]+"Width"))||0),n==="margin"&&(r+=parseFloat(B.css(e,n+i[s]))||0);return r+"px"}function m(e,t){t.src?B.ajax({url:t.src,async:!1,dataType:"script"}):B.globalEval((t.text||t.textContent||t.innerHTML||"").replace(kt,"/*$0*/")),t.parentNode&&t.parentNode.removeChild(t)}function g(e){var t=D.createElement("div");return At.appendChild(t),t.innerHTML=e.outerHTML,t.firstChild}function y(e){var t=(e.nodeName||"").toLowerCase();t==="input"?b(e):t!=="script"&&typeof e.getElementsByTagName!="undefined"&&B.grep(e.getElementsByTagName("input"),b)}function b(e){if(e.type==="checkbox"||e.type==="radio")e.defaultChecked=e.checked}function w(e){return typeof e.getElementsByTagName!="undefined"?e.getElementsByTagName("*"):typeof e.querySelectorAll!="undefined"?e.querySelectorAll("*"):[]}function E(e,t){var n;if(t.nodeType===1){t.clearAttributes&&t.clearAttributes(),t.mergeAttributes&&t.mergeAttributes(e),n=t.nodeName.toLowerCase();if(n==="object")t.outerHTML=e.outerHTML;else if(n!=="input"||e.type!=="checkbox"&&e.type!=="radio"){if(n==="option")t.selected=e.defaultSelected;else if(n==="input"||n==="textarea")t.defaultValue=e.defaultValue}else e.checked&&(t.defaultChecked=t.checked=e.checked),t.value!==e.value&&(t.value=e.value);t.removeAttribute(B.expando)}}function S(e,t){if(t.nodeType===1&&!!B.hasData(e)){var n,r,i,s=B._data(e),o=B._data(t,s),u=s.events;if(u){delete o.handle,o.events={};for(n in u)for(r=0,i=u[n].length;r<i;r++)B.event.add(t,n+(u[n][r].namespace?".":"")+u[n][r].namespace,u[n][r],u[n][r].data)}o.data&&(o.data=B.extend({},o.data))}}function x(e,t){return B.nodeName(e,"table")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function T(e){var t=vt.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}function N(e,t,n){t=t||0;if(B.isFunction(t))return B.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n});if(t.nodeType)return B.grep(e,function(e,r){return e===t===n});if(typeof t=="string"){var r=B.grep(e,function(e){return e.nodeType===1});if(ct.test(t))return B.filter(t,r,!n);t=B.filter(t,r)}return B.grep(e,function(e,r){return B.inArray(e,t)>=0===n})}function C(e){return!e||!e.parentNode||e.parentNode.nodeType===11}function k(){return!0}function L(){return!1}function A(e,t,n){var r=t+"defer",i=t+"queue",s=t+"mark",o=B._data(e,r);o&&(n==="queue"||!B._data(e,i))&&(n==="mark"||!B._data(e,s))&&setTimeout(function(){!B._data(e,i)&&!B._data(e,s)&&(B.removeData(e,r,!0),o.fire())},0)}function O(e){for(var t in e){if(t==="data"&&B.isEmptyObject(e[t]))continue;if(t!=="toJSON")return!1}return!0}function M(e,n,r){if(r===t&&e.nodeType===1){var i="data-"+n.replace(q,"-$1").toLowerCase();r=e.getAttribute(i);if(typeof r=="string"){try{r=r==="true"?!0:r==="false"?!1:r==="null"?null:B.isNumeric(r)?parseFloat(r):I.test(r)?B.parseJSON(r):r}catch(s){}B.data(e,n,r)}else r=t}return r}function _(e){var t=j[e]={},n,r;e=e.split(/\s+/);for(n=0,r=e.length;n<r;n++)t[e[n]]=!0;return t}var D=e.document,P=e.navigator,H=e.location,B=function(){function n(){if(!r.isReady){try{D.documentElement.doScroll("left")}catch(e){setTimeout(n,1);return}r.ready()}}var r=function(e,t){return new r.fn.init(e,t,o)},i=e.jQuery,s=e.$,o,u=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,a=/\S/,f=/^\s+/,l=/\s+$/,c=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,h=/^[\],:{}\s]*$/,p=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,d=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,v=/(?:^|:|,)(?:\s*\[)+/g,m=/(webkit)[ \/]([\w.]+)/,g=/(opera)(?:.*version)?[ \/]([\w.]+)/,y=/(msie) ([\w.]+)/,b=/(mozilla)(?:.*? rv:([\w.]+))?/,w=/-([a-z]|[0-9])/ig,E=/^-ms-/,S=function(e,t){return(t+"").toUpperCase()},x=P.userAgent,T,N,C,k=Object.prototype.toString,L=Object.prototype.hasOwnProperty,A=Array.prototype.push,O=Array.prototype.slice,M=String.prototype.trim,_=Array.prototype.indexOf,H={};return r.fn=r.prototype={constructor:r,init:function(e,n,i){var s,o,a,f;if(!e)return this;if(e.nodeType)return this.context=this[0]=e,this.length=1,this;if(e==="body"&&!n&&D.body)return this.context=D,this[0]=D.body,this.selector=e,this.length=1,this;if(typeof e=="string"){e.charAt(0)!=="<"||e.charAt(e.length-1)!==">"||e.length<3?s=u.exec(e):s=[null,e,null];if(s&&(s[1]||!n)){if(s[1])return n=n instanceof r?n[0]:n,f=n?n.ownerDocument||n:D,a=c.exec(e),a?r.isPlainObject(n)?(e=[D.createElement(a[1])],r.fn.attr.call(e,n,!0)):e=[f.createElement(a[1])]:(a=r.buildFragment([s[1]],[f]),e=(a.cacheable?r.clone(a.fragment):a.fragment).childNodes),r.merge(this,e);o=D.getElementById(s[2]);if(o&&o.parentNode){if(o.id!==s[2])return i.find(e);this.length=1,this[0]=o}return this.context=D,this.selector=e,this}return!n||n.jquery?(n||i).find(e):this.constructor(n).find(e)}return r.isFunction(e)?i.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),r.makeArray(e,this))},selector:"",jquery:"1.7.1",length:0,size:function(){return this.length},toArray:function(){return O.call(this,0)},get:function(e){return e==null?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e,t,n){var i=this.constructor();return r.isArray(e)?A.apply(i,e):r.merge(i,e),i.prevObject=this,i.context=this.context,t==="find"?i.selector=this.selector+(this.selector?" ":"")+n:t&&(i.selector=this.selector+"."+t+"("+n+")"),i},each:function(e,t){return r.each(this,e,t)},ready:function(e){return r.bindReady(),N.add(e),this},eq:function(e){return e=+e,e===-1?this.slice(e):this.slice(e,e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(O.apply(this,arguments),"slice",O.call(arguments).join(","))},map:function(e){return this.pushStack(r.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:A,sort:[].sort,splice:[].splice},r.fn.init.prototype=r.fn,r.extend=r.fn.extend=function(){var e,n,i,s,o,u,a=arguments[0]||{},f=1,l=arguments.length,c=!1;typeof a=="boolean"&&(c=a,a=arguments[1]||{},f=2),typeof a!="object"&&!r.isFunction(a)&&(a={}),l===f&&(a=this,--f);for(;f<l;f++)if((e=arguments[f])!=null)for(n in e){i=a[n],s=e[n];if(a===s)continue;c&&s&&(r.isPlainObject(s)||(o=r.isArray(s)))?(o?(o=!1,u=i&&r.isArray(i)?i:[]):u=i&&r.isPlainObject(i)?i:{},a[n]=r.extend(c,u,s)):s!==t&&(a[n]=s)}return a},r.extend({noConflict:function(t){return e.$===r&&(e.$=s),t&&e.jQuery===r&&(e.jQuery=i),r},isReady:!1,readyWait:1,holdReady:function(e){e?r.readyWait++:r.ready(!0)},ready:function(e){if(e===!0&&!--r.readyWait||e!==!0&&!r.isReady){if(!D.body)return setTimeout(r.ready,1);r.isReady=!0;if(e!==!0&&--r.readyWait>0)return;N.fireWith(D,[r]),r.fn.trigger&&r(D).trigger("ready").off("ready")}},bindReady:function(){if(!N){N=r.Callbacks("once memory");if(D.readyState==="complete")return setTimeout(r.ready,1);if(D.addEventListener)D.addEventListener("DOMContentLoaded",C,!1),e.addEventListener("load",r.ready,!1);else if(D.attachEvent){D.attachEvent("onreadystatechange",C),e.attachEvent("onload",r.ready);var t=!1;try{t=e.frameElement==null}catch(i){}D.documentElement.doScroll&&t&&n()}}},isFunction:function(e){return r.type(e)==="function"},isArray:Array.isArray||function(e){return r.type(e)==="array"},isWindow:function(e){return e&&typeof e=="object"&&"setInterval"in e},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return e==null?String(e):H[k.call(e)]||"object"},isPlainObject:function(e){if(!e||r.type(e)!=="object"||e.nodeType||r.isWindow(e))return!1;try{if(e.constructor&&!L.call(e,"constructor")&&!L.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var i;for(i in e);return i===t||L.call(e,i)},isEmptyObject:function(e){for(var t in e)return!1;return!0},error:function(e){throw new Error(e)},parseJSON:function(t){if(typeof t!="string"||!t)return null;t=r.trim(t);if(e.JSON&&e.JSON.parse)return e.JSON.parse(t);if(h.test(t.replace(p,"@").replace(d,"]").replace(v,"")))return(new Function("return "+t))();r.error("Invalid JSON: "+t)},parseXML:function(n){var i,s;try{e.DOMParser?(s=new DOMParser,i=s.parseFromString(n,"text/xml")):(i=new ActiveXObject("Microsoft.XMLDOM"),i.async="false",i.loadXML(n))}catch(o){i=t}return(!i||!i.documentElement||i.getElementsByTagName("parsererror").length)&&r.error("Invalid XML: "+n),i},noop:function(){},globalEval:function(t){t&&a.test(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(E,"ms-").replace(w,S)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toUpperCase()===t.toUpperCase()},each:function(e,n,i){var s,o=0,u=e.length,a=u===t||r.isFunction(e);if(i){if(a){for(s in e)if(n.apply(e[s],i)===!1)break}else for(;o<u;)if(n.apply(e[o++],i)===!1)break}else if(a){for(s in e)if(n.call(e[s],s,e[s])===!1)break}else for(;o<u;)if(n.call(e[o],o,e[o++])===!1)break;return e},trim:M?function(e){return e==null?"":M.call(e)}:function(e){return e==null?"":(e+"").replace(f,"").replace(l,"")},makeArray:function(e,t){var n=t||[];if(e!=null){var i=r.type(e);e.length==null||i==="string"||i==="function"||i==="regexp"||r.isWindow(e)?A.call(n,e):r.merge(n,e)}return n},inArray:function(e,t,n){var r;if(t){if(_)return _.call(t,e,n);r=t.length,n=n?n<0?Math.max(0,r+n):n:0;for(;n<r;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=e.length,i=0;if(typeof n.length=="number")for(var s=n.length;i<s;i++)e[r++]=n[i];else while(n[i]!==t)e[r++]=n[i++];return e.length=r,e},grep:function(e,t,n){var r=[],i;n=!!n;for(var s=0,o=e.length;s<o;s++)i=!!t(e[s],s),n!==i&&r.push(e[s]);return r},map:function(e,n,i){var s,o,u=[],a=0,f=e.length,l=e instanceof r||f!==t&&typeof f=="number"&&(f>0&&e[0]&&e[f-1]||f===0||r.isArray(e));if(l)for(;a<f;a++)s=n(e[a],a,i),s!=null&&(u[u.length]=s);else for(o in e)s=n(e[o],o,i),s!=null&&(u[u.length]=s);return u.concat.apply([],u)},guid:1,proxy:function(e,n){if(typeof n=="string"){var i=e[n];n=e,e=i}if(!r.isFunction(e))return t;var s=O.call(arguments,2),o=function(){return e.apply(n,s.concat(O.call(arguments)))};return o.guid=e.guid=e.guid||o.guid||r.guid++,o},access:function(e,n,i,s,o,u){var a=e.length;if(typeof n=="object"){for(var f in n)r.access(e,f,n[f],s,o,i);return e}if(i!==t){s=!u&&s&&r.isFunction(i);for(var l=0;l<a;l++)o(e[l],n,s?i.call(e[l],l,o(e[l],n)):i,u);return e}return a?o(e[0],n):t},now:function(){return(new Date).getTime()},uaMatch:function(e){e=e.toLowerCase();var t=m.exec(e)||g.exec(e)||y.exec(e)||e.indexOf("compatible")<0&&b.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},sub:function(){function e(t,n){return new e.fn.init(t,n)}r.extend(!0,e,this),e.superclass=this,e.fn=e.prototype=this(),e.fn.constructor=e,e.sub=this.sub,e.fn.init=function(n,i){return i&&i instanceof r&&!(i instanceof e)&&(i=e(i)),r.fn.init.call(this,n,i,t)},e.fn.init.prototype=e.fn;var t=e(D);return e},browser:{}}),r.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(e,t){H["[object "+t+"]"]=t.toLowerCase()}),T=r.uaMatch(x),T.browser&&(r.browser[T.browser]=!0,r.browser.version=T.version),r.browser.webkit&&(r.browser.safari=!0),a.test("Â ")&&(f=/^[\s\xA0]+/,l=/[\s\xA0]+$/),o=r(D),D.addEventListener?C=function(){D.removeEventListener("DOMContentLoaded",C,!1),r.ready()}:D.attachEvent&&(C=function(){D.readyState==="complete"&&(D.detachEvent("onreadystatechange",C),r.ready())}),r}(),j={};B.Callbacks=function(e){e=e?j[e]||_(e):{};var n=[],r=[],i,s,o,u,a,f=function(t){var r,i,s,o,u;for(r=0,i=t.length;r<i;r++)s=t[r],o=B.type(s),o==="array"?f(s):o==="function"&&(!e.unique||!c.has(s))&&n.push(s)},l=function(t,f){f=f||[],i=!e.memory||[t,f],s=!0,a=o||0,o=0,u=n.length;for(;n&&a<u;a++)if(n[a].apply(t,f)===!1&&e.stopOnFalse){i=!0;break}s=!1,n&&(e.once?i===!0?c.disable():n=[]:r&&r.length&&(i=r.shift(),c.fireWith(i[0],i[1])))},c={add:function(){if(n){var e=n.length;f(arguments),s?u=n.length:i&&i!==!0&&(o=e,l(i[0],i[1]))}return this},remove:function(){if(n){var t=arguments,r=0,i=t.length;for(;r<i;r++)for(var o=0;o<n.length;o++)if(t[r]===n[o]){s&&o<=u&&(u--,o<=a&&a--),n.splice(o--,1);if(e.unique)break}}return this},has:function(e){if(n){var t=0,r=n.length;for(;t<r;t++)if(e===n[t])return!0}return!1},empty:function(){return n=[],this},disable:function(){return n=r=i=t,this},disabled:function(){return!n},lock:function(){return r=t,(!i||i===!0)&&c.disable(),this},locked:function(){return!r},fireWith:function(t,n){return r&&(s?e.once||r.push([t,n]):(!e.once||!i)&&l(t,n)),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!i}};return c};var F=[].slice;B.extend({Deferred:function(e){var t=B.Callbacks("once memory"),n=B.Callbacks("once memory"),r=B.Callbacks("memory"),i="pending",s={resolve:t,reject:n,notify:r},o={done:t.add,fail:n.add,progress:r.add,state:function(){return i},isResolved:t.fired,isRejected:n.fired,then:function(e,t,n){return u.done(e).fail(t).progress(n),this},always:function(){return u.done.apply(u,arguments).fail.apply(u,arguments),this},pipe:function(e,t,n){return B.Deferred(function(r){B.each({done:[e,"resolve"],fail:[t,"reject"],progress:[n,"notify"]},function(e,t){var n=t[0],i=t[1],s;B.isFunction(n)?u[e](function(){s=n.apply(this,arguments),s&&B.isFunction(s.promise)?s.promise().then(r.resolve,r.reject,r.notify):r[i+"With"](this===u?r:this,[s])}):u[e](r[i])})}).promise()},promise:function(e){if(e==null)e=o;else for(var t in o)e[t]=o[t];return e}},u=o.promise({}),a;for(a in s)u[a]=s[a].fire,u[a+"With"]=s[a].fireWith;return u.done(function(){i="resolved"},n.disable,r.lock).fail(function(){i="rejected"},t.disable,r.lock),e&&e.call(u,u),u},when:function(e){function t(e){return function(t){o[e]=arguments.length>1?F.call(arguments,0):t,f.notifyWith(l,o)}}function n(e){return function(t){r[e]=arguments.length>1?F.call(arguments,0):t,--u||f.resolveWith(f,r)}}var r=F.call(arguments,0),i=0,s=r.length,o=Array(s),u=s,a=s,f=s<=1&&e&&B.isFunction(e.promise)?e:B.Deferred(),l=f.promise();if(s>1){for(;i<s;i++)r[i]&&r[i].promise&&B.isFunction(r[i].promise)?r[i].promise().then(n(i),f.reject,t(i)):--u;u||f.resolveWith(f,r)}else f!==e&&f.resolveWith(f,s?[e]:[]);return l}}),B.support=function(){var t,n,r,i,s,o,u,a,f,l,c,h,p,d=D.createElement("div"),v=D.documentElement;d.setAttribute("className","t"),d.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",n=d.getElementsByTagName("*"),r=d.getElementsByTagName("a")[0];if(!n||!n.length||!r)return{};i=D.createElement("select"),s=i.appendChild(D.createElement("option")),o=d.getElementsByTagName("input")[0],t={leadingWhitespace:d.firstChild.nodeType===3,tbody:!d.getElementsByTagName("tbody").length,htmlSerialize:!!d.getElementsByTagName("link").length,style:/top/.test(r.getAttribute("style")),hrefNormalized:r.getAttribute("href")==="/a",opacity:/^0.55/.test(r.style.opacity),cssFloat:!!r.style.cssFloat,checkOn:o.value==="on",optSelected:s.selected,getSetAttribute:d.className!=="t",enctype:!!D.createElement("form").enctype,html5Clone:D.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0},o.checked=!0,t.noCloneChecked=o.cloneNode(!0).checked,i.disabled=!0,t.optDisabled=!s.disabled;try{delete d.test}catch(m){t.deleteExpando=!1}!d.addEventListener&&d.attachEvent&&d.fireEvent&&(d.attachEvent("onclick",function(){t.noCloneEvent=!1}),d.cloneNode(!0).fireEvent("onclick")),o=D.createElement("input"),o.value="t",o.setAttribute("type","radio"),t.radioValue=o.value==="t",o.setAttribute("checked","checked"),d.appendChild(o),a=D.createDocumentFragment(),a.appendChild(d.lastChild),t.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,t.appendChecked=o.checked,a.removeChild(o),a.appendChild(d),d.innerHTML="",e.getComputedStyle&&(u=D.createElement("div"),u.style.width="0",u.style.marginRight="0",d.style.width="2px",d.appendChild(u),t.reliableMarginRight=(parseInt((e.getComputedStyle(u,null)||{marginRight:0}).marginRight,10)||0)===0);if(d.attachEvent)for(h in{submit:1,change:1,focusin:1})c="on"+h,p=c in d,p||(d.setAttribute(c,"return;"),p=typeof d[c]=="function"),t[h+"Bubbles"]=p;return a.removeChild(d),a=i=s=u=d=o=null,B(function(){var e,n,r,i,s,o,u,a,l,c,h,v=D.getElementsByTagName("body")[0];!v||(u=1,a="position:absolute;top:0;left:0;width:1px;height:1px;margin:0;",l="visibility:hidden;border:0;",c="style='"+a+"border:5px solid #000;padding:0;'",h="<div "+c+"><div></div></div>"+"<table "+c+" cellpadding='0' cellspacing='0'>"+"<tr><td></td></tr></table>",e=D.createElement("div"),e.style.cssText=l+"width:0;height:0;position:static;top:0;margin-top:"+u+"px",v.insertBefore(e,v.firstChild),d=D.createElement("div"),e.appendChild(d),d.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>",f=d.getElementsByTagName("td"),p=f[0].offsetHeight===0,f[0].style.display="",f[1].style.display="none",t.reliableHiddenOffsets=p&&f[0].offsetHeight===0,d.innerHTML="",d.style.width=d.style.paddingLeft="1px",B.boxModel=t.boxModel=d.offsetWidth===2,typeof d.style.zoom!="undefined"&&(d.style.display="inline",d.style.zoom=1,t.inlineBlockNeedsLayout=d.offsetWidth===2,d.style.display="",d.innerHTML="<div style='width:4px;'></div>",t.shrinkWrapBlocks=d.offsetWidth!==2),d.style.cssText=a+l,d.innerHTML=h,n=d.firstChild,r=n.firstChild,s=n.nextSibling.firstChild.firstChild,o={doesNotAddBorder:r.offsetTop!==5,doesAddBorderForTableAndCells:s.offsetTop===5},r.style.position="fixed",r.style.top="20px",o.fixedPosition=r.offsetTop===20||r.offsetTop===15,r.style.position=r.style.top="",n.style.overflow="hidden",n.style.position="relative",o.subtractsBorderForOverflowNotVisible=r.offsetTop===-5,o.doesNotIncludeMarginInBodyOffset=v.offsetTop!==u,v.removeChild(e),d=e=null,B.extend(t,o))}),t}();var I=/^(?:\{.*\}|\[.*\])$/,q=/([A-Z])/g;B.extend({cache:{},uuid:0,expando:"jQuery"+(B.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?B.cache[e[B.expando]]:e[B.expando],!!e&&!O(e)},data:function(e,n,r,i){if(!!B.acceptData(e)){var s,o,u,a=B.expando,f=typeof n=="string",l=e.nodeType,c=l?B.cache:e,h=l?e[a]:e[a]&&a,p=n==="events";if((!h||!c[h]||!p&&!i&&!c[h].data)&&f&&r===t)return;h||(l?e[a]=h=++B.uuid:h=a),c[h]||(c[h]={},l||(c[h].toJSON=B.noop));if(typeof n=="object"||typeof n=="function")i?c[h]=B.extend(c[h],n):c[h].data=B.extend(c[h].data,n);return s=o=c[h],i||(o.data||(o.data={}),o=o.data),r!==t&&(o[B.camelCase(n)]=r),p&&!o[n]?s.events:(f?(u=o[n],u==null&&(u=o[B.camelCase(n)])):u=o,u)}},removeData:function(e,t,n){if(!!B.acceptData(e)){var r,i,s,o=B.expando,u=e.nodeType,a=u?B.cache:e,f=u?e[o]:o;if(!a[f])return;if(t){r=n?a[f]:a[f].data;if(r){B.isArray(t)||(t in r?t=[t]:(t=B.camelCase(t),t in r?t=[t]:t=t.split(" ")));for(i=0,s=t.length;i<s;i++)delete r[t[i]];if(!(n?O:B.isEmptyObject)(r))return}}if(!n){delete a[f].data;if(!O(a[f]))return}B.support.deleteExpando||!a.setInterval?delete a[f]:a[f]=null,u&&(B.support.deleteExpando?delete e[o]:e.removeAttribute?e.removeAttribute(o):e[o]=null)}},_data:function(e,t,n){return B.data(e,t,n,!0)},acceptData:function(e){if(e.nodeName){var t=B.noData[e.nodeName.toLowerCase()];if(t)return t!==!0&&e.getAttribute("classid")===t}return!0}}),B.fn.extend({data:function(e,n){var r,i,s,o=null;if(typeof e=="undefined"){if(this.length){o=B.data(this[0]);if(this[0].nodeType===1&&!B._data(this[0],"parsedAttrs")){i=this[0].attributes;for(var u=0,a=i.length;u<a;u++)s=i[u].name,s.indexOf("data-")===0&&(s=B.camelCase(s.substring(5)),M(this[0],s,o[s]));B._data(this[0],"parsedAttrs",!0)}}return o}return typeof e=="object"?this.each(function(){B.data(this,e)}):(r=e.split("."),r[1]=r[1]?"."+r[1]:"",n===t?(o=this.triggerHandler("getData"+r[1]+"!",[r[0]]),o===t&&this.length&&(o=B.data(this[0],e),o=M(this[0],e,o)),o===t&&r[1]?this.data(r[0]):o):this.each(function(){var t=B(this),i=[r[0],n];t.triggerHandler("setData"+r[1]+"!",i),B.data(this,e,n),t.triggerHandler("changeData"+r[1]+"!",i)}))},removeData:function(e){return this.each(function(){B.removeData(this,e)})}}),B.extend({_mark:function(e,t){e&&(t=(t||"fx")+"mark",B._data(e,t,(B._data(e,t)||0)+1))},_unmark:function(e,t,n){e!==!0&&(n=t,t=e,e=!1);if(t){n=n||"fx";var r=n+"mark",i=e?0:(B._data(t,r)||1)-1;i?B._data(t,r,i):(B.removeData(t,r,!0),A(t,n,"mark"))}},queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=B._data(e,t),n&&(!r||B.isArray(n)?r=B._data(e,t,B.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=B.queue(e,t),r=n.shift(),i={};r==="inprogress"&&(r=n.shift()),r&&(t==="fx"&&n.unshift("inprogress"),B._data(e,t+".run",i),r.call(e,function(){B.dequeue(e,t)},i)),n.length||(B.removeData(e,t+"queue "+t+".run",!0),A(e,t,"queue"))}}),B.fn.extend({queue:function(e,n){return typeof e!="string"&&(n=e,e="fx"),n===t?B.queue(this[0],e):this.each(function(){var t=B.queue(this,e,n);e==="fx"&&t[0]!=="inprogress"&&B.dequeue(this,e)})},dequeue:function(e){return this.each(function(){B.dequeue(this,e)})},delay:function(e,t){return e=B.fx?B.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){function r(){--u||i.resolveWith(s,[s])}typeof e!="string"&&(n=e,e=t),e=e||"fx";var i=B.Deferred(),s=this,o=s.length,u=1,a=e+"defer",f=e+"queue",l=e+"mark",c;while(o--)if(c=B.data(s[o],a,t,!0)||(B.data(s[o],f,t,!0)||B.data(s[o],l,t,!0))&&B.data(s[o],a,B.Callbacks("once memory"),!0))u++,c.add(r);return r(),i.promise()}});var R=/[\n\t\r]/g,U=/\s+/,z=/\r/g,W=/^(?:button|input)$/i,X=/^(?:button|input|object|select|textarea)$/i,V=/^a(?:rea)?$/i,$=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,J=B.support.getSetAttribute,K,Q,G;B.fn.extend({attr:function(e,t){return B.access(this,e,t,!0,B.attr)},removeAttr:function(e){return this.each(function(){B.removeAttr(this,e)})},prop:function(e,t){return B.access(this,e,t,!0,B.prop)},removeProp:function(e){return e=B.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,s,o,u;if(B.isFunction(e))return this.each(function(t){B(this).addClass(e.call(this,t,this.className))});if(e&&typeof e=="string"){t=e.split(U);for(n=0,r=this.length;n<r;n++){i=this[n];if(i.nodeType===1)if(!i.className&&t.length===1)i.className=e;else{s=" "+i.className+" ";for(o=0,u=t.length;o<u;o++)~s.indexOf(" "+t[o]+" ")||(s+=t[o]+" ");i.className=B.trim(s)}}}return this},removeClass:function(e){var n,r,i,s,o,u,a;if(B.isFunction(e))return this.each(function(t){B(this).removeClass(e.call(this,t,this.className))});if(e&&typeof e=="string"||e===t){n=(e||"").split(U);for(r=0,i=this.length;r<i;r++){s=this[r];if(s.nodeType===1&&s.className)if(e){o=(" "+s.className+" ").replace(R," ");for(u=0,a=n.length;u<a;u++)o=o.replace(" "+n[u]+" "," ");s.className=B.trim(o)}else s.className=""}}return this},toggleClass:function(e,t){var n=typeof e,r=typeof t=="boolean";return B.isFunction(e)?this.each(function(n){B(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if(n==="string"){var i,s=0,o=B(this),u=t,a=e.split(U);while(i=a[s++])u=r?u:!o.hasClass(i),o[u?"addClass":"removeClass"](i)}else if(n==="undefined"||n==="boolean")this.className&&B._data(this,"__className__",this.className),this.className=this.className||e===!1?"":B._data(this,"__className__")||""})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;n<r;n++)if(this[n].nodeType===1&&(" "+this[n].className+" ").replace(R," ").indexOf(t)>-1)return!0;return!1},val:function(e){var n,r,i,s=this[0];if(!!arguments.length)return i=B.isFunction(e),this.each(function(r){var s=B(this),o;if(this.nodeType===1){i?o=e.call(this,r,s.val()):o=e,o==null?o="":typeof o=="number"?o+="":B.isArray(o)&&(o=B.map(o,function(e){return e==null?"":e+""})),n=B.valHooks[this.nodeName.toLowerCase()]||B.valHooks[this.type];if(!n||!("set"in n)||n.set(this,o,"value")===t)this.value=o}});if(s)return n=B.valHooks[s.nodeName.toLowerCase()]||B.valHooks[s.type],n&&"get"in n&&(r=n.get(s,"value"))!==t?r:(r=s.value,typeof r=="string"?r.replace(z,""):r==null?"":r)}}),B.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r,i,s=e.selectedIndex,o=[],u=e.options,a=e.type==="select-one";if(s<0)return null;n=a?s:0,r=a?s+1:u.length;for(;n<r;n++){i=u[n];if(i.selected&&(B.support.optDisabled?!i.disabled:i.getAttribute("disabled")===null)&&(!i.parentNode.disabled||!B.nodeName(i.parentNode,"optgroup"))){t=B(i).val();if(a)return t;o.push(t)}}return a&&!o.length&&u.length?B(u[s]).val():o},set:function(e,t){var n=B.makeArray(t);return B(e).find("option").each(function(){this.selected=B.inArray(B(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(e,n,r,i){var s,o,u,a=e.nodeType;if(!!e&&a!==3&&a!==8&&a!==2){if(i&&n in B.attrFn)return B(e)[n](r);if(typeof e.getAttribute=="undefined")return B.prop(e,n,r);u=a!==1||!B.isXMLDoc(e),u&&(n=n.toLowerCase(),o=B.attrHooks[n]||($.test(n)?Q:K));if(r!==t){if(r===null){B.removeAttr(e,n);return}return o&&"set"in o&&u&&(s=o.set(e,r,n))!==t?s:(e.setAttribute(n,""+r),r)}return o&&"get"in o&&u&&(s=o.get(e,n))!==null?s:(s=e.getAttribute(n),s===null?t:s)}},removeAttr:function(e,t){var n,r,i,s,o=0;if(t&&e.nodeType===1){r=t.toLowerCase().split(U),s=r.length;for(;o<s;o++)i=r[o],i&&(n=B.propFix[i]||i,B.attr(e,i,""),e.removeAttribute(J?i:n),$.test(i)&&n in e&&(e[n]=!1))}},attrHooks:{type:{set:function(e,t){if(W.test(e.nodeName)&&e.parentNode)B.error("type property can't be changed");else if(!B.support.radioValue&&t==="radio"&&B.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}},value:{get:function(e,t){return K&&B.nodeName(e,"button")?K.get(e,t):t in e?e.value:null},set:function(e,t,n){if(K&&B.nodeName(e,"button"))return K.set(e,t,n);e.value=t}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,s,o,u=e.nodeType;if(!!e&&u!==3&&u!==8&&u!==2)return o=u!==1||!B.isXMLDoc(e),o&&(n=B.propFix[n]||n,s=B.propHooks[n]),r!==t?s&&"set"in s&&(i=s.set(e,r,n))!==t?i:e[n]=r:s&&"get"in s&&(i=s.get(e,n))!==null?i:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):X.test(e.nodeName)||V.test(e.nodeName)&&e.href?0:t}}}}),B.attrHooks.tabindex=B.propHooks.tabIndex,Q={get:function(e,n){var r,i=B.prop(e,n);return i===!0||typeof i!="boolean"&&(r=e.getAttributeNode(n))&&r.nodeValue!==!1?n.toLowerCase():t},set:function(e,t,n){var r;return t===!1?B.removeAttr(e,n):(r=B.propFix[n]||n,r in e&&(e[r]=!0),e.setAttribute(n,n.toLowerCase())),n}},J||(G={name:!0,id:!0},K=B.valHooks.button={get:function(e,n){var r;return r=e.getAttributeNode(n),r&&(G[n]?r.nodeValue!=="":r.specified)?r.nodeValue:t},set:function(e,t,n){var r=e.getAttributeNode(n);return r||(r=D.createAttribute(n),e.setAttributeNode(r)),r.nodeValue=t+""}},B.attrHooks.tabindex.set=K.set,B.each(["width","height"],function(e,t){B.attrHooks[t]=B.extend(B.attrHooks[t],{set:function(e,n){if(n==="")return e.setAttribute(t,"auto"),n}})}),B.attrHooks.contenteditable={get:K.get,set:function(e,t,n){t===""&&(t="false"),K.set(e,t,n)}}),B.support.hrefNormalized||B.each(["href","src","width","height"],function(e,n){B.attrHooks[n]=B.extend(B.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return r===null?t:r}})}),B.support.style||(B.attrHooks.style={get:function(e){return e.style.cssText.toLowerCase()||t},set:function(e,t){return e.style.cssText=""+t}}),B.support.optSelected||(B.propHooks.selected=B.extend(B.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),B.support.enctype||(B.propFix.enctype="encoding"),B.support.checkOn||B.each(["radio","checkbox"],function(){B.valHooks[this]={get:function(e){return e.getAttribute("value")===null?"on":e.value}}}),B.each(["radio","checkbox"],function(){B.valHooks[this]=B.extend(B.valHooks[this],{set:function(e,t){if(B.isArray(t))return e.checked=B.inArray(B(e).val(),t)>=0}})});var Y=/^(?:textarea|input|select)$/i,Z=/^([^\.]*)?(?:\.(.+))?$/,et=/\bhover(\.\S+)?\b/,tt=/^key/,nt=/^(?:mouse|contextmenu)|click/,rt=/^(?:focusinfocus|focusoutblur)$/,it=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,st=function(e){var t=it.exec(e);return t&&(t[1]=(t[1]||"").toLowerCase(),t[3]=t[3]&&new RegExp("(?:^|\\s)"+t[3]+"(?:\\s|$)")),t},ot=function(e,t){var n=e.attributes||{};return(!t[1]||e.nodeName.toLowerCase()===t[1])&&(!t[2]||(n.id||{}).value===t[2])&&(!t[3]||t[3].test((n["class"]||{}).value))},ut=function(e){return B.event.special.hover?e:e.replace(et,"mouseenter$1 mouseleave$1")};B.event={add:function(e,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g;if(!(e.nodeType===3||e.nodeType===8||!n||!r||!(o=B._data(e)))){r.handler&&(d=r,r=d.handler),r.guid||(r.guid=B.guid++),a=o.events,a||(o.events=a={}),u=o.handle,u||(o.handle=u=function(e){return typeof B=="undefined"||!!e&&B.event.triggered===e.type?t:B.event.dispatch.apply(u.elem,arguments)},u.elem=e),n=B.trim(ut(n)).split(" ");for(f=0;f<n.length;f++){l=Z.exec(n[f])||[],c=l[1],h=(l[2]||"").split(".").sort(),g=B.event.special[c]||{},c=(s?g.delegateType:g.bindType)||c,g=B.event.special[c]||{},p=B.extend({type:c,origType:l[1],data:i,handler:r,guid:r.guid,selector:s,quick:st(s),namespace:h.join(".")},d),m=a[c];if(!m){m=a[c]=[],m.delegateCount=0;if(!g.setup||g.setup.call(e,i,h,u)===!1)e.addEventListener?e.addEventListener(c,u,!1):e.attachEvent&&e.attachEvent("on"+c,u)}g.add&&(g.add.call(e,p),p.handler.guid||(p.handler.guid=r.guid)),s?m.splice(m.delegateCount++,0,p):m.push(p),B.event.global[c]=!0}e=null}},global:{},remove:function(e,t,n,r,i){var s=B.hasData(e)&&B._data(e),o,u,a,f,l,c,h,p,d,v,m,g;if(!!s&&!!(p=s.events)){t=B.trim(ut(t||"")).split(" ");for(o=0;o<t.length;o++){u=Z.exec(t[o])||[],a=f=u[1],l=u[2];if(!a){for(a in p)B.event.remove(e,a+t[o],n,r,!0);continue}d=B.event.special[a]||{},a=(r?d.delegateType:d.bindType)||a,m=p[a]||[],c=m.length,l=l?new RegExp("(^|\\.)"+l.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;for(h=0;h<m.length;h++)g=m[h],(i||f===g.origType)&&(!n||n.guid===g.guid)&&(!l||l.test(g.namespace))&&(!r||r===g.selector||r==="**"&&g.selector)&&(m.splice(h--,1),g.selector&&m.delegateCount--,d.remove&&d.remove.call(e,g));m.length===0&&c!==m.length&&((!d.teardown||d.teardown.call(e,l)===!1)&&B.removeEvent(e,a,s.handle),delete p[a])}B.isEmptyObject(p)&&(v=s.handle,v&&(v.elem=null),B.removeData(e,["events","handle"],!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(n,r,i,s){if(!i||i.nodeType!==3&&i.nodeType!==8){var o=n.type||n,u=[],a,f,l,c,h,p,d,v,m,g;if(rt.test(o+B.event.triggered))return;o.indexOf("!")>=0&&(o=o.slice(0,-1),f=!0),o.indexOf(".")>=0&&(u=o.split("."),o=u.shift(),u.sort());if((!i||B.event.customEvent[o])&&!B.event.global[o])return;n=typeof n=="object"?n[B.expando]?n:new B.Event(o,n):new B.Event(o),n.type=o,n.isTrigger=!0,n.exclusive=f,n.namespace=u.join("."),n.namespace_re=n.namespace?new RegExp("(^|\\.)"+u.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,p=o.indexOf(":")<0?"on"+o:"";if(!i){a=B.cache;for(l in a)a[l].events&&a[l].events[o]&&B.event.trigger(n,r,a[l].handle.elem,!0);return}n.result=t,n.target||(n.target=i),r=r!=null?B.makeArray(r):[],r.unshift(n),d=B.event.special[o]||{};if(d.trigger&&d.trigger.apply(i,r)===!1)return;m=[[i,d.bindType||o]];if(!s&&!d.noBubble&&!B.isWindow(i)){g=d.delegateType||o,c=rt.test(g+o)?i:i.parentNode,h=null;for(;c;c=c.parentNode)m.push([c,g]),h=c;h&&h===i.ownerDocument&&m.push([h.defaultView||h.parentWindow||e,g])}for(l=0;l<m.length&&!n.isPropagationStopped();l++)c=m[l][0],n.type=m[l][1],v=(B._data(c,"events")||{})[n.type]&&B._data(c,"handle"),v&&v.apply(c,r),v=p&&c[p],v&&B.acceptData(c)&&v.apply(c,r)===!1&&n.preventDefault();return n.type=o,!s&&!n.isDefaultPrevented()&&(!d._default||d._default.apply(i.ownerDocument,r)===!1)&&(o!=="click"||!B.nodeName(i,"a"))&&B.acceptData(i)&&p&&i[o]&&(o!=="focus"&&o!=="blur"||n.target.offsetWidth!==0)&&!B.isWindow(i)&&(h=i[p],h&&(i[p]=null),B.event.triggered=o,i[o](),B.event.triggered=t,h&&(i[p]=h)),n.result}},dispatch:function(n){n=B.event.fix(n||e.event);var r=(B._data(this,"events")||{})[n.type]||[],i=r.delegateCount,s=[].slice.call(arguments,0),o=!n.exclusive&&!n.namespace,u=[],a,f,l,c,h,p,d,v,m,g,y;s[0]=n,n.delegateTarget=this;if(i&&!n.target.disabled&&(!n.button||n.type!=="click")){c=B(this),c.context=this.ownerDocument||this;for(l=n.target;l!=this;l=l.parentNode||this){p={},v=[],c[0]=l;for(a=0;a<i;a++)m=r[a],g=m.selector,p[g]===t&&(p[g]=m.quick?ot(l,m.quick):c.is(g)),p[g]&&v.push(m);v.length&&u.push({elem:l,matches:v})}}r.length>i&&u.push({elem:this,matches:r.slice(i)});for(a=0;a<u.length&&!n.isPropagationStopped();a++){d=u[a],n.currentTarget=d.elem;for(f=0;f<d.matches.length&&!n.isImmediatePropagationStopped();f++){m=d.matches[f];if(o||!n.namespace&&!m.namespace||n.namespace_re&&n.namespace_re.test(m.namespace))n.data=m.data,n.handleObj=m,h=((B.event.special[m.origType]||{}).handle||m.handler).apply(d.elem,s),h!==t&&(n.result=h,h===!1&&(n.preventDefault(),n.stopPropagation()))}}return n.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return e.which==null&&(e.which=t.charCode!=null?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,i,s,o=n.button,u=n.fromElement;return e.pageX==null&&n.clientX!=null&&(r=e.target.ownerDocument||D,i=r.documentElement,s=r.body,e.pageX=n.clientX+(i&&i.scrollLeft||s&&s.scrollLeft||0)-(i&&i.clientLeft||s&&s.clientLeft||0),e.pageY=n.clientY+(i&&i.scrollTop||s&&s.scrollTop||0)-(i&&i.clientTop||s&&s.clientTop||0)),!e.relatedTarget&&u&&(e.relatedTarget=u===e.target?n.toElement:u),!e.which&&o!==t&&(e.which=o&1?1:o&2?3:o&4?2:0),e}},fix:function(e){if(e[B.expando])return e;var n,r,i=e,s=B.event.fixHooks[e.type]||{},o=s.props?this.props.concat(s.props):this.props;e=B.Event(i);for(n=o.length;n;)r=o[--n],e[r]=i[r];return e.target||(e.target=i.srcElement||D),e.target.nodeType===3&&(e.target=e.target.parentNode),e.metaKey===t&&(e.metaKey=e.ctrlKey),s.filter?s.filter(e,i):e},special:{ready:{setup:B.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(e,t,n){B.isWindow(this)&&(this.onbeforeunload=n)},teardown:function(e,t){this.onbeforeunload===t&&(this.onbeforeunload=null)}}},simulate:function(e,t,n,r){var i=B.extend(new B.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?B.event.trigger(i,null,t):B.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},B.event.handle=B.event.dispatch,B.removeEvent=D.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){e.detachEvent&&e.detachEvent("on"+t,n)},B.Event=function(e,t){if(!(this instanceof B.Event))return new B.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?k:L):this.type=e,t&&B.extend(this,t),this.timeStamp=e&&e.timeStamp||B.now(),this[B.expando]=!0},B.Event.prototype={preventDefault:function(){this.isDefaultPrevented=k;var e=this.originalEvent;!e||(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=k;var e=this.originalEvent;!e||(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=k,this.stopPropagation()},isDefaultPrevented:L,isPropagationStopped:L,isImmediatePropagationStopped:L},B.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){B.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n=this,r=e.relatedTarget,i=e.handleObj,s=i.selector,o;if(!r||r!==n&&!B.contains(n,r))e.type=i.origType,o=i.handler.apply(this,arguments),e.type=t;return o}}}),B.support.submitBubbles||(B.event.special.submit={setup:function(){if(B.nodeName(this,"form"))return!1;B.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=B.nodeName(n,"input")||B.nodeName(n,"button")?n.form:t;r&&!r._submit_attached&&(B.event.add(r,"submit._submit",function(e){this.parentNode&&!e.isTrigger&&B.event.simulate("submit",this.parentNode,e,!0)}),r._submit_attached=!0)})},teardown:function(){if(B.nodeName(this,"form"))return!1;B.event.remove(this,"._submit")}}),B.support.changeBubbles||(B.event.special.change={setup:function(){if(Y.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")B.event.add(this,"propertychange._change",function(e){e.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),B.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1,B.event.simulate("change",this,e,!0))});return!1}B.event.add(this,"beforeactivate._change",function(e){var t=e.target;Y.test(t.nodeName)&&!t._change_attached&&(B.event.add(t,"change._change",function(e){this.parentNode&&!e.isSimulated&&!e.isTrigger&&B.event.simulate("change",this.parentNode,e,!0)}),t._change_attached=!0)})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||t.type!=="radio"&&t.type!=="checkbox")return e.handleObj.handler.apply(this,arguments)},teardown:function(){return B.event.remove(this,"._change"),Y.test(this.nodeName)}}),B.support.focusinBubbles||B.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){B.event.simulate(t,e.target,B.event.fix(e),!0)};B.event.special[t]={setup:function(){n++===0&&D.addEventListener(e,r,!0)},teardown:function(){--n===0&&D.removeEventListener(e,r,!0)}}}),B.fn.extend({on:function(e,n,r,i,s){var o,u;if(typeof e=="object"){typeof n!="string"&&(r=n,n=t);for(u in e)this.on(u,n,r,e[u],s);return this}r==null&&i==null?(i=n,r=n=t):i==null&&(typeof n=="string"?(i=r,r=t):(i=r,r=n,n=t));if(i===!1)i=L;else if(!i)return this;return s===1&&(o=i,i=function(e){return B().off(e),o.apply(this,arguments)},i.guid=o.guid||(o.guid=B.guid++)),this.each(function(){B.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on.call(this,e,t,n,r,1)},off:function(e,n,r){if(e&&e.preventDefault&&e.handleObj){var i=e.handleObj;return B(e.delegateTarget).off(i.namespace?i.type+"."+i.namespace:i.type,i.selector,i.handler),this}if(typeof e=="object"){for(var s in e)this.off(s,n,e[s]);return this}if(n===!1||typeof n=="function")r=n,n=t;return r===!1&&(r=L),this.each(function(){B.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},live:function(e,t,n){return B(this.context).on(e,this.selector,t,n),this},die:function(e,t){return B(this.context).off(e,this.selector||"**",t),this},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return arguments.length==1?this.off(e,"**"):this.off(t,e,n)},trigger:function(e,t){return this.each(function(){B.event.trigger(e,t,this)})},triggerHandler:function(e,t){if(this[0])return B.event.trigger(e,t,this[0],!0)},toggle:function(e){var t=arguments,n=e.guid||B.guid++,r=0,i=function(n){var i=(B._data(this,"lastToggle"+e.guid)||0)%r;return B._data(this,"lastToggle"+e.guid,i+1),n.preventDefault(),t[i].apply(this,arguments)||!1};i.guid=n;while(r<t.length)t[r++].guid=n;return this.click(i)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),B.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){B.fn[t]=function(e,n){return n==null&&(n=e,e=null),arguments.length>0?this.on(t,null,e,n):this.trigger(t)},B.attrFn&&(B.attrFn[t]=!0),tt.test(t)&&(B.event.fixHooks[t]=B.event.keyHooks),nt.test(t)&&(B.event.fixHooks[t]=B.event.mouseHooks)}),function(){function e(e,t,n,r,s,o){for(var u=0,a=r.length;u<a;u++){var f=r[u];if(f){var l=!1;f=f[e];while(f){if(f[i]===n){l=r[f.sizset];break}if(f.nodeType===1){o||(f[i]=n,f.sizset=u);if(typeof t!="string"){if(f===t){l=!0;break}}else if(h.filter(t,[f]).length>0){l=f;break}}f=f[e]}r[u]=l}}}function n(e,t,n,r,s,o){for(var u=0,a=r.length;u<a;u++){var f=r[u];if(f){var l=!1;f=f[e];while(f){if(f[i]===n){l=r[f.sizset];break}f.nodeType===1&&!o&&(f[i]=n,f.sizset=u);if(f.nodeName.toLowerCase()===t){l=f;break}f=f[e]}r[u]=l}}}var r=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,i="sizcache"+(Math.random()+"").replace(".",""),s=0,o=Object.prototype.toString,u=!1,a=!0,f=/\\/g,l=/\r\n/g,c=/\W/;[0,0].sort(function(){return a=!1,0});var h=function(e,t,n,i){n=n||[],t=t||D;var s=t;if(t.nodeType!==1&&t.nodeType!==9)return[];if(!e||typeof e!="string")return n;var u,a,f,l,c,p,m,g,b=!0,w=h.isXML(t),E=[],x=e;do{r.exec(""),u=r.exec(x);if(u){x=u[3],E.push(u[1]);if(u[2]){l=u[3];break}}}while(u);if(E.length>1&&v.exec(e))if(E.length===2&&d.relative[E[0]])a=S(E[0]+E[1],t,i);else{a=d.relative[E[0]]?[t]:h(E.shift(),t);while(E.length)e=E.shift(),d.relative[e]&&(e+=E.shift()),a=S(e,a,i)}else{!i&&E.length>1&&t.nodeType===9&&!w&&d.match.ID.test(E[0])&&!d.match.ID.test(E[E.length-1])&&(c=h.find(E.shift(),t,w),t=c.expr?h.filter(c.expr,c.set)[0]:c.set[0]);if(t){c=i?{expr:E.pop(),set:y(i)}:h.find(E.pop(),E.length!==1||E[0]!=="~"&&E[0]!=="+"||!t.parentNode?t:t.parentNode,w),a=c.expr?h.filter(c.expr,c.set):c.set,E.length>0?f=y(a):b=!1;while(E.length)p=E.pop(),m=p,d.relative[p]?m=E.pop():p="",m==null&&(m=t),d.relative[p](f,m,w)}else f=E=[]}f||(f=a),f||h.error(p||e);if(o.call(f)==="[object Array]")if(!b)n.push.apply(n,f);else if(t&&t.nodeType===1)for(g=0;f[g]!=null;g++)f[g]&&(f[g]===!0||f[g].nodeType===1&&h.contains(t,f[g]))&&n.push(a[g]);else for(g=0;f[g]!=null;g++)f[g]&&f[g].nodeType===1&&n.push(a[g]);else y(f,n);return l&&(h(l,s,n,i),h.uniqueSort(n)),n};h.uniqueSort=function(e){if(w){u=a,e.sort(w);if(u)for(var t=1;t<e.length;t++)e[t]===e[t-1]&&e.splice(t--,1)}return e},h.matches=function(e,t){return h(e,null,null,t)},h.matchesSelector=function(e,t){return h(t,null,null,[e]).length>0},h.find=function(e,t,n){var r,i,s,o,u,a;if(!e)return[];for(i=0,s=d.order.length;i<s;i++){u=d.order[i];if(o=d.leftMatch[u].exec(e)){a=o[1],o.splice(1,1);if(a.substr(a.length-1)!=="\\"){o[1]=(o[1]||"").replace(f,""),r=d.find[u](o,t,n);if(r!=null){e=e.replace(d.match[u],"");break}}}}return r||(r=typeof t.getElementsByTagName!="undefined"?t.getElementsByTagName("*"):[]),{set:r,expr:e}},h.filter=function(e,n,r,i){var s,o,u,a,f,l,c,p,v,m=e,g=[],y=n,b=n&&n[0]&&h.isXML(n[0]);while(e&&n.length){for(u in d.filter)if((s=d.leftMatch[u].exec(e))!=null&&s[2]){l=d.filter[u],c=s[1],o=!1,s.splice(1,1);if(c.substr(c.length-1)==="\\")continue;y===g&&(g=[]);if(d.preFilter[u]){s=d.preFilter[u](s,y,r,g,i,b);if(!s)o=a=!0;else if(s===!0)continue}if(s)for(p=0;(f=y[p])!=null;p++)f&&(a=l(f,s,p,y),v=i^a,r&&a!=null?v?o=!0:y[p]=!1:v&&(g.push(f),o=!0));if(a!==t){r||(y=g),e=e.replace(d.match[u],"");if(!o)return[];break}}if(e===m){if(o!=null)break;h.error(e)}m=e}return y},h.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)};var p=h.getText=function(e){var t,n,r=e.nodeType,i="";if(r){if(r===1||r===9){if(typeof e.textContent=="string")return e.textContent;if(typeof e.innerText=="string")return e.innerText.replace(l,"");for(e=e.firstChild;e;e=e.nextSibling)i+=p(e)}else if(r===3||r===4)return e.nodeValue}else for(t=0;n=e[t];t++)n.nodeType!==8&&(i+=p(n));return i},d=h.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(e){return e.getAttribute("href")},type:function(e){return e.getAttribute("type")}},relative:{"+":function(e,t){var n=typeof t=="string",r=n&&!c.test(t),i=n&&!r;r&&(t=t.toLowerCase());for(var s=0,o=e.length,u;s<o;s++)if(u=e[s]){while((u=u.previousSibling)&&u.nodeType!==1);e[s]=i||u&&u.nodeName.toLowerCase()===t?u||!1:u===t}i&&h.filter(t,e,!0)},">":function(e,t){var n,r=typeof t=="string",i=0,s=e.length;if(r&&!c.test(t)){t=t.toLowerCase();for(;i<s;i++){n=e[i];if(n){var o=n.parentNode;e[i]=o.nodeName.toLowerCase()===t?o:!1}}}else{for(;i<s;i++)n=e[i],n&&(e[i]=r?n.parentNode:n.parentNode===t);r&&h.filter(t,e,!0)}},"":function(t,r,i){var o,u=s++,a=e;typeof r=="string"&&!c.test(r)&&(r=r.toLowerCase(),o=r,a=n),a("parentNode",r,u,t,o,i)},"~":function(t,r,i){var o,u=s++,a=e;typeof r=="string"&&!c.test(r)&&(r=r.toLowerCase(),o=r,a=n),a("previousSibling",r,u,t,o,i)}},find:{ID:function(e,t,n){if(typeof t.getElementById!="undefined"&&!n){var r=t.getElementById(e[1]);return r&&r.parentNode?[r]:[]}},NAME:function(e,t){if(typeof t.getElementsByName!="undefined"){var n=[],r=t.getElementsByName(e[1]);for(var i=0,s=r.length;i<s;i++)r[i].getAttribute("name")===e[1]&&n.push(r[i]);return n.length===0?null:n}},TAG:function(e,t){if(typeof t.getElementsByTagName!="undefined")return t.getElementsByTagName(e[1])}},preFilter:{CLASS:function(e,t,n,r,i,s){e=" "+e[1].replace(f,"")+" ";if(s)return e;for(var o=0,u;(u=t[o])!=null;o++)u&&(i^(u.className&&(" "+u.className+" ").replace(/[\t\n\r]/g," ").indexOf(e)>=0)?n||r.push(u):n&&(t[o]=!1));return!1},ID:function(e){return e[1].replace(f,"")},TAG:function(e,t){return e[1].replace(f,"").toLowerCase()},CHILD:function(e){if(e[1]==="nth"){e[2]||h.error(e[0]),e[2]=e[2].replace(/^\+|\s*/g,"");var t=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(e[2]==="even"&&"2n"||e[2]==="odd"&&"2n+1"||!/\D/.test(e[2])&&"0n+"+e[2]||e[2]);e[2]=t[1]+(t[2]||1)-0,e[3]=t[3]-0}else e[2]&&h.error(e[0]);return e[0]=s++,e},ATTR:function(e,t,n,r,i,s){var o=e[1]=e[1].replace(f,"");return!s&&d.attrMap[o]&&(e[1]=d.attrMap[o]),e[4]=(e[4]||e[5]||"").replace(f,""),e[2]==="~="&&(e[4]=" "+e[4]+" "),e},PSEUDO:function(e,t,n,i,s){if(e[1]==="not"){if(!((r.exec(e[3])||"").length>1||/^\w/.test(e[3]))){var o=h.filter(e[3],t,n,!0^s);return n||i.push.apply(i,o),!1}e[3]=h(e[3],null,null,t)}else if(d.match.POS.test(e[0])||d.match.CHILD.test(e[0]))return!0;return e},POS:function(e){return e.unshift(!0),e}},filters:{enabled:function(e){return e.disabled===!1&&e.type!=="hidden"},disabled:function(e){return e.disabled===!0},checked:function(e){return e.checked===!0},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},parent:function(e){return!!e.firstChild},empty:function(e){return!e.firstChild},has:function(e,t,n){return!!h(n[3],e).length},header:function(e){return/h\d/i.test(e.nodeName)},text:function(e){var t=e.getAttribute("type"),n=e.type;return e.nodeName.toLowerCase()==="input"&&"text"===n&&(t===n||t===null)},radio:function(e){return e.nodeName.toLowerCase()==="input"&&"radio"===e.type},checkbox:function(e){return e.nodeName.toLowerCase()==="input"&&"checkbox"===e.type},file:function(e){return e.nodeName.toLowerCase()==="input"&&"file"===e.type},password:function(e){return e.nodeName.toLowerCase()==="input"&&"password"===e.type},submit:function(e){var t=e.nodeName.toLowerCase();return(t==="input"||t==="button")&&"submit"===e.type},image:function(e){return e.nodeName.toLowerCase()==="input"&&"image"===e.type},reset:function(e){var t=e.nodeName.toLowerCase();return(t==="input"||t==="button")&&"reset"===e.type},button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&"button"===e.type||t==="button"},input:function(e){return/input|select|textarea|button/i.test(e.nodeName)},focus:function(e){return e===e.ownerDocument.activeElement}},setFilters:{first:function(e,t){return t===0},last:function(e,t,n,r){return t===r.length-1},even:function(e,t){return t%2===0},odd:function(e,t){return t%2===1},lt:function(e,t,n){return t<n[3]-0},gt:function(e,t,n){return t>n[3]-0},nth:function(e,t,n){return n[3]-0===t},eq:function(e,t,n){return n[3]-0===t}},filter:{PSEUDO:function(e,t,n,r){var i=t[1],s=d.filters[i];if(s)return s(e,n,t,r);if(i==="contains")return(e.textContent||e.innerText||p([e])||"").indexOf(t[3])>=0;if(i==="not"){var o=t[3];for(var u=0,a=o.length;u<a;u++)if(o[u]===e)return!1;return!0}h.error(i)},CHILD:function(e,t){var n,r,s,o,u,a,f,l=t[1],c=e;switch(l){case"only":case"first":while(c=c.previousSibling)if(c.nodeType===1)return!1;if(l==="first")return!0;c=e;case"last":while(c=c.nextSibling)if(c.nodeType===1)return!1;return!0;case"nth":n=t[2],r=t[3];if(n===1&&r===0)return!0;s=t[0],o=e.parentNode;if(o&&(o[i]!==s||!e.nodeIndex)){a=0;for(c=o.firstChild;c;c=c.nextSibling)c.nodeType===1&&(c.nodeIndex=++a);o[i]=s}return f=e.nodeIndex-r,n===0?f===0:f%n===0&&f/n>=0}},ID:function(e,t){return e.nodeType===1&&e.getAttribute("id")===t},TAG:function(e,t){return t==="*"&&e.nodeType===1||!!e.nodeName&&e.nodeName.toLowerCase()===t},CLASS:function(e,t){return(" "+(e.className||e.getAttribute("class"))+" ").indexOf(t)>-1},ATTR:function(e,t){var n=t[1],r=h.attr?h.attr(e,n):d.attrHandle[n]?d.attrHandle[n](e):e[n]!=null?e[n]:e.getAttribute(n),i=r+"",s=t[2],o=t[4];return r==null?s==="!=":!s&&h.attr?r!=null:s==="="?i===o:s==="*="?i.indexOf(o)>=0:s==="~="?(" "+i+" ").indexOf(o)>=0:o?s==="!="?i!==o:s==="^="?i.indexOf(o)===0:s==="$="?i.substr(i.length-o.length)===o:s==="|="?i===o||i.substr(0,o.length+1)===o+"-":!1:i&&r!==!1},POS:function(e,t,n,r){var i=t[2],s=d.setFilters[i];if(s)return s(e,n,t,r)}}},v=d.match.POS,m=function(e,t){return"\\"+(t-0+1)};for(var g in d.match)d.match[g]=new RegExp(d.match[g].source+/(?![^\[]*\])(?![^\(]*\))/.source),d.leftMatch[g]=new RegExp(/(^(?:.|\r|\n)*?)/.source+d.match[g].source.replace(/\\(\d+)/g,m));var y=function(e,t){return e=Array.prototype.slice.call(e,0),t?(t.push.apply(t,e),t):e};try{Array.prototype.slice.call(D.documentElement.childNodes,0)[0].nodeType}catch(b){y=function(e,t){var n=0,r=t||[];if(o.call(e)==="[object Array]")Array.prototype.push.apply(r,e);else if(typeof e.length=="number")for(var i=e.length;n<i;n++)r.push(e[n]);else for(;e[n];n++)r.push(e[n]);return r}}var w,E;D.documentElement.compareDocumentPosition?w=function(e,t){return e===t?(u=!0,0):!e.compareDocumentPosition||!t.compareDocumentPosition?e.compareDocumentPosition?-1:1:e.compareDocumentPosition(t)&4?-1:1}:(w=function(e,t){if(e===t)return u=!0,0;if(e.sourceIndex&&t.sourceIndex)return e.sourceIndex-t.sourceIndex;var n,r,i=[],s=[],o=e.parentNode,a=t.parentNode,f=o;if(o===a)return E(e,t);if(!o)return-1;if(!a)return 1;while(f)i.unshift(f),f=f.parentNode;f=a;while(f)s.unshift(f),f=f.parentNode;n=i.length,r=s.length;for(var l=0;l<n&&l<r;l++)if(i[l]!==s[l])return E(i[l],s[l]);return l===n?E(e,s[l],-1):E(i[l],t,1)},E=function(e,t,n){if(e===t)return n;var r=e.nextSibling;while(r){if(r===t)return-1;r=r.nextSibling}return 1}),function(){var e=D.createElement("div"),n="script"+(new Date).getTime(),r=D.documentElement;e.innerHTML="<a name='"+n+"'/>",r.insertBefore(e,r.firstChild),D.getElementById(n)&&(d.find.ID=function(e,n,r){if(typeof n.getElementById!="undefined"&&!r){var i=n.getElementById(e[1]);return i?i.id===e[1]||typeof i.getAttributeNode!="undefined"&&i.getAttributeNode("id").nodeValue===e[1]?[i]:t:[]}},d.filter.ID=function(e,t){var n=typeof e.getAttributeNode!="undefined"&&e.getAttributeNode("id");return e.nodeType===1&&n&&n.nodeValue===t}),r.removeChild(e),r=e=null}(),function(){var e=D.createElement("div");e.appendChild(D.createComment("")),e.getElementsByTagName("*").length>0&&(d.find.TAG=function(e,t){var n=t.getElementsByTagName(e[1]);if(e[1]==="*"){var r=[];for(var i=0;n[i];i++)n[i].nodeType===1&&r.push(n[i]);n=r}return n}),e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!="undefined"&&e.firstChild.getAttribute("href")!=="#"&&(d.attrHandle.href=function(e){return e.getAttribute("href",2)}),e=null}(),D.querySelectorAll&&function(){var e=h,t=D.createElement("div"),n="__sizzle__";t.innerHTML="<p class='TEST'></p>";if(!t.querySelectorAll||t.querySelectorAll(".TEST").length!==0){h=function(t,r,i,s){r=r||D;if(!s&&!h.isXML(r)){var o=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(t);if(o&&(r.nodeType===1||r.nodeType===9)){if(o[1])return y(r.getElementsByTagName(t),i);if(o[2]&&d.find.CLASS&&r.getElementsByClassName)return y(r.getElementsByClassName(o[2]),i)}if(r.nodeType===9){if(t==="body"&&r.body)return y([r.body],i);if(o&&o[3]){var u=r.getElementById(o[3]);if(!u||!u.parentNode)return y([],i);if(u.id===o[3])return y([u],i)}try{return y(r.querySelectorAll(t),i)}catch(a){}}else if(r.nodeType===1&&r.nodeName.toLowerCase()!=="object"){var f=r,l=r.getAttribute("id"),c=l||n,p=r.parentNode,v=/^\s*[+~]/.test(t);l?c=c.replace(/'/g,"\\$&"):r.setAttribute("id",c),v&&p&&(r=r.parentNode);try{if(!v||p)return y(r.querySelectorAll("[id='"+c+"'] "+t),i)}catch(m){}finally{l||f.removeAttribute("id")}}}return e(t,r,i,s)};for(var r in e)h[r]=e[r];t=null}}(),function(){var e=D.documentElement,t=e.matchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.msMatchesSelector;if(t){var n=!t.call(D.createElement("div"),"div"),r=!1;try{t.call(D.documentElement,"[test!='']:sizzle")}catch(i){r=!0}h.matchesSelector=function(e,i){i=i.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!h.isXML(e))try{if(r||!d.match.PSEUDO.test(i)&&!/!=/.test(i)){var s=t.call(e,i);if(s||!n||e.document&&e.document.nodeType!==11)return s}}catch(o){}return h(i,null,null,[e]).length>0}}}(),function(){var e=D.createElement("div");e.innerHTML="<div class='test e'></div><div class='test'></div>";if(!!e.getElementsByClassName&&e.getElementsByClassName("e").length!==0){e.lastChild.className="e";if(e.getElementsByClassName("e").length===1)return;d.order.splice(1,0,"CLASS"),d.find.CLASS=function(e,t,n){if(typeof t.getElementsByClassName!="undefined"&&!n)return t.getElementsByClassName(e[1])},e=null}}(),D.documentElement.contains?h.contains=function(e,t){return e!==t&&(e.contains?e.contains(t):!0)}:D.documentElement.compareDocumentPosition?h.contains=function(e,t){return!!(e.compareDocumentPosition(t)&16)}:h.contains=function(){return!1},h.isXML=function(e){var t=(e?e.ownerDocument||e:0).documentElement;return t?t.nodeName!=="HTML":!1};var S=function(e,t,n){var r,i=[],s="",o=t.nodeType?[t]:t;while(r=d.match.PSEUDO.exec(e))s+=r[0],e=e.replace(d.match.PSEUDO,"");e=d.relative[e]?e+"*":e;for(var u=0,a=o.length;u<a;u++)h(e,o[u],i,n);return h.filter(s,i)};h.attr=B.attr,h.selectors.attrMap={},B.find=h,B.expr=h.selectors,B.expr[":"]=B.expr.filters,B.unique=h.uniqueSort,B.text=h.getText,B.isXMLDoc=h.isXML,B.contains=h.contains}();var at=/Until$/,ft=/^(?:parents|prevUntil|prevAll)/,lt=/,/,ct=/^.[^:#\[\.,]*$/,ht=Array.prototype.slice,pt=B.expr.match.POS,dt={children:!0,contents:!0,next:!0,prev:!0};B.fn.extend({find:function(e){var t=this,n,r;if(typeof e!="string")return B(e).filter(function(){for(n=0,r=t.length;n<r;n++)if(B.contains(t[n],this))return!0});var i=this.pushStack("","find",e),s,o,u;for(n=0,r=this.length;n<r;n++){s=i.length,B.find(e,this[n],i);if(n>0)for(o=s;o<i.length;o++)for(u=0;u<s;u++)if(i[u]===i[o]){i.splice(o--,1);break}}return i},has:function(e){var t=B(e);return this.filter(function(){for(var e=0,n=t.length;e<n;e++)if(B.contains(this,t[e]))return!0})},not:function(e){return this.pushStack(N(this,e,!1),"not",e)},filter:function(e){return this.pushStack(N(this,e,!0),"filter",e)},is:function(e){return!!e&&(typeof e=="string"?pt.test(e)?B(e,this.context).index(this[0])>=0:B.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var n=[],r,i,s=this[0];if(B.isArray(e)){var o=1;while(s&&s.ownerDocument&&s!==t){for(r=0;r<e.length;r++)B(s).is(e[r])&&n.push({selector:e[r],elem:s,level:o});s=s.parentNode,o++}return n}var u=pt.test(e)||typeof e!="string"?B(e,t||this.context):0;for(r=0,i=this.length;r<i;r++){s=this[r];while(s){if(u?u.index(s)>-1:B.find.matchesSelector(s,e)){n.push(s);break}s=s.parentNode;if(!s||!s.ownerDocument||s===t||s.nodeType===11)break}}return n=n.length>1?B.unique(n):n,this.pushStack(n,"closest",e)},index:function(e){return e?typeof e=="string"?B.inArray(this[0],B(e)):B.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(e,t){var n=typeof e=="string"?B(e,t):B.makeArray(e&&e.nodeType?[e]:e),r=B.merge(this.get(),n);return this.pushStack(C(n[0])||C(r[0])?r:B.unique(r))},andSelf:function(){return this.add(this.prevObject)}}),B.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return B.dir(e,"parentNode")},parentsUntil:function(e,t,n){return B.dir(e,"parentNode",n)},next:function(e){return B.nth(e,2,"nextSibling")},prev:function(e){return B.nth(e,2,"previousSibling")},nextAll:function(e){return B.dir(e,"nextSibling")},prevAll:function(e){return B.dir(e,"previousSibling")},nextUntil:function(e,t,n){return B.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return B.dir(e,"previousSibling",n)},siblings:function(e){return B.sibling(e.parentNode.firstChild,e)},children:function(e){return B.sibling(e.firstChild)},contents:function(e){return B.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:B.makeArray(e.childNodes)}},function(e,t){B.fn[e]=function(n,r){var i=B.map(this,t,n);return at.test(e)||(r=n),r&&typeof r=="string"&&(i=B.filter(r,i)),i=this.length>1&&!dt[e]?B.unique(i):i,(this.length>1||lt.test(r))&&ft.test(e)&&(i=i.reverse()),this.pushStack(i,e,ht.call(arguments).join(","))}}),B.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),t.length===1?B.find.matchesSelector(t[0],e)?[t[0]]:[]:B.find.matches(e,t)},dir:function(e,n,r){var i=[],s=e[n];while(s&&s.nodeType!==9&&(r===t||s.nodeType!==1||!B(s).is(r)))s.nodeType===1&&i.push(s),s=s[n];return i},nth:function(e,t,n,r){t=t||1;var i=0;for(;e;e=e[n])if(e.nodeType===1&&++i===t)break;return e},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)e.nodeType===1&&e!==t&&n.push(e);return n}});var vt="abbr|article|aside|audio|canvas|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",mt=/ jQuery\d+="(?:\d+|null)"/g,gt=/^\s+/,yt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,bt=/<([\w:]+)/,wt=/<tbody/i,Et=/<|&#?\w+;/,St=/<(?:script|style)/i,xt=/<(?:script|object|embed|option|style)/i,Tt=new RegExp("<(?:"+vt+")","i"),Nt=/checked\s*(?:[^=]|=\s*.checked.)/i,Ct=/\/(java|ecma)script/i,kt=/^\s*<!(?:\[CDATA\[|\-\-)/,Lt={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},At=T(D);Lt.optgroup=Lt.option,Lt.tbody=Lt.tfoot=Lt.colgroup=Lt.caption=Lt.thead,Lt.th=Lt.td,B.support.htmlSerialize||(Lt._default=[1,"div<div>","</div>"]),B.fn.extend({text:function(e){return B.isFunction(e)?this.each(function(t){var n=B(this);n.text(e.call(this,t,n.text()))}):typeof e!="object"&&e!==t?this.empty().append((this[0]&&this[0].ownerDocument||D).createTextNode(e)):B.text(this)},wrapAll:function(e){if(B.isFunction(e))return this.each(function(t){B(this).wrapAll(e.call(this,t))});if(this[0]){var t=B(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&e.firstChild.nodeType===1)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return B.isFunction(e)?this.each(function(t){B(this).wrapInner(e.call(this,t))}):this.each(function(){var t=B(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=B.isFunction(e);return this.each(function(n){B(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){B.nodeName(this,"body")||B(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){this.nodeType===1&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){this.nodeType===1&&this.insertBefore(e,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this)});if(arguments.length){var e=B.clean(arguments);return e.push.apply(e,this.toArray()),this.pushStack(e,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this.nextSibling)});if(arguments.length){var e=this.pushStack(this,"after",arguments);return e.push.apply(e,B.clean(arguments)),e}},remove:function(e,t){for(var n=0,r;(r=this[n])!=null;n++)if(!e||B.filter(e,[r]).length)!t&&r.nodeType===1&&(B.cleanData(r.getElementsByTagName("*")),B.cleanData([r])),r.parentNode&&r.parentNode.removeChild(r);return this},empty:function(){for(var e=0,t;(t=this[e])!=null;e++){t.nodeType===1&&B.cleanData(t.getElementsByTagName("*"));while(t.firstChild)t.removeChild(t.firstChild)}return this},clone:function(e,t){return e=e==null?!1:e,t=t==null?e:t,this.map(function(){return B.clone(this,e,t)})},html:function(e){if(e===t)return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(mt,""):null;if(typeof e=="string"&&!St.test(e)&&(B.support.leadingWhitespace||!gt.test(e))&&!Lt[(bt.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(yt,"<$1></$2>");try{for(var n=0,r=this.length;n<r;n++)this[n].nodeType===1&&(B.cleanData(this[n].getElementsByTagName("*")),this[n].innerHTML=e)}catch(i){this.empty().append(e)}}else B.isFunction(e)?this.each(function(t){var n=B(this);n.html(e.call(this,t,n.html()))}):this.empty().append(e);return this},replaceWith:function(e){return this[0]&&this[0].parentNode?B.isFunction(e)?this.each(function(t){var n=B(this),r=n.html();n.replaceWith(e.call(this,t,r))}):(typeof e!="string"&&(e=B(e).detach()),this.each(function(){var t=this.nextSibling,n=this.parentNode;B(this).remove(),t?B(t).before(e):B(n).append(e)})):this.length?this.pushStack(B(B.isFunction(e)?e():e),"replaceWith",e):this},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){var i,s,o,u,a=e[0],f=[];if(!B.support.checkClone&&arguments.length===3&&typeof a=="string"&&Nt.test(a))return this.each(function(){B(this).domManip(e,n,r,!0)});if(B.isFunction(a))return this.each(function(i){var s=B(this);e[0]=a.call(this,i,n?s.html():t),s.domManip(e,n,r)});if(this[0]){u=a&&a.parentNode,B.support.parentNode&&u&&u.nodeType===11&&u.childNodes.length===this.length?i={fragment:u}:i=B.buildFragment(e,this,f),o=i.fragment,o.childNodes.length===1?s=o=o.firstChild:s=o.firstChild;if(s){n=n&&B.nodeName(s,"tr");for(var l=0,c=this.length,h=c-1;l<c;l++)r.call(n?x(this[l],s):this[l],i.cacheable||c>1&&l<h?B.clone(o,!0,!0):o)}f.length&&B.each(f,m)}return this}}),B.buildFragment=function(e,t,n){var r,i,s,o,u=e[0];return t&&t[0]&&(o=t[0].ownerDocument||t[0]),o.createDocumentFragment||(o=D),e.length===1&&typeof u=="string"&&u.length<512&&o===D&&u.charAt(0)==="<"&&!xt.test(u)&&(B.support.checkClone||!Nt.test(u))&&(B.support.html5Clone||!Tt.test(u))&&(i=!0,s=B.fragments[u],s&&s!==1&&(r=s)),r||(r=o.createDocumentFragment(),B.clean(e,o,r,n)),i&&(B.fragments[u]=s?r:1),{fragment:r,cacheable:i}},B.fragments={},B.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){B.fn[e]=function(n){var r=[],i=B(n),s=this.length===1&&this[0].parentNode;if(s&&s.nodeType===11&&s.childNodes.length===1&&i.length===1)return i[t](this[0]),this;for(var o=0,u=i.length;o<u;o++){var a=(o>0?this.clone(!0):this).get();B(i[o])[t](a),r=r.concat(a)}return this.pushStack(r,e,i.selector)}}),B.extend({clone:function(e,t,n){var r,i,s,o=B.support.html5Clone||!Tt.test("<"+e.nodeName)?e.cloneNode(!0):g(e);if((!B.support.noCloneEvent||!B.support.noCloneChecked)&&(e.nodeType===1||e.nodeType===11)&&!B.isXMLDoc(e)){E(e,o),r=w(e),i=w(o);for(s=0;r[s];++s)i[s]&&E(r[s],i[s])}if(t){S(e,o);if(n){r=w(e),i=w(o);for(s=0;r[s];++s)S(r[s],i[s])}}return r=i=null,o},clean:function(e,t,n,r){var i;t=t||D,typeof t.createElement=="undefined"&&(t=t.ownerDocument||t[0]&&t[0].ownerDocument||D);var s=[],o;for(var u=0,a;(a=e[u])!=null;u++){typeof a=="number"&&(a+="");if(!a)continue;if(typeof a=="string")if(!Et.test(a))a=t.createTextNode(a);else{a=a.replace(yt,"<$1></$2>");var f=(bt.exec(a)||["",""])[1].toLowerCase(),l=Lt[f]||Lt._default,c=l[0],h=t.createElement("div");t===D?At.appendChild(h):T(t).appendChild(h),h.innerHTML=l[1]+a+l[2];while(c--)h=h.lastChild;if(!B.support.tbody){var p=wt.test(a),d=f==="table"&&!p?h.firstChild&&h.firstChild.childNodes:l[1]==="<table>"&&!p?h.childNodes:[];for(o=d.length-1;o>=0;--o)B.nodeName(d[o],"tbody")&&!d[o].childNodes.length&&d[o].parentNode.removeChild(d[o])}!B.support.leadingWhitespace&&gt.test(a)&&h.insertBefore(t.createTextNode(gt.exec(a)[0]),h.firstChild),a=h.childNodes}var v;if(!B.support.appendChecked)if(a[0]&&typeof (v=a.length)=="number")for(o=0;o<v;o++)y(a[o]);else y(a);a.nodeType?s.push(a):s=B.merge(s,a)}if(n){i=function(e){return!e.type||Ct.test(e.type)};for(u=0;s[u];u++)if(r&&B.nodeName(s[u],"script")&&(!s[u].type||s[u].type.toLowerCase()==="text/javascript"))r.push(s[u].parentNode?s[u].parentNode.removeChild(s[u]):s[u]);else{if(s[u].nodeType===1){var m=B.grep(s[u].getElementsByTagName("script"),i);s.splice.apply(s,[u+1,0].concat(m))}n.appendChild(s[u])}}return s},cleanData:function(e){var t,n,r=B.cache,i=B.event.special,s=B.support.deleteExpando;for(var o=0,u;(u=e[o])!=null;o++){if(u.nodeName&&B.noData[u.nodeName.toLowerCase()])continue;n=u[B.expando];if(n){t=r[n];if(t&&t.events){for(var a in t.events)i[a]?B.event.remove(u,a):B.removeEvent(u,a,t.handle);t.handle&&(t.handle.elem=null)}s?delete u[B.expando]:u.removeAttribute&&u.removeAttribute(B.expando),delete r[n]}}}});var Ot=/alpha\([^)]*\)/i,Mt=/opacity=([^)]*)/,_t=/([A-Z]|^ms)/g,Dt=/^-?\d+(?:px)?$/i,Pt=/^-?\d/,Ht=/^([\-+])=([\-+.\de]+)/,Bt={position:"absolute",visibility:"hidden",display:"block"},jt=["Left","Right"],Ft=["Top","Bottom"],It,qt,Rt;B.fn.css=function(e,n){return arguments.length===2&&n===t?this:B.access(this,e,n,!0,function(e,n,r){return r!==t?B.style(e,n,r):B.css(e,n)})},B.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=It(e,"opacity","opacity");return n===""?"1":n}return e.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":B.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(!!e&&e.nodeType!==3&&e.nodeType!==8&&!!e.style){var s,o,u=B.camelCase(n),a=e.style,f=B.cssHooks[u];n=B.cssProps[u]||u;if(r===t)return f&&"get"in f&&(s=f.get(e,!1,i))!==t?s:a[n];o=typeof r,o==="string"&&(s=Ht.exec(r))&&(r=+(s[1]+1)*+s[2]+parseFloat(B.css(e,n)),o="number");if(r==null||o==="number"&&isNaN(r))return;o==="number"&&!B.cssNumber[u]&&(r+="px");if(!f||!("set"in f)||(r=f.set(e,r))!==t)try{a[n]=r}catch(l){}}},css:function(e,n,r){var i,s;n=B.camelCase(n),s=B.cssHooks[n],n=B.cssProps[n]||n,n==="cssFloat"&&(n="float");if(s&&"get"in s&&(i=s.get(e,!0,r))!==t)return i;if(It)return It(e,n)},swap:function(e,t,n){var r={};for(var i in t)r[i]=e.style[i],e.style[i]=t[i];n.call(e);for(i in t)e.style[i]=r[i]}}),B.curCSS=B.css,B.each(["height","width"],function(e,t){B.cssHooks[t]={get:function(e,n,r){var i;if(n)return e.offsetWidth!==0?v(e,t,r):(B.swap(e,Bt,function(){i=v(e,t,r)}),i)},set:function(e,t){if(!Dt.test(t))return t;t=parseFloat(t);if(t>=0)return t+"px"}}}),B.support.opacity||(B.cssHooks.opacity={get:function(e,t){return Mt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?parseFloat(RegExp.$1)/100+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=B.isNumeric(t)?"alpha(opacity="+t*100+")":"",s=r&&r.filter||n.filter||"";n.zoom=1;if(t>=1&&B.trim(s.replace(Ot,""))===""){n.removeAttribute("filter");if(r&&!r.filter)return}n.filter=Ot.test(s)?s.replace(Ot,i):s+" "+i}}),B(function(){B.support.reliableMarginRight||(B.cssHooks.marginRight={get:function(e,t){var n;return B.swap(e,{display:"inline-block"},function(){t?n=It(e,"margin-right","marginRight"):n=e.style.marginRight}),n}})}),D.defaultView&&D.defaultView.getComputedStyle&&(qt=function(e,t){var n,r,i;return t=t.replace(_t,"-$1").toLowerCase(),(r=e.ownerDocument.defaultView)&&(i=r.getComputedStyle(e,null))&&(n=i.getPropertyValue(t),n===""&&!B.contains(e.ownerDocument.documentElement,e)&&(n=B.style(e,t))),n}),D.documentElement.currentStyle&&(Rt=function(e,t){var n,r,i,s=e.currentStyle&&e.currentStyle[t],o=e.style;return s===null&&o&&(i=o[t])&&(s=i),!Dt.test(s)&&Pt.test(s)&&(n=o.left,r=e.runtimeStyle&&e.runtimeStyle.left,r&&(e.runtimeStyle.left=e.currentStyle.left),o.left=t==="fontSize"?"1em":s||0,s=o.pixelLeft+"px",o.left=n,r&&(e.runtimeStyle.left=r)),s===""?"auto":s}),It=qt||Rt,B.expr&&B.expr.filters&&(B.expr.filters.hidden=function(e){var t=e.offsetWidth,n=e.offsetHeight;return t===0&&n===0||!B.support.reliableHiddenOffsets&&(e.style&&e.style.display||B.css(e,"display"))==="none"},B.expr.filters.visible=function(e){return!B.expr.filters.hidden(e)});var Ut=/%20/g,zt=/\[\]$/,Wt=/\r?\n/g,Xt=/#.*$/,Vt=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,$t=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,Jt=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,Kt=/^(?:GET|HEAD)$/,Qt=/^\/\//,Gt=/\?/,Yt=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,Zt=/^(?:select|textarea)/i,en=/\s+/,tn=/([?&])_=[^&]*/,nn=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,rn=B.fn.load,sn={},on={},un,an,fn=["*/"]+["*"];try{un=H.href}catch(ln){un=D.createElement("a"),un.href="",un=un.href}an=nn.exec(un.toLowerCase())||[],B.fn.extend({load:function(e,n,r){if(typeof e!="string"&&rn)return rn.apply(this,arguments);if(!this.length)return this;var i=e.indexOf(" ");if(i>=0){var s=e.slice(i,e.length);e=e.slice(0,i)}var o="GET";n&&(B.isFunction(n)?(r=n,n=t):typeof n=="object"&&(n=B.param(n,B.ajaxSettings.traditional),o="POST"));var u=this;return B.ajax({url:e,type:o,dataType:"html",data:n,complete:function(e,t,n){n=e.responseText,e.isResolved()&&(e.done(function(e){n=e}),u.html(s?B("<div>").append(n.replace(Yt,"")).find(s):n)),r&&u.each(r,[n,t,e])}}),this},serialize:function(){return B.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?B.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||Zt.test(this.nodeName)||$t.test(this.type))}).map(function(e,t){var n=B(this).val();return n==null?null:B.isArray(n)?B.map(n,function(e,n){return{name:t.name,value:e.replace(Wt,"\r\n")}}):{name:t.name,value:n.replace(Wt,"\r\n")}}).get()}}),B.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(e,t){B.fn[t]=function(e){return this.on(t,e)}}),B.each(["get","post"],function(e,n){B[n]=function(e,r,i,s){return B.isFunction(r)&&(s=s||i,i=r,r=t),B.ajax({type:n,url:e,data:r,success:i,dataType:s})}}),B.extend({getScript:function(e,n){return B.get(e,t,n,"script")},getJSON:function(e,t,n){return B.get(e,t,n,"json")},ajaxSetup:function(e,t){return t?h(e,B.ajaxSettings):(t=e,e=B.ajaxSettings),h(e,t),e},ajaxSettings:{url:un,isLocal:Jt.test(an[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":fn},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":B.parseJSON,"text xml":B.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:d(sn),ajaxTransport:d(on),ajax:function(e,n){function r(e,n,r,p){if(E!==2){E=2,b&&clearTimeout(b),y=t,m=p||"",T.readyState=e>0?4:0;var d,v,g,w=n,x=r?l(i,T,r):t,N,C;if(e>=200&&e<300||e===304){if(i.ifModified){if(N=T.getResponseHeader("Last-Modified"))B.lastModified[h]=N;if(C=T.getResponseHeader("Etag"))B.etag[h]=C}if(e===304)w="notmodified",d=!0;else try{v=f(i,x),w="success",d=!0}catch(k){w="parsererror",g=k}}else{g=w;if(!w||e)w="error",e<0&&(e=0)}T.status=e,T.statusText=""+(n||w),d?u.resolveWith(s,[v,w,T]):u.rejectWith(s,[T,w,g]),T.statusCode(c),c=t,S&&o.trigger("ajax"+(d?"Success":"Error"),[T,i,d?v:g]),a.fireWith(s,[T,w]),S&&(o.trigger("ajaxComplete",[T,i]),--B.active||B.event.trigger("ajaxStop"))}}typeof e=="object"&&(n=e,e=t),n=n||{};var i=B.ajaxSetup({},n),s=i.context||i,o=s!==i&&(s.nodeType||s instanceof B)?B(s):B.event,u=B.Deferred(),a=B.Callbacks("once memory"),c=i.statusCode||{},h,d={},v={},m,g,y,b,w,E=0,S,x,T={readyState:0,setRequestHeader:function(e,t){if(!E){var n=e.toLowerCase();e=v[n]=v[n]||e,d[e]=t}return this},getAllResponseHeaders:function(){return E===2?m:null},getResponseHeader:function(e){var n;if(E===2){if(!g){g={};while(n=Vt.exec(m))g[n[1].toLowerCase()]=n[2]}n=g[e.toLowerCase()]}return n===t?null:n},overrideMimeType:function(e){return E||(i.mimeType=e),this},abort:function(e){return e=e||"abort",y&&y.abort(e),r(0,e),this}};u.promise(T),T.success=T.done,T.error=T.fail,T.complete=a.add,T.statusCode=function(e){if(e){var t;if(E<2)for(t in e)c[t]=[c[t],e[t]];else t=e[T.status],T.then(t,t)}return this},i.url=((e||i.url)+"").replace(Xt,"").replace(Qt,an[1]+"//"),i.dataTypes=B.trim(i.dataType||"*").toLowerCase().split(en),i.crossDomain==null&&(w=nn.exec(i.url.toLowerCase()),i.crossDomain=!(!w||w[1]==an[1]&&w[2]==an[2]&&(w[3]||(w[1]==="http:"?80:443))==(an[3]||(an[1]==="http:"?80:443)))),i.data&&i.processData&&typeof i.data!="string"&&(i.data=B.param(i.data,i.traditional)),p(sn,i,n,T);if(E===2)return!1;S=i.global,i.type=i.type.toUpperCase(),i.hasContent=!Kt.test(i.type),S&&B.active++===0&&B.event.trigger("ajaxStart");if(!i.hasContent){i.data&&(i.url+=(Gt.test(i.url)?"&":"?")+i.data,delete i.data),h=i.url;if(i.cache===!1){var N=B.now(),C=i.url.replace(tn,"$1_="+N);i.url=C+(C===i.url?(Gt.test(i.url)?"&":"?")+"_="+N:"")}}(i.data&&i.hasContent&&i.contentType!==!1||n.contentType)&&T.setRequestHeader("Content-Type",i.contentType),i.ifModified&&(h=h||i.url,B.lastModified[h]&&T.setRequestHeader("If-Modified-Since",B.lastModified[h]),B.etag[h]&&T.setRequestHeader("If-None-Match",B.etag[h])),T.setRequestHeader("Accept",i.dataTypes[0]&&i.accepts[i.dataTypes[0]]?i.accepts[i.dataTypes[0]]+(i.dataTypes[0]!=="*"?", "+fn+"; q=0.01":""):i.accepts["*"]);for(x in i.headers)T.setRequestHeader(x,i.headers[x]);if(!i.beforeSend||i.beforeSend.call(s,T,i)!==!1&&E!==2){for(x in{success:1,error:1,complete:1})T[x](i[x]);y=p(on,i,n,T);if(!y)r(-1,"No Transport");else{T.readyState=1,S&&o.trigger("ajaxSend",[T,i]),i.async&&i.timeout>0&&(b=setTimeout(function(){T.abort("timeout")},i.timeout));try{E=1,y.send(d,r)}catch(k){if(!(E<2))throw k;r(-1,k)}}return T}return T.abort(),!1},param:function(e,n){var r=[],i=function(e,t){t=B.isFunction(t)?t():t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};n===t&&(n=B.ajaxSettings.traditional);if(B.isArray(e)||e.jquery&&!B.isPlainObject(e))B.each(e,function(){i(this.name,this.value)});else for(var s in e)c(s,e[s],n,i);return r.join("&").replace(Ut,"+")}}),B.extend({active:0,lastModified:{},etag:{}});var cn=B.now(),hn=/(\=)\?(&|$)|\?\?/i;B.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return B.expando+"_"+cn++}}),B.ajaxPrefilter("json jsonp",function(t,n,r){var i=t.contentType==="application/x-www-form-urlencoded"&&typeof t.data=="string";if(t.dataTypes[0]==="jsonp"||t.jsonp!==!1&&(hn.test(t.url)||i&&hn.test(t.data))){var s,o=t.jsonpCallback=B.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,u=e[o],a=t.url,f=t.data,l="$1"+o+"$2";return t.jsonp!==!1&&(a=a.replace(hn,l),t.url===a&&(i&&(f=f.replace(hn,l)),t.data===f&&(a+=(/\?/.test(a)?"&":"?")+t.jsonp+"="+o))),t.url=a,t.data=f,e[o]=function(e){s=[e]},r.always(function(){e[o]=u,s&&B.isFunction(u)&&e[o](s[0])}),t.converters["script json"]=function(){return s||B.error(o+" was not called"),s[0]},t.dataTypes[0]="json","script"}}),B.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(e){return B.globalEval(e),e}}}),B.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),B.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=D.head||D.getElementsByTagName("head")[0]||D.documentElement;return{send:function(i,s){n=D.createElement("script"),n.async="async",e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,i){if(i||!n.readyState||/loaded|complete/.test(n.readyState))n.onload=n.onreadystatechange=null,r&&n.parentNode&&r.removeChild(n),n=t,i||s(200,"success")},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(0,1)}}}});var pn=e.ActiveXObject?function(){for(var e in vn)vn[e](0,1)}:!1,dn=0,vn;B.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&a()||u()}:a,function(e){B.extend(B.support,{ajax:!!e,cors:!!e&&"withCredentials"in e})}(B.ajaxSettings.xhr()),B.support.ajax&&B.ajaxTransport(function(n){if(!n.crossDomain||B.support.cors){var r;return{send:function(i,s){var o=n.xhr(),u,a;n.username?o.open(n.type,n.url,n.async,n.username,n.password):o.open(n.type,n.url,n.async);if(n.xhrFields)for(a in n.xhrFields)o[a]=n.xhrFields[a];n.mimeType&&o.overrideMimeType&&o.overrideMimeType(n.mimeType),!n.crossDomain&&!i["X-Requested-With"]&&(i["X-Requested-With"]="XMLHttpRequest");try{for(a in i)o.setRequestHeader(a,i[a])}catch(f){}o.send(n.hasContent&&n.data||null),r=function(e,i){var a,f,l,c,h;try{if(r&&(i||o.readyState===4)){r=t,u&&(o.onreadystatechange=B.noop,pn&&delete vn[u]);if(i)o.readyState!==4&&o.abort();else{a=o.status,l=o.getAllResponseHeaders(),c={},h=o.responseXML,h&&h.documentElement&&(c.xml=h),c.text=o.responseText;try{f=o.statusText}catch(p){f=""}!a&&n.isLocal&&!n.crossDomain?a=c.text?200:404:a===1223&&(a=204)}}}catch(d){i||s(-1,d)}c&&s(a,f,c,l)},!n.async||o.readyState===4?r():(u=++dn,pn&&(vn||(vn={},B(e).unload(pn)),vn[u]=r),o.onreadystatechange=r)},abort:function(){r&&r(0,1)}}}});var mn={},gn,yn,bn=/^(?:toggle|show|hide)$/,wn=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,En,Sn=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],xn;B.fn.extend({show:function(e,t,n){var s,o;if(e||e===0)return this.animate(i("show",3),e,t,n);for(var u=0,a=this.length;u<a;u++)s=this[u],s.style&&(o=s.style.display,!B._data(s,"olddisplay")&&o==="none"&&(o=s.style.display=""),o===""&&B.css(s,"display")==="none"&&B._data(s,"olddisplay",r(s.nodeName)));for(u=0;u<a;u++){s=this[u];if(s.style){o=s.style.display;if(o===""||o==="none")s.style.display=B._data(s,"olddisplay")||""}}return this},hide:function(e,t,n){if(e||e===0)return this.animate(i("hide",3),e,t,n);var r,s,o=0,u=this.length;for(;o<u;o++)r=this[o],r.style&&(s=B.css(r,"display"),s!=="none"&&!B._data(r,"olddisplay")&&B._data(r,"olddisplay",s));for(o=0;o<u;o++)this[o].style&&(this[o].style.display="none");return this},_toggle:B.fn.toggle,toggle:function(e,t,n){var r=typeof e=="boolean";return B.isFunction(e)&&B.isFunction(t)?this._toggle.apply(this,arguments):e==null||r?this.each(function(){var t=r?e:B(this).is(":hidden");B(this)[t?"show":"hide"]()}):this.animate(i("toggle",3),e,t,n),this},fadeTo:function(e,t,n,r){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,i){function s(){o.queue===!1&&B._mark(this);var t=B.extend({},o),n=this.nodeType===1,i=n&&B(this).is(":hidden"),s,u,a,f,l,c,h,p,d;t.animatedProperties={};for(a in e){s=B.camelCase(a),a!==s&&(e[s]=e[a],delete e[a]),u=e[s],B.isArray(u)?(t.animatedProperties[s]=u[1],u=e[s]=u[0]):t.animatedProperties[s]=t.specialEasing&&t.specialEasing[s]||t.easing||"swing";if(u==="hide"&&i||u==="show"&&!i)return t.complete.call(this);n&&(s==="height"||s==="width")&&(t.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],B.css(this,"display")==="inline"&&B.css(this,"float")==="none"&&(!B.support.inlineBlockNeedsLayout||r(this.nodeName)==="inline"?this.style.display="inline-block":this.style.zoom=1))}t.overflow!=null&&(this.style.overflow="hidden");for(a in e)f=new B.fx(this,t,a),u=e[a],bn.test(u)?(d=B._data(this,"toggle"+a)||(u==="toggle"?i?"show":"hide":0),d?(B._data(this,"toggle"+a,d==="show"?"hide":"show"),f[d]()):f[u]()):(l=wn.exec(u),c=f.cur(),l?(h=parseFloat(l[2]),p=l[3]||(B.cssNumber[a]?"":"px"),p!=="px"&&(B.style(this,a,(h||1)+p),c=(h||1)/f.cur()*c,B.style(this,a,c+p)),l[1]&&(h=(l[1]==="-="?-1:1)*h+c),f.custom(c,h,p)):f.custom(c,u,""));return!0}var o=B.speed(t,n,i);return B.isEmptyObject(e)?this.each(o.complete,[!1]):(e=B.extend({},e),o.queue===!1?this.each(s):this.queue(o.queue,s))},stop:function(e,n,r){return typeof e!="string"&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){function t(e,t,n){var i=t[n];B.removeData(e,n,!0),i.stop(r)}var n,i=!1,s=B.timers,o=B._data(this);r||B._unmark(!0,this);if(e==null)for(n in o)o[n]&&o[n].stop&&n.indexOf(".run")===n.length-4&&t(this,o,n);else o[n=e+".run"]&&o[n].stop&&t(this,o,n);for(n=s.length;n--;)s[n].elem===this&&(e==null||s[n].queue===e)&&(r?s[n](!0):s[n].saveState(),i=!0,s.splice(n,1));(!r||!i)&&B.dequeue(this,e)})}}),B.each({slideDown:i("show",1),slideUp:i("hide",1),slideToggle:i("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){B.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),B.extend({speed:function(e,t,n){var r=e&&typeof e=="object"?B.extend({},e):{complete:n||!n&&t||B.isFunction(e)&&e,duration:e,easing:n&&t||t&&!B.isFunction(t)&&t};r.duration=B.fx.off?0:typeof r.duration=="number"?r.duration:r.duration in B.fx.speeds?B.fx.speeds[r.duration]:B.fx.speeds._default;if(r.queue==null||r.queue===!0)r.queue="fx";return r.old=r.complete,r.complete=function(e){B.isFunction(r.old)&&r.old.call(this),r.queue?B.dequeue(this,r.queue):e!==!1&&B._unmark(this)},r},easing:{linear:function(e,t,n,r){return n+r*e},swing:function(e,t,n,r){return(-Math.cos(e*Math.PI)/2+.5)*r+n}},timers:[],fx:function(e,t,n){this.options=t,this.elem=e,this.prop=n,t.orig=t.orig||{}}}),B.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(B.fx.step[this.prop]||B.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]==null||!!this.elem.style&&this.elem.style[this.prop]!=null){var e,t=B.css(this.elem,this.prop);return isNaN(e=parseFloat(t))?!t||t==="auto"?0:t:e}return this.elem[this.prop]},custom:function(e,n,r){function i(e){return s.step(e)}var s=this,u=B.fx;this.startTime=xn||o(),this.end=n,this.now=this.start=e,this.pos=this.state=0,this.unit=r||this.unit||(B.cssNumber[this.prop]?"":"px"),i.queue=this.options.queue,i.elem=this.elem,i.saveState=function(){s.options.hide&&B._data(s.elem,"fxshow"+s.prop)===t&&B._data(s.elem,"fxshow"+s.prop,s.start)},i()&&B.timers.push(i)&&!En&&(En=setInterval(u.tick,u.interval))},show:function(){var e=B._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=e||B.style(this.elem,this.prop),this.options.show=!0,e!==t?this.custom(this.cur(),e):this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur()),B(this.elem).show()},hide:function(){this.options.orig[this.prop]=B._data(this.elem,"fxshow"+this.prop)||B.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(e){var t,n,r,i=xn||o(),s=!0,u=this.elem,a=this.options;if(e||i>=a.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),a.animatedProperties[this.prop]=!0;for(t in a.animatedProperties)a.animatedProperties[t]!==!0&&(s=!1);if(s){a.overflow!=null&&!B.support.shrinkWrapBlocks&&B.each(["","X","Y"],function(e,t){u.style["overflow"+t]=a.overflow[e]}),a.hide&&B(u).hide();if(a.hide||a.show)for(t in a.animatedProperties)B.style(u,t,a.orig[t]),B.removeData(u,"fxshow"+t,!0),B.removeData(u,"toggle"+t,!0);r=a.complete,r&&(a.complete=!1,r.call(u))}return!1}return a.duration==Infinity?this.now=i:(n=i-this.startTime,this.state=n/a.duration,this.pos=B.easing[a.animatedProperties[this.prop]](this.state,n,0,1,a.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update(),!0}},B.extend(B.fx,{tick:function(){var e,t=B.timers,n=0;for(;n<t.length;n++)e=t[n],!e()&&t[n]===e&&t.splice(n--,1);t.length||B.fx.stop()},interval:13,stop:function(){clearInterval(En),En=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(e){B.style(e.elem,"opacity",e.now)},_default:function(e){e.elem.style&&e.elem.style[e.prop]!=null?e.elem.style[e.prop]=e.now+e.unit:e.elem[e.prop]=e.now}}}),B.each(["width","height"],function(e,t){B.fx.step[t]=function(e){B.style(e.elem,t,Math.max(0,e.now)+e.unit)}}),B.expr&&B.expr.filters&&(B.expr.filters.animated=function(e){return B.grep(B.timers,function(t){return e===t.elem}).length});var Tn=/^t(?:able|d|h)$/i,Nn=/^(?:body|html)$/i;"getBoundingClientRect"in D.documentElement?B.fn.offset=function(e){var t=this[0],r;if(e)return this.each(function(t){B.offset.setOffset(this,e,t)});if(!t||!t.ownerDocument)return null;if(t===t.ownerDocument.body)return B.offset.bodyOffset(t);try{r=t.getBoundingClientRect()}catch(i){}var s=t.ownerDocument,o=s.documentElement;if(!r||!B.contains(o,t))return r?{top:r.top,left:r.left}:{top:0,left:0};var u=s.body,a=n(s),f=o.clientTop||u.clientTop||0,l=o.clientLeft||u.clientLeft||0,c=a.pageYOffset||B.support.boxModel&&o.scrollTop||u.scrollTop,h=a.pageXOffset||B.support.boxModel&&o.scrollLeft||u.scrollLeft,p=r.top+c-f,d=r.left+h-l;return{top:p,left:d}}:B.fn.offset=function(e){var t=this[0];if(e)return this.each(function(t){B.offset.setOffset(this,e,t)});if(!t||!t.ownerDocument)return null;if(t===t.ownerDocument.body)return B.offset.bodyOffset(t);var n,r=t.offsetParent,i=t,s=t.ownerDocument,o=s.documentElement,u=s.body,a=s.defaultView,f=a?a.getComputedStyle(t,null):t.currentStyle,l=t.offsetTop,c=t.offsetLeft;while((t=t.parentNode)&&t!==u&&t!==o){if(B.support.fixedPosition&&f.position==="fixed")break;n=a?a.getComputedStyle(t,null):t.currentStyle,l-=t.scrollTop,c-=t.scrollLeft,t===r&&(l+=t.offsetTop,c+=t.offsetLeft,B.support.doesNotAddBorder&&(!B.support.doesAddBorderForTableAndCells||!Tn.test(t.nodeName))&&(l+=parseFloat(n.borderTopWidth)||0,c+=parseFloat(n.borderLeftWidth)||0),i=r,r=t.offsetParent),B.support.subtractsBorderForOverflowNotVisible&&n.overflow!=="visible"&&(l+=parseFloat(n.borderTopWidth)||0,c+=parseFloat(n.borderLeftWidth)||0),f=n}if(f.position==="relative"||f.position==="static")l+=u.offsetTop,c+=u.offsetLeft;return B.support.fixedPosition&&f.position==="fixed"&&(l+=Math.max(o.scrollTop,u.scrollTop),c+=Math.max(o.scrollLeft,u.scrollLeft)),{top:l,left:c}},B.offset={bodyOffset:function(e){var t=e.offsetTop,n=e.offsetLeft;return B.support.doesNotIncludeMarginInBodyOffset&&(t+=parseFloat(B.css(e,"marginTop"))||0,n+=parseFloat(B.css(e,"marginLeft"))||0),{top:t,left:n}},setOffset:function(e,t,n){var r=B.css(e,"position");r==="static"&&(e.style.position="relative");var i=B(e),s=i.offset(),o=B.css(e,"top"),u=B.css(e,"left"),a=(r==="absolute"||r==="fixed")&&B.inArray("auto",[o,u])>-1,f={},l={},c,h;a?(l=i.position(),c=l.top,h=l.left):(c=parseFloat(o)||0,h=parseFloat(u)||0),B.isFunction(t)&&(t=t.call(e,n,s)),t.top!=null&&(f.top=t.top-s.top+c),t.left!=null&&(f.left=t.left-s.left+h),"using"in t?t.using.call(e,f):i.css(f)}},B.fn.extend({position:function(){if(!this[0])return null;var e=this[0],t=this.offsetParent(),n=this.offset(),r=Nn.test(t[0].nodeName)?{top:0,left:0}:t.offset();return n.top-=parseFloat(B.css(e,"marginTop"))||0,n.left-=parseFloat(B.css(e,"marginLeft"))||0,r.top+=parseFloat(B.css(t[0],"borderTopWidth"))||0,r.left+=parseFloat(B.css(t[0],"borderLeftWidth"))||0,{top:n.top-r.top,left:n.left-r.left}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||D.body;while(e&&!Nn.test(e.nodeName)&&B.css(e,"position")==="static")e=e.offsetParent;return e})}}),B.each(["Left","Top"],function(e,r){var i="scroll"+r;B.fn[i]=function(r){var s,o;return r===t?(s=this[0],s?(o=n(s),o?"pageXOffset"in o?o[e?"pageYOffset":"pageXOffset"]:B.support.boxModel&&o.document.documentElement[i]||o.document.body[i]:s[i]):null):this.each(function(){o=n(this),o?o.scrollTo(e?B(o).scrollLeft():r,e?r:B(o).scrollTop()):this[i]=r})}}),B.each(["Height","Width"],function(e,n){var r=n.toLowerCase();B.fn["inner"+n]=function(){var e=this[0];return e?e.style?parseFloat(B.css(e,r,"padding")):this[r]():null},B.fn["outer"+n]=function(e){var t=this[0];return t?t.style?parseFloat(B.css(t,r,e?"margin":"border")):this[r]():null},B.fn[r]=function(e){var i=this[0];if(!i)return e==null?null:this;if(B.isFunction(e))return this.each(function(t){var n=B(this);n[r](e.call(this,t,n[r]()))});if(B.isWindow(i)){var s=i.document.documentElement["client"+n],o=i.document.body;return i.document.compatMode==="CSS1Compat"&&s||o&&o["client"+n]||s}if(i.nodeType===9)return Math.max(i.documentElement["client"+n],i.body["scroll"+n],i.documentElement["scroll"+n],i.body["offset"+n],i.documentElement["offset"+n]);if(e===t){var u=B.css(i,r),a=parseFloat(u);return B.isNumeric(a)?a:u}return this.css(r,typeof e=="string"?e:e+"px")}}),e.jQuery=e.$=B,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return B})}(window),TD.controller.feather=function(){var exposed={};exposed.latestFeatherId=6;var feather_base;return window.location.href.indexOf("http://localhost:8090")===0?feather_base="http://localhost:8090":feather_base="https://web.tweetdeck.com",exposed.loadFeathers=function(isRetry){var d=new TD.core.defer.Deferred;return $.get(feather_base+"/web/scripts/unbundled/feathers.js").success(function(feathers){try{eval(feathers),d.callback()}catch(e){d.errback()}}).error(function(e,t,n){isRetry||exposed.loadFeathers(!0),d.errback()}),d},exposed.applyFeathers=function(e){var t=exposed.latestFeatherId,n,r=_.sortBy(e,function(e){return e.id});for(var i=0;i<r.length;i++){n=r[i];if(n.id>t)try{n.patch(),t=n.id}catch(s){console.log("Error patching feather id: "+n.id+" "+s)}}exposed.latestFeatherId=t},setInterval(exposed.loadFeathers,36e5),exposed}(),function(e){var t={};e.publish=function(n,r){var i=t[n];i&&e.each(i,function(){this.apply(e,r||[])})},e.subscribe=function(e,n){return t[e]||(t[e]=[]),t[e].push(n),[e,n]},e.unsubscribe=function(n){if(!n||!(n instanceof Array))throw new Error("unsubscribe(): handle must be an instance of Array.");var r=n[0];t[r]&&e.each(t[r],function(e){this==n[1]&&t[r].splice(e,1)})},e.unsubscribeAll=function(e){delete t[e]}}(jQuery),TD.core.base64=function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t=function(e){e=e.replace(/\r\n/g,"\n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(r&63|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(r&63|128))}return t},n=function(e){var t="",n=0,r=c1=c2=0;while(n<e.length)r=e.charCodeAt(n),r<128?(t+=String.fromCharCode(r),n++):r>191&&r<224?(c2=e.charCodeAt(n+1),t+=String.fromCharCode((r&31)<<6|c2&63),n+=2):(c2=e.charCodeAt(n+1),c3=e.charCodeAt(n+2),t+=String.fromCharCode((r&15)<<12|(c2&63)<<6|c3&63),n+=3);return t},r=function(n){var r="",i,s,o,u,a,f,l,c=0;n=t(n);while(c<n.length)i=n.charCodeAt(c++),s=n.charCodeAt(c++),o=n.charCodeAt(c++),u=i>>2,a=(i&3)<<4|s>>4,f=(s&15)<<2|o>>6,l=o&63,isNaN(s)?f=l=64:isNaN(o)&&(l=64),r=r+e.charAt(u)+e.charAt(a)+e.charAt(f)+e.charAt(l);return r},i=function(t){var r="",i,s,o,u,a,f,l,c=0;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(c<t.length)u=e.indexOf(t.charAt(c++)),a=e.indexOf(t.charAt(c++)),f=e.indexOf(t.charAt(c++)),l=e.indexOf(t.charAt(c++)),i=u<<2|a>>4,s=(a&15)<<4|f>>2,o=(f&3)<<6|l,r+=String.fromCharCode(i),f!=64&&(r+=String.fromCharCode(s)),l!=64&&(r+=String.fromCharCode(o));return r=n(r),r};return{encode:r,decode:i}}(),function(e,t){"use strict";function n(e){return"[object Arguments]"==nt.call(e)}function r(e){return new i(e)}function i(e){if(e&&e._wrapped)return e;this._wrapped=e}function s(){for(var e,t,n,r=-1,i=arguments.length,s={e:"",f:"",k:"",q:"",c:{d:"",m:"++l<o"},o:{d:""}};++r<i;)for(t in e=arguments[r],e)n=(n=e[t])==k?"":n,/d|m|j/.test(t)?("string"==typeof n&&(n={b:n,n:n}),s.c[t]=n.b,s.o[t]=n.n):s[t]=n;e=s.a,t=s.c,n=s.o;var r=/^[^,]+/.exec(e)[0],i=n.m,o=/\S+$/.exec(i||r)[0];s.g=r,s.i=O,s.h="j.call("+o+",l)",s.l=o,s.p=j,s.r=s.r!==L,s.f||(s.f="if(!"+r+")return u");if("r"==r||!t.j)s.c=k;return i||(n.m="l in "+o),Function("c,i,j,k,n,s,w,z,C,D,h,E",'"use strict";return function('+e+"){"+ft(s)+"}")(z,V,Z,T,f,R,tt,K,nt,C,L)}function o(e,t){return I[t]}function u(e){return"\\"+U[e]}function a(e){return q[e]}function f(e,t){return function(n,r,i){return e.call(t,n,r,i)}}function l(){}function c(e,t){var n=I.length;return I[n]="'+_.escape("+t+")+'",F+n}function h(e,t){var n=I.length;return I[n]="'+((__t=("+t+"))==null?'':__t)+'",F+n}function p(e,t){var n=I.length;return I[n]="';"+t+";__p+='",F+n}function d(e,t,n,r){if(!e)return n;var i=e.length,s=3>arguments.length;r&&(t=f(t,r));if(i===i>>>0){for(i&&s&&(n=e[--i]);i--;)n=t(n,e[i],i,e);return n}var o=Lt(e);for((i=o.length)&&s&&(n=e[o[--i]]);i--;)s=o[i],n=t(n,e[s],s,e);return n}function v(e,n,r){if(e)return n==t||r?e[0]:tt.call(e,0,n)}function m(e,t){var n=[];if(!e)return n;for(var r,i=-1,s=e.length;++i<s;)r=e[i],kt(r)?et.apply(n,t?r:m(r)):n.push(r);return n}function g(e,t,n){if(!e)return-1;var r=-1,i=e.length;if(n){if("number"!=typeof n)return r=w(e,t),e[r]===t?r:-1;r=(0>n?Math.max(0,i+n):n)-1}for(;++r<i;)if(e[r]===t)return r;return-1}function y(e,t,n){var r=-Infinity,i=r;if(!e)return i;var s=-1,o=e.length;if(!t){for(;++s<o;)e[s]>i&&(i=e[s]);return i}for(n&&(t=f(t,n));++s<o;)n=t(e[s],s,e),n>r&&(r=n,i=e[s]);return i}function b(e,n,r){return e?tt.call(e,n==t||r?1:n):[]}function w(e,t,n,r){if(!e)return 0;var i,s=0,o=e.length;if(n){if(r)var u=n,n=function(e){return u.call(r,e)};for(t=n(t);s<o;)i=s+o>>>1,n(e[i])<t?s=i+1:o=i}else for(;s<o;)i=s+o>>>1,e[i]<t?s=i+1:o=i;return s}function E(e,t,n,r){var i=[];if(!e)return i;var s=-1,o=e.length,u=[];"function"==typeof t&&(r=n,n=t,t=L);for(n?r&&(n=f(n,r)):n=T;++s<o;)if(r=n(e[s],s,e),t?!s||u[u.length-1]!==r:0>g(u,r))u.push(r),i.push(e[s]);return i}function S(e,t){function n(){var o=arguments,u=t;return i||(e=t[r]),s.length&&(o=o.length?Y.apply(s,o):s),this instanceof n?(l.prototype=e.prototype,u=new l,o=e.apply(u,o),R[typeof o]&&o!==k?o:u):e.apply(u,o)}var r,i=nt.call(e)==V;if(i){if(rt)return rt.call.apply(rt,arguments)}else r=t,t=e;var s=tt.call(arguments,2);return n}function x(e,n,r){r||(r=[]);if(e===n)return 0!==e||1/e==1/n;if(e==t||n==t)return e===n;e._chain&&(e=e._wrapped),n._chain&&(n=n._wrapped);if(e.isEqual&&nt.call(e.isEqual)==V)return e.isEqual(n);if(n.isEqual&&nt.call(n.isEqual)==V)return n.isEqual(e);var i=nt.call(e);if(i!=nt.call(n))return L;switch(i){case K:return e==""+n;case $:return e!=+e?n!=+n:0==e?1/e==1/n:e==+n;case W:case X:return+e==+n;case J:return e.source==n.source&&e.global==n.global&&e.multiline==n.multiline&&e.ignoreCase==n.ignoreCase}if("object"!=typeof e||"object"!=typeof n)return L;for(var s=r.length;s--;)if(r[s]==e)return C;var s=-1,o=C,u=0;r.push(e);if(i==z){if(u=e.length,o=u==n.length)for(;u--&&(o=x(e[u],n[u],r)););}else{if("constructor"in e!="constructor"in n||e.constructor!=n.constructor)return L;for(var a in e)if(Z.call(e,a)&&(u++,!(o=Z.call(n,a)&&x(e[a],n[a],r))))break;if(o){for(a in n)if(Z.call(n,a)&&!(u--))break;o=!u}if(o&&O)for(;7>++s&&(a=j[s],!Z.call(e,a)||!!(o=Z.call(n,a)&&x(e[a],n[a],r))););}return r.pop(),o}function T(e){return e}function N(e){wt(Ct(e),function(t){var n=r[t]=e[t];i.prototype[t]=function(){var e=[this._wrapped];return arguments.length&&et.apply(e,arguments),e=n.apply(r,e),this._chain&&(e=new i(e),e._chain=C),e}})}var C=!0,k=null,L=!1,A="object"==typeof exports&&exports&&("object"==typeof global&&global&&global==global.global&&(e=global),exports),O=!{valueOf:0}.propertyIsEnumerable("valueOf"),M=0,_=e._,D=RegExp("^"+({}.valueOf+"").replace(/[.*+?^=!:${}()|[\]\/\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),P=/__token__(\d+)/g,H=/[&<"']/g,B=/['\n\r\t\u2028\u2029\\]/g,j="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),F="__token__",I=[],q={"&":"&amp;","<":"&lt;",'"':"&quot;","'":"&#x27;"},R={"boolean":L,"function":C,object:C,number:L,string:L,"undefined":L},U={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},z="[object Array]",W="[object Boolean]",X="[object Date]",V="[object Function]",$="[object Number]",J="[object RegExp]",K="[object String]",Q=Array.prototype,G=Object.prototype,Y=Q.concat,Z=G.hasOwnProperty,et=Q.push,tt=Q.slice,nt=G.toString,rt=D.test(rt=tt.bind)&&/\n|Opera/.test(rt+nt.call(e.opera))&&rt,it=D.test(it=Array.isArray)&&it,st=e.isFinite,ot=D.test(ot=Object.keys)&&ot,ut=e.clearTimeout,at=e.setTimeout;r.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,variable:"obj"};var ft=Function("obj","var __p;with(obj){__p='var l,u';if(k){__p+='='+k};__p+=';'+f+';'+q+';';if(c){__p+='var o='+g+'.length;l=-1;';if(o){__p+='if(o===o>>>0){'};__p+=''+c['d']+';while('+c['m']+'){'+c['j']+'}';if(o){__p+='}'}}if(o){if(c){__p+='else{'}if(!i){__p+='var v=typeof '+l+'==\\'function\\';'};__p+=''+o['d']+';for('+o['m']+'){';if(i){if(r){__p+='if('+h+'){'};__p+=''+o['j']+';';if(r){__p+='}'}}else{__p+='if(!(v&&l==\\'prototype\\')';if(r){__p+='&&'+h};__p+='){'+o['j']+'}'};__p+='}';if(i){__p+='var g='+l+'.constructor;';for(var k=0;k<7;k++){__p+='l=\\''+p[k]+'\\';if(';if(p[k]=='constructor'){__p+='!(g&&g.prototype==='+l+')&&'};__p+=''+h+'){'+o['j']+'}'}}if(c){__p+='}'}};__p+=''+e+';return u'}return __p"),lt={a:"f,d,B",k:"f",q:"if(!d){d=k}else if(B){d=n(d,B)}",j:"d(f[l],l,f)"},ct={k:"D",j:"if(!d(f[l],l,f))return!u"},ht={a:"r",k:"r",q:"for(var x,y=1,o=arguments.length;y<o;y++){x=arguments[y];"+(O?"if(x){":""),m:"l in x",r:L,j:"r[l]=x[l]",e:(O?"}":"")+"}"},pt={k:"[]",j:"d(f[l],l,f)&&u.push(f[l])"},dt={q:"if(B)d=n(d,B)"},vt={j:{n:lt.j}},mt={k:"",f:"if(!f)return[]",d:{b:"u=Array(o)",n:"u=[]"},j:{b:"u[l]=d(f[l],l,f)",n:"u.push(d(f[l],l,f))"}},gt=s({a:"r",f:"if(!s[typeof r]||r===null)throw TypeError()",k:"[]",j:"u.push(l)"}),D=s({a:"f,A",k:"h",j:"if(f[l]===A)return D"}),yt=s(lt,ct),G=s(lt,pt),bt=s(lt,dt,{k:"",j:"if(d(f[l],l,f))return f[l]"}),wt=s(lt,dt),Et=s(mt,{a:"f,p",q:"var b=w.call(arguments,2),m=typeof p=='function'",j:{b:"u[l]=(m?p:f[l][p]).apply(f[l],b)",n:"u.push((m?p:f[l][p]).apply(f[l],b))"}}),St=s(lt,mt),xt=s(mt,{a:"f,t",j:{b:"u[l]=f[l][t]",n:"u.push(f[l][t])"}}),mt=s({a:"f,d,a,B",k:"a",q:"var q=arguments.length<3;if(B)d=n(d,B)",d:{b:"if(q)u=f[++l]"},j:{b:"u=d(u,f[l],l,f)",n:"u=q?(q=h,f[l]):d(u,f[l],l,f)"}}),pt=s(lt,pt,{j:"!"+pt.j}),ct=s(lt,ct,{k:"h",j:ct.j.replace("!","")}),Tt=s(ht,{j:"if(r[l]==E)"+ht.j}),Nt=s(ht),ht=s(lt,dt,vt,{r:L}),lt=s(lt,dt,vt),Ct=s({a:"r",k:"[]",r:L,j:"if(C.call(r[l])==i)u.push(l)",e:"u.sort()"});n(arguments)||(n=function(e){return!!e&&!!Z.call(e,"callee")});var kt=it||function(e){return nt.call(e)==z},it=s({a:"F",k:"D",q:"var e=C.call(F);if(e==c||e==z)return!F.length",j:{n:"return h"}}),Lt=ot?function(e){return"function"==typeof e?gt(e):ot(e)}:gt,At=s({a:"r",k:"[]",j:"u.push(r[l])"});r.VERSION="0.3.1",r.after=function(e,t){return 1>e?t():function(){if(1>--e)return t.apply(this,arguments)}},r.bind=S,r.bindAll=function(e){var t=arguments,n=1;1==t.length&&(n=0,t=Ct(e));for(var r=t.length;n<r;n++)e[t[n]]=S(e[t[n]],e);return e},r.chain=function(e){return e=new i(e),e._chain=C,e},r.clone=function(e){return R[typeof e]&&e!==k?kt(e)?e.slice():Nt({},e):e},r.compact=function(e){var t=[];if(!e)return t;for(var n=-1,r=e.length;++n<r;)e[n]&&t.push(e[n]);return t},r.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length;n--;)t=[e[n].apply(this,t)];return t[0]}},r.contains=D,r.debounce=function(e,n,r){function i(){a=t,r||e.apply(u,s)}var s,o,u,a;return function(){var t=r&&!a;return s=arguments,u=this,ut(a),a=at(i,n),t&&(o=e.apply(u,s)),o}},r.defaults=Tt,r.defer=function(e){var n=tt.call(arguments,1);return at(function(){return e.apply(t,n)},1)},r.delay=function(e,n){var r=tt.call(arguments,2);return at(function(){return e.apply(t,r)},n)},r.difference=function(e){var t=[];if(!e)return t;for(var n=-1,r=e.length,i=Y.apply(t,tt.call(arguments,1));++n<r;)0>g(i,e[n])&&t.push(e[n]);return t},r.escape=function(e){return e==k?"":(e+"").replace(H,a)},r.every=yt,r.extend=Nt,r.filter=G,r.find=bt,r.first=v,r.flatten=m,r.forEach=wt,r.forIn=ht,r.forOwn=lt,r.functions=Ct,r.groupBy=function(e,t,n){var r={};if(!e)return r;var i,s=-1,o="function"==typeof t,u=e.length;for(o&&n&&(t=f(t,n));++s<u;)i=e[s],n=o?t(i,s,e):i[t],(Z.call(r,n)?r[n]:r[n]=[]).push(i);return r},r.has=function(e,t){return Z.call(e,t)},r.identity=T,r.indexOf=g,r.initial=function(e,n,r){return e?tt.call(e,0,-(n==t||r?1:n)):[]},r.intersection=function(e){var t=[];if(!e)return t;for(var n,r=-1,i=e.length,s=tt.call(arguments,1);++r<i;)n=e[r],0>g(t,n)&&yt(s,function(e){return-1<g(e,n)})&&t.push(n);return t},r.invoke=Et,r.isArguments=n,r.isArray=kt,r.isBoolean=function(e){return e===C||e===L||nt.call(e)==W},r.isDate=function(e){return nt.call(e)==X},r.isElement=function(e){return!!e&&1==e.nodeType},r.isEmpty=it,r.isEqual=x,r.isFinite=function(e){return st(e)&&nt.call(e)==$},r.isFunction=function(e){return nt.call(e)==V},r.isNaN=function(e){return nt.call(e)==$&&e!=+e},r.isNull=function(e){return e===k},r.isNumber=function(e){return nt.call(e)==$},r.isObject=function(e){return R[typeof e]&&e!==k},r.isRegExp=function(e){return nt.call(e)==J},r.isString=function(e){return nt.call(e)==K},r.isUndefined=function(e){return e===t},r.keys=Lt,r.last=function(e,n,r){if(e){var i=e.length;return n==t||r?e[i-1]:tt.call(e,-n||i)}},r.lastIndexOf=function(e,t,n){if(!e)return-1;var r=e.length;for(n&&"number"==typeof n&&(r=(0>n?Math.max(0,r+n):Math.min(n,r-1))+1);r--;)if(e[r]===t)return r;return-1},r.map=St,r.max=y,r.memoize=function(e,t){var n={};return function(){var r=t?t.apply(this,arguments):arguments[0];return Z.call(n,r)?n[r]:n[r]=e.apply(this,arguments)}},r.min=function(e,t,n){var r=Infinity,i=r;if(!e)return i;var s=-1,o=e.length;if(!t){for(;++s<o;)e[s]<i&&(i=e[s]);return i}for(n&&(t=f(t,n));++s<o;)n=t(e[s],s,e),n<r&&(r=n,i=e[s]);return i},r.mixin=N,r.noConflict=function(){return e._=_,this},r.once=function(e){var t,n=L;return function(){return n?t:(n=C,t=e.apply(this,arguments))}},r.partial=function(e){var t=tt.call(arguments,1),n=t.length;return function(){var r;return r=arguments,r.length&&(t.length=n,et.apply(t,r)),r=1==t.length?e.call(this,t[0]):e.apply(this,t),t.length=n,r}},r.pick=function(e){for(var t,n=0,r=Y.apply(Q,arguments),i=r.length,s={};++n<i;)t=r[n],t in e&&(s[t]=e[t]);return s},r.pluck=xt,r.range=function(e,t,n){n||(n=1),2>arguments.length&&(t=e||0,e=0);for(var r=-1,i=Math.max(Math.ceil((t-e)/n),0),s=Array(i);++r<i;)s[r]=e,e+=n;return s},r.reduce=mt,r.reduceRight=d,r.reject=pt,r.rest=b,r.result=function(e,t){if(!e)return k;var n=e[t];return nt.call(n)==V?e[t]():n},r.shuffle=function(e){if(!e)return[];for(var t,n=-1,r=e.length,i=Array(r);++n<r;)t=Math.floor(Math.random()*(n+1)),i[n]=i[t],i[t]=e[n];return i},r.size=function(e){var t=nt.call(e);return t==z||t==K?e.length:Lt(e).length},r.some=ct,r.sortBy=function(e,n,r){if(!e)return[];if("string"==typeof n)var i=n,n=function(e){return e[i]};else r&&(n=f(n,r));for(var r=-1,s=e.length,o=Array(s);++r<s;)o[r]={a:n(e[r],r,e),b:e[r]};for(o.sort(function(e,n){var r=e.a,i=n.a;return r===t?1:i===t?-1:r<i?-1:r>i?1:0});s--;)o[s]=o[s].b;return o},r.sortedIndex=w,r.tap=function(e,t){return t(e),e},r.template=function(e,t,n){n||(n={});var i;i=r.templateSettings;var s=n.escape,a=n.evaluate,f=n.interpolate,n=n.variable;return s==k&&(s=i.escape),a==k&&(a=i.evaluate),f==k&&(f=i.interpolate),s&&(e=e.replace(s,c)),f&&(e=e.replace(f,h)),a&&(e=e.replace(a,p)),e="__p='"+e.replace(B,u).replace(P,o)+"';",I.length=0,n||(n=i.variable,e="with("+n+"||{}){"+e+"}"),e="function("+n+"){var __p,__t,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}"+e+"return __p}",i=Function("_","return "+e)(r),t?i(t):(i.source=e,i)},r.throttle=function(e,n){function r(){a=new Date,u=t,e.apply(o,i)}var i,s,o,u,a=0;return function(){var t=new Date,f=n-(t-a);return i=arguments,o=this,0>=f?(a=t,s=e.apply(o,i)):u||(u=at(r,f)),s}},r.times=function(e,t,n){var r=-1;if(n)for(;++r<e;)t.call(n,r);else for(;++r<e;)t(r)},r.toArray=function(e){if(!e)return[];if(nt.call(e.toArray)==V)return e.toArray();var t=e.length;return t===t>>>0?tt.call(e):At(e)},r.union=function(){for(var e=-1,t=[],n=Y.apply(t,arguments),r=n.length;++e<r;)0>g(t,n[e])&&t.push(n[e]);return t},r.uniq=E,r.uniqueId=function(e){var t=M++;return e?e+t:t},r.values=At,r.without=function(e){var t=[];if(!e)return t;for(var n=tt.call(arguments,1),r=-1,i=e.length;++r<i;)0>g(n,e[r])&&t.push(e[r]);return t},r.wrap=function(e,t){return function(){var n=[e];return arguments.length&&et.apply(n,arguments),t.apply(this,n)}},r.zip=function(e){if(!e)return[];for(var t=-1,n=y(xt(arguments,"length")),r=Array(n);++t<n;)r[t]=xt(arguments,t);return r},r.all=yt,r.any=ct,r.collect=St,r.detect=bt,r.each=wt,r.foldl=mt,r.foldr=d,r.head=v,r.include=D,r.inject=mt,r.methods=Ct,r.select=G,r.tail=b,r.take=v,r.unique=E,i.prototype=r.prototype,N(r),i.prototype.chain=function(){return this._chain=C,this},i.prototype.value=function(){return this._wrapped},wt("pop push reverse shift sort splice unshift".split(" "),function(e){var t=Q[e];i.prototype[e]=function(){var e=this._wrapped;return t.apply(e,arguments),e.length===0&&delete e[0],this._chain&&(e=new i(e),e._chain=C),e}}),wt(["concat","join","slice"],function(e){var t=Q[e];i.prototype[e]=function(){var e=t.apply(this._wrapped,arguments);return this._chain&&(e=new i(e),e._chain=C),e}}),typeof define=="function"&&typeof define.amd=="object"&&define.amd?(e._=r,define(function(){return r})):A?"object"==typeof module&&module&&module.s==A?(module.s=r)._=r:A._=r:e._=r}(this),function(){function e(e){return e?n.escapeRegExp(e):"\\s"}var t=String.prototype.trim,n;n=this._s={capitalize:function(e){return e.charAt(0).toUpperCase()+e.substring(1).toLowerCase()},join:function(e){for(var t="",n=1;n<arguments.length;n+=1)t+=String(arguments[n]),n!==arguments.length-1&&(t+=String(e));return t},escapeRegExp:function(e){return e.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")},reverse:function(e){return Array.prototype.reverse.apply(e.split("")).join("")},contains:function(e,t){return e.indexOf(t)!==-1},clean:function(e){return n.strip(e.replace(/\s+/g," "))},trim:function(n,r){return!r&&t?t.call(n):(r=e(r),n.replace(new RegExp("^["+r+"]+|["+r+"]+$","g"),""))},ltrim:function(t,n){return n=e(n),t.replace(new RegExp("^["+n+"]+","g"),"")},rtrim:function(t,n){return n=e(n),t.replace(new RegExp("["+n+"]+$","g"),"")},startsWith:function(e,t){return e.length>=t.length&&e.substring(0,t.length)===t},endsWith:function(e,t){return e.length>=t.length&&e.substring(e.length-t.length)===t},sprintf:function(){for(var e=0,t,n=arguments[e++],r=[],i,s,o;n;){if(i=/^[^\x25]+/.exec(n))r.push(i[0]);else if(i=/^\x25{2}/.exec(n))r.push("%");else{if(!(i=/^\x25(?:(\d+)\$)?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(n)))throw"Huh ?!";if((t=arguments[i[1]||e++])==null||t==undefined)throw"Too few arguments.";if(/[^s]/.test(i[7])&&typeof t!="number")throw"Expecting number but found "+typeof t;switch(i[7]){case"b":t=t.toString(2);break;case"c":t=String.fromCharCode(t);break;case"d":t=parseInt(t);break;case"e":t=i[6]?t.toExponential(i[6]):t.toExponential();break;case"f":t=i[6]?parseFloat(t).toFixed(i[6]):parseFloat(t);break;case"o":t=t.toString(8);break;case"s":t=(t=String(t))&&i[6]?t.substring(0,i[6]):t;break;case"u":t=Math.abs(t);break;case"x":t=t.toString(16);break;case"X":t=t.toString(16).toUpperCase()}t=/[def]/.test(i[7])&&i[2]&&t>=0?"+"+t:t,s=i[3]?i[3]=="0"?"0":i[3].charAt(1):" ",o=i[5]-String(t).length-0;if(i[5]){o=o;for(var u=[];o>0;u[--o]=s);s=u.join("")}else s="";s=s,r.push(""+(i[4]?t+s:s+t))}n=n.substring(i[0].length)}return r.join("")}},this._s.strip=n.trim,this._s.lstrip=n.ltrim,this._s.rstrip=n.rtrim,this._&&this._.mixin(this._s)}(),TD.core.sha1=function(e){function t(e,t){var n=e<<t|e>>>32-t;return n}function n(e){var t="",n,r,i;for(n=0;n<=6;n+=2)r=e>>>n*4+4&15,i=e>>>n*4&15,t+=r.toString(16)+i.toString(16);return t}function r(e){var t="",n,r;for(n=7;n>=0;n--)r=e>>>n*4&15,t+=r.toString(16);return t}function i(e){e=e.replace(/\r\n/g,"\n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(r&63|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(r&63|128))}return t}var s,o,u,a=new Array(80),f=1732584193,l=4023233417,c=2562383102,h=271733878,p=3285377520,d,v,m,g,y,b;e=i(e);var w=e.length,E=new Array;for(o=0;o<w-3;o+=4)u=e.charCodeAt(o)<<24|e.charCodeAt(o+1)<<16|e.charCodeAt(o+2)<<8|e.charCodeAt(o+3),E.push(u);switch(w%4){case 0:o=2147483648;break;case 1:o=e.charCodeAt(w-1)<<24|8388608;break;case 2:o=e.charCodeAt(w-2)<<24|e.charCodeAt(w-1)<<16|32768;break;case 3:o=e.charCodeAt(w-3)<<24|e.charCodeAt(w-2)<<16|e.charCodeAt(w-1)<<8|128}E.push(o);while(E.length%16!=14)E.push(0);E.push(w>>>29),E.push(w<<3&4294967295);for(s=0;s<E.length;s+=16){for(o=0;o<16;o++)a[o]=E[s+o];for(o=16;o<=79;o++)a[o]=t(a[o-3]^a[o-8]^a[o-14]^a[o-16],1);d=f,v=l,m=c,g=h,y=p;for(o=0;o<=19;o++)b=t(d,5)+(v&m|~v&g)+y+a[o]+1518500249&4294967295,y=g,g=m,m=t(v,30),v=d,d=b;for(o=20;o<=39;o++)b=t(d,5)+(v^m^g)+y+a[o]+1859775393&4294967295,y=g,g=m,m=t(v,30),v=d,d=b;for(o=40;o<=59;o++)b=t(d,5)+(v&m|v&g|m&g)+y+a[o]+2400959708&4294967295,y=g,g=m,m=t(v,30),v=d,d=b;for(o=60;o<=79;o++)b=t(d,5)+(v^m^g)+y+a[o]+3395469782&4294967295,y=g,g=m,m=t(v,30),v=d,d=b;f=f+d&4294967295,l=l+v&4294967295,c=c+m&4294967295,h=h+g&4294967295,p=p+y&4294967295}var b=r(f)+r(l)+r(c)+r(h)+r(p);return b.toLowerCase()},function(){var e=8,t="=",n=0,r=function(t){var n=[],r=(1<<e)-1,i=t.length*e,s;for(s=0;s<i;s+=e)n[s>>5]|=(t.charCodeAt(s/e)&r)<<32-e-s%32;return n},i=function(e){var t=[],n=e.length,r,i;for(r=0;r<n;r+=2){i=parseInt(e.substr(r,2),16);if(!!isNaN(i))return"INVALID HEX STRING";t[r>>3]|=i<<24-4*(r%8)}return t},s=function(e){var t=n?"0123456789ABCDEF":"0123456789abcdef",r="",i=e.length*4,s,o;for(s=0;s<i;s+=1)o=e[s>>2]>>(3-s%4)*8,r+=t.charAt(o>>4&15)+t.charAt(o&15);return r},o=function(e){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="",i=e.length*4,s,o,u;for(s=0;s<i;s+=3){u=(e[s>>2]>>8*(3-s%4)&255)<<16|(e[s+1>>2]>>8*(3-(s+1)%4)&255)<<8|e[s+2>>2]>>8*(3-(s+2)%4)&255;for(o=0;o<4;o+=1)s*8+o*6<=e.length*32?r+=n.charAt(u>>6*(3-o)&63):r+=t}return r},u=function(e,t){return e>>>t|e<<32-t},a=function(e,t){return e>>>t},f=function(e,t,n){return e&t^~e&n},l=function(e,t,n){return e&t^e&n^t&n},c=function(e){return u(e,2)^u(e,13)^u(e,22)},h=function(e){return u(e,6)^u(e,11)^u(e,25)},p=function(e){return u(e,7)^u(e,18)^a(e,3)},d=function(e){return u(e,17)^u(e,19)^a(e,10)},v=function(e,t){var n=(e&65535)+(t&65535),r=(e>>>16)+(t>>>16)+(n>>>16);return(r&65535)<<16|n&65535},m=function(e,t,n,r){var i=(e&65535)+(t&65535)+(n&65535)+(r&65535),s=(e>>>16)+(t>>>16)+(n>>>16)+(r>>>16)+(i>>>16);return(s&65535)<<16|i&65535},g=function(e,t,n,r,i){var s=(e&65535)+(t&65535)+(n&65535)+(r&65535)+(i&65535),o=(e>>>16)+(t>>>16)+(n>>>16)+(r>>>16)+(i>>>16)+(s>>>16);return(o&65535)<<16|s&65535},y=function(e,t,n){var r,i,s,o,u,a,y,b,w,E,S,x,T,N,C,k=[],L;if(n==="SHA-224"||n==="SHA-256")x=(t+65>>9<<4)+15,C=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],n==="SHA-224"?S=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]:S=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];e[t>>5]|=128<<24-t%32,e[x]=t,L=e.length;for(T=0;T<L;T+=16){r=S[0],i=S[1],s=S[2],o=S[3],u=S[4],a=S[5],y=S[6],b=S[7];for(N=0;N<64;N+=1)N<16?k[N]=e[N+T]:k[N]=m(d(k[N-2]),k[N-7],p(k[N-15]),k[N-16]),w=g(b,h(u),f(u,a,y),C[N],k[N]),E=v(c(r),l(r,i,s)),b=y,y=a,a=u,u=v(o,w),o=s,s=i,i=r,r=v(w,E);S[0]=v(r,S[0]),S[1]=v(i,S[1]),S[2]=v(s,S[2]),S[3]=v(o,S[3]),S[4]=v(u,S[4]),S[5]=v(a,S[5]),S[6]=v(y,S[6]),S[7]=v(b,S[7])}switch(n){case"SHA-224":return[S[0],S[1],S[2],S[3],S[4],S[5],S[6]];case"SHA-256":return S;default:return[]}},b=function(t,n){this.sha224=null,this.sha256=null,this.strBinLen=null,this.strToHash=null;if("HEX"===n){if(0!==t.length%2)return"TEXT MUST BE IN BYTE INCREMENTS";this.strBinLen=t.length*4,this.strToHash=i(t)}else{if("ASCII"!==n&&"undefined"!=typeof n)return"UNKNOWN TEXT INPUT TYPE";this.strBinLen=t.length*e,this.strToHash=r(t)}};b.prototype={getHash:function(e,t){var n=null,r=this.strToHash.slice();switch(t){case"HEX":n=s;break;case"B64":n=o;break;default:return"FORMAT NOT RECOGNIZED"}switch(e){case"SHA-224":return null===this.sha224&&(this.sha224=y(r,this.strBinLen,e)),n(this.sha224);case"SHA-256":return null===this.sha256&&(this.sha256=y(r,this.strBinLen,e)),n(this.sha256);default:return"HASH NOT RECOGNIZED"}},getHMAC:function(t,n,u,a){var f,l,c,h,p,d,v=[],m=[];switch(a){case"HEX":f=s;break;case"B64":f=o;break;default:return"FORMAT NOT RECOGNIZED"}switch(u){case"SHA-224":d=224;break;case"SHA-256":d=256;break;default:return"HASH NOT RECOGNIZED"}if("HEX"===n){if(0!==t.length%2)return"KEY MUST BE IN BYTE INCREMENTS";l=i(t),p=t.length*4}else{if("ASCII"!==n)return"UNKNOWN KEY INPUT TYPE";l=r(t),p=t.length*e}64<p/8?(l=y(l,p,u),l[15]&=4294967040):64>p/8&&(l[15]&=4294967040);for(c=0;c<=15;c+=1)v[c]=l[c]^909522486,m[c]=l[c]^1549556828;return h=y(v.concat(this.strToHash),512+this.strBinLen,u),h=y(m.concat(h),512+d,u),f(h)}},window.jsSHA=b}(),TD.util=function(){var e,t,n=0,r=1e3,i=r*60,s=i*60,o=s*24,u=o*7,a=/(.+)(?:_normal)\.(\w+)$/,f=new RegExp("<(?:.|\\n)*?>","gm"),l=/\B(?=(\d{3})+(?!\d))/g,c=/^[@\uff20]?/,h=/^https?:\/\/twitter.com\/([a-zA-Z0-9-_]+)(?:\/status\/([0-9]+))?$/;return $.subscribe("/date",function(e){var t=TD.util.parseDateString(e).getTime(),r=(new Date).getTime();n=t-r}),{ANCHOR_TAG_REGEXP:/href=/g,LT_REGEXP:/</g,GT_REGEXP:/>/g,SINGLE_QUOTE_REGEXP:/'/g,QUOTE_REGEXP:/"/g,TWITTER_USERNAME_REGEXP:/@([A-Za-z0-9_]+)/g,parseDateString:function(e){var t;return $.browser.msie&&e?t=new Date(Date.parse(e.replace(/( \+)/," UTC$1"))):t=new Date(e),t},parseISO8601:function(e){var t=e.split("+"),n=t[0].split("T"),r=n[0].split("-"),i=n[1].split("Z"),s=i[0].split(":"),o=s[2].split("."),u=Number(s[0]),a=new Date;return a.setUTCDate(1),a.setUTCMonth(0),a.setUTCFullYear(Number(r[0])),a.setUTCMonth(Number(r[1])-1),a.setUTCDate(Number(r[2])),a.setUTCHours(Number(u)),a.setUTCMinutes(Number(s[1])),a.setUTCSeconds(Number(o[0])),o[1]?a.setUTCMilliseconds(Number(o[1].substring(0,3))):a.setUTCMilliseconds(0),a},iso8601:function(e){e||(e=new Date);var t=("000"+e.getUTCFullYear()).slice(-4)+"-"+("0"+(e.getUTCMonth()+1)).slice(-2)+"-"+("0"+e.getUTCDate()).slice(-2)+"T"+("0"+e.getUTCHours()).slice(-2)+":"+("0"+e.getUTCMinutes()).slice(-2)+":"+("0"+e.getUTCSeconds()).slice(-2);return e.getMilliseconds()&&(t+="."+("000"+e.getMilliseconds()).slice(-3)),t},unixTime:function(e){return Math.round(e.getTime()/1e3)},prettyDate:function(e){return TD.util.timeAgo(e.getTime(),!1,!0)},clean:function(e){return e?e.replace(this.LT_REGEXP,"&lt;").replace(this.GT_REGEXP,"&gt;").replace(this.SINGLE_QUOTE_REGEXP,"&#39;").replace(this.QUOTE_REGEXP,"&quot;"):e},removeHTMLCodes:function(e){return e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')},stripHTMLTags:function(e){return e.replace(f,"")},htmlToText:function(e){return $("<div>"+e+"</div>").text()},h:function(e){var t=$("<div/>"),n=function(e){return e?t.text(e).html().replace(/\"/gi,"&quot;"):e};return this.h=function(e){return n(e)},n(e)},transform:function(e,t){return e?(t=t||{},this.updateEntities(e,t),this.linkify(e,t)):""},updateEntities:function(e,t){var n=twttr.txt.modifyIndicesFromUnicodeToUTF16,r,i,s,o,u,a,f,l;t.media&&t.media.length?n(e,t.media):t.media=[];if(t.urls&&t.urls.length)n(e,t.urls);else{i=this.extractURLEntities(e),l={},t.urls=[];for(s=0;s<t.media.length;s++)l[t.media[s].url]=!0;for(s=0;s<i.length;s++)l[i[s].url]||t.urls.push(i[s])}t.hashtags&&t.hashtags.length?n(e,t.hashtags):t.hashtags=this.extractHashtagEntities(e),t.user_mentions&&t.user_mentions.length?n(e,t.user_mentions):t.user_mentions=[],t.cashtags=twttr.txt.extractCashtagsWithIndices(e),r=this.extractMentionEntities(e);for(s=0,u=r.length;s<u;s++)a=r[s],f=this.getEntityOverlap(a,t),f?a.list_slug&&a.indices[0]===f.indices[0]&&(f.indices=a.indices,f.list_slug=a.list_slug):t.user_mentions.push(a);return t},extractURLEntities:function(e){return twttr.txt.extractUrlsWithIndices(e)},extractMentionEntities:function(e){var t=twttr.txt.extractMentionsOrListsWithIndices(e);return _.each(t,function(e){e.screen_name=e.screenName,e.list_slug=e.listSlug,delete e.screenName,delete e.listSlug}),t},extractHashtagEntities:function(e){var t=twttr.txt.extractHashtagsWithIndices(e);return _.each(t,function(e){e.text=e.hashtag,delete e.hashtag}),t},getEntityOverlap:function(e,t){var n=t.urls;n=n.concat(t.media),n=n.concat(t.user_mentions),n=n.concat(t.hashtags);for(var r=0,i=n.length;r<i;r++)if(e.indices[0]<n[r].indices[1]&&e.indices[1]>n[r].indices[0])return n[r];return null},linkify:function(e,t){var n,r,i,s,o,u="",a,f=t.urls||[];f=f.concat(t.media||[]),f=f.concat(t.user_mentions||[]),f=f.concat(t.hashtags||[]),f=f.concat(t.cashtags||[]),f.sort(function(e,t){return t.indices[0]-e.indices[0]});for(var l=0,c=f.length;l<c;l++)s=f[l],n=e.substring(0,s.indices[0]),r=e.substring(s.indices[0],s.indices[1]),i=e.substring(s.indices[1]),o="",s.url?r===s.url?o=this.createUrlAnchor(s):o=r:s.screen_name?s.list_slug?o=TD.ui.template.render("text/list_link",{slug:s.list_slug.substr(1),user:{screenName:s.screen_name},fullName:"@"+s.screen_name+s.list_slug}):(r='<span class="at">@</span>'+s.screen_name,o='<a href="http://twitter.com/'+s.screen_name+'"',o+=' rel="user"',o+=' data-user-name="'+s.screen_name+'"',o+=' target="_blank">'+r+"</a>"):s.text?(a={searchTerm:s.text,symbol:"#",escapedSymbol:escape("#")},o=TD.ui.template.render("text/search_link",a)):s.cashtag&&(a={searchTerm:s.cashtag,symbol:"$",escapedSymbol:escape("$")},o=TD.ui.template.render("text/search_link",a)),u=o+this.clean(i)+u,e=n;return this.clean(e)+u},createUrlAnchor:function(e){var t,n=e.url,r="url",i=e.expanded_url||e.url,s=i.match(h),o,u;return s&&(o=s[1],u=s[2]),!_.startsWith(n,"https://")&&!_.startsWith(n,"http://")&&(n="http://"+n),t='<a href="'+TD.util.escape(n)+'" target="_blank" class="url-ext" ',e.expanded_url&&(t+='data-full-url="'+TD.util.escape(e.expanded_url)+'" '),u?(r="tweet",t+='data-tweet-id="'+u+'" '):o&&(r="user",t+='data-user-name="'+o+'" '),t+='rel="'+r+'" ',e.display_url&&e.expanded_url&&e.display_url.charCodeAt(e.display_url.length-1)==8230&&(t+='title="'+TD.util.escape(e.expanded_url)+'" '),t+=">"+TD.util.escape(e.display_url||e.url)+"</a>",t},getReplyUsers:function(e){var t=e.getMainTweet(),n={},r=e.account.getUsername().toLowerCase(),i=[t.user.screenName];return i=i.concat(twttr.txt.extractMentions(t.text)),e.retweetedStatus&&i.push(e.user.screenName),i=i.filter(function(e){return e.toLowerCase()!==r}),t.user.isMe()&&i.length===0&&i.unshift(t.user.screenName),i=i.filter(function(e){var t=e.toLowerCase(),r=!n[t];return n[t]=!0,r}),i=i.map(TD.util.atMentionify),i},pluralise:function(e,t,n){return n!=1?t:e},atMentionify:function(e){return e.replace(c,"@")},deMentionify:function(e){return e.replace(c,"")},selectAttrsFrom:function(e,t){var n={};for(var r=0;r<t.length;r++)n[t[r]]=e[t[r]];return n},values:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t},isEmpty:_.isEmpty,isChromeApp:function(){return e==null&&(e=_.startsWith(window.location.href,"chrome-extension://")),e},isWrapperApp:function(){return t==null&&(t=Boolean(window.deck&&deck.inApp())),t},isUnsupportedWebWrapperVersion:function(){var e,t=!1,n=Boolean(TD.util.isWrapperApp()&&deck.getWrapperVersion),r;if(n){r=deck.getWrapperVersion();switch(TD.util.getAppEnv()){case"mac":e=TD.minWrapperVersionMac;break;case"win":e=TD.minWrapperVersionWin}t=!e||TD.util.versionComparator(r,e)<0}return t},isRetina:function(){return window.devicePixelRatio>=1.5},shouldStream:function(){var e=new XMLHttpRequest,t="withCredentials"in e;return t&&TD.settings.getUseStream()&&!TD.config.disable_streaming},getCurrentLocation:function(e,t,n){var r=Number.MAX_VALUE,i,s,o,u=navigator.geolocation,a=function(e){var t=e.coords.accuracy;t<r&&(i=e,r=t),t<50&&(clearTimeout(o),f())},f=function(){u.clearWatch(s),i?t(i):n&&n()};o=setTimeout(f,e),s=u.watchPosition(a,n,{enableHighAccuracy:!0})},openURL:function(e,t){if(!_.isString(e))return;if(!_.startsWith(e,"https://")&&!_.startsWith(e,"http://"))return;t&&(e=TD.net.util.addURLParameters(e,t));var n=window.open(e);n.focus()},maybeOpenClickExternally:function(e){var t=!1,n=$(e.currentTarget),r=n.prop("tagName"),i=n.attr("rel"),s=n.attr("target"),o=e.ctrlKey||e.shiftKey||e.altKey||e.metaKey||e.button!==0;return r==="A"&&s==="_blank"&&(i==="url"||o)&&(TD.util.isWrapperApp()?(TD.util.openURL(n.attr("href")),e.preventDefault(),e.stopImmediatePropagation()):e.stopImmediatePropagation(),t=!0),t},openEmail:function(e,t,n){var r="mailto:",i={};t&&(i.subject=t),n&&(i.body=n),e&&(r+=e),r=r+"?"+TD.net.util.formEncode(i),window.open(r)},escape:function(e){return this.clean(e)},truncateText:function(e,t,n,r,i,s){t=t==undefined?"â¦":t,r=r||0,s=s||0;var o;if(e.length>n+r){var u=e.indexOf(" ",n-s-1);u!=-1&&(n=Math.min(n,u+1)),o=e.substr(0,n),i&&(o=this.transform(o)),o+=t}return o},timesCached:null,timeWords:function(){return TD.util.timesCached||(TD.util.timesCached={longForm:{singular:{now:TD.i("now",null,!0),seconds:TD.i("{{one}} second ago",null,!0),minutes:TD.i("{{one}} minute ago",null,!0),hours:TD.i("{{one}} hour ago",null,!0),days:TD.i("{{one}} day ago",null,!0)},plural:{now:TD.i("now",null,!0),seconds:TD.i("{{plural_number}} seconds ago",null,!0),minutes:TD.i("{{plural_number}} minutes ago",null,!0),hours:TD.i("{{plural_number}} hours ago",null,!0),days:TD.i("{{plural_number}} days ago",null,!0)}},shortForm:{singular:{now:TD.i("now",null,!0),seconds:TD.i("{{one}}s",null,!0),minutes:TD.i("{{one}}m",null,!0),hours:TD.i("{{one}}h",null,!0),days:TD.i("{{one}}d",null,!0)},plural:{now:TD.i("now",null,!0),seconds:TD.i("{{plural_number}}s",null,!0),minutes:TD.i("{{plural_number}}m",null,!0),hours:TD.i("{{plural_number}}h",null,!0),days:TD.i("{{plural_number}}d",null,!0)}}}),TD.util.timesCached},datesCached:null,dates:function(){return TD.util.datesCached||(TD.util.datesCached={months:[TD.i("Jan"),TD.i("Feb"),TD.i("Mar"),TD.i("Apr"),TD.i("May"),TD.i("Jun"),TD.i("Jul"),TD.i("Aug"),TD.i("Sep"),TD.i("Oct"),TD.i("Nov"),TD.i("Dec")],dates:[TD.i("1st"),TD.i("2nd"),TD.i("3rd"),TD.i("4th"),TD.i("5th"),TD.i("6th"),TD.i("7th"),TD.i("8th"),TD.i("9th"),TD.i("10th"),TD.i("11th"),TD.i("12th"),TD.i("13th"),TD.i("14th"),TD.i("15th"),TD.i("16th"),TD.i("17th"),TD.i("18th"),TD.i("19th"),TD.i("20th"),TD.i("21st"),TD.i("22nd"),TD.i("23rd"),TD.i("24th"),TD.i("25th"),TD.i("26th"),TD.i("27th"),TD.i("28th"),TD.i("29th"),TD.i("30th"),TD.i("31st")]}),TD.util.datesCached},timeAgo:function(e,t,u){var a=(new Date).getTime(),f=(new Date(e)).getTime(),l,c=TD.util.timeWords()[t?"longForm":"shortForm"],h,p,d;return u&&(a+=n),l=a-f,isNaN(l)||l<r*-5?"":(l<r*7?(p="",h="now"):l<i?(p=Math.floor(l/r),h="seconds"):l<s?(p=Math.floor(l/i),h="minutes"):l<o?(p=Math.floor(l/s),h="hours"):(p=Math.floor(l/o),h="days"),p===1?c=c.singular:c=c.plural,d=TD.ui.template.toHtml(c[h],{one:p,plural_number:p}),d)},prettyTime:function(e){var t={month:TD.util.dates().months[e.getMonth()],hours24:e.getHours(),hours12:e.getHours()%12||12,minutes:TD.util.padLeadingZero(e.getMinutes()),amPm:e.getHours()<12?TD.i("am"):TD.i("pm"),date:TD.util.dates().dates[e.getDate()-1],day:e.getDate(),year:e.getFullYear().toString().slice(2)};return t},prettyTimeString:function(e){return TD.i("{{hours12}}:{{minutes}}{{amPm}} Â· {{day}} {{month}} {{year}}",TD.util.prettyTime(e))},padLeadingZero:function(e){return e.toString().replace(/^(\d)$/,"0$1")},prettyNumber:function(e){var t;if(typeof e=="string")e=parseInt(e,10);else if(typeof e!="number"||isNaN(e))return"";return t=e.toString().split("."),t[0].replace(l,",")},chirpDescSort:function(e,t){return t.created.getTime()-e.created.getTime()},chirpAscSort:function(e,t){return e.created.getTime()-t.created.getTime()},transformTwitterAvatar:function(e,t){return e.replace(a,"$1_"+t+".$2")},getOSName:function(){var e="";return this.isWrapperApp()?e=deck.osname():navigator.appVersion.indexOf("Win")!=-1?e="windows":navigator.appVersion.indexOf("Mac")!=-1?e="osx":navigator.appVersion.indexOf("Linux")!=-1&&(e="linux"),e},getAppEnv:function(){var e="unknown",t;if(this.isChromeApp())e="chrome";else if(this.isWrapperApp()){t=this.getOSName();switch(t){case"osx":e="mac";break;case"windows":e="win"}}else _.startsWith(window.location.href,"file://")||(e="web");return e},hasFixedScrollBars:function(){var e,t=$("<div>").css({width:"100px",height:"100px",overflow:"scroll",position:"absolute",top:"-9999px"});return $("body").append(t),e=t[0].offsetWidth-t[0].clientWidth,t.remove(),Boolean(e)},bind:function(e,t){return function(){e.apply(t,arguments)}},random:function(e,t){return t==null&&(t=e,e=0),e+(0|Math.random()*(t-e+1))},extendObjectWith:function(e,t){_.each(t,function(t){e[t[0]]=t[1]})},insertLogDivider:_.debounce(function(){console.log(" ")},1),versionComparator:function(e,t){e=e.toString(),t=t.toString();var n=e.split("."),r=t.split("."),i,s,o=Math.min(n.length,r.length);for(var u=0;u<o;u++){i=parseInt(n[u],10),s=parseInt(r[u],10);if(i>s)return 1;if(i<s)return-1}return n.length>r.length?1:n.length<r.length?-1:0},getPreciseTime:function(){if(!window.performance)return+(new Date);if(typeof window.performance.now=="function")return window.performance.now();if(typeof window.performance.webkitNow=="function")return window.performance.webkitNow()},fnPerformanceWrapper:function(e,t,n){return function(){var r=TD.util.getPreciseTime(),i,s=e.apply(t,arguments);return i=TD.util.getPreciseTime(),TD.controller.stats.performance.log(n,i-r),s}},logTimeToRenderColumn:function(e,t){var n;t>0&&(n=e/t,TD.controller.stats.performance.log(TD.controller.stats.performance.keys.RENDER_TWEET,n))},TpmCounter:function(e,t,n){var r=0,i=0,s=0,o=[],u=(new Date).getTime(),a=setInterval(function(){var e,a,f,l=(new Date).getTime(),c=l-t;o.push({renderedCount:s,startTime:u}),i+=s,s=0,u=l;while(o.length&&o[0].startTime<c)e=o.shift(),i-=e.renderedCount;o.length&&(a=l-o[0].startTime,f=6e4/a,r=i*f,$(document).trigger(n,{itemsPerMinute:Math.round(r)}))}.bind(this),e);this.incrementCounter=function(e){s+=e},this.stop=function(){clearInterval(a)}},deterministicObjectHash:function(e){var t=TD.util.createHashableObject(e),n=JSON.stringify(t),r=TD.core.sha1(n);return r=r.substr(0,10),r},createHashableObject:function(e){var t,n;if(Array.isArray(e))t=e.map(TD.util.createHashableObject),t.push("A");else if(e===Object(e)){t=[];for(var r in e)e.hasOwnProperty(r)&&(n=TD.util.createHashableObject(e[r]),t.push([r,n]));t.sort(function(e,t){return e[0].localeCompare(t[0])}),t.push("O")}else t=e;return t}}}(),TD.core.defer=function(){var e={};e.NAME="TD.core.defer",e.DEBUG_DEFERREDS=!1;var t=Array.prototype.slice,n=function(e){this.message=e,this.name=e};n.prototype=new Error,n.prototype.toString=function(){return this.message&&this.message!=this.name?this.name+"("+this.message.toString()+")":this.name+"()"};var r=function(e,t,r){r.prototype=new n(e.NAME+"."+t),e[t]=r};r(e,"AlreadyCalledError",function(e){this.deferred=e}),r(e,"CancelledError",function(e){this.deferred=e}),r(e,"GenericError",function(e){this.message=e}),r(e,"XMLHttpRequestError",function(e,t){this.req=e,this.message=t;try{this.number=e.status}catch(n){}});var i=function(){try{throw new Error("DEBUG_DEFERRED stack trace")}catch(e){return e.stack}};return e.Deferred=function(t){this.chain=[],this.id=_.uniqueId("d:"),e.DEBUG_DEFERREDS&&(this.create_stack=i()),this.fired=-1,this.paused=0,this.results=[null,null],this.canceller=t,this.silentlyCancelled=!1,this.chained=!1},e.Deferred.prototype={toString:function(){var e;return this.fired==-1?e="unfired":this.fired===0?e="success":e="error","Deferred("+this.id+", "+e+"["+this.chain.length+"])"},cancel:function(){this.fired==-1?(this.canceller?this.canceller(this):this.silentlyCancelled=!0,this.fired==-1&&this.errback(new e.CancelledError(this))):this.fired===0&&this.results[0]instanceof e.Deferred&&this.results[0].cancel()},_resback:function(t){e.DEBUG_DEFERREDS&&(this.invoke_stack=i()),this.fired=t instanceof Error?1:0,this.results[this.fired]=t,this._fire()},_check:function(){if(this.fired!=-1){if(!this.silentlyCancelled)throw new e.AlreadyCalledError(this);this.silentlyCancelled=!1;return}},callback:function(t){this._check();if(t instanceof e.Deferred)throw new Error("Deferred instances can only be chained if they are the result of a callback");this._resback(t)},errback:function(t){this._check();if(t instanceof e.Deferred)throw new Error("Deferred instances can only be chained if they are the result of a callback");t instanceof Error||(t=new e.GenericError(t)),this._resback(t)},addBoth:function(e){var n=t.call(arguments,1);return this.addCallbacks(e,e,n,n,null,null)},addBothWith:function(e,n){var r=t.call(arguments,2);return this.addCallbacks(n,n,r,r,e,e)},addCallback:function(e){var n=t.call(arguments,1);return this.addCallbacks(e,null,n,null,null,null)},addCallbackWith:function(e,n){var r=t.call(arguments,2);return this.addCallbacks(n,null,r,null,e,null)},addErrback:function(e){var n=t.call(arguments,1);return this.addCallbacks(null,e,null,n,null,null)},addErrbackWith:function(e,n){var r=t.call(arguments,2);return this.addCallbacks(null,n,null,r,null,e)},addCallbacks:function(e,t,n,r,i,s){if(this.chained)throw new Error("Chained Deferreds can not be re-used");return this.chain.push([e,t,n,r,i,s]),this.fired>=0&&this._fire(),this},_fire:function(){var t=this.chain,n=this.fired,r=this.results[n],i=this,s=null,o,u,a=function(e){i._resback(e),i.paused--,i.paused===0&&i.fired>=0&&i._fire()};while(t.length>0&&this.paused===0){var f=t.shift(),l=f[n];if(l===null)continue;try{f[2+n]?o=[r].concat(f[2+n]):o=[r],u=f[4+n],r=l.apply(u,o),n=r instanceof Error?1:0,r instanceof e.Deferred&&(s=a,this.paused++)}catch(c){n=1,c instanceof Error?r=c:r=new e.GenericError(c),r.stack&&r.stack.split?r.stackTrace=r.stack.split("\n"):r.stackTrace=[]}}this.fired=n,this.results[n]=r,s&&this.paused&&(r.addBoth(s),r.chained=!0)}},e.DeferredList=function(t,n,r){e.Deferred.apply(this,[r]),this.list=t;var i=[];this.resultList=i,this.finishedCount=0,this.fireOnOneCallback=Boolean(n&&n.fireOnOneCallback),this.fireOnOneErrback=Boolean(n&&n.fireOnOneErrback),this.consumeErrors=Boolean(n&&n.consumeErrors);var s=_.bind(this._cbDeferred,this);for(var o=0;o<t.length;o++){var u=t[o];i.push(void 0),u.addCallback(s,o,!0),u.addErrback(s,o,!1)}t.length===0&&!this.fireOnOneCallback&&this.callback(this.resultList)},e.DeferredList.prototype=new e.Deferred,e.DeferredList.prototype._cbDeferred=function(e,t,n){return this.resultList[t]=[n,e],this.finishedCount+=1,this.fired==-1&&(n&&this.fireOnOneCallback?this.callback([t,e]):!n&&this.fireOnOneErrback?this.errback(e):this.finishedCount==this.list.length&&this.callback(this.resultList)),!n&&this.consumeErrors&&(e=null),e},e.gatherResults=function(t){var n=new e.DeferredList(t,{fireOnOneErrback:!0});return n.addCallback(function(e){var t=[];for(var n=0;n<e.length;n++)t.push(e[n][1]);return t}),n},e.succeed=function(t){var n=new e.Deferred;return n.callback.apply(n,[t]),n},e.fail=function(t){var n=new e.Deferred;return n.errback.apply(n,[t]),n},e.maybeDeferred=function(n){var r;try{var i=n.apply(null,t.call(arguments,1));i instanceof e.Deferred?r=i:i instanceof Error?r=e.fail(i):r=e.succeed(i)}catch(s){r=e.fail(s)}return r},e}(),TD.util.i18n=function(){var e={},t,n,r=function(e){if(typeof TD_locale_messages=="undefined")return undefined;var t=TD_locale_messages[e];return t&&t.message?t.message:undefined},i=function(e){var t=deck.i18n(e);return t?t:undefined};return e.getMessage=function(e){return t||(TD.util.isChromeApp()?t=chrome.i18n.getMessage:TD.util.isWrapperApp()?t=i:t=r),t(e)},e.getLocale=function(){return n?n:(TD.util.isChromeApp()&&(n=e.getMessage("@@ui_locale")),n)},e}(),TD.constants={keyCodes:{enter:13,escape:27,tab:9,del:8,spacebar:32,upArrow:38,downArrow:40,leftArrow:37,rightArrow:39},charCodes:{space:32,questionMark:63},regexps:{name:/\S+/,username:/^[@ï¼ ]?([a-zA-Z0-9_]{1,15})$/,usernameWithAt:/^[@ï¼ ]{1}([a-zA-Z0-9_]{1,15}) /,usernameWithSpace:/^[@ï¼ ]{1}(\w{1,15})\s*$/,email:/^[\w-]+([^@,\s\<\>\(\)]*[\w-]+)?\@[\w-]+(\.[\w-]+)*\.[a-z]{2,}$/i,tokenSeparator:/[\s-_]+/},time:{oneDay:864e5,oneHour:36e5},TDApi:{ERROR_ACCOUNT_DOESNT_EXIST:"Account does not exist.",ERROR_BAD_PASSWORD:"BadPassword",ERROR_SESSION_EXPIRED:"SessionExpired"}},TD.languages={_index:null,_initialiseIndex:function(){var e=TD.languages.getAllLanguages();TD.languages._index={},e.forEach(function(e){TD.languages._index[e.code]=e,e.actual_code&&(TD.languages._index[e.actual_code]=e)})},getLanguageFromISOCode:function(e){TD.languages._index||TD.languages._initialiseIndex();var t=TD.languages._index[e];return _.clone(t)},getSystemLanguageCode:function(e){var t=navigator.language||navigator.userLanguage||"";return e&&(t=t.replace(/-[a-z]+$/i,"")),t},isSupportedTranslationSourceLanguage:function(e){var t=TD.languages.getSupportedTranslationSourceLanguages();return t.indexOf(e.toLowerCase())!==-1},isSystemLangSupportedDestinationLanguage:function(){var e=TD.languages.getSupportedTranslationDestinationLanguages();return e.indexOf(TD.languages.getSystemLanguageCode(!0).toLowerCase())!==-1||e.indexOf(TD.languages.getSystemLanguageCode(!1).toLowerCase())!==-1},getSupportedDestinationSystemLanguage:function(){var e=TD.languages.getSupportedTranslationDestinationLanguages();return e.indexOf(TD.languages.getSystemLanguageCode(!0).toLowerCase())!==-1?TD.languages.getSystemLanguageCode(!0):TD.languages.getSystemLanguageCode(!1)},getAllLanguages:function(){return[{code:"am",localized_name:TD.i("Amharic"),name:"á áá­á"},{code:"ar",localized_name:TD.i("Arabic"),name:"Ø§ÙØ¹Ø±Ø¨ÙØ©"},{code:"bg",localized_name:TD.i("Bulgarian"),name:"ÐÑÐ»Ð³Ð°ÑÑÐºÐ¸"},{code:"bn",localized_name:TD.i("Bengali"),name:"à¦¬à¦¾à¦à¦²à¦¾"},{code:"bo",localized_name:TD.i("Tibetan"),name:"à½à½¼à½à¼à½¦à¾à½"},{code:"chr",localized_name:TD.i("Cherokee"),name:"á£á³á©"},{code:"da",localized_name:TD.i("Danish"),name:"Dansk"},{code:"de",localized_name:TD.i("German"),name:"Deutsch"},{code:"dv",localized_name:TD.i("Maldivian"),name:"ÞÞ¨ÞÞ¬ÞÞ¨"},{code:"el",localized_name:TD.i("Greek"),name:"ÎÎ»Î»Î·Î½Î¹ÎºÎ¬"},{code:"en",localized_name:TD.i("English"),name:"English"},{code:"es",localized_name:TD.i("Spanish"),name:"EspaÃ±ol"},{code:"fa",localized_name:TD.i("Persian"),name:"ÙØ§Ø±Ø³Û"},{code:"fi",localized_name:TD.i("Finnish"),name:"Suomi"},{code:"fr",localized_name:TD.i("French"),name:"FranÃ§ais"},{code:"gu",localized_name:TD.i("Gujarati"),name:"àªà«àªàª°àª¾àª¤à«"},{code:"iw",actual_code:"he",localized_name:TD.i("Hebrew"),name:"×¢××¨××ª"},{code:"hi",localized_name:TD.i("Hindi"),name:"à¤¹à¤¿à¤à¤¦à¥"},{code:"hu",localized_name:TD.i("Hungarian"),name:"Magyar"},{code:"hy",localized_name:TD.i("Armenian"),name:"ÕÕ¡ÕµÕ¥ÖÕ¥Õ¶"},{code:"in",actual_code:"id",localized_name:TD.i("Indonesian"),name:"Bahasa Indonesia"},{code:"is",localized_name:TD.i("Icelandic"),name:"Ãslenska"},{code:"it",localized_name:TD.i("Italian"),name:"Italiano"},{code:"iu",localized_name:TD.i("Inuktitut"),name:"áááááá¦"},{code:"ja",localized_name:TD.i("Japanese"),name:"æ¥æ¬èª"},{code:"ka",localized_name:TD.i("Georgian"),name:"á¥áá áá£áá"},{code:"km",localized_name:TD.i("Khmer"),name:"ááááá"},{code:"kn",localized_name:TD.i("Kannada"),name:"à²à²¨à³à²¨à²¡"},{code:"ko",localized_name:TD.i("Korean"),name:"íêµ­ì´"},{code:"lo",localized_name:TD.i("Lao"),name:"àº¥àº²àº§"},{code:"lt",localized_name:TD.i("Lithuanian"),name:"LietuviÅ³"},{code:"ml",localized_name:TD.i("Malayalam"),name:"à´®à´²à´¯à´¾à´³à´"},{code:"my",localized_name:TD.i("Myanmar"),name:"áá¼ááºáá¬áá¬áá¬"},{code:"ne",localized_name:TD.i("Nepali"),name:"à¤¨à¥à¤ªà¤¾à¤²à¥"},{code:"nl",localized_name:TD.i("Dutch"),name:"Nederlands"},{code:"no",localized_name:TD.i("Norwegian"),name:"Norsk"},{code:"or",localized_name:TD.i("Oriya"),name:"à¬à¬¡à¬¼à¬¿à¬"},{code:"pa",localized_name:TD.i("Panjabi"),name:"à¨ªà©°à¨à¨¾à¨¬à©"},{code:"pl",localized_name:TD.i("Polish"),name:"Polski"},{code:"pt",localized_name:TD.i("Portuguese"),name:"PortuguÃªs"},{code:"ru",localized_name:TD.i("Russian"),name:"Ð ÑÑÑÐºÐ¸Ð¹"},{code:"si",localized_name:TD.i("Sinhala"),name:"à·à·à¶à·à¶½"},{code:"sv",localized_name:TD.i("Swedish"),name:"Svenska"},{code:"ta",localized_name:TD.i("Tamil"),name:"à®¤à®®à®¿à®´à¯"},{code:"te",localized_name:TD.i("Telugu"),name:"à°¤à±à°²à±à°à±"},{code:"th",localized_name:TD.i("Thai"),name:"à¹à¸à¸¢"},{code:"tl",localized_name:TD.i("Tagalog"),name:"Tagalog"},{code:"tr",localized_name:TD.i("Turkish"),name:"TÃ¼rkÃ§e"},{code:"ur",localized_name:TD.i("Urdu"),name:"ïºïº­ïº©ï»­"},{code:"vi",localized_name:TD.i("Vietnamese"),name:"Tiáº¿ng Viá»t"},{code:"zh",localized_name:TD.i("Chinese"),name:"ä¸­æ"}]},getSupportedTranslationSourceLanguages:function(){return["bg","ca","zh","cs","da","nl","en","et","fi","fr","de","el","ht","hi","hu","id","in","it","ja","ko","lv","lt","no","pl","pt","ro","ru","sk","sl","es","sv","th","tr","uk","vi","ar","fa","he"]},getSupportedTranslationDestinationLanguages:function(){return["bg","ca","zh-cn","zh-tw","cs","da","nl","en","et","fi","fr","de","el","ht","hi","hu","id","in","it","ja","ko","lv","lt","no","pl","pt","ro","ru","sk","sl","es","sv","th","tr","uk","vi","ar","fa","he"]}},TD.services.bitly=function(){var e={},t,n="tweetdeckapi",r="R_b8032856b71a14fabfe64f6845689ddf",i=function(e,t){var i="https://api-ssl.bitly.com/v3/"+e,s;t.login=n,t.apiKey=r,t.format="json";var o=TD.storage.accountController.getAccountsForService("bitly");if(o.length>0){var u=o[0];t.x_login=u.getUserID(),t.x_apiKey=u.getOAuthToken()}return s=TD.net.ajax.jsonp(i,t),s};return e.shorten=function(e,t,n){var r=e,s,o=function(r){var i=r.data;if(!i||!i.data||!i.data.url){n();return}i.data&&(i.data.long_url=e),t(i)};return!_.startsWith(e,"http://")&&!_.startsWith(e,"https://")&&(r="http://"+e),s=i("shorten",{longUrl:r}),s.addCallbacks(o,n),s},e}(),!function(e,t){typeof define=="function"?define(t):typeof module!="undefined"?module.exports=t():this[e]=t()}("klass",function(){function s(e){return f.call(o(e)?e:function(){},e,1)}function o(e){return typeof e===n}function u(e,t,n){return function(){var r=this.supr;this.supr=n[i][e];var s=t.apply(this,arguments);return this.supr=r,s}}function a(e,t,n){for(var s in t)t.hasOwnProperty(s)&&(e[s]=o(t[s])&&o(n[i][s])&&r.test(t[s])?u(s,t[s],n):t[s])}function f(e,t){function n(){}function c(){this.initialize?this.initialize.apply(this,arguments):(t||u&&r.apply(this,arguments),f.apply(this,arguments))}n[i]=this[i];var r=this,s=new n,u=o(e),f=u?e:this,l=u?{}:e;return c.methods=function(e){return a(s,e,r),c[i]=s,this},c.methods.call(c,l).prototype.constructor=c,c.extend=arguments.callee,c[i].implement=c.statics=function(e,t){return e=typeof e=="string"?function(){var n={};return n[e]=t,n}():e,a(this,e,r),this},c.mixin=function(){for(var e=0;e<arguments.length;e++){var t=arguments[e];t===undefined?console.warn("you have an undefined mixin coming from "+ns):t.call(this,this)}return this},c}var e=this,t=e.klass,n="function",r=/xyz/.test(function(){xyz})?/\bsupr\b/:/.*/,i="prototype";return s.noConflict=function(){return e.klass=t,this},e.klass=s,s}),klass.mixin=function(e,t){if(_.isString(e)){var n=window,r=e.split(".");for(var i=0,s=r.length;i<s;++i)n=n[r[i]]=n[r[i]]||(_.isUndefined(r[i+1])?t:{});return n}_.extend(e,t)},klass.mixin("TD.mixins.caretHelper",function(){return this.statics({spaceBoundary:/\s|$/,wordEnd:/\S+$/}).methods({init:function(){this.$input.bind("blur",_.bind(function(e){setTimeout(_.bind(function(){this.hide()},this),1e3)},this)).bind("mouseup",_.bind(function(e){setTimeout(_.bind(function(){this.getCaret()},this),0)},this)).bind("focus",_.bind(function(e){this.getCaret()},this))},getCurrentText:function(){return this.$input.val()},setCaretPosition:function(e){var t=this.$input[0];if(t.setSelectionRange)t.focus(),t.setSelectionRange(e,e);else if(t.createTextRange){var n=t.createTextRange();n.collapse(!0),n.moveEnd("character",e),n.moveStart("character",e),n.select()}this.lastCaret=e},getCaret:function(){var e=this.$input[0],t=0;if(document.selection){try{e.focus()}catch(n){}var r=document.selection.createRange();if(r==null)return this.lastCaret=0,0;var i=e.createTextRange(),s=i.duplicate();i.moveToBookmark(r.getBookmark()),s.setEndPoint("EndToStart",i),t=s.text.length}else if(e.selectionStart||e.selectionStart=="0")t=e.selectionStart;return this.lastCaret=t,t},insertOrReplaceSelection:function(e,t){var n=this.$input[0],r=this.getCaret(),i=r+e.length;if(document.selection){n.focus();var s=document.selection.createRange();s.text=e;if(t){var o=n.createTextRange();o.collapse(!0),o.moveEnd("character",i),o.moveStart("character",r),o.select()}else this.setCaretPosition(i)}else if(n.selectionStart||n.selectionStart=="0"){var u=n.selectionStart,a=n.selectionEnd,f=n.scrollTop;n.value=n.value.substring(0,u)+e+n.value.substring(a,n.value.length),n.focus(),n.selectionStart=t?r:i,n.selectionEnd=i,n.scrollTop=f}else n.value+=e,this.setCaretPosition(i),n.focus();this.lastCaret=i,this.$input.change()},getCurrentWord:function(e){var t=this.getCurrentText(),n=t.slice(0,e),r=t.slice(e,t.length),i=t.charAt(e-1);if(!i||i===" ")return"";this.leftBoundary=n.search(this.constructor.wordEnd);var s=n.slice(this.leftBoundary,n.length),o=r.slice(0,r.search(this.constructor.spaceBoundary)),u=s.concat(o);return this.rightBoundary=this.leftBoundary+u.length,u},replaceCurrentWord:function(e){var t=this.getCurrentText().split("");this.oldValueArray=t;var n=t.slice(0,this.leftBoundary),r=t.slice(this.rightBoundary,t.length);if(r.length<1||!r[0].match(/\s/))e+=" ";var i=(n.join("")+e).length+1;return{value:n.join("")+e+r.join(""),cursor:i}}}),this}),function(){function n(t,n){return n=n||"",typeof t!="string"&&(t.global&&n.indexOf("g")<0&&(n+="g"),t.ignoreCase&&n.indexOf("i")<0&&(n+="i"),t.multiline&&n.indexOf("m")<0&&(n+="m"),t=t.source),new RegExp(t.replace(/#\{(\w+)\}/g,function(t,n){var r=e.txt.regexen[n]||"";return typeof r!="string"&&(r=r.source),r}),n)}function r(e,t){return e.replace(/#\{(\w+)\}/g,function(e,n){return t[n]||""})}function i(e,t,n){var r=String.fromCharCode(t);return n!==t&&(r+="-"+String.fromCharCode(n)),e.push(r),e}function m(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function w(e,t,n){return n?!e||e.match(t)&&RegExp["$&"]===e:typeof e=="string"&&e.match(t)&&RegExp["$&"]===e}if(typeof e=="undefined"||e===null)var e={};e.txt={},e.txt.regexen={};var t={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"};e.txt.htmlEscape=function(e){return e&&e.replace(/[&"'><]/g,function(e){return t[e]})},e.txt.regexSupplant=n,e.txt.stringSupplant=r,e.txt.addCharsToCharClass=i;var s=String.fromCharCode,o=[s(32),s(133),s(160),s(5760),s(6158),s(8232),s(8233),s(8239),s(8287),s(12288)];i(o,9,13),i(o,8192,8202);var u=[s(65534),s(65279),s(65535)];i(u,8234,8238),e.txt.regexen.spaces_group=n(o.join("")),e.txt.regexen.spaces=n("["+o.join("")+"]"),e.txt.regexen.invalid_chars_group=n(u.join("")),e.txt.regexen.punct=/\!'#%&'\(\)*\+,\\\-\.\/:;<=>\?@\[\]\^_{|}~\$/,e.txt.regexen.rtl_chars=/[\u0600-\u06FF]|[\u0750-\u077F]|[\u0590-\u05FF]|[\uFE70-\uFEFF]/mg,e.txt.regexen.non_bmp_code_pairs=/[\uD800-\uDBFF][\uDC00-\uDFFF]/mg;var a=[];i(a,1024,1279),i(a,1280,1319),i(a,11744,11775),i(a,42560,42655),i(a,1425,1471),i(a,1473,1474),i(a,1476,1477),i(a,1479,1479),i(a,1488,1514),i(a,1520,1524),i(a,64274,64296),i(a,64298,64310),i(a,64312,64316),i(a,64318,64318),i(a,64320,64321),i(a,64323,64324),i(a,64326,64335),i(a,1552,1562),i(a,1568,1631),i(a,1646,1747),i(a,1749,1756),i(a,1758,1768),i(a,1770,1775),i(a,1786,1788),i(a,1791,1791),i(a,1872,1919),i(a,2208,2208),i(a,2210,2220),i(a,2276,2302),i(a,64336,64433),i(a,64467,64829),i(a,64848,64911),i(a,64914,64967),i(a,65008,65019),i(a,65136,65140),i(a,65142,65276),i(a,8204,8204),i(a,3585,3642),i(a,3648,3662),i(a,4352,4607),i(a,12592,12677),i(a,43360,43391),i(a,44032,55215),i(a,55216,55295),i(a,65441,65500),i(a,12449,12538),i(a,12540,12542),i(a,65382,65439),i(a,65392,65392),i(a,65296,65305),i(a,65313,65338),i(a,65345,65370),i(a,12353,12438),i(a,12441,12446),i(a,13312,19903),i(a,19968,40959),i(a,173824,177983),i(a,177984,178207),i(a,194560,195103),i(a,12291,12291),i(a,12293,12293),i(a,12347,12347),e.txt.regexen.nonLatinHashtagChars=n(a.join(""));var f=[];i(f,192,214),i(f,216,246),i(f,248,255),i(f,256,591),i(f,595,596),i(f,598,599),i(f,601,601),i(f,603,603),i(f,611,611),i(f,616,616),i(f,623,623),i(f,626,626),i(f,649,649),i(f,651,651),i(f,699,699),i(f,768,879),i(f,7680,7935),e.txt.regexen.latinAccentChars=n(f.join("")),e.txt.regexen.hashSigns=/[#ï¼]/,e.txt.regexen.hashtagAlpha=n(/[a-z_#{latinAccentChars}#{nonLatinHashtagChars}]/i),e.txt.regexen.hashtagAlphaNumeric=n(/[a-z0-9_#{latinAccentChars}#{nonLatinHashtagChars}]/i),e.txt.regexen.endHashtagMatch=n(/^(?:#{hashSigns}|:\/\/)/),e.txt.regexen.hashtagBoundary=n(/(?:^|$|[^&a-z0-9_#{latinAccentChars}#{nonLatinHashtagChars}])/),e.txt.regexen.validHashtag=n(/(#{hashtagBoundary})(#{hashSigns})(#{hashtagAlphaNumeric}*#{hashtagAlpha}#{hashtagAlphaNumeric}*)/gi),e.txt.regexen.validMentionPrecedingChars=/(?:^|[^a-zA-Z0-9_!#$%&*@ï¼ ]|RT:?)/,e.txt.regexen.atSigns=/[@ï¼ ]/,e.txt.regexen.validMentionOrList=n("(#{validMentionPrecedingChars})(#{atSigns})([a-zA-Z0-9_]{1,20})(/[a-zA-Z][a-zA-Z0-9_-]{0,24})?","g"),e.txt.regexen.validReply=n(/^(?:#{spaces})*#{atSigns}([a-zA-Z0-9_]{1,20})/),e.txt.regexen.endMentionMatch=n(/^(?:#{atSigns}|[#{latinAccentChars}]|:\/\/)/),e.txt.regexen.validUrlPrecedingChars=n(/(?:[^A-Za-z0-9@ï¼ $#ï¼#{invalid_chars_group}]|^)/),e.txt.regexen.invalidUrlWithoutProtocolPrecedingChars=/[-_.\/]$/,e.txt.regexen.invalidDomainChars=r("#{punct}#{spaces_group}#{invalid_chars_group}",e.txt.regexen),e.txt.regexen.validDomainChars=n(/[^#{invalidDomainChars}]/),e.txt.regexen.validSubdomain=n(/(?:(?:#{validDomainChars}(?:[_-]|#{validDomainChars})*)?#{validDomainChars}\.)/),e.txt.regexen.validDomainName=n(/(?:(?:#{validDomainChars}(?:-|#{validDomainChars})*)?#{validDomainChars}\.)/),e.txt.regexen.validGTLD=n(/(?:(?:aero|asia|biz|cat|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|pro|tel|travel|xxx)(?=[^0-9a-zA-Z]|$))/),e.txt.regexen.validCCTLD=n(/(?:(?:ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|ss|st|su|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw|sx)(?=[^0-9a-zA-Z]|$))/),e.txt.regexen.validPunycode=n(/(?:xn--[0-9a-z]+)/),e.txt.regexen.validDomain=n(/(?:#{validSubdomain}*#{validDomainName}(?:#{validGTLD}|#{validCCTLD}|#{validPunycode}))/),e.txt.regexen.validAsciiDomain=n(/(?:(?:[\-a-z0-9#{latinAccentChars}]+)\.)+(?:#{validGTLD}|#{validCCTLD}|#{validPunycode})/gi),e.txt.regexen.invalidShortDomain=n(/^#{validDomainName}#{validCCTLD}$/),e.txt.regexen.validPortNumber=n(/[0-9]+/),e.txt.regexen.validGeneralUrlPathChars=n(/[a-z0-9!\*';:=\+,\.\$\/%#\[\]\-_~@|&#{latinAccentChars}]/i),e.txt.regexen.validUrlBalancedParens=n(/\(#{validGeneralUrlPathChars}+\)/i),e.txt.regexen.validUrlPathEndingChars=n(/[\+\-a-z0-9=_#\/#{latinAccentChars}]|(?:#{validUrlBalancedParens})/i),e.txt.regexen.validUrlPath=n("(?:(?:#{validGeneralUrlPathChars}*(?:#{validUrlBalancedParens}#{validGeneralUrlPathChars}*)*#{validUrlPathEndingChars})|(?:@#{validGeneralUrlPathChars}+/))","i"),e.txt.regexen.validUrlQueryChars=/[a-z0-9!?\*'@\(\);:&=\+\$\/%#\[\]\-_\.,~|]/i,e.txt.regexen.validUrlQueryEndingChars=/[a-z0-9_&=#\/]/i,e.txt.regexen.extractUrl=n("((#{validUrlPrecedingChars})((https?:\\/\\/)?(#{validDomain})(?::(#{validPortNumber}))?(\\/#{validUrlPath}*)?(\\?#{validUrlQueryChars}*#{validUrlQueryEndingChars})?))","gi"),e.txt.regexen.validTcoUrl=/^https?:\/\/t\.co\/[a-z0-9]+/i,e.txt.regexen.urlHasProtocol=/^https?:\/\//i,e.txt.regexen.urlHasHttps=/^https:\/\//i,e.txt.regexen.cashtag=/[a-z]{1,6}(?:[._][a-z]{1,2})?/i,e.txt.regexen.validCashtag=n("(^|#{spaces})(\\$)(#{cashtag})(?=$|\\s|[#{punct}])","gi"),e.txt.regexen.validateUrlUnreserved=/[a-z0-9\-._~]/i,e.txt.regexen.validateUrlPctEncoded=/(?:%[0-9a-f]{2})/i,e.txt.regexen.validateUrlSubDelims=/[!$&'()*+,;=]/i,e.txt.regexen.validateUrlPchar=n("(?:#{validateUrlUnreserved}|#{validateUrlPctEncoded}|#{validateUrlSubDelims}|[:|@])","i"),e.txt.regexen.validateUrlScheme=/(?:[a-z][a-z0-9+\-.]*)/i,e.txt.regexen.validateUrlUserinfo=n("(?:#{validateUrlUnreserved}|#{validateUrlPctEncoded}|#{validateUrlSubDelims}|:)*","i"),e.txt.regexen.validateUrlDecOctet=/(?:[0-9]|(?:[1-9][0-9])|(?:1[0-9]{2})|(?:2[0-4][0-9])|(?:25[0-5]))/i,e.txt.regexen.validateUrlIpv4=n(/(?:#{validateUrlDecOctet}(?:\.#{validateUrlDecOctet}){3})/i),e.txt.regexen.validateUrlIpv6=/(?:\[[a-f0-9:\.]+\])/i,e.txt.regexen.validateUrlIp=n("(?:#{validateUrlIpv4}|#{validateUrlIpv6})","i"),e.txt.regexen.validateUrlSubDomainSegment=/(?:[a-z0-9](?:[a-z0-9_\-]*[a-z0-9])?)/i,e.txt.regexen.validateUrlDomainSegment=/(?:[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?)/i,e.txt.regexen.validateUrlDomainTld=/(?:[a-z](?:[a-z0-9\-]*[a-z0-9])?)/i,e.txt.regexen.validateUrlDomain=n(/(?:(?:#{validateUrlSubDomainSegment]}\.)*(?:#{validateUrlDomainSegment]}\.)#{validateUrlDomainTld})/i),e.txt.regexen.validateUrlHost=n("(?:#{validateUrlIp}|#{validateUrlDomain})","i"),e.txt.regexen.validateUrlUnicodeSubDomainSegment=/(?:(?:[a-z0-9]|[^\u0000-\u007f])(?:(?:[a-z0-9_\-]|[^\u0000-\u007f])*(?:[a-z0-9]|[^\u0000-\u007f]))?)/i,e.txt.regexen.validateUrlUnicodeDomainSegment=/(?:(?:[a-z0-9]|[^\u0000-\u007f])(?:(?:[a-z0-9\-]|[^\u0000-\u007f])*(?:[a-z0-9]|[^\u0000-\u007f]))?)/i,e.txt.regexen.validateUrlUnicodeDomainTld=/(?:(?:[a-z]|[^\u0000-\u007f])(?:(?:[a-z0-9\-]|[^\u0000-\u007f])*(?:[a-z0-9]|[^\u0000-\u007f]))?)/i,e.txt.regexen.validateUrlUnicodeDomain=n(/(?:(?:#{validateUrlUnicodeSubDomainSegment}\.)*(?:#{validateUrlUnicodeDomainSegment}\.)#{validateUrlUnicodeDomainTld})/i),e.txt.regexen.validateUrlUnicodeHost=n("(?:#{validateUrlIp}|#{validateUrlUnicodeDomain})","i"),e.txt.regexen.validateUrlPort=/[0-9]{1,5}/,e.txt.regexen.validateUrlUnicodeAuthority=n("(?:(#{validateUrlUserinfo})@)?(#{validateUrlUnicodeHost})(?::(#{validateUrlPort}))?","i"),e.txt.regexen.validateUrlAuthority=n("(?:(#{validateUrlUserinfo})@)?(#{validateUrlHost})(?::(#{validateUrlPort}))?","i"),e.txt.regexen.validateUrlPath=n(/(\/#{validateUrlPchar}*)*/i),e.txt.regexen.validateUrlQuery=n(/(#{validateUrlPchar}|\/|\?)*/i),e.txt.regexen.validateUrlFragment=n(/(#{validateUrlPchar}|\/|\?)*/i),e.txt.regexen.validateUrlUnencoded=n("^(?:([^:/?#]+):\\/\\/)?([^/?#]*)([^?#]*)(?:\\?([^#]*))?(?:#(.*))?$","i");var l="tweet-url list-slug",c="tweet-url username",h="tweet-url hashtag",p="tweet-url cashtag",d={urlClass:!0,listClass:!0,usernameClass:!0,hashtagClass:!0,cashtagClass:!0,usernameUrlBase:!0,listUrlBase:!0,hashtagUrlBase:!0,cashtagUrlBase:!0,usernameUrlBlock:!0,listUrlBlock:!0,hashtagUrlBlock:!0,linkUrlBlock:!0,usernameIncludeSymbol:!0,suppressLists:!0,suppressNoFollow:!0,targetBlank:!0,suppressDataScreenName:!0,urlEntities:!0,symbolTag:!0,textWithSymbolTag:!0,urlTarget:!0,invisibleTagAttrs:!0,linkAttributeBlock:!0,linkTextBlock:!0,htmlEscapeNonEntities:!0},v={disabled:!0,readonly:!0,multiple:!0,checked:!0};e.txt.tagAttrs=function(t){var n="";for(var r in t){var i=t[r];v[r]&&(i=i?r:null);if(i==null)continue;n+=" "+e.txt.htmlEscape(r)+'="'+e.txt.htmlEscape(i.toString())+'"'}return n},e.txt.linkToText=function(t,n,i,s){s.suppressNoFollow||(i.rel="nofollow"),s.linkAttributeBlock&&s.linkAttributeBlock(t,i),s.linkTextBlock&&(n=s.linkTextBlock(t,n));var o={text:n,attr:e.txt.tagAttrs(i)};return r("<a#{attr}>#{text}</a>",o)},e.txt.linkToTextWithSymbol=function(t,n,r,i,s){var o=s.symbolTag?"<"+s.symbolTag+">"+n+"</"+s.symbolTag+">":n;r=e.txt.htmlEscape(r);var u=s.textWithSymbolTag?"<"+s.textWithSymbolTag+">"+r+"</"+s.textWithSymbolTag+">":r;return s.usernameIncludeSymbol||!n.match(e.txt.regexen.atSigns)?e.txt.linkToText(t,o+u,i,s):o+e.txt.linkToText(t,u,i,s)},e.txt.linkToHashtag=function(t,n,r){var i=n.substring(t.indices[0],t.indices[0]+1),s=e.txt.htmlEscape(t.hashtag),o=m(r.htmlAttrs||{});return o.href=r.hashtagUrlBase+s,o.title="#"+s,o["class"]=r.hashtagClass,s[0].match(e.txt.regexen.rtl_chars)&&(o["class"]+=" rtl"),r.targetBlank&&(o.target="_blank"),e.txt.linkToTextWithSymbol(t,i,s,o,r)},e.txt.linkToCashtag=function(t,n,r){var i=e.txt.htmlEscape(t.cashtag),s=m(r.htmlAttrs||{});return s.href=r.cashtagUrlBase+i,s.title="$"+i,s["class"]=r.cashtagClass,r.targetBlank&&(s.target="_blank"),e.txt.linkToTextWithSymbol(t,"$",i,s,r)},e.txt.linkToMentionAndList=function(t,n,r){var i=n.substring(t.indices[0],t.indices[0]+1),s=e.txt.htmlEscape(t.screenName),o=e.txt.htmlEscape(t.listSlug),u=t.listSlug&&!r.suppressLists,a=m(r.htmlAttrs||{});return a["class"]=u?r.listClass:r.usernameClass,a.href=u?r.listUrlBase+s+o:r.usernameUrlBase+s,!u&&!r.suppressDataScreenName&&(a["data-screen-name"]=s),r.targetBlank&&(a.target="_blank"),e.txt.linkToTextWithSymbol(t,i,u?s+o:s,a,r)},e.txt.linkToUrl=function(t,n,r){var i=t.url,s=i,o=e.txt.htmlEscape(s),u=r.urlEntities&&r.urlEntities[i]||t;u.display_url&&(o=e.txt.linkTextWithEntity(u,r));var a=m(r.htmlAttrs||{});return i.match(e.txt.regexen.urlHasProtocol)||(i="http://"+i),a.href=i,r.targetBlank&&(a.target="_blank"),r.urlClass&&(a["class"]=r.urlClass),r.urlTarget&&(a.target=r.urlTarget),!r.title&&u.display_url&&(a.title=u.expanded_url),e.txt.linkToText(t,o,a,r)},e.txt.linkTextWithEntity=function(t,n){var i=t.display_url,s=t.expanded_url,o=i.replace(/â¦/g,"");if(s.indexOf(o)!=-1){var u=s.indexOf(o),a={displayUrlSansEllipses:o,beforeDisplayUrl:s.substr(0,u),afterDisplayUrl:s.substr(u+o.length),precedingEllipsis:i.match(/^â¦/)?"â¦":"",followingEllipsis:i.match(/â¦$/)?"â¦":""};for(var f in a)a.hasOwnProperty(f)&&(a[f]=e.txt.htmlEscape(a[f]));return a.invisible=n.invisibleTagAttrs,r("<span class='tco-ellipsis'>#{precedingEllipsis}<span #{invisible}>&nbsp;</span></span><span #{invisible}>#{beforeDisplayUrl}</span><span class='js-display-url'>#{displayUrlSansEllipses}</span><span #{invisible}>#{afterDisplayUrl}</span><span class='tco-ellipsis'><span #{invisible}>&nbsp;</span>#{followingEllipsis}</span>",a)}return i},e.txt.autoLinkEntities=function(t,n,r){r=m(r||{}),r.hashtagClass=r.hashtagClass||h,r.hashtagUrlBase=r.hashtagUrlBase||"https://twitter.com/#!/search?q=%23",r.cashtagClass=r.cashtagClass||p,r.cashtagUrlBase=r.cashtagUrlBase||"https://twitter.com/#!/search?q=%24",r.listClass=r.listClass||l,r.usernameClass=r.usernameClass||c,r.usernameUrlBase=r.usernameUrlBase||"https://twitter.com/",r.listUrlBase=r.listUrlBase||"https://twitter.com/",r.htmlAttrs=e.txt.extractHtmlAttrsFromOptions(r),r.invisibleTagAttrs=r.invisibleTagAttrs||"style='position:absolute;left:-9999px;'";var i,s,o;if(r.urlEntities){i={};for(s=0,o=r.urlEntities.length;s<o;s++)i[r.urlEntities[s].url]=r.urlEntities[s];r.urlEntities=i}var u="",a=0;n.sort(function(e,t){return e.indices[0]-t.indices[0]});var f=r.htmlEscapeNonEntities?e.txt.htmlEscape:function(e){return e};for(var s=0;s<n.length;s++){var d=n[s];u+=f(t.substring(a,d.indices[0])),d.url?u+=e.txt.linkToUrl(d,t,r):d.hashtag?u+=e.txt.linkToHashtag(d,t,r):d.screenName?u+=e.txt.linkToMentionAndList(d,t,r):d.cashtag&&(u+=e.txt.linkToCashtag(d,t,r)),a=d.indices[1]}return u+=f(t.substring(a,t.length)),u},e.txt.autoLinkWithJSON=function(t,n,r){var i=[];for(var s in n)i=i.concat(n[s]);for(var o=0;o<i.length;o++)entity=i[o],entity.screen_name?entity.screenName=entity.screen_name:entity.text&&(entity.hashtag=entity.text);return e.txt.modifyIndicesFromUnicodeToUTF16(t,i),e.txt.autoLinkEntities(t,i,r)},e.txt.extractHtmlAttrsFromOptions=function(e){var t={};for(var n in e){var r=e[n];if(d[n])continue;v[n]&&(r=r?n:null);if(r==null)continue;t[n]=r}return t},e.txt.autoLink=function(t,n){var r=e.txt.extractEntitiesWithIndices(t,{extractUrlsWithoutProtocol:!1});return e.txt.autoLinkEntities(t,r,n)},e.txt.autoLinkUsernamesOrLists=function(t,n){var r=e.txt.extractMentionsOrListsWithIndices(t);return e.txt.autoLinkEntities(t,r,n)},e.txt.autoLinkHashtags=function(t,n){var r=e.txt.extractHashtagsWithIndices(t);return e.txt.autoLinkEntities(t,r,n)},e.txt.autoLinkCashtags=function(t,n){var r=e.txt.extractCashtagsWithIndices(t);return e.txt.autoLinkEntities(t,r,n)},e.txt.autoLinkUrlsCustom=function(t,n){var r=e.txt.extractUrlsWithIndices(t,{extractUrlsWithoutProtocol:!1});return e.txt.autoLinkEntities(t,r,n)},e.txt.removeOverlappingEntities=function(e){e.sort(function(e,t){return e.indices[0]-t.indices[0]});var t=e[0];for(var n=1;n<e.length;n++)t.indices[1]>e[n].indices[0]?(e.splice(n,1),n--):t=e[n]},e.txt.extractEntitiesWithIndices=function(t,n){var r=e.txt.extractUrlsWithIndices(t,n).concat(e.txt.extractMentionsOrListsWithIndices(t)).concat(e.txt.extractHashtagsWithIndices(t,{checkUrlOverlap:!1})).concat(e.txt.extractCashtagsWithIndices(t));return r.length==0?[]:(e.txt.removeOverlappingEntities(r),r)},e.txt.extractMentions=function(t){var n=[],r=e.txt.extractMentionsWithIndices(t);for(var i=0;i<r.length;i++){var s=r[i].screenName;n.push(s)}return n},e.txt.extractMentionsWithIndices=function(t){var n=[],r,i=e.txt.extractMentionsOrListsWithIndices(t);for(var s=0;s<i.length;s++)r=i[s],r.listSlug==""&&n.push({screenName:r.screenName,indices:r.indices});return n},e.txt.extractMentionsOrListsWithIndices=function(t){if(!t||!t.match(e.txt.regexen.atSigns))return[];var n=[],r;return t.replace(e.txt.regexen.validMentionOrList,function(t,r,i,s,o,u,a){var f=a.slice(u+t.length);if(!f.match(e.txt.regexen.endMentionMatch)){o=o||"";var l=u+r.length,c=l+s.length+o.length+1;n.push({screenName:s,listSlug:o,indices:[l,c]})}}),n},e.txt.extractReplies=function(t){if(!t)return null;var n=t.match(e.txt.regexen.validReply);return!n||RegExp.rightContext.match(e.txt.regexen.endMentionMatch)?null:n[1]},e.txt.extractUrls=function(t,n){var r=[],i=e.txt.extractUrlsWithIndices(t,n);for(var s=0;s<i.length;s++)r.push(i[s].url);return r},e.txt.extractUrlsWithIndices=function(t,n){n||(n={extractUrlsWithoutProtocol:!0});if(!t||(n.extractUrlsWithoutProtocol?!t.match(/\./):!t.match(/:/)))return[];var r=[];while(e.txt.regexen.extractUrl.exec(t)){var i=RegExp.$2,s=RegExp.$3,o=RegExp.$4,u=RegExp.$5,a=RegExp.$7,f=e.txt.regexen.extractUrl.lastIndex,l=f-s.length;if(!o){if(!n.extractUrlsWithoutProtocol||i.match(e.txt.regexen.invalidUrlWithoutProtocolPrecedingChars))continue;var c=null,h=!1,p=0;u.replace(e.txt.regexen.validAsciiDomain,function(t){var n=u.indexOf(t,p);p=n+t.length,c={url:t,indices:[l+n,l+p]},h=t.match(e.txt.regexen.invalidShortDomain),h||r.push(c)});if(c==null)continue;a&&(h&&r.push(c),c.url=s.replace(u,c.url),c.indices[1]=f)}else s.match(e.txt.regexen.validTcoUrl)&&(s=RegExp.lastMatch,f=l+s.length),r.push({url:s,indices:[l,f]})}return r},e.txt.extractHashtags=function(t){var n=[],r=e.txt.extractHashtagsWithIndices(t);for(var i=0;i<r.length;i++)n.push(r[i].hashtag);return n},e.txt.extractHashtagsWithIndices=function(t,n){n||(n={checkUrlOverlap:!0});if(!t||!t.match(e.txt.regexen.hashSigns))return[];var r=[];t.replace(e.txt.regexen.validHashtag,function(t,n,i,s,o,u){var a=u.slice(o+t.length);if(a.match(e.txt.regexen.endHashtagMatch))return;var f=o+n.length,l=f+s.length+1;r.push({hashtag:s,indices:[f,l]})});if(n.checkUrlOverlap){var i=e.txt.extractUrlsWithIndices(t);if(i.length>0){var s=r.concat(i);e.txt.removeOverlappingEntities(s),r=[];for(var o=0;o<s.length;o++)s[o].hashtag&&r.push(s[o])}}return r},e.txt.extractCashtags=function(t){var n=[],r=e.txt.extractCashtagsWithIndices(t);for(var i=0;i<r.length;i++)n.push(r[i].cashtag);return n},e.txt.extractCashtagsWithIndices=function(t){if(!t||t.indexOf("$")==-1)return[];var n=[];return t.replace(e.txt.regexen.validCashtag,function(e,t,r,i,s,o){var u=s+t.length,a=u+i.length+1;n.push({cashtag:i,indices:[u,a]})}),n},e.txt.modifyIndicesFromUnicodeToUTF16=function(t,n){e.txt.convertUnicodeIndices(t,n,!1)},e.txt.modifyIndicesFromUTF16ToUnicode=function(t,n){e.txt.convertUnicodeIndices(t,n,!0)},e.txt.getUnicodeTextLength=function(t){return t.replace(e.txt.regexen.non_bmp_code_pairs," ").length},e.txt.convertUnicodeIndices=function(e,t,n){if(t.length==0)return;var r=0,i=0;t.sort(function(e,t){return e.indices[0]-t.indices[0]});var s=0,o=t[0];while(r<e.length){if(o.indices[0]==(n?r:i)){var u=o.indices[1]-o.indices[0];o.indices[0]=n?i:r,o.indices[1]=o.indices[0]+u,s++;if(s==t.length)break;o=t[s]}var a=e.charCodeAt(r);55296<=a&&a<=56319&&r<e.length-1&&(a=e.charCodeAt(r+1),56320<=a&&a<=57343&&r++),i++,r++}},e.txt.splitTags=function(e){var t=e.split("<"),n,r=[],i;for(var s=0;s<t.length;s+=1){i=t[s];if(!i)r.push("");else{n=i.split(">");for(var o=0;o<n.length;o+=1)r.push(n[o])}}return r},e.txt.hitHighlight=function(t,n,r){var i="em";n=n||[],r=r||{};if(n.length===0)return t;var s=r.tag||i,o=["<"+s+">","</"+s+">"],u=e.txt.splitTags(t),a,f,l="",c=0,h=u[0],p=0,d=0,v=!1,m=h,g=[],y,b,w,E,S;for(a=0;a<n.length;a+=1)for(f=0;f<n[a].length;f+=1)g.push(n[a][f]);for(y=0;y<g.length;y+=1){b=g[y],w=o[y%2],E=!1;while(h!=null&&b>=p+h.length)l+=m.slice(d),v&&b===p+m.length&&(l+=w,E=!0),u[c+1]&&(l+="<"+u[c+1]+">"),p+=m.length,d=0,c+=2,h=u[c],m=h,v=!1;!E&&h!=null?(S=b-p,l+=m.slice(d,S)+w,d=S,y%2===0?v=!0:v=!1):E||(E=!0,l+=w)}if(h!=null){d<m.length&&(l+=m.slice(d));for(y=c+1;y<u.length;y+=1)l+=y%2===0?u[y]:"<"+u[y]+">"}return l};var g=140,y=[s(65534),s(65279),s(65535),s(8234),s(8235),s(8236),s(8237),s(8238)];e.txt.getTweetLength=function(t,n){n||(n={short_url_length:22,short_url_length_https:23});var r=e.txt.getUnicodeTextLength(t),i=e.txt.extractUrlsWithIndices(t);e.txt.modifyIndicesFromUTF16ToUnicode(t,i);for(var s=0;s<i.length;s++)r+=i[s].indices[0]-i[s].indices[1],i[s].url.toLowerCase().match(e.txt.regexen.urlHasHttps)?r+=n.short_url_length_https:r+=n.short_url_length;return r},e.txt.isInvalidTweet=function(t){if(!t)return"empty";if(e.txt.getTweetLength(t)>g)return"too_long";for(var n=0;n<y.length;n++)if(t.indexOf(y[n])>=0)return"invalid_characters";return!1},e.txt.isValidTweetText=function(t){return!e.txt.isInvalidTweet(t)},e.txt.isValidUsername=function(t){if(!t)return!1;var n=e.txt.extractMentions(t);return n.length===1&&n[0]===t.slice(1)};var b=n(/^#{validMentionOrList}$/);e.txt.isValidList=function(e){var t=e.match(b);return!!t&&t[1]==""&&!!t[4]},e.txt.isValidHashtag=function(t){if(!t)return!1;var n=e.txt.extractHashtags(t);return n.length===1&&n[0]===t.slice(1)},e.txt.isValidUrl=function(t,n,r){n==null&&(n=!0),r==null&&(r=!0);if(!t)return!1;var i=t.match(e.txt.regexen.validateUrlUnencoded);if(!i||i[0]!==t)return!1;var s=i[1],o=i[2],u=i[3],a=i[4],f=i[5];return(!r||w(s,e.txt.regexen.validateUrlScheme)&&s.match(/^https?$/i))&&w(u,e.txt.regexen.validateUrlPath)&&w(a,e.txt.regexen.validateUrlQuery,!0)&&w(f,e.txt.regexen.validateUrlFragment,!0)?n&&w(o,e.txt.regexen.validateUrlUnicodeAuthority)||!n&&w(o,e.txt.regexen.validateUrlAuthority):!1},typeof module!="undefined"&&module.exports&&(module.exports=e.txt);if(typeof window!="undefined")if(window.twttr)for(var E in e)window.twttr[E]=e[E];else window.twttr=e}(),TD.components.Base=klass(function(){this.$node=$.createElement("div").addClass("js-component")}).methods({$find:function(){return this.$node.find.apply(this.$node,arguments)},publishEvent:function(e,t){var n={data:t,target:this};TD.storage.notification.notify(e,n)},bubbleEvent:function(e,t){var n={data:t,target:this};this.$node.trigger(e,[n])},destroy:function(){this.$node.remove()},show:function(){this.$node.show()},hide:function(){this.$node.hide()}}),TD.components.Autocomplete=TD.components.Base.extend(function(e,t){var n={limit:5,dmMode:!1};this.options=_.extend(n,t),this.$input=e,this.isCompletionsOpen=!1,this.dropdownId=_.uniqueId("autocomplete"),this.$node=$.createElement("ul").addClass("lst lst-modal l-compose-box").insertAfter(this.$input),this.$selectedItem=null,this._registerEvents(),n.dmMode?this.usernameRegex=this.constructor.dmUsername:this.usernameRegex=this.constructor.username,$(document).on("dataTypeaheadSuggestions",this.updateDropdown.bind(this))}).mixin(TD.mixins.caretHelper).statics({username:/^[@ï¼ ]([a-zA-Z0-9_]{1,20})$/,dmUsername:/^([a-zA-Z0-9_]{1,20})$/,hashtag:/^[#ï¼]([a-zA-Z0-9_]+)/,SELECT:"td-autocomplete-select",_htmlEscapeAndStrongifyMatches:function(e,t){return TD.util.escape(e.replace(t,"<strong>$1</strong>")).replace(/&lt;(\/?strong)&gt;/g,"<$1>")}}).methods({_registerEvents:function(){var e=this,t="keypress"+($.browser.webkit||$.browser.msie?" keydown":"");this.$input.bind(t,_.bind(this.keypress,this)),this.$input.bind("keyup click",_.bind(this.keyup,this)),this.blurHandler=function(){_.delay(function(){e.hide()},500)},this.$input.bind("blur",this.blurHandler),this.$node.delegate("li","mouseenter",function(t){e.$node.find("li.s-selected").removeClass("s-selected"),$(this).addClass("s-selected")}).delegate("li","click",_.bind(function(t){e.$selectedItem=$(t.target).closest("li").addClass("s-selected"),e.$selectedItem.siblings(".s-selected").removeClass("s-selected"),this.$input.focus(),this.select()},this))},_unregisterEvents:function(){var e="keypress"+($.browser.webkit||$.browser.msie?" keydown":"");this.$input.unbind(e),this.$input.unbind("keyup click keydown"),this.$input.unbind("bind",this.blurHandler)},keyup:function(e){if(!e.keyCode)return;e.stopPropagation();var t="",n=this.getCaret(),r=!1;t=this.getCurrentWord(n),t.match(this.usernameRegex)?(t=RegExp.$1,this.autocompleteType="username",r=!0):t.match(this.constructor.hashtag)&&(t=RegExp.$1,this.autocompleteType="hashtag",r=!0);if(t.length&&r)switch(e.keyCode){case TD.constants.keyCodes.escape:this.hide(),e.stopPropagation();break;case TD.constants.keyCodes.upArrow:case TD.constants.keyCodes.downArrow:break;case TD.constants.keyCodes.tab:case TD.constants.keyCodes.enter:!e.shiftKey&&this.$selectedItem&&this.isCompletionsOpen?this.select():this.options.dmMode&&!this.isCompletionsOpen&&this.select();break;case TD.constants.keyCodes.spacebar:this.options.dmMode&&this.set(this.$input.val());break;default:this.autocompleteType=="hashtag"?this.lookUpHashtag(t):this.lookUpUser(t)}else this.hide()},keypress:function(e){switch(e.keyCode){case TD.constants.keyCodes.spacebar:if(!this.options.dmMode)break;case TD.constants.keyCodes.tab:case TD.constants.keyCodes.enter:case TD.constants.keyCodes.escape:this.isCompletionsOpen&&e.preventDefault();break;case TD.constants.keyCodes.upArrow:this.isCompletionsOpen&&!e.shiftKey&&(this.moveSelection("prev"),e.preventDefault());break;case TD.constants.keyCodes.downArrow:this.isCompletionsOpen&&!e.shiftKey&&(this.moveSelection("next"),e.preventDefault());break;default:this.$selectedItem=null}},sanitize:function(e){return e.replace(/ /g,"")},moveSelection:function(e){var t=e=="next"?"li:first":"li:last",n=this.$selectedItem||this.$node.find("li.s-selected");if(!n.length){this.$selectedItem=this.$node.find(t).addClass("s-selected");return}n=n.removeClass("s-selected"),e==="next"?n=n.nextAll("li:first"):n=n.prevAll("li:first"),n.length?this.$selectedItem=n.addClass("s-selected"):this.$selectedItem=this.$node.find(t).addClass("s-selected")},select:function(){var e,t;this.autocompleteType==="username"?(e=this.$selectedItem.find(".js-screenname").text(),this.options.dmMode||(e="@"+e),t=this.$selectedItem.find("img").attr("src")):e=this.$selectedItem.find(".js-hashtag").text(),this.set(e,t)},set:function(e,t){var n=this.replaceCurrentWord(e);this.$input.val(n.value),this.setCaretPosition(n.cursor),this.$input.change(),this.$node.trigger(this.constructor.SELECT,[e,t]),this.hide()},show:function(){this.$node.show(),this.isCompletionsOpen=!0},hide:function(){this.$node.hide(),this.isCompletionsOpen=!1,this.$node.trigger("dataTypeaheadQueryReset")},lookUpHashtag:function(e){var e=this.sanitize(e);this.$node.trigger("uiNeedsTypeaheadSuggestions",{datasources:["topics"],query:"#"+e,onlyLocalData:!0,dropdownId:this.dropdownId})},lookUpUser:function(e){var e=this.sanitize(e);this.$node.trigger("uiNeedsTypeaheadSuggestions",{datasources:["users"],query:e,onlyLocalData:!0,dropdownId:this.dropdownId})},updateDropdown:function(e,t){var n=new RegExp("("+t.query.split("").join("|")+")","gi"),r,i,s=[];if(t.dropdownId!==this.dropdownId)return;this.autocompleteType==="hashtag"&&t.suggestions.topics?(i=t.suggestions.topics.slice(0,this.options.limit),s=i.map(function(e){return{value:this.constructor._htmlEscapeAndStrongifyMatches(e.topic,n)}},this),r=TD.ui.template.render("compose/autocomplete_hashtag",{results:s})):this.autocompleteType==="username"&&t.suggestions.users&&(i=t.suggestions.users.slice(0,this.options.limit),s=i.map(function(e){return{id:e.id,screenName:this.constructor._htmlEscapeAndStrongifyMatches(e.screen_name,n),name:this.constructor._htmlEscapeAndStrongifyMatches(e.name,n),pic:TD.util.transformTwitterAvatar(e.profile_image_url_https,"mini")}},this),r=TD.ui.template.render("compose/autocomplete_twitter_user",{results:s})),this.$node.html(r),s.length?(this.isCompletionsOpen||this.show(),this.moveSelection("next")):this.isCompletionsOpen&&this.hide()},destroy:function(){this._unregisterEvents(),this.$node.remove()}}),TD.components.Retweeters=TD.components.Base.extend(function(e,t){function s(e){var t,n={stats:[]};this.tweetSummary=e;if(_.isString(e.retweeters_count))t=e.retweeters_count;else{var s=e.retweeters_count||0;t=Math.max(s,r.length)+""}this.tweetSummary.retweeters_count=t,t!=="0"&&n.stats.push({count:TD.util.prettyNumber(t),label:TD.util.pluralise(TD.i("Retweet"),TD.i("Retweets"),t),type:"retweeters"}),e.favoriters_count!=="0"&&n.stats.push({count:TD.util.prettyNumber(e.favoriters_count),label:TD.util.pluralise(TD.i("Favorite"),TD.i("Favorites"),e.favoriters_count),type:"favoriters"});if(n.stats.length>0){var o=TD.ui.template.render("status/tweet_detail_socialstats",n);i.$node.html(o)}else i.destroy()}if(!(e instanceof TD.services.TwitterStatus)||e instanceof TD.services.TwitterDirectMessage)return;this.tweet=e.getMainTweet();var n=TD.controller.clients.getClient(this.tweet.account.getKey()),r=[],i=this;n.getTweetSummary(this.tweet.id,s.bind(this),function(){i.destroy()})}),TD.components.RepliesTo=TD.components.Base.extend(function(e,t){this.chirp=e.getMainTweet(),this.mainTweet=this.chirp.getMainTweet(),this.repliesTo=[],this.mediaPreviewSize=t,this.subscription=$.subscribe("/tweets/conversation/"+this.mainTweet.id,this._handleConversation.bind(this));var n=TD.controller.clients.getClient(this.chirp.account.getKey());n.getConversation(this.mainTweet.id)}).methods({_handleConversation:function(e){this.repliesTo=e.descendants,this.repliesTo.sort(TD.util.chirpAscSort);if(this.repliesTo.length>0){var t=_.map(this.repliesTo,function(e){return e.renderAsReply(this.mediaPreviewSize)}.bind(this)).join(""),n=TD.ui.template.render("status/tweet_detail_repliesto",{renderedChirps:t});this.$node.html(n)}},findChirp:function(e){var t=null;return this.chirp.id===e?t=this.chirp:this.mainTweet.id===e?t=this.mainTweet:this.repliesTo&&(t=_.detect(this.repliesTo,function(t){return t.id===e})),t},destroy:function(){$.unsubscribe(this.subscription),this.supr()}}),TD.components.InReplyTo=TD.components.Base.extend(function(e,t,n){var r=this;this.chirp=e,this.mainTweet=this.chirp.getMainTweet(),this.$container=t,this.$detailContentContainer=this.$container.find(".js-detail-container"),this.$detailContent=this.$detailContentContainer.find(".js-detail-content"),this.mediaPreviewSize=n;if(!this.mainTweet.inReplyToID)return;this.$node.html(TD.ui.template.render("status/tweet_detail_inreplyto")),this.$repliesContainer=this.$find(".js-replies-before"),this.$repliesText=this.$find(".in-reply-to").hide(),this.replies=null,_.defer(function(){r.bubbleEvent(TD.components.InReplyTo.BEGIN)}),this.subscription=$.subscribe("/tweets/conversation/"+this.mainTweet.id,_.bind(this._handleRelatedResults,this)),this.client=TD.controller.clients.getClient(this.chirp.account.getKey()),this.client.getConversation(this.mainTweet.id)}).statics({BEGIN:"td-load-convo",END:"td-load-finish",INREPLYTO_PADDING:20}).methods({_handleRelatedResults:function(e){this.replies=e.ancestors,_.isEmpty(this.replies)?this._getTweet():this._showReplies()},_getTweet:function(){var e=this;this.client.show(this.mainTweet.inReplyToID,function(t){e.replies=e.replies||[],e.replies.push(t),e._showReplies()},function(){e.bubbleEvent(TD.components.InReplyTo.END)})},_showReplies:function(){_.defer(_.bind(this._showRepliesInternal,this))},_showRepliesInternal:function(){var e,t,n,r,i,s,o;this.bubbleEvent(TD.components.InReplyTo.END);if(_.isEmpty(this.replies))return;this.replies.sort(TD.util.chirpAscSort),t=this.mainTweet.id,this.replies=_.filter(this.replies,function(e){return e.id!==t}),n=_.map(this.replies,function(e){return e.renderAsReply(this.mediaPreviewSize)}.bind(this)).join(""),r=this.$detailContentContainer.outerHeight(),i=this.$detailContent.outerHeight(),this.$repliesContainer.html(n),e=this.$node.outerHeight(),i<r&&this.$detailContent.css("padding-bottom",r-i),this.replies.length<=1?s=0:(o=this.$repliesContainer.children().last().outerHeight()+TD.components.InReplyTo.INREPLYTO_PADDING,s=e-o),this.$detailContentContainer.scrollTop(e),this.$detailContentContainer.animate({scrollTop:s},{duration:"fast"})},findChirp:function(e){var t=null;return this.chirp.id===e?t=this.chirp:this.mainTweet.id===e?t=this.mainTweet:this.replies&&(t=_.detect(this.replies,function(t){return t.id===e})),t},destroy:function(){this.subscription&&$.unsubscribe(this.subscription),this.supr()}}),TD.components.BaseModal=TD.components.Base.extend(function(){this.$node=$(TD.ui.template.render("large_modal")),$(document).trigger("uiCloseModal"),this.$title=this.$find(".js-header-title"),this.$closeButton=this.$find(".js-dismiss"),this.$menuContainer=this.$find(".js-mdl-content"),this.$footer=this.$find("footer");var e=_.bind(this.destroy,this);this.$closeButton.bind("click",function(){e()}),this.$node.bind(TD.components.BaseModal.CLOSE_EVENT,e),this.boundCloseModal=this._handleCloseModal.bind(this),$(document).on("uiCloseModal",this.boundCloseModal);var t=_.bind(this.handleDragStart,this),n=_.bind(this.getDragDropBoundary,this);this.$node.draggable({boundary:n,handle:this.$find(".mdl-drag-handle")}),this.$node.on("start.draggable",t),$("div.ovl.scroll-v").on("click",function(t){this===t.target&&e()}),this.hasFocus=!1,this.focusId=_.uniqueId("focus"),this._boundHandleFocus=this.handleFocus.bind(this),$(document).on("uiFocus",this._boundHandleFocus),$(document).trigger("uiFocusRequest",{id:this.focusId})}).statics({CLOSE_EVENT:"td-close"}).methods({handleFocus:function(e,t){t.id===this.focusId?this.hasFocus=!0:this.hasFocus=!1},getDragDropBoundary:function(){return this.$node.parent()},handleDragStart:function(){this.$node.css({position:"absolute",top:this.$node.offset().top,left:this.$node.offset().left}),this.$node.parent("#open-modal").addClass("is-dragging")},show:function(){this.supr()},_handleCloseModal:function(){this.destroy()},destroy:function(){this.$node.parent("#open-modal").removeClass("is-dragging"),$(document).off("uiFocus",this._boundHandleFocus),$(document).off("uiCloseModal",this.boundCloseModal),$(document).trigger("uiFocusRelease",{id:this.focusId}),this.supr()}}),TD.components.NewFeaturesSplash=TD.components.BaseModal.extend(function(){this.$node.addClass("release-notes-modal"),this.$menuContainer.append(TD.ui.template.render("splash/whats_new")),this.$doneButton=this.$find(".js-done"),this.$doneButton.click(_.bind(this.destroy,this)),$("#splash-modal").empty().append(this.$node).show(),TD.components.NewFeaturesSplash.updateSeenVersion()}).statics({FOR_VERSION:"3.0",shouldShow:function(){var e=TD.components.NewFeaturesSplash.FOR_VERSION,t=TD.settings.getPreviousSplashVersion();return t==="0"?(TD.components.NewFeaturesSplash.updateSeenVersion(),!1):TD.util.versionComparator(e,t)!==1?!1:TD.util.versionComparator(TD.version,e)===-1?!1:!0},updateSeenVersion:function(){TD.settings.setPreviousSplashVersion(TD.version)}}).methods({destroy:function(){this.supr(),$("#splash-modal").hide()}}),TD.components.OpenColumn=TD.components.BaseModal.extend(function(){var e=this;this.$footer.append($(TD.ui.template.render("open_column_footer"))),this.$backButton=this.$find(".js-back"),this.$addButton=this.$find(".js-add-column"),this.history=[],this.menu=null,this.$backButton.bind("click",function(t){t.stopPropagation(),e._previous()})}).statics({GO_URL_REGEX:/^(add|profile)$/,GO_EVENT:"/go",instance:null}).methods({canGo:function(e,t){return TD.components.OpenColumn.GO_URL_REGEX.test(e)},go:function(e,t,n,r){TD.components.OpenColumn.instance=this,r&&(this.history=[r]),this.history.push([e,_.clone(t),n]);var i=t.shift();if(this.menu&&this.menu.canGo&&this.menu.canGo(e,t)){this.history.pop(),this.history[this.history.length-1]=fullUrl,this.menu.go(i,t,n);return}var s,o=!1,u=!1,a=!1;if(e==="add")switch(i){case"home":s=new TD.components.OpenColumnHome,o=!0;break;case"lists":s=new TD.components.OpenLists;break;case"trends":s=new TD.components.OpenTrends;break;default:TD.controller.columnManager.TWITTER_GENERIC[i]&&(s=new TD.components.OpenTwitterGeneric(i))}this._show(i,s,o,u,a),s.go&&s.go(i,t,n)},_show:function(e,t,n,r,i){this.menu&&this.menu.destroy(),this.menu=t,this.$menuContainer.append(t.$node),n||this.menu.setup(this.$addButton),this.$node.toggleClass("s-nonav",n),this.$node.toggleClass("s-narrow",r),this.$backButton.toggle(this.history.length>1).toggleClass("hide",this.history.length===0),e==="home"?this.$title.text(TD.i("Add Column")):e==="profile"?this.$title.text(TD.i("Account profile")):this.$title.text(TD.controller.columnManager.MENU_TITLE[e]||"")},_previous:function(){this.history.pop();var e=this.history.pop();e instanceof Array?this.go.apply(this,e):(this.destroy(),$(e.target).trigger(e.type,[e.data]))},destroy:function(){this.menu&&this.menu.destroy(),_.each(this.eventSubscriptions,function(e){$.unsubscribe(e)}),this.$backButton.unbind(),$("#open-modal").hide(),TD.components.OpenColumn.instance=null,this.supr()}}),TD.components.OpenColumnHome=TD.components.Base.extend(function(){var e=this,t={};TD.storage.accountController.getPostingAccounts().forEach(function(e){t[e.getType()]=!0});var n=TD.controller.columnManager.DISPLAY_ORDER_SINGLETONS.filter(function(e){return _.isEmpty(TD.storage.columnController.getColumnsByType(e.type))}),r=TD.controller.columnManager.DISPLAY_ORDER.filter(function(e){return t[e.service]});this.$node=$(TD.ui.template.render("open_column_home",{options:r,singletons:n,hasSingletons:n.length})),this.$launchers=this.$find(".js-item-launch"),this.$launchers.bind("click",function(t){var n=$(t.currentTarget),r=n.data("action"),i=n.data("type"),s;switch(r){case"add":s=TD.controller.columnManager.makeColumnFor(i,"tweetdeck"),TD.controller.columnManager.addColumnToUI(s),e.bubbleEvent(TD.components.BaseModal.CLOSE_EVENT);break;case"open":e.publishEvent(TD.components.OpenColumn.GO_EVENT,TD.components.OpenColumnHome.URL_BASE+"/"+i)}})}).statics({URL_BASE:"/add"}),TD.components.SplitMenu=TD.components.Base.extend(function(){this.$node=$(TD.ui.template.render("open_split_menu")),this.menuItems=[],this.rightPillarComponent=null,this.$leftPinnedContainer=this.$find(".js-left-pinned"),this.$leftPillarContainer=this.$find(".js-left-column"),this.$rightPillarContainer=this.$find(".js-right-column")}).methods({appendMenuItem:function(e){this.menuItems.push(e),this.$leftPillarContainer.append(e.$node)},removeMenuItem:function(e){e.destroy(),this.menuItems=_.without(this.menuItems,e)},appendPinnedMenuItem:function(e){this.menuItems.push(e),this.$leftPillarContainer.addClass("s-with-pinned"),this.$leftPinnedContainer.html(e.$node)},appendMenuItemElement:function(e){this.$leftPillarContainer.append(e)},setRightPillar:function(e){this.rightPillarComponent&&this.rightPillarComponent.destroy(),this.rightPillarComponent=e,this.$rightPillarContainer.html(e.$node)},destroy:function(){_.each(this.menuItems,function(e){e.destroy()}),this.rightPillarComponent&&this.rightPillarComponent.destroy(),this.supr()}}),TD.components.OpenSplitMenu=TD.components.SplitMenu.extend(function(){this.$addButton=null}).methods({setup:function(e){this.$addButton=e,this.$addButton.hide(),this.$addButton.click(_.bind(this._handleAddClick,this))},setChirpPillar:function(e){this.setRightPillar(e);var t=this;e instanceof TD.components.TemporaryColumn&&_.defer(function(){e.populate(),t.$addButton.show(),t.$addButton.attr("disabled",!1)})},_handleAddClick:function(e){this.$addButton.attr("disabled")||this.makeChirpColumnPermanent()},makeChirpColumnPermanent:function(){this.rightPillarComponent&&(this.rightPillarComponent.makePermanent(),this.$addButton.attr("disabled",!0))},destroy:function(){this.$addButton.unbind("click"),this.$addButton.hide(),this.supr()}}),TD.components.OpenTwitterGeneric=TD.components.OpenSplitMenu.extend(function(e){this.type=e,this.showUserSearch=!TD.controller.columnManager.SELF_ACCOUNTS_ONLY[e],this.userSearch=null,this.helpText=TD.controller.columnManager.HELP_TEXT[e],this.placeHolder=new TD.components.OpenColumnPlaceholder(this.helpText),this.setChirpPillar(this.placeHolder);if(this.showUserSearch){this.userSearch=new TD.components.TwitterUserSearch,this.appendPinnedMenuItem(this.userSearch);var t=this.userSearch.detachResultsContainer();this.appendMenuItemElement(t)}this.profileAccount=new TD.components.ProfileAccount,this.profileAccount.$node.hide(),this.appendMenuItem(this.profileAccount),this.selfAccounts=new TD.components.SelfAccounts("twitter"),this.appendMenuItem(this.selfAccounts),this.$node.bind(TD.components.MenuItemBase.BUBBLE_SELECT_EVENT,_.bind(this._handleSelect,this))}).methods({go:function(e,t,n){n.screenName?(this.profileAccount.setUser(n.screenName),this.profileAccount.$node.show(),this.profileAccount.select()):this.selfAccounts.selectDefault()},_handleSelect:function(e,t){var n;if(t.target.account)n=new TD.components.TemporaryColumn,n.genericTwitter(this.type,t.target.account,undefined);else if(t.target.twitterUser){n=new TD.components.TemporaryColumn;var r=this.userSearch.client.oauth.account;n.genericTwitter(this.type,r,t.target.twitterUser)}n&&(this.setChirpPillar(n),e.stopPropagation())}}),TD.components.OpenLists=TD.components.OpenSplitMenu.extend(function(){this.screenName=null,this.listsComponent=null,this.newListButton=null,this.helpText=TD.controller.columnManager.HELP_TEXT[TD.controller.columnManager.LISTS],this.placeHolder=new TD.components.OpenColumnPlaceholder(this.helpText),this.removePlaceholder=new TD.components.OpenColumnPlaceholder(""),this.setChirpPillar(this.placeHolder),this.$node.bind(TD.components.MenuItemBase.BUBBLE_SELECT_EVENT,_.bind(this._handleListSelect,this)),this.$node.bind(TD.components.Lists.LOADED,_.bind(this._handleListsLoaded,this))}).methods({go:function(e,t,n){n.screenName?(this.screenName=n.screenName,this.listsComponent=new TD.components.Lists(this.screenName,n.slug),this.appendMenuItem(this.listsComponent)):(this.newListButton=new TD.components.NewListButton,this.appendPinnedMenuItem(this.newListButton),this.listsComponent=new TD.components.Lists,this.appendMenuItem(this.listsComponent))},_handleListsLoaded:function(e,t){if(t.target!==this.listsComponent)return;if(t.data===0){this.removeMenuItem(this.listsComponent);var n;this.screenName?n=TD.i("This user has no public lists"):n=TD.i("You are not subscribed to any lists"),this.listsComponent=new TD.components.OpenColumnPlaceholder(n),this.setChirpPillar(this.removePlaceholder),this.appendMenuItem(this.listsComponent)}},_handleListSelect:function(e,t){var n=t.target.list,r=new TD.components.TemporaryColumn;r.list(n),this.setChirpPillar(r),e.stopPropagation()}}),TD.components.OpenTrends=TD.components.OpenSplitMenu.extend(function(){this.trends=new TD.components.Trends,this.appendMenuItem(this.trends),this.helpText=TD.controller.columnManager.HELP_TEXT[TD.controller.columnManager.TRENDS],this.placeHolder=new TD.components.OpenColumnPlaceholder(this.helpText),this.setChirpPillar(this.placeHolder),this.$node.bind(TD.components.MenuItemBase.BUBBLE_SELECT_EVENT,_.bind(this._handleTrendSelect,this))}).methods({_handleTrendSelect:function(e,t){var n=t.target.title,r=new TD.components.TemporaryColumn;r.search(n),this.setChirpPillar(r),e.stopPropagation()}}),TD.components.OpenColumnPlaceholder=TD.components.Base.extend(function(e){this.helperText=e,this.$node=$(TD.ui.template.render("open_column_temp_help",{helpText:e}))}),TD.components.NewListButton=TD.components.Base.extend(function(){var e=this;this.$button=$.createElement("button").addClass("btn").text(TD.i("Create list")),this.$button.click(function(t){e.bubbleEvent(TD.components.BaseModal.CLOSE_EVENT);var n=new TD.components.ListDetails}),this.$node.append(this.$button),this.$node.addClass("sch-list padding-al")}),TD.components.ListDetails=TD.components.BaseModal.extend(function(e){this.theList=e,this.toAutoAdd=[];var t=TD.storage.accountController.getAccountsForService("twitter");this.$editForm=$(TD.ui.template.render("lists/edit_form",{accounts:t})),this.$menuContainer.append(this.$editForm),this.$footer.append($(TD.ui.template.render("lists/edit_footer"))),$("#lists-modal").empty().append(this.$node).show(),this.$account=$("#list-account"),this.$name=$("#list-name"),this.$description=$("#list-description"),this.$modePublic=this.$find('input:radio[value="public"]'),this.$modePrivate=this.$find('input:radio[value="private"]'),this.$saveButton=this.$find(".js-save"),this.$name.focus(),this.$saveButton.click(_.bind(this._handleSaveClick,this)),e?(this.$title.text(TD.i("Edit list")),this.$account.val(TD.storage.Account.generateKeyFor("twitter",e.user.id)),this.$account.attr("disabled",!0),this.$name.val(e.name),this.$description.val(e.description),e.isPrivate?this.$modePrivate.attr("checked",!0):this.$modePublic.attr("checked",!0)):this.$title.text(TD.i("Create list"))}).methods({autoAddMember:function(e){this.toAutoAdd.push(e)},_handleSaveClick:function(){var e=this.$account.val(),t=TD.controller.clients.getClient(e),n=this.$name.val(),r=this.$description.val(),i=Boolean(this.$modePrivate.attr("checked")),s=_.bind(this._handleSaveSuccess,this),o=_.bind(this._handleSaveFailure,this);this.$saveButton.prop("disabled",!0),this.theList?t.updateList(this.theList.id,n,r,i,s,o):t.createList(n,r,i,s,o)},_handleSaveSuccess:function(e){this.destroy();var t=new TD.components.ListMembers(e,this.toAutoAdd)},_handleSaveFailure:function(){this.$saveButton.prop("disabled",!1);var e=TD.i("Problem saving list. Please check the details and try again");TD.controller.progressIndicator.addMessage(e)},destroy:function(){this.supr(),$("#lists-modal").hide()}}),TD.components.ListMembers=TD.components.BaseModal.extend(function(e,t){var n=this;this.theList=e,this.membersIndex={},this.changed=!1,this.client=TD.controller.clients.getClient(e.account.getKey()),this.feedKey=TD.storage.Feed.generateKeyFor(this.theList.account.getKey(),"list",{listId:this.theList.id,ownerId:this.theList.user.id,slug:this.theList.id,screenName:this.theList.user.id}),this.splitMenu=new TD.components.SplitMenu,this.userSearch=new TD.components.TwitterUserSearch(e.user.account,10,TD.components.ListMember),this.suggestedUsers=new TD.components.SuggestedUsers(e.user.account,10,TD.components.ListMember,e.name),this.loadingPane=new TD.components.OpenColumnPlaceholder(TD.i("Loading list members...")),this.memberList=new TD.components.ListMemberList,this.$title.text(TD.i("{{{1}}} by {{2}}",{1:e.name,2:e.user.screenName})),this.$menuContainer.append(this.splitMenu.$node),this.$footer.append($(TD.ui.template.render("lists/edit_members_footer"))),this.splitMenu.appendPinnedMenuItem(this.userSearch),this.splitMenu.appendMenuItemElement(this.userSearch.detachResultsContainer()),this.splitMenu.appendMenuItem(this.suggestedUsers),this.splitMenu.setRightPillar(this.loadingPane),$("#lists-modal").empty().append(this.$node).show(),this.userSearch.searchInput.$inputBox.focus(),this.$memberCount=this.memberList.$find(".js-member-count"),this.$editButton=this.$find(".js-edit"),this.$deleteButton=this.$find(".js-delete"),this.$doneButton=this.$find(".js-done"),this.$addColumnOption=this.$find(".js-add-column-option"),this.$addColumnCheckbox=this.$addColumnOption.find(".js-add-column-checkbox"),TD.storage.columnController.getColumnsContainingFeed(this.feedKey).length===0&&(this.$addColumnCheckbox.prop("checked",!0),this.$addColumnOption.removeClass("is-hidden")),this.$editButton.click(_.bind(this._editDetails,this)),this.$deleteButton.click(_.bind(this._deleteList,this)),this.$doneButton.click(_.bind(this._handleDone,this)),this.$node.bind(TD.components.ListMember.ADD_REMOVE_EVENT,_.bind(this._addRemoveMember,this)),this.$node.bind(TD.components.TwitterUserSearch.SEARCH_COMPLETE,function(e,t){var r=t.target;n._checkResultsState(r),n.splitMenu.$leftPillarContainer.scrollTop(0)}),this._updateMemberCount();var r=this._addMembers(t);r.addBothWith(this,this._loadAllMembers),r.addCallback(function(){n.suggestedUsers.render(),n._checkResultsState(n.userSearch),n._checkResultsState(n.suggestedUsers)})}).methods({_addMembers:function(e){var t;if(_.isEmpty(e))t=TD.core.defer.succeed();else{t=new TD.core.defer.Deferred;var n=_.pluck(e,"screenName");this.client.addUsersToList(this.theList.id,n,_.bind(t.callback,t),_.bind(t.errback,t))}return t},_loadAllMembers:function(){var e=this,t,n=function(t){e._displayMembers(t.users,!1);if(t.next_cursor){var r=e._fetchMemberPage(t.next_cursor_str);return r.addCallback(n),r}};return t=this._fetchMemberPage(-1),t.addCallback(n),t},_fetchMemberPage:function(e){var t=new TD.core.defer.Deferred;return this.client.getListMembers(this.theList.id,e,_.bind(t.callback,t),_.bind(t.errback,t)),t},_displayMembers:function(e,t){var n=this;t&&e.reverse(),_.each(e,function(e){if(!n.membersIndex[e.id]){var r=new TD.components.ListMember(e);n.membersIndex[r.user.id]=r,t?n.memberList.prepend(r):n.memberList.append(r)}}),this.loadingPane&&(this.loadingPane.destroy(),this.loadingPane=null,this.splitMenu.setRightPillar(this.memberList))},_updateMemberCount:function(){this.$memberCount.text(this.theList.memberCount)},_editDetails:function(){this.destroy();var e=new TD.components.ListDetails(this.theList)},_deleteList:function(){var e=this,t=_.uniqueId(),n={id:t,title:TD.i("Deleting list!"),message:TD.i("Are you sure you want to delete this list?"),okLabel:TD.i("Delete"),cancelLabel:TD.i("Cancel")},r=function(n,i){if(i.id!==t)return;$(document).off("uiConfirmationAction",r),i.result&&e.client.destroyList(e.theList.id,function(){e.theList=null,e.destroy()})};$(document).on("uiConfirmationAction",r).trigger("uiShowConfirmationDialog",n)},_addRemoveMember:function(e,t){e.stopPropagation();var n=t.target;this.membersIndex[n.user.id]?this.removeMember(n.user):this.addMember(n.user)},addMember:function(e){var t=this;this._changeUserState(e.id,TD.components.ListMember.STATE_WORKING),this.client.addUserToList(this.theList.id,e.screenName,function(n){t._displayMembers([e],!0),t.theList.memberCount++,t._updateMemberCount(),t._changeUserState(e.id,TD.components.ListMember.STATE_MEMBER),t.changed=!0},function(n){t._changeUserState(e.id,TD.components.ListMember.STATE_NON_MEMBER);var r=TD.i("Problem adding {{userName}} to the list {{listName}}. Please try again",{userName:e.name,listName:t.theList.name});TD.controller.progressIndicator.addMessage(r)})},removeMember:function(e){var t=this;this._changeUserState(e.id,TD.components.ListMember.STATE_WORKING),this.client.removeUserFromList(this.theList.id,e.screenName,function(n){var r=t.membersIndex[e.id];r.destroy(),delete t.membersIndex[e.id],t.theList.memberCount--,t._updateMemberCount(),t._changeUserState(e.id,TD.components.ListMember.STATE_NON_MEMBER),t.changed=!0},function(n){t._changeUserState(e.id,TD.components.ListMember.STATE_MEMBER);var r=TD.i("Problem removing {{userName}} from the list {{listName}}. Please try again",{userName:e.name,listName:t.theList.name});TD.controller.progressIndicator.addMessage(r)})},_changeUserState:function(e,t){this.membersIndex[e]&&this.membersIndex[e].setState(t),t===TD.components.ListMember.STATE_MEMBER&&(t=TD.components.ListMember.STATE_MEMBER_CHECKED);var n=this.userSearch.items.concat(this.suggestedUsers.items);_.each(n,function(n){n.user.id==e&&n.setState(t)})},_checkResultsState:function(e){var t=this,n=e===this.suggestedUsers;_.each(e.items,function(e){t.membersIndex[e.user.id]?(e.setState(TD.components.ListMember.STATE_MEMBER_CHECKED),n&&e.hide()):(e.setState(TD.components.ListMember.STATE_NON_MEMBER),n&&e.show())})},_handleDone:function(){if(this.$addColumnCheckbox.prop("checked")){var e=new TD.components.TemporaryColumn;e.list(this.theList),e.makePermanent()}this.destroy()},destroy:function(){if(this.changed&&this.theList){TD.cache.lists.add(this.theList);var e=TD.controller.feedManager.getPoller(this.feedKey);e&&(e.removeAll(),e.refresh())}$("#lists-modal").hide(),this.splitMenu.destroy(),this.userSearch.destroy(),this.suggestedUsers.destroy(),this.memberList.destroy(),this.loadingPane&&this.loadingPane.destroy(),_.each(this.membersIndex,function(e,t){e.destroy()}),this.supr()}}),TD.components.ListMember=TD.components.Base.extend(function(e){this.user=e,this.state=null;var t={isTwitter:!0,fullname:e.name||e.screenName,username:e.screenName,profileImageURL:e.profileImageURL,description:e.description,isProtected:e.isProtected,isVerified:e.isVerified};this.$node=$(TD.ui.template.render("lists/member",t)),this.$addRemoveButton=this.$find(".js-add-remove"),this.$addRemoveButton.click(_.bind(this._handleAddRemoveClick,this)),this.setMember()}).statics({ADD_REMOVE_EVENT:"td-add-remove",STATE_MEMBER:"member",STATE_MEMBER_CHECKED:"member-checked",STATE_NON_MEMBER:"non-member",STATE_WORKING:"working"}).methods({_handleAddRemoveClick:function(){this.bubbleEvent(TD.components.ListMember.ADD_REMOVE_EVENT)},setState:function(e){switch(e){case TD.components.ListMember.STATE_MEMBER:this.setMember();break;case TD.components.ListMember.STATE_MEMBER_CHECKED:this.setMemberChecked();break;case TD.components.ListMember.STATE_NON_MEMBER:this.setNonMember();break;case TD.components.ListMember.STATE_WORKING:this.setWorking()}},setMember:function(){this.state=TD.components.ListMember.STATE_MEMBER,this.$addRemoveButton.removeClass("s-nonmember s-working s-checked").addClass("s-member"),this.$addRemoveButton.attr("disabled",!1)},setMemberChecked:function(){this.state=TD.components.ListMember.STATE_MEMBER_CHECKED,this.$addRemoveButton.removeClass("s-nonmember s-member s-working").addClass("s-checked"),this.$addRemoveButton.attr("disabled",!1)},setNonMember:function(){this.state=TD.components.ListMember.STATE_NON_MEMBER,this.$addRemoveButton.removeClass("s-member s-checked s-working").addClass("s-nonmember"),this.$addRemoveButton.attr("disabled",!1)},setWorking:function(){this.state=TD.components.ListMember.STATE_WORKING,this.$addRemoveButton.removeClass("s-member s-nonmember s-checked").addClass("s-working"),this.$addRemoveButton.attr("disabled",!0)}}),TD.components.ListMemberList=TD.components.Base.extend(function(){this.$node=$(TD.ui.template.render("lists/member_list")),this.$list=this.$find(".js-member-list")}).methods({append:function(e){this.$list.append(e.$node)},prepend:function(e){this.$list.prepend(e.$node)}}),TD.components.TwitterProfileMenu=TD.components.Base.extend(function(e){var t=TD.controller.columnManager.DISPLAY_ORDER_PROFILE;this.screenName=e,this.$node=$(TD.ui.template.render("open_column_profile",{options:t})),this.$launchers=this.$find(".js-item-launch"),this.$launchers.click(_.bind(this._handleItemClick,this))}).statics({URL_BASE:"/add"}).methods({_handleItemClick:function(e){var t=$(e.currentTarget),n=t.data("action"),r=t.data("type"),i=TD.components.OpenColumnHome.URL_BASE+"/"+r;if(n!=="open")return;this.screenName&&(i+="?screenName="+this.screenName),this.publishEvent(TD.components.OpenColumn.GO_EVENT,i)}}),TD.components.Lists=TD.components.Base.extend(function(e,t){var n=this,r={},i=TD.storage.clientController.client.getDefaultAccount(),s;this.owners=r,this.screenName=e,e?s=TD.i("@{{screenName}}'s lists",this):s=TD.i("My lists"),this.$node=$(TD.ui.template.render("open_column_list_multi_group",{groups:[{title:s,className:"js-my-lists"},{title:TD.i("Subscribed to"),className:"js-others-lists"}]})),this.$myLists=this.$find("ul.js-my-lists"),this.$otherLists=this.$find("ul.js-others-lists"),this.lists=[],this.listComponents=[],this.slug=t,this.listComparator=function(e,t){var n=TD.components.Lists,s,o;return r[e.user.id]&&!r[t.user.id]?-1:!r[e.user.id]&&r[t.user.id]?1:r[e.user.id]&&r[t.user.id]?(s=e.account.getKey()===i,o=t.account.getKey()===i,s===o?n.ownerNameComparator(e,t)||n.nameComparator(e,t):s?-1:1):n.nameComparator(e,t)||n.ownerNameComparator(e,t)};if(e){var o=TD.cache.twitterUsers.getByScreenName(e);o.addCallback(function(t){r[t.id]=!0;var i=TD.controller.clients.getClientsByService("twitter"),s=_.find(i,function(t){if(t.oauth.account.getUsername().toLowerCase()===e.toLowerCase())return t});s?(n._handleLists(TD.cache.lists.getListsFor(s.oauth.account.getKey())),n.bubbleEvent(TD.components.Lists.LOADED,n.lists.length)):(s=TD.controller.clients.getPreferredClient("twitter"),s.getLists(e,function(e){n._handleLists(e),n.bubbleEvent(TD.components.Lists.LOADED,n.lists.length)}))})}else{var u=TD.controller.clients.getClientsByService("twitter");_.each(u,function(e){r[e.oauth.account.getUserID()]=!0}),_.each(u,function(e){n._handleLists(TD.cache.lists.getListsFor(e.oauth.account.getKey()))}),this.bubbleEvent(TD.components.Lists.LOADED,n.lists.length)}}).statics({LOADED:"td-lists-loaded",nameComparator:function(e,t){var n=e.name.toLowerCase(),r=t.name.toLowerCase();return(n>r)-(n<r)},ownerNameComparator:function(e,t){var n=e.user.name.toLowerCase(),r=t.user.name.toLowerCase();return(n>r)-(n<r)}}).methods({_handleLists:function(e){var t=this;if(!_.isArray(e)||e.length===0)return;this.lists=this.lists.concat(e),this.lists.sort(this.listComparator);var n={};this.lists=_.select(this.lists,function(e){var t=!n[e.id];return n[e.id]=!0,t}),_.each(this.listComponents,function(e){e.destroy()});var r;this.listComponents=_.map(this.lists,function(e){var n=(new TD.components.MenuItem).list(e);return t.owners[e.user.id]?(t.$myLists.append(n.$node),t.slug&&e.slug.toLowerCase()===t.slug.toLowerCase()&&e.user.screenName.toLowerCase()===t.screenName.toLowerCase()&&(r=n)):t.$otherLists.append(n.$node),n}),!r&&this.screenName&&this.listComponents.length>0&&(r=this.listComponents[0]),r&&_.defer(function(){r.select()})}}),TD.components.SearchInput=TD.components.Base.extend(function(e){var t=this;_.isString(e)?this.promptText=e:this.promptText=TD.i("Enter a #hashtag or keyword"),this.$node=$(TD.ui.template.render("add_column_search_input",{searchInputClassName:"js-add-column-search-input",searchInputPlaceholder:this.promptText})),this.$inputBox=this.$find(".js-add-column-search-input"),this.$searchButton=this.$find(".js-perform-search"),this.$spinner=this.$find(".js-spinner"),this.$clearButton=this.$find(".js-clear-search"),this.$node.submit(function(e){t._search(),e.preventDefault()}),this.$clearButton.click(function(e){t._clear(),e.preventDefault()}),this.$searchButton.click(function(e){t._search(),e.preventDefault()}),this.boundCancelSearch=this.cancelSearch.bind(this),this.$inputBox.on("uiInputBlur",this.boundCancelSearch)}).methods({cancelSearch:function(){this.$inputBox.val("").blur()},_search:function(){var e=$.trim(this.$inputBox.val());e===""?this._clear():this.prevSearchTerm!==e&&(this.prevSearchTerm=e,this.bubbleEvent("td-search",this.$inputBox.val()))},_clear:function(){this.$inputBox.val(""),this.prevSearchTerm="",this.$inputBox.focus(),this.bubbleEvent("td-search-clear"),this.$clearButton.hide(),this.$searchButton.show()},showActivity:function(){this.$searchButton.hide(),this.$clearButton.hide(),this.$spinner.show()},hideActivity:function(){var e=this.$inputBox.val()!=="";this.$clearButton.toggle(e),this.$searchButton.toggle(!e),this.$spinner.hide()},destroy:function(){$(document).off("uiSearchBlur",this.boundCancelSearch),this.$inputBox.unbind(),this.$node.remove()}}),TD.components.MenuItemBase=TD.components.Base.extend(function(){this.eventSubscriptions=[],this.selected=!1,this.eventSubscriptions.push($.subscribe(TD.components.MenuItemBase.GLOBAL_SELECT_EVENT,_.bind(this._handleSelectionEvent,this))),_.defer(_.bind(this._addClickHandler,this))}).statics({GLOBAL_SELECT_EVENT:"/menuitem/select",BUBBLE_SELECT_EVENT:"td-menuitem-select",deselectAll:function(){var e={target:null};TD.storage.notification.notify(this.GLOBAL_SELECT_EVENT,e)}}).methods({_handleSelectionEvent:function(e){this.selected=e.target===this,this.$node.toggleClass("selected",this.selected)},_addClickHandler:function(){var e=this;this.$node.bind("click",function(t){e.selected||e.select()})},select:function(){this.publishEvent(TD.components.MenuItemBase.GLOBAL_SELECT_EVENT,null),this.bubbleEvent(TD.components.MenuItemBase.BUBBLE_SELECT_EVENT)},deselect:function(){this.selected=!1,this.$node.removeClass("selected")},destroy:function(){_.each(this.eventSubscriptions,function(e){$.unsubscribe(e)}),this.$node.remove()}}),TD.components.MenuItem=TD.components.MenuItemBase.extend(function(){this.type=null}).statics({BASIC:"basic",SUBTITLE:"subtitle",PERSON:"person",LIST:"list"}).methods({basic:function(e){return this.type=TD.components.MenuItem.BASIC,this.title=e,this.$node=$(TD.ui.template.render("list_module_list_item",{title:this.title})),this},subtitle:function(e,t){this.type=TD.components.MenuItem.SUBTITLE,this.title=e,this.subtitle=t;var n={title:e,subtitle:t};return this.$node=$(TD.ui.template.render("list_module_subtitle_item",n)),this},selfAccount:function(e){this.type=TD.components.MenuItem.PERSON,this.account=e;var t=e.getType(),n={isTwitter:t==="twitter",fullname:e.getName()||e.getUsername(),username:e.getUsername(),profileImageURL:e.getProfileImageURL()};return this.$node=$(TD.ui.template.render("list_module_account_item",n)),this},twitterUser:function(e){this.type=TD.components.MenuItem.PERSON,this.twitterUser=e;var t={isTwitter:!0,fullname:e.name||e.screenName,username:e.screenName,profileImageURL:e.profileImageURL};return this.$node=$(TD.ui.template.render("list_module_account_item",t)),this},list:function(e){this.type=TD.components.MenuItem.LIST,this.list=e;var t={title:e.name,by:TD.i("by {{1}}",{1:e.user.name}),description:e.description,subtitle:TD.i("{{1}} members",{1:e.memberCount}),miniProfileURL:e.user.miniProfileImageURL(),isPrivate:e.isPrivate};return this.$node=$(TD.ui.template.render("list_module_twitter_list_item",t)),this}}),TD.components.SelfAccounts=TD.components.Base.extend(function(e){var t=TD.storage.accountController.getPostingAccounts();this.titleText=TD.i("Your Accounts"),this.service=e,this.items=[],this.$node=$(TD.ui.template.render("open_column_list_with_header",{title:this.titleText})),this.$list=this.$find(".js-list-container");for(var n=0;n<t.length;n++){var r=t[n],i=r.getType();if(this.service&&i!==this.service)continue;var s=(new TD.components.MenuItem).selfAccount(t[n]);this.items.push(s),this.$list.append(s.$node)}}).methods({selectDefault:function(){var e,t=TD.storage.accountController.getDefault(),n=t.getKey();for(var r=0;r<this.items.length;r++){e=this.items[r];if(n===e.account.getKey()){e.select();break}}},destroy:function(){_.each(this.items,function(e){e.destroy()}),this.$node.remove()}}),TD.components.ProfileAccount=TD.components.Base.extend(function(){this.titleText=TD.i("Profile Account"),this.screenName=null,this.twitterUser=null,this.$node=$(TD.ui.template.render("open_column_list_with_header",{title:this.titleText})),this.$list=this.$find(".js-list-container"),this.menuItem=null}).methods({setUser:function(e){this.screenName=e;var t=TD.cache.twitterUsers.getByScreenName(this.screenName);t.addCallbackWith(this,this._renderUser)},_renderUser:function(e){this.twitterUser=e,this.menuItem=(new TD.components.MenuItem).twitterUser(e),this.$list.append(this.menuItem.$node)},select:function(){this.menuItem.select()},destroy:function(){this.menuItem&&this.menuItem.destroy(),this.$node.remove()}}),TD.components.Trends=TD.components.Base.extend(function(){var e=this;this.woeid=1,this.locationName=TD.i("Worldwide"),this.$node=$(TD.ui.template.render("list_module_trends",{locationName:this.locationName})),this.$trendList=this.$find(".js-trend-list"),this.trendComponents=[],this.trendLocations=null,this.$changeLocation=this.$find("#change-trends"),this.$changeLocation.bind("click",function(t){e._showTrendLocations()}),this.account=TD.storage.accountController.getPreferredAccount("twitter"),this.client=TD.controller.clients.getClient(this.account.getKey()),e._showTrendsForLocation(this.woeid)}).statics({CLICK_URL_BASE:"/open/search/tweets/"}).methods({_showTrendLocations:function(){var e=this;$.isEmptyObject(e.trendLocations)?this.account&&this.client.getTrendLocations(_.bind(this._displayLocations,this)):this._displayLocations(e.trendLocations.locations)},_showTrendsForLocation:function(e){this.client.getTrends(e,_.bind(this._displayTrends,this))},_displayTrends:function(e){var e=e.trends,t=e.locations,n="",r;for(var i=0;i<e.length;i++){if(e[i].promotedContent)continue;r=(new TD.components.MenuItem).basic(e[i].name),this.trendComponents.push(r),this.$trendList.append(r.$node)}},_displayLocations:function(e){},destroy:function(){_.each(this.trendComponents,function(e){e.destroy()}),this.$trendList.unbind(),this.$changeLocation.unbind(),this.$node.remove()}}),TD.components.TwitterUserSearch=TD.components.Base.extend(function(e,t,n){e||(e=TD.storage.accountController.getPreferredAccount("twitter"));if(!e)return;this.listItemComponent=n,this.client=TD.controller.clients.getClient(e.getKey()),this.maxResults=t||TD.components.TwitterUserSearch.MAX_RESULTS,this.searchInput=new TD.components.SearchInput(TD.i("Enter a @name or full name")),this.items=[],this.resultsTitle=TD.i("Search results"),this.$searchResults=$(TD.ui.template.render("open_column_list_with_header",{title:this.resultsTitle})),this.$searchResults.hide(),this.$node=$(this.searchInput.$node),this.$node.append(this.$searchResults),this.$node.bind("td-search",_.bind(this._handleSearchSubmit,this)),this.$node.bind("td-search-clear",_.bind(this._handleSearchClear,this)),this.$searchResultsList=this.$find(".js-list-container")}).statics({SEARCH_COMPLETE:"td-search-complete",MAX_RESULTS:4}).methods({_handleSearchSubmit:function(e,t){this.searchInput.showActivity();var n=t.data;this._search(n),e.stopPropagation()},_search:function(e){e&&this.client.userSearch(e,_.bind(this._handleUsers,this))},_handleSearchClear:function(e){_.each(this.items,function(e){e.destroy()}),this.$searchResults.hide()},_handleUsers:function(e){this.searchInput.hideActivity();var t,n,r;e=_.first(e,this.maxResults),this.items=[],this.$searchResultsList.empty();for(t=0,n=e.length;t<n;t++)this.listItemComponent?r=new this.listItemComponent(e[t]):r=(new TD.components.MenuItem).twitterUser(e[t]),this.items.push(r),this.$searchResultsList.append(r.$node);this.$searchResults.show(),this.bubbleEvent(TD.components.TwitterUserSearch.SEARCH_COMPLETE)},detachResultsContainer:function(){return this.$searchResults.detach()},destroy:function(){_.each(this.items,function(e){e.destroy()}),this.supr()}}),TD.components.SuggestedUsers=TD.components.TwitterUserSearch.extend(function(e,t,n,r){this.searchTerm=r,this._ready=!1,this._userData=null,this.resultsTitle=TD.i("Suggested"),$(".js-title",this.$searchResults).text(this.resultsTitle),this.$node=this.$searchResults,this.searchInput.$node.detach(),this._search(r)}).methods({_handleUsers:function(e){this._ready?e&&e.length>0&&(this.supr(e),this._userData=null):this._userData=e},render:function(){this._ready||(this._ready=!0,this._handleUsers(this._userData))}}),TD.components.TemporaryColumn=TD.components.Base.extend(function(){this.type=undefined,this.service=undefined,this.accountKey=undefined,this.metaString=undefined,this.column=null,this.$actionButton=null}).methods({_init:function(e,t,n,r,i){this.type=e,this.service=t,this.accountKey=n,this.metaString=r,this.column=TD.controller.columnManager.makeColumnFor(e,t,n,r,i),this.column.visible=!0,this.column.temporary=!0,TD.controller.columnManager.add(this.column);var s=this.column.model,o={columnkey:s.getKey(),columntitle:this.column.getTitleHTML(),columnclass:this.column.getIconClass(),isTemporary:!0};this.$node=$(TD.ui.template.render("column",o)),this.$actionButton=this.$find(".js-action-header-button")},populate:function(){TD.ui.columns.setupColumn(this.column),TD.controller.feedScheduler.addColumn(this.column,!1)},makePermanent:function(){var e=TD.controller.columnManager.makeColumnFor(this.type,this.service,this.accountKey,this.metaString,this.column.getSearchFilter());e.setFeeds(this.column.getFeeds()),TD.controller.columnManager.addColumnToUI(e)},home:function(){this._init("home","tweetdeck")},me:function(){this._init("me","tweetdeck")},inbox:function(){this._init("privateMe","tweetdeck")},scheduled:function(){this._init("scheduled","tweetdeck")},genericTwitter:function(e,t,n){var r,i="twitter",s=t.getKey(),o=n?n.id:undefined,u;n?(r=TD.controller.columnManager.NON_SELF_FEED_TYPE[e]||e,e===TD.controller.columnManager.MENTIONS&&(o="@"+n.screenName),TD.cache.names.addScreenName(n.id,n.screenName)):(e===TD.controller.columnManager.MENTIONS&&(u=new TD.vo.SearchFilter,u.action.fromJSONObject({showMentions:!0})),e===TD.controller.columnManager.FOLLOWERS&&(u=new TD.vo.SearchFilter,u.action.fromJSONObject({showFollowers:!0})),r=TD.controller.columnManager.SELF_FEED_TYPE[e]||e),this._init(r,i,s,o,u)},search:function(e,t){if(!t){var n=TD.storage.accountController.getPreferredAccount("twitter");t=n.getKey()}this._init("search","twitter",t,e)},list:function(e){var t=this,n=e.user.account.getKey(),r=e.user.id+"/"+e.id;TD.cache.names.addScreenName(e.user.id,e.user.screenName),TD.cache.names.addListName(e.id,e.name),this._init("list","twitter",n,r),e.isOwnList()&&(this.$actionButton.text(TD.i("Edit")),this.$actionButton.removeClass("is-hidden"),this.$actionButton.click(function(){t.bubbleEvent(TD.components.BaseModal.CLOSE_EVENT);var n=new TD.components.ListMembers(e)}))},destroy:function(){this.column&&this.column.temporary&&TD.controller.columnManager.removeFromAppLayer(this.column.model.getKey()),this.$node.remove()}}),TD.components.ScheduledDatePicker=TD.components.Base.extend(function(e){var t=this;this.$node=$(TD.ui.template.render("compose/schedule")),e.append(this.$node),this.$minutes=$("#scheduled-minute"),this.$hours=$("#scheduled-hour"),this.$datepicker=$("#datepicker"),this.$nextMonth=$("#next-month"),this.$prevMonth=$("#prev-month"),this.$removeDate=$(".js-remove",this.$node),this.$amToggle=$("#amPm"),this.$hours.bind("change",function(){t._refreshDate(),t.publishDateChanged()}),this.$minutes.bind("change",function(){t._refreshDate(),t.publishDateChanged()}),this.$datepicker=this.$datepicker.dateinput({onHide:function(){return!1},change:function(){t._refreshDate(),t.publishDateChanged()},min:-1}),t.datePickerData=this.$datepicker.data("dateinput").show(),this.$nextMonth.bind("click",function(e){t.datePickerData.addMonth(1)}),this.$prevMonth.bind("click",function(e){t.datePickerData.addMonth(-1)}),this.$removeDate.bind("click",function(e){t.publishRemoval()}),this.$amToggle.bind("click",function(e){var n=$(this),r=n.data("value");t._setAmPm(!r)}),t.setDate(new Date)}).methods({_refreshDate:function(){var e=this.datePickerData.getValue(),t=this.$amToggle.data("value"),n=Number(this.$hours.val())%12;t?e.setHours(n+12):e.setHours(n),e.setMinutes(Number(this.$minutes.val())),this.date=e},_setAmPm:function(e){e?(this.$amToggle.text(TD.i("PM")),this.$amToggle.data("value",!0)):(this.$amToggle.text(TD.i("AM")),this.$amToggle.data("value",!1)),this._refreshDate(),this.publishDateChanged()},setDate:function(e){if(e){var t=e.getHours()%12||12,n=e.getHours()>11,r=n?TD.i("PM"):TD.i("AM"),i=e.getMinutes();this._setAmPm(n),this.datePickerData.setValue(e.getFullYear(),e.getMonth(),e.getDate()),this.$hours.val(t),this.$minutes.val(i)}this.date=e,this.publishDateChanged()},getDate:function(){return this.date},publishDateChanged:function(e){$.publish("/change/date",[e!==undefined?e:this.getDate()])},publishRemoval:function(){this.date=null,this.publishDateChanged(null),$.publish("/removed/date")}}),TD.components.LocationPicker=TD.components.Base.extend(function(e){var t=this,n;this.$node=$(TD.ui.template.render("compose/locations")),e.append(this.$node),this.$locationButton=e.find("button"),this.$locationList=this.$find(".js-location-list"),this.$locationSearchHolder=this.$find(".js-location-search"),this.$locationSearchBox=this.$find("#location-search").keyup(function(e){switch(e.keyCode){case TD.constants.keyCodes.enter:t.getPlaces(t.position,t.$locationSearchBox.val());break;case TD.constants.keyCodes.escape:t.hide()}}),this.$node.on("click",".js-location-item",function(e){t.setLocation(e.currentTarget)}),this.$removeLocation=this.$find(".js-location-remove").click(function(e){t.removeLocation()}),n=TD.controller.clients.getClientsByService("twitter");if(!n.length){this.removeLocation();return}this.client=n[0],TD.util.getCurrentLocation(6e3,_.bind(this.getPlaces,this))}).statics({SELECT:"td-select",canHazGeolocation:function(){return!1}}).methods({getPlaces:function(e,t){var n=e?e.coords:{};this.position=e,t=t||"",this.client.geoSearch(t,n.latitude,n.longitude,n.accuracy,null,_.bind(this.showTwitterPlaces,this),_.bind(this.removeLocation,this))},showTwitterPlaces:function(e){if(e&&e.length>0){this.places=e;var t=$(TD.ui.template.render("compose/location_list_item",this));this.$locationList.find(".js-location-item").remove(),t.insertAfter(this.$locationSearchHolder)}},setTwitterPlace:function(e,t){this.twitterPlaceID=e,this.twitterPlaceName=t},setLocation:function(e,t){var n=$(e).data("place-id"),r,i;for(r=0;r<this.places.length;r++){i=this.places[r];if(i.id==n){this.setTwitterPlace(i.id,i.full_name),this.$locationButton.addClass("set-content"),$("b",this.$locationButton).text(i.name),this.$node.trigger(TD.components.LocationPicker.SELECT),this.hide();break}}},hide:function(){this.$node.hide()},removeLocation:function(){this.setTwitterPlace(null,null),this.$locationButton.removeClass("set-content"),this.$node.trigger(TD.components.LocationPicker.SELECT),this.hide(),TD.storage.store.set(":CACHED_PLACES",null)}}),TD.components.DetailView=TD.components.Base.extend(function(e,t){this.initialised=!1,this.column=e,this.$column=t,this.$detailContainer=$(".js-column-detail",this.$column),this.$columnsContainer=$("#container"),this.$column.on("click",".js-column-back",this._handleHeaderClick.bind(this)),this._render(),this.$detailContainer.html(this.$node),this.column.temporary||this.$node.trigger("uiCloseModal"),this.$holder=$(".js-detail-container",this.$column),this.$header=$(".js-column-header",this.$column),TD.ui.columns.refreshTitle(this.column)}).statics({RETWEETER_COUNT:8}).methods({_render:function(){throw"DetailView._render not implemented"},_handleHeaderClick:function(e){this.destroy()},changed:function(e){},deleted:function(e){e.id===this.chirp.id&&this.destroy()},destroy:function(e){var t=this.supr.bind(this);this.$column.off("click",".js-column-back"),this.$column.trigger("uiDetailViewClosed",{column:this.column}),TD.ui.main.TRANSITION_END_EVENTS?this.$column.one(TD.ui.main.TRANSITION_END_EVENTS,function(){e&&e(),t()}):(e&&e(),this.supr())}}),TD.components.TweetDetailView=TD.components.DetailView.extend(function(e,t){}).statics({CARD_CONTAINER:".js-cards-container",MEDIA_CONTAINER:".js-tweet-media",TWEET_STAT:".js-tweet-stat"}).methods({_render:function(){this.$node=$(TD.ui.template.render("status/tweet_detail_wrapper",{headerClass:"js-detail-header",headerAction:"resetToTopColumn",headerLinkClass:"js-column-back"}))},showChirp:function(e,t){this.parentChirp=t,this._showChirp(e);if(!e.cards&&e.entities&&e.entities.urls&&e.entities.urls.length){var n=TD.controller.clients.getClient(e.account.getKey());n.show(e.id,_.bind(this._showCardsForChirp,this),_.bind(this._chirpRetrievalError,this))}else this._showCardsForChirp(e)},_showCardsForChirp:function(e){if(e.cards){var t=TD.ui.template.render("cards/card_layouts",e.cards);this.$find(TD.components.TweetDetailView.CARD_CONTAINER).html(t)}this.showMedia(e)},showMedia:function(e){if(!e.getMedia())return;var t=TD.ui.template.render("status/tweet_detail_media",e);this.$find(TD.components.TweetDetailView.MEDIA_CONTAINER).html(t)},_chirpRetrievalError:function(){},_showChirp:function(e){this.chirp=e,this.$tweetDetail=$(TD.ui.template.render("status/tweet_detail",this.chirp.getMainTweet())),this.$find(".js-tweet-detail").html(this.$tweetDetail);var t=this.$find(".spn-loading"),n=this.$header,r=this.$tweetDetail.find(".js-translate-call-to-action"),i=this.column.getMediaPreviewSize();i!==TD.vo.Column.MEDIA_PREVIEW_OFF&&(i=TD.vo.Column.MEDIA_PREVIEW_SIZE_SMALL),this.replies=new TD.components.InReplyTo(this.chirp,this.$detailContainer,i),this.retweeters=new TD.components.Retweeters(this.chirp,TD.components.DetailView.RETWEETER_COUNT),this.repliesTo=new TD.components.RepliesTo(this.chirp,i),this.$find(".js-inreplyto").replaceWith(this.replies.$node),this.$find(".js-tweet-stats").append(this.retweeters.$node),this.$find(".js-tweet-replies").append(this.repliesTo.$node),this._boundShowSocialProof=this.showSocialProof.bind(this),this.$column.on("click",TD.components.TweetDetailView.TWEET_STAT,this._boundShowSocialProof),this.replies.$node.bind(TD.components.InReplyTo.BEGIN,function(){t.show()}),this.replies.$node.bind(TD.components.InReplyTo.END,function(){n.addClass("gradient-top"),t.hide()}),r.on("click",function(){this.chirp.translate()}.bind(this)),this.initialised=!0,this.$tweetDetail.trigger("uiDetailViewActive",{$chirp:this.$tweetDetail,chirp:this.chirp,parentChirp:this.parentChirp})},showSocialProof:function(e){var t=$(e.srcElement).closest(TD.components.TweetDetailView.TWEET_STAT).data("type");this.$column.trigger("uiShowSocialProof",{type:t,tweetSummary:this.retweeters.tweetSummary,$chirp:this.$tweetDetail,chirp:this.chirp,parentChirp:this.parentChirp})},destroy:function(){this.$column.off("click",this._boundShowSocialProof);var e=function(){this.initialised&&(this.replies.destroy(),this.retweeters.destroy(),this.repliesTo.destroy())}.bind(this);this.supr(e)},findChirp:function(e){return this.initialised?this.replies.findChirp(e)||this.repliesTo.findChirp(e):undefined},getMostInteresting$Chirp:function(){return this.$tweetDetail}}),TD.components.MessageDetailView=TD.components.DetailView.extend(function(e,t){}).methods({_render:function(){this.$node=$(TD.ui.template.render("status/message_wrapper",{headerClass:"js-detail-header",headerAction:"resetToTopColumn",headerLinkClass:"js-column-back"}))},showChirp:function(e,t){var n;this.chirp=e,this.parentChirp=t,this.replyBar=new TD.components.ReplyBar(this.chirp),n=this.chirp.renderThread(),this.$find(".js-message-box").replaceWith(this.replyBar.$node),this.$find(".js-message-detail").html(n),this.initialised=!0,this.chirp.markAsRead(),this.$node.trigger("uiDetailViewActive",{$chirp:this.getMostInteresting$Chirp(),chirp:this.chirp,parentChirp:this.parentChirp})},changed:function(e){if(this.initialised&&e.id===this.chirp.id){var t=e.renderThread();this.$find(".js-message-detail").html(t)}},findChirp:function(e){return this.initialised?this.chirp.messageIndex[e]:undefined},getMostInteresting$Chirp:function(){return this.$find(".js-message-detail .js-stream-item").first()},destroy:function(){var e=function(){this.initialised&&(this.replyBar.destroy(),this.chirp.markAsRead())}.bind(this);this.supr(e)}}),TD.components.ReplyBar=TD.components.Base.extend(function(e){if(!e||!e.postComment)return;var t=TD.ui.template.render("text/strong",{text:e.account.getUsername()}),n={from:TD.i("From {{{1}}}",{1:t})};this._boundHandleGlobalKeydown=this._handleGlobalKeydown.bind(this),this._boundSend=this.send.bind(this),this.$node=$(TD.ui.template.render("status/tweet_detail_replybar",n)),this.chirp=e,this.$inputBox=this.$find(".js-reply-tweetbox"),this.$charCount=this.$find(".js-reply-charcount"),this.$sendButton=this.$find(".js-send");switch(e.account.getType()){case"twitter":this.charLimit=140}this.$sendButton.bind("click",this._boundSend),this._reset()}).statics({ACTIVITY_EVENTS:"click change focus blur input keydown keypress keyup mousedown mouseup paste",RESET_EVENT:"td-reset",REPLYING_EVENT:"td-replying",OVER_CHAR_COUNT_CLASS:"over-char-count"}).methods({_updateCharCount:function(){var e=TD.ui.compose.getTextLength(this.$inputBox.val()),t=this.charLimit-e;t<0||t===this.charLimit?this.$sendButton.attr("disabled",!0):this.$sendButton.attr("disabled",!1),t<0?this.$charCount.addClass(TD.components.ReplyBar.OVER_CHAR_COUNT_CLASS):this.$charCount.removeClass(TD.components.ReplyBar.OVER_CHAR_COUNT_CLASS),this.$charCount.val(t)},_reset:function(){var e="";if(this.chirp instanceof TD.services.TwitterStatus){var t=this.chirp.getMainTweet();e=TD.i("Reply to @{{1}}",{1:t.user.screenName})}else this.chirp instanceof TD.services.TwitterMessageThread&&(e=TD.i("Message @{{1}}",{1:this.chirp.correspondent.screenName}));this.$node.removeClass("s-replying"),this.$inputBox.val(e),this.$inputBox.blur().attr("disabled",!1),this.$sendButton.attr("disabled",!1),this.$inputBox.bind(TD.components.ReplyBar.ACTIVITY_EVENTS,_.bind(this._handleActivity,this)),this.bubbleEvent(TD.components.ReplyBar.RESET_EVENT,null),$(window).unbind("keydown",this._boundHandleGlobalKeydown)},_handleActivity:function(e){var t=this;this.$inputBox.unbind(),t.bubbleEvent(TD.components.ReplyBar.REPLYING_EVENT,null),this.$node.addClass("s-replying");var n="",r=[];this.chirp instanceof TD.services.TwitterStatus&&(r=TD.util.getReplyUsers(this.chirp)),r.length>0&&(n=r.join(" ")+" "),this.$inputBox.val(n),this._updateCharCount();var i=n.length,s=n.length;r.length>0&&(i=r[0].length+1),this.$inputBox.bind("keydown change",_.bind(this._handleKeydown,this)),_.defer(function(){t.$inputBox[0].setSelectionRange(i,s)}),this.$inputBox.bind("cut paste",_.bind(this._handleCutPaste,this)),this.$inputBox.bind("keyup",_.bind(this._updateCharCount,this))},_handleCutPaste:function(e){_.defer(_.bind(this._updateCharCount,this))},_handleGlobalKeydown:function(e){e.which===TD.constants.keyCodes.escape&&this._reset()},_handleKeydown:function(e){this._updateCharCount();switch(e.charCode||e.keyCode){case 10:case 13:if(e.ctrlKey||e.metaKey)e.preventDefault(),this.send();break;case TD.constants.keyCodes.escape:this.$inputBox.blur(),$(window).bind("keydown",this._boundHandleGlobalKeydown)}},send:function(){var e=this.$inputBox.val(),t=this;if(!e)return;this.$sendButton.attr("disabled",!0),this.$inputBox.attr("disabled",!0),this.$inputBox.blur(),this.chirp.postComment(e,function(){t._reset()},function(){t.$sendButton.attr("disabled",!1),t.$inputBox.attr("disabled",!1),t.$inputBox.focus()})}}),TD.components.MediaGallery=TD.components.BaseModal.extend(function(e,t,n){var r=this,i=$(window);this.tweet=e,this.column=n,this.clickedLink=t,this.originalLinkHeight=20,this.$node=$(TD.ui.template.render("media/media_gallery")),this.$closeButton=this.$find(".js-dismiss"),this.$prevButton=this.$find("#media-gallery-prev"),this.$nextButton=this.$find("#media-gallery-next"),this.$embed=this.$find(".js-mediaembed"),this.$tweet=this.$find(".med-tweet"),this.$mainframe=this.$find(".js-embeditem"),this._sizeMedia=this._sizeMedia.bind(this),this.sizeMediaInterval=setInterval(this._sizeMedia,300),this.$closeButton.bind("click",function(){r.destroy()}),this.$prevButton.bind("click",function(){r._prev()}),this.$nextButton.bind("click",function(){r._next()}),this._loadTweet(),this.showInModal(),e.hasMedia()||e.cards?(this.media=e.getMedia().concat(e.getCardsForGallery()),this._setupEmbeds()):(TD.util.openURL(t),this.destroy())}).statics({MEDIA_FLAG_NSFW:".js-media-flag-nsfw",MEDIA_FLAGGED_NSFW:".js-media-flagged-nsfw",HIDDEN_CLASS:"is-hidden"}).methods({showInModal:function(){var e=$("#open-modal");e.append(this.$node).show()},_prev:function(){var e=_.indexOf(this.media,this.currentMedia);e===0&&(e=this.embeds.length),this.currentMedia=this.embeds[e-1],this._renderEmbed()},_next:function(){var e=_.indexOf(this.media,this.currentMedia);e==this.media.length-1&&(e=-1),this.currentMedia=this.media[e+1],this._renderEmbed()},_setupEmbeds:function(){if(!this.media||this.media.length===0)return;var e=this;this.currentMedia=this.media[0],this.clickedLink&&_.each(this.media,function(t){t.url===e.clickedLink&&(e.currentMedia=t)}),this._renderEmbed()},_loadTweet:function(){var e=this;this.$tweet.append(this.tweet.renderInMediaGallery()),this.$tweet.bind("click",function(t){$.publish("chirp/click",[t,e.tweet,e.column])})},_sizeMedia:function(){var e=$("img",this.$mainframe),t=this.tweet.translation?this.$tweet.height()+this.originalLinkHeight:this.originalLinkHeight;e.css({"max-width":this.$mainframe.width(),"max-height":this.$mainframe.height()-t+"px"})},_fadeIn:function(){this.$mainframe.addClass("is-loaded"),this.$embed.fadeTo("fast",1)},_renderEmbed:function(){var e=this,t=this.currentMedia,n="";if(t instanceof TD.services.TwitterCard&&t.shouldDisable()){TD.util.openURL(t.url),this.destroy();return}n=t.renderGallery(),this.$embed.html(n),this.$embed.append(TD.ui.template.render("text/gallery_original_link",t)),this.$embed.append(TD.ui.template.render("text/gallery_flag_media",{flagged:t.flaggedNSFW}));var r=$("img",this.$embed);r.length===0?_.delay(function(){e._fadeIn(),e._sizeMedia()},1e3):r.load(function(){r.attr("data-maxwidth",r.width()),r.attr("data-maxheight",r.height()),r.css({"max-width":r.width()+"px",width:"auto"}),e._sizeMedia(),e._fadeIn()}),this.$find(TD.components.MediaGallery.MEDIA_FLAG_NSFW).click(function(n){var r;t.flaggedNSFW=!0,e.$find(TD.components.MediaGallery.MEDIA_FLAG_NSFW).addClass(TD.components.MediaGallery.HIDDEN_CLASS),e.$find(TD.components.MediaGallery.MEDIA_FLAGGED_NSFW).removeClass(TD.components.MediaGallery.HIDDEN_CLASS),r=TD.controller.clients.getClient(e.tweet.account.getKey()),r.flagTweet(e.tweet.id,function(){},function(){var t=TD.i("Problem flagging media. Please try again");TD.controller.progressIndicator.addMessage(t),e.$find(TD.components.MediaGallery.MEDIA_FLAG_NSFW).removeClass(TD.components.MediaGallery.HIDDEN_CLASS),e.$find(TD.components.MediaGallery.MEDIA_FLAGGED_NSFW).addClass(TD.components.MediaGallery.HIDDEN_CLASS)})}),this.media.length>1?(this.$prevButton.removeClass(TD.components.MediaGallery.HIDDEN_CLASS),this.$nextButton.removeClass(TD.components.MediaGallery.HIDDEN_CLASS),this.$mainframe.addClass("s-shorter"),this.$tweet.find(".js-media").show()):(this.$prevButton.addClass(TD.components.MediaGallery.HIDDEN_CLASS),this.$nextButton.addClass(TD.components.MediaGallery.HIDDEN_CLASS),this.$tweet.find(".js-media").hide())},destroy:function(){var e=$(window);$("#open-modal").hide(),clearInterval(this.sizeMediaInterval),this.supr()}}),TD.components.AccountSelector=TD.components.Base.extend(function(e){var t=this;this.$node=$.createElement("ul").addClass("accs cf js-account-selector"),this.cachedSelectedAccounts=[],this.accountIndex={},this.refreshPostingAccounts(),this.$node.delegate(".js-account-item","click",function(e){var n=$(e.currentTarget);e.stopPropagation(),e.shiftKey?($("li",t.$node).removeClass(TD.components.AccountSelector.SELECTED_CLASS),n.addClass(TD.components.AccountSelector.SELECTED_CLASS)):n.toggleClass(TD.components.AccountSelector.SELECTED_CLASS),t.updateSelectedAccounts()}),this.subscription=$.subscribe("/storage/client/account_whitelist_changed",_.bind(this.refreshPostingAccounts,this))}).statics({CHANGE:"td-accounts-change",SELECTED_CLASS:"acc-selected"}).methods({refreshPostingAccounts:function(){var e,t,n=TD.storage.accountController.getPostingAccounts(),r,i=[],s,o,u,a;this.accountIndex={};for(e=0;e<n.length;e++)r=n[e],u=r.getKey(),i.push(u),this.accountIndex[u]={account:u,uid:u,type:"account",username:r.getUsername(),service:r.getType(),picture:r.getProfileImageURL()};var f=function(e,t,n){var r={accounts:[],show_acc_toggle:n};return r.accounts=_.map(e,function(e){return t[e]}),r};i.length&&(a=TD.ui.template.render("compose/accounts",f(i,this.accountIndex,!0)),this.$node.html(a))},getSelectedAccounts:function(){var e,t=[],n;if(this.cachedSelectedAccounts)return this.cachedSelectedAccounts.concat();e=$("."+TD.components.AccountSelector.SELECTED_CLASS,this.$node);for(var r=0;r<e.length;r++)n=e[r].attributes["data-id"].value,t.push(this.accountIndex[n]);return this.cachedSelectedAccounts=t,t},selectAccounts:function(e){var t=this.$node.find(".js-account-item"),n;if(!_.isArray(e))return;t.removeClass(TD.components.AccountSelector.SELECTED_CLASS);if(!e||!e.length)return;for(n=0;n<e.length;n++)e[n]&&t.filter("li[data-id='"+e[n]+"']").addClass(TD.components.AccountSelector.SELECTED_CLASS);this.updateSelectedAccounts()},selectDefaultAccount:function(){var e=TD.storage.accountController.getDefault();e&&this.selectAccounts([e.getKey()])},updateSelectedAccounts:function(){this.cachedSelectedAccounts=null;var e=this.getSelectedAccounts();this.$node.trigger(TD.components.AccountSelector.CHANGE)},destroy:function(){$.unsubscribe(this.subscription),$(".js-account-item",this.$node).die(),this.supr()}}),TD.components.FollowDialog=TD.components.BaseModal.extend(function(e){var t=this;this.$node.removeClass("s-tall-fixed").addClass("s-fluid s-nonav cmp"),this.$find(".js-header-title").html(TD.i("Your relationship to {{>text/user_link_screenname}}",e)),this.$followFromAccountHolder=this.$find(".js-mdl-content"),$("#actions-modal").html(this.$node);var n=TD.storage.accountController.getAccountsForService("twitter");$(".js-dismiss",this.$node).click(_.bind(this.destroy,this)),this.followAccounts=[],_.each(n,function(n){if(n.getUserID()==e.id)return;var r=new TD.components.FollowFrom(e,n);t.followAccounts.push(r),t.$followFromAccountHolder.append(r.$node)}),$("#actions-modal").show()}).methods({destroy:function(e){this.$node.remove(),$("#actions-modal").hide(),e&&e.preventDefault()}}),TD.components.FollowFrom=TD.components.Base.extend(function(e,t,n){var r=this;this.userToFollow=e,this.account=t,this.showAccountMenu=n,this.isSingleAccount=TD.storage.accountController.getAccountsForService("twitter").length===1,this.client=TD.controller.clients.getClient(t.getKey()),this.$node=$(TD.ui.template.render("actions/follow_from",this)),this.$followButton=this.$find(".js-follow-button").click(_.bind(this.handleClick,r)),this.$followButtonHolder=this.$find(".js-action-follow"),this.state="stranger",n&&(this.$profileMenuButton=this.$find(".js-profile-menu").click(_.bind(this._handleProfileMenuButtonClick,this))),t.getUserID()==e.id?(this.state="me",this.updateButtonState()):this.client.showFriendship(t.getUserID(),e.id,null,_.bind(this.handleFollowInfoResponse,this),_.bind(this.handleFollowInfoError,this)),this.subscriptions=[$.subscribe("/user/"+this.userToFollow.screenName+"/block",_.bind(this._handleBlock,this)),$.subscribe("/user/"+this.userToFollow.screenName+"/blocked",_.bind(this._handleBlock,this))]}).methods({_handleProfileMenuButtonClick:function(e){if(!this.profileMenu||!this.profileMenu.$node)this.profileMenu=new TD.components.ProfileMenu(this.$profileMenuButton,this.userToFollow),this.profileMenu.setPosition(TD.components.DropDown.POSITION_LEFT),e.stopPropagation()},_handleBlock:function(e){e.getKey()===this.account.getKey()&&(this.state="blocked",this.updateButtonState())},handleFollowInfoResponse:function(e){var t=this;e.relationship.source.blocking===!0?this.state="blocked":e.relationship.source.following===!0?this.state="following":this.state="stranger",this.updateButtonState()},handleFollowInfoError:function(e){this.following=!1,this.blocking=!1,this.updateButtonState()},handleClick:function(e){var t=this.account;if(this.$followButton.attr("disabled"))return;switch(this.state){case"me":TD.util.openURL("https://twitter.com/settings/profile");break;case"blocked":this.userToFollow.unblock(t,null,_.bind(this.unblockError,this)),this.state="stranger";break;case"pending":case"following":this.userToFollow.unfollow(t,null,_.bind(this.unfollowError,this)),this.state="stranger";break;case"stranger":this.userToFollow.follow(t,_.bind(this.followResponse,this),_.bind(this.followError,this)),this.state="following"}this.updateButtonState()},followError:function(){this.state="stranger",this.updateButtonState()},unfollowError:function(){this.state="following",this.updateButtonState()},unblockError:function(){this.state="blocked",this.updateButtonState()},followResponse:function(e){e.isProtected&&(this.state="pending",this.updateButtonState())},updateButtonState:function(){this.$followButton.attr("disabled",!1),this.$followButtonHolder.removeClass("s-not-following s-following s-pending s-blocking");switch(this.state){case"me":this.$followButtonHolder.addClass("s-thats-you");break;case"blocked":this.$followButtonHolder.addClass("s-blocking");break;case"pending":this.$followButtonHolder.addClass("s-pending");break;case"following":this.$followButtonHolder.addClass("s-following");break;case"stranger":this.$followButtonHolder.addClass("s-not-following")}},destroy:function(){_.each(this.subscriptions,function(e){$.unsubscribe(e)}),this.supr()}}),TD.components.AddToListsDialog=TD.components.BaseModal.extend(function(e){var t=this,n=TD.storage.accountController.getAccountsForService("twitter");this.myLists=[],this.userToAdd=e,_.each(n,function(n){var r=TD.controller.clients.getClient(n.getKey());_.each(TD.cache.lists.getListsFor(n.getKey()),function(e){e.user.id==n.getUserID()&&t.myLists.push(e)}),r.getListMemberships(e.screenName,!0,function(e){_.each(e,function(e){t.$find("#"+e.id).attr("checked","checked")})})}),this.$node.removeClass("s-tall-fixed").addClass("s-fluid cmp"),this.$find(".js-header-title").text(TD.i("Your lists")).after(" "+TD.i("Include {{>text/user_link_screenname}} in:",e)),this.$find(".js-mdl-content").html(TD.ui.template.render("actions/add_to_list_dialog",this)).addClass("with-scroll scroll-v scroll-alt").toggleClass("scroll-styled-v",TD.globalRenderOptions.styledScrollbar),this.$listCheckboxes=this.$find(".js-mdl-content input").click(_.bind(this._changeSubscription,this)),this.$find(".mdl-buttonbar").html(TD.ui.template.render("actions/add_to_list_footer")),this.$createListButton=this.$find(".js-create-list"),$(".js-dismiss",this.$node).click(_.bind(this.destroy,this)),this.$createListButton.click(_.bind(this._createList,this)),$("#actions-modal").html(this.$node).show()}).methods({_changeSubscription:function(e){var t=$(e.target),n=t.attr("id"),r=t.attr("checked")==="checked",i=t.attr("data-account"),s=TD.controller.clients.getClient(i),o=TD.storage.Feed.generateKeyFor(i,"list",{listId:n}),u=TD.controller.feedManager.getPoller(o),a=this;r?s.addUserToList(n,this.userToAdd.screenName,function(){u&&_.delay(function(){u.refresh(!0,!0)},1e3)}):s.removeUserFromList(n,this.userToAdd.screenName,function(){u&&u.removeWhere(function(e){return a.userToAdd.id==e.user.id})})},_createList:function(e){this.destroy();var t=new TD.components.ListDetails;t.autoAddMember(this.userToAdd)},destroy:function(e){this.$node.remove(),$("#actions-modal").hide(),e&&e.preventDefault()}}),TD.components.ActionDialog=TD.components.BaseModal.extend(function(e){var t=this;this.tweet=e,this.$node.removeClass("js-modal-panel s-tall-fixed").addClass("cmp s-fluid s-inreply l-no-txtarea"),this.$find(".mdl-inner").replaceWith($(TD.ui.template.render("actions/action_dialog"))),this.$inreplyToHolder=this.$find(".js-inreply"),this.header=new TD.components.ActionHeader,this.header.$node.bind(TD.components.ActionHeader.CLOSE,function(e){t.destroy()}),this.$find(".mdl-header").prepend(this.header.$node),this.$buttons=this.$find(".js-action-button"),this.$buttons.click(this._handleClick.bind(this)),this._boundRetweet=this._retweet.bind(this),$(document).on("uiSendRetweetAction",this._boundRetweet),this.displayTweet(e),this.header.accountSelector.selectAccounts([e.account.getKey()]),$("#actions-modal").html(this.$node).show()}).methods({displayTweet:function(e){var t=e;t&&(t.withAvatar=!0,this.$inreplyToHolder.html(TD.ui.template.render("status/tweet_single",t)).show())},_quote:function(){var e=this.header.accountSelector.getSelectedAccounts();TD.ui.compose.showComposeWindow(this.tweet.getMainTweet().getQuoteText()),TD.ui.compose.selectAccounts(_.map(e,function(e){return e.account}))},_retweetFromAccount:function(e){var t=TD.controller.clients.getClient(e.account),n=t.create();this.$buttons.attr("disabled","disabled"),n.Retweet(this.tweet.id),n.post(this._handleRetweeted.bind(this),this._handleRetweetFailure.bind(this))},_retweet:function(){var e=this.header.accountSelector.getSelectedAccounts();e.forEach(this._retweetFromAccount,this)},_handleClick:function(e){var t=$(e.target),n=t.data("action");switch(n){case"quote":this._quote(),this.destroy();break;case"retweet":this._retweet()}},_handleRetweeted:function(e){this.tweet.setRetweeted(!0),this.destroy()},_handleRetweetFailure:function(e){var t=TD.i("Failed: Retweet");e.errors&&e.errors.forEach(function(e){t+=" - "+e.message}),TD.controller.progressIndicator.addMessage(t),this.$buttons.removeAttr("disabled")},destroy:function(){$(document).off("uiSendRetweetAction",this._boundRetweet),$("#actions-modal").hide(),this.supr()}}),TD.components.ActionHeader=TD.components.Base.extend(function(){var e=this;this.accountsVisible=!1,this.$node=$.createElement("div"),this.$node.append($(TD.ui.template.render("actions/action_header"))),this.accountSelector=new TD.components.AccountSelector,this.$node.append(this.accountSelector.$node),this.$composeUsernames=this.$find("h3"),this.$actionText=this.$find("span"),this.$showAccountsToggle=this.$find(".js-accounts-toggle"),this.$showAccountsToggle.click(_.bind(this.toggleAccountsVisibility,this)),this.accountSelector.$node.bind(TD.components.AccountSelector.CHANGE,function(){var t=_.map(e.accountSelector.getSelectedAccounts(),function(e){return e.username}),n=TD.i("From {{accounts}}",{accounts:t.join(", ")});e.$composeUsernames.text(n)}),this.accountSelector.selectDefaultAccount(),this.toggleAccountsVisibility()}).statics({CHANGE:"td-accounts-change",CLOSE:"td-dialog-close"}).methods({toggleAccountsVisibility:function(){this.accountsVisible?(this.$actionText.text(TD.i("Change")),this.accountSelector.hide()):(this.$actionText.text(TD.i("Hide")),this.accountSelector.show()),this.accountsVisible=!this.accountsVisible}}),TD.components.GlobalSettings=TD.components.BaseModal.extend(function(){var e=TD.storage.accountController.isEmpty()?"accounts":"general",t={tabs:[{title:TD.i("General"),action:"general"},{title:TD.i("Accounts"),action:"accounts"},{title:TD.i("Services"),action:"services"},{title:TD.i("Mute"),action:"filter"}]};this.$find(".js-header-title").text(TD.i("Settings")),this.$node.removeClass("s-tall-fixed").addClass("s-short s-nonav"),this.$find(".js-mdl-content").html(TD.ui.template.render("settings/global_settings_modal",t)),this.$optionList=this.$find(".js-setting-list li"),$("#settings-modal").append(this.$node),$(".js-dismiss",this.$node).click(_.bind(this.destroy,this)),$("a.list-link",this.$node).click(function(e){var t=$(e.currentTarget),n=t.data("action");this.switchTab(n)}.bind(this)),this.switchTab(e),$("#settings-modal").show()}).methods({switchTab:function(e){if(e===this.currentTabName)return;this.$optionList.removeClass("selected"),this.currentTab&&this.currentTab.destroy();switch(e){case"general":this.currentTab=new TD.components.GeneralSettings;break;case"accounts":this.currentTab=new TD.components.AccountSettings;break;case"services":this.currentTab=new TD.components.ServicesSettings;break;case"filter":this.currentTab=new TD.components.FilterSettings}this.currentTabName=e,this.$optionList.find("[data-action="+e+"]").parent("li").addClass("selected")},destroy:function(e){this.currentTab&&this.currentTab.destroy(),$("#settings-modal").hide(),e&&e.preventDefault(),this.supr()}}),TD.components.AccountSettings=TD.components.Base.extend(function(){this.$node=$(TD.ui.template.render("settings/global_setting_account")),$("#global-settings").append(this.$node),this.$accountHolder=$(".js-account-container"),this.$resetPasswordButton=$(".js-reset-password"),this.$resetPasswordButton.click(this.handleResetPassword.bind(this)),this.$resetPasswordErrorMessage=this.$find(".js-reset-error"),this.$resetPasswordSuccessMessage=this.$find(".js-reset-success"),this.$resetProgressSpinner=this.$find(".js-reset-progress"),this.boundRefreshAccounts=this.refreshAccounts.bind(this),this.subscriptions=[$.subscribe("/storage/account/new",this.boundRefreshAccounts),$.subscribe("/storage/account/blacklisted",this.boundRefreshAccounts),$.subscribe("/storage/client/default_account_changed",this.setDefaultAccount.bind(this))],this.refreshAccounts(),$(".js-add-account").on("click",this.handleAddAccount.bind(this)),this.$node.on("click",".js-remove-account",this.handleRemoveAccount.bind(this)),this.$node.on("click",".js-set-default",this.handleSetDefaultClick.bind(this))}).methods({handleRemoveAccount:function(e){var t=$(e.target),n=t.data("account"),r=_.uniqueId(),i={id:r,title:TD.i("Removing account!"),message:TD.i("Are you sure you want to remove account '{{1}}' from TweetDeck?",{1:TD.storage.accountController.get(n).getUsername()}),okLabel:TD.i("Remove"),cancelLabel:TD.i("Cancel")},s=function(e,t){if(t.id!==r)return;$(document).off("uiConfirmationAction",s),t.result&&TD.controller.clients.removeClient(n)};$(document).on("uiConfirmationAction",s).trigger("uiShowConfirmationDialog",i)},handleAddAccount:function(e){var t=$(e.target);TD.controller.clients.addClient(t.data("service"))},handleSetDefaultClick:function(e){var t=$(e.target),n=t.data("account");n&&TD.storage.accountController.setDefault(n)},refreshAccounts:function(){var e=TD.storage.accountController.getAccountsForService("twitter"),t="";t+=TD.ui.template.render("settings/global_setting_account_row",{accounts:e,isTwitter:!0}),this.$accountHolder.html(t),this.setDefaultAccount()},setDefaultAccount:function(){var e=TD.storage.accountController.getDefault();if(!e)return;var t=e.getKey(),n=$(".js-is-default-account"),r=$(".js-set-default");n.addClass("is-hidden"),r.removeClass("is-hidden"),n.filter('[data-account="'+t+'"]').removeClass("is-hidden"),r.filter('[data-account="'+t+'"]').addClass("is-hidden")},destroy:function(e){this.$node.remove(),$(".js-remove-account").off("click"),$(".js-add-account").off("click"),$(".js-set-default").off("click"),_.each(this.subscriptions,function(e){$.unsubscribe(e)})},handleResetPassword:function(e){var t,n;this.$resetPasswordButton.prop("disabled",!0),this.$resetPasswordErrorMessage.addClass("is-hidden"),this.$resetProgressSpinner.removeClass("is-hidden"),n=TD.storage.store.getTweetdeckAccount(),t=TD.controller.clients.getTDClient().forgotPassword(n),t.addCallbackWith(this,function(e){this.$resetPasswordSuccessMessage.removeClass("is-hidden"),this.$resetPasswordErrorMessage.addClass("is-hidden"),this.$resetProgressSpinner.addClass("is-hidden")}),t.addErrbackWith(this,function(e){this.$resetPasswordErrorMessage.removeClass("is-hidden"),this.$resetProgressSpinner.addClass("is-hidden"),this.$resetPasswordButton.prop("disabled",!1)})}}),TD.components.FilterSettings=TD.components.Base.extend(function(){this.$globalSettings=$("#global-settings"),this.$globalSettings.submit(_.bind(this.handleAddFilter,this)),this.$node=$(TD.ui.template.render("settings/global_setting_filter",{})),this.$globalSettings.append(this.$node),this.$filterHolder=$("#filter-results"),$(".js-remove-filter").live("click",_.bind(this.handleRemoveFilter,this)),this.$addFilterInput=$("#filter-input"),this.$addFilterInput.keyup(_.bind(this._validateFilter,this)),this.$filterTypes=$("#filter-types"),this.$filterTypes.change(_.bind(this.handleFilterTypeChange,this)),this.$addFilterButton=$("#add-filter"),this.$addFilterButton.click(_.bind(this.handleAddFilter,this)),this.handleFilterTypeChange(),this.refreshFilters()}).methods({_validateFilter:function(e){var t=this.$filterTypes.val(),n=this.$addFilterInput.val(),r=TD.controller.filterManager.validateFilter(t,n);return r?this.$addFilterButton.removeAttr("disabled"):this.$addFilterButton.attr("disabled","disabled"),r},handleAddFilter:function(e){e.preventDefault();if(!this._validateFilter())return;var t=this.$filterTypes.val(),n=this.$addFilterInput.val();TD.controller.filterManager.addFilter(t,n),this.refreshFilters(),this.$addFilterInput.val("")},handleRemoveFilter:function(e){var t=$(e.target);TD.controller.filterManager.removeFilter(t.data("id")),this.refreshFilters()},handleFilterTypeChange:function(){var e=this.$filterTypes.val(),t;switch(e){case TD.vo.Filter.PHRASE:t=TD.i("eg iPad");break;case TD.vo.Filter.SENDER:t=TD.i("eg @JohnDoe123");break;case TD.vo.Filter.SOURCE:t=TD.i("eg TweetSpamApp")}this.$addFilterInput.attr("placeholder",t),this._validateFilter()},refreshFilters:function(){var e=TD.controller.filterManager.getAll(),t="";_.each(e,function(e){t+=TD.ui.template.render("settings/global_setting_filter_row",e)}),this.$filterHolder.html(t),this._validateFilter()},destroy:function(e){$(".js-remove-filter").die("click"),this.$globalSettings.unbind("submit"),this.$node.remove()}}),TD.components.ServicesSettings=TD.components.Base.extend(function(){this.$node=$(TD.ui.template.render("settings/global_setting_services",{}));var e=TD.storage.accountController.getAccountsForService("bitly");e.length>0&&(this.bitlyAccount=e[0]),$("#global-settings").append(this.$node),this.$bitlyForm=$("#bitly-form"),this.$bitlyUsername=$("#bitly-email"),this.$bitlyKey=$("#bitly-key"),this.$linkShorteners=$("#link-shortening"),this.$linkShorteners.change(_.bind(this.handleLinkShortenerChange,this)),this.setLinkShortener()}).methods({handleLinkShortenerChange:function(e){var t=this.$linkShorteners.val();t=t.split("-")[1],TD.settings.setLinkShortener(t),this.setLinkShortener()},setLinkShortener:function(){var e=TD.settings.getLinkShortener();this.$linkShorteners.val("link-"+e),e=="bitly"?(this.$bitlyForm.show(),this.bitlyAccount&&(this.$bitlyUsername.val(this.bitlyAccount.getUserID()),this.$bitlyKey.val(this.bitlyAccount.getOAuthToken()))):this.$bitlyForm.hide()},commitBitlyChanges:function(e,t){var n=this.$bitlyUsername.val(),r=this.$bitlyKey.val();e&&t&&TD.storage.accountController.blacklistAccount(e);if(!e||t){e=new TD.storage.Account,e.setType("bitly"),e.setOAuthToken(r),e.setUserID(n),e.computeKey(),TD.storage.accountController.manage(e);return}e.setOAuthToken(r)},destroy:function(){var e=TD.settings.getLinkShortener();if(e=="bitly"){var t=this.bitlyAccount,n=this.$bitlyUsername.val(),r=this.$bitlyKey.val();n&&r&&(!t||t.getUserID()==n&&t.getOAuthToken()==r?t||this.commitBitlyChanges():this.commitBitlyChanges(t,t.getUserID()!=n))}this.$node.remove()}}),TD.components.GeneralSettings=TD.components.Base.extend(function(){var e={version:TD.version,buildIDShort:TD.buildIDShort,appEnv:TD.util.getAppEnv()};TD.util.isWrapperApp()&&deck.getWrapperVersion&&(e.wrapperVersion=deck.getWrapperVersion()),this.$node=$(TD.ui.template.render("settings/global_setting_general",e)),$("#global-settings").append(this.$node),this.$streamingForm=this.$find(".js-streaming-form"),this.$streamingUpdates=$("#streaming-updates"),this.$streamingUpdates.change(_.bind(this.handleStreamingChange,this)),this.setStreaming(),this.$checkForUpdatesForm=this.$find(".js-check-updates-form"),this.$checkForUpdates=$("#check-for-updates"),this.$checkForUpdates.change(_.bind(this.handleCheckForUpdatesChange,this)),this.setCheckForUpdates(),this.$inlineMedia=$("#inline-media"),this.$inlineMedia.change(_.bind(this.handleInlineMediaChange,this)),this.setInlineMedia(),this.$showStartupNotifications=$("#show-startup-notifications"),this.$showStartupNotifications.change(_.bind(this.handleShowStartupNotificationsChange,this)),this.setShowStartupNotifications(),this.$columnSizeRadios=$(".js-column-size-radio"),this.$columnSizeRadios.change(this.handleColumnWidthChange.bind(this)),this.setColumnWidth(),this.$fontSizeRadioButtons=$(".js-font-size-radio"),this.$fontSizeRadioButtons.change(this.handleFontSizeChange.bind(this)),this.setFontSize(),this.$themeSwitcherRadios=$(".js-theme-radio"),this.$themeSwitcherRadios.change(this.handleThemeSwitcherChange.bind(this)),this.setTheme()}).methods({handleStreamingChange:function(e){var t=Boolean(this.$streamingUpdates.attr("checked"));TD.settings.setUseStream(t)},setStreaming:function(){this.$streamingUpdates.prop("checked",TD.settings.getUseStream())},handleInlineMediaChange:function(e){var t=Boolean(this.$inlineMedia.attr("checked"));TD.settings.setShowInlineMedia(t)},setInlineMedia:function(){this.$inlineMedia.attr("checked",TD.settings.getShowInlineMedia())},handleCheckForUpdatesChange:function(e){var t=Boolean(this.$checkForUpdates.attr("checked"));TD.settings.setCheckForUpdates(t),this.setStreaming()},setCheckForUpdates:function(){this.$checkForUpdatesForm.hide()},handleShowStartupNotificationsChange:function(e){var t=Boolean(this.$showStartupNotifications.attr("checked"));TD.settings.setShowStartupNotifications(t)},setShowStartupNotifications:function(){this.$showStartupNotifications.attr("checked",TD.settings.getShowStartupNotifications())},setFontSize:function(){var e=TD.settings.getFontSize(),t=$('.js-font-size-radio[value="'+e+'"]');t.prop("checked",!0)},handleFontSizeChange:function(e){var t;e.currentTarget.checked&&(t=e.currentTarget.value,TD.settings.setFontSize(t))},setColumnWidth:function(){var e=TD.settings.getColumnWidth(),t=$('.js-column-size-radio[value="'+e+'"]');t.prop("checked",!0)},handleColumnWidthChange:function(e){var t;e.currentTarget.checked&&(t=e.currentTarget.value,TD.settings.setColumnWidth(t))},handleThemeSwitcherChange:function(e){$(document).trigger("uiThemeChangeAction")},setTheme:function(){var e=TD.settings.getTheme(),t=$('.js-theme-radio[value="'+e+'"]');t.prop("checked",!0)}}),TD.components.AccountSelector=TD.components.Base.extend(function(e){var t=this;this.$node=$.createElement("ul").addClass("accs cf js-account-selector"),this.cachedSelectedAccounts=[],this.accountIndex={},this.refreshPostingAccounts(),this.$node.delegate(".js-account-item","click",function(e){var n=$(e.currentTarget);e.stopPropagation(),e.shiftKey?($("li",t.$node).removeClass(TD.components.AccountSelector.SELECTED_CLASS),n.addClass(TD.components.AccountSelector.SELECTED_CLASS)):n.toggleClass(TD.components.AccountSelector.SELECTED_CLASS),t.updateSelectedAccounts()}),this.subscription=$.subscribe("/storage/client/account_whitelist_changed",_.bind(this.refreshPostingAccounts,this))}).statics({CHANGE:"td-accounts-change",SELECTED_CLASS:"acc-selected"}).methods({refreshPostingAccounts:function(){var e,t,n=TD.storage.accountController.getPostingAccounts(),r,i=[],s,o,u,a;this.accountIndex={};for(e=0;e<n.length;e++)r=n[e],u=r.getKey(),i.push(u),this.accountIndex[u]={account:u,uid:u,type:"account",username:r.getUsername(),service:r.getType(),picture:r.getProfileImageURL()};var f=function(e,t,n){var r={accounts:[],show_acc_toggle:n};return r.accounts=_.map(e,function(e){return t[e]}),r};i.length&&(a=TD.ui.template.render("compose/accounts",f(i,this.accountIndex,!0)),this.$node.html(a))},getSelectedAccounts:function(){var e,t=[],n;if(this.cachedSelectedAccounts)return this.cachedSelectedAccounts.concat();e=$("."+TD.components.AccountSelector.SELECTED_CLASS,this.$node);for(var r=0;r<e.length;r++)n=e[r].attributes["data-id"].value,t.push(this.accountIndex[n]);return this.cachedSelectedAccounts=t,t},selectAccounts:function(e){var t=this.$node.find(".js-account-item"),n;if(!_.isArray(e))return;t.removeClass(TD.components.AccountSelector.SELECTED_CLASS);if(!e||!e.length)return;for(n=0;n<e.length;n++)e[n]&&t.filter("li[data-id='"+e[n]+"']").addClass(TD.components.AccountSelector.SELECTED_CLASS);this.updateSelectedAccounts()},selectDefaultAccount:function(){var e=TD.storage.accountController.getDefault();e&&this.selectAccounts([e.getKey()])},updateSelectedAccounts:function(){this.cachedSelectedAccounts=null;var e=this.getSelectedAccounts();this.$node.trigger(TD.components.AccountSelector.CHANGE)},destroy:function(){$.unsubscribe(this.subscription),$(".js-account-item",this.$node).die(),this.supr()}}),TD.components.DropDown=TD.components.Base.extend(function(e){this.$parent=e,this.$body=$("body"),this.$container=this.$parent.closest(TD.components.DropDown.CONTAINER_SELECTOR),this.$container.length===0&&(this.$container=this.$body),this._handleCloseDropdown=_.bind(this._handleCloseDropdown,this),$(document).on("uiCloseDropdown",this._handleCloseDropdown),this._boundHandleGlobalClick=_.bind(this._handleGlobalClick,this)}).statics({CLOSE:"td-dropdown-close",POSITION_RIGHT:"td-dropdown-right",POSITION_LEFT:"td-dropdown-left",CONTAINER_SELECTOR:".js-dropdown-container",dropdown:null}).methods({addToDisplay:function(){var e=TD.components.DropDown.dropdown;if(e){e.destroy(),TD.components.DropDown.dropdown=null;if(e.$parent[0]===this.$parent[0]){this.destroy();return}}this.$parent.addClass("is-selected"),this.$node.insertAfter(this.$parent),this.$node.show(),this.setPosition(),this.$body.on("click","*",this._boundHandleGlobalClick),TD.components.DropDown.dropdown=this},_handleGlobalClick:function(e){this.$node&&this.$find(e.currentTarget).length===0&&this.$parent.find(e.currentTarget).length===0&&this.destroy()},_handleCloseDropdown:function(){this.destroy()},destroy:function(){if(!this.$node)return;this.$parent.removeClass("is-selected"),$(document).off("uiCloseDropdown",this._handleCloseDropdown),this.$body.off("click","*",this._boundHandleGlobalClick),this.bubbleEvent(TD.components.DropDown.CLOSE),this.$node.remove(),this.$node=null,TD.components.DropDown.dropdown=null},setPosition:function(e){var t,n,r,i,s;e===TD.components.DropDown.POSITION_RIGHT?this.$node.addClass("pos-r"):e===TD.components.DropDown.POSITION_LEFT&&this.$node.addClass("pos-l"),this.$container.length>0&&!this.$node.hasClass("pos-t")&&(t=this.$node.offset().top,n=this.$container.offset().top,s=this.$node.outerHeight(),r=t+s,i=n+this.$container.height(),r>=i&&t-s>n&&this.$node.addClass("pos-t"))}}),TD.components.ProfileMenu=TD.components.DropDown.extend(function(e,t,n,r){this.user=t,this.chirp=n,this.isSingleAccount=TD.storage.accountController.getAccountsForService("twitter").length===1,this.showFollow=r||!this.isSingleAccount,this.isFlagged=this.chirp&&this.chirp.getMedia().some(function(e){return e.flaggedNSFW}),this.chirp instanceof TD.services.TwitterDirectMessage?this.$node=$(TD.ui.template.render("menus/profile_directmessage",this)):this.$node=$(TD.ui.template.render("menus/profile",this)),this.actionsMenu=e.closest("ul"),this.setChirpMenuState(),this.$find("a").click(_.bind(this.handleClick,this)),this.addToDisplay()}).methods({_handleFlagTweetSuccess:function(){var e=this.chirp.getMedia();e.forEach(function(e){e.flaggedNSFW=!0}),TD.controller.progressIndicator.addMessage(TD.i("Success: Media flagged"))},_handleFlagTweetError:function(){TD.controller.progressIndicator.addMessage(TD.i("Error: Failed to flag media. Please try again."))},handleClick:function(e){var t=$(e.target).data("action"),n=$(e.target).attr("rel"),r;if(t==="url")return;e.preventDefault(),e.stopPropagation();switch(t){case"mention":TD.ui.compose.mention(this.user.screenName,this.user.account.getKey());break;case"message":TD.ui.compose.directMessage(this.user.screenName,this.user.profileImageURL,this.user.account.getKey());break;case"lists":new TD.components.AddToListsDialog(this.user);break;case"flag-media":TD.controller.progressIndicator.addMessage(TD.i("Flagging media...")),r=TD.controller.clients.getClient(this.chirp.account.getKey()),r.flagTweet(this.chirp.id,this._handleFlagTweetSuccess.bind(this),this._handleFlagTweetError);break;case"block":$(document).trigger("uiBlockAction",{account:this.user.account,twitterUser:this.user});break;case"report-spam":$(document).trigger("uiReportAction",{account:this.user.account,twitterUser:this.user});break;case"followOrUnfollow":var i=new TD.components.FollowDialog(this.user);break;case"follow":this.user.follow(this.user.account,null,null,!0);break;case"unfollow":this.user.unfollow(this.user.account,null,null,!0);break;case"reference-to":this.chirp.referenceTo();break;case"email":this.chirp.email();break;case"destroy":this.chirp.destroy();break;case"embed":$(document).trigger("uiShowEmbedTweet",{tweet:this.chirp.getMainTweet()});break;case"translate":this.chirp.translate()}this.destroy()},setChirpMenuState:function(){this.actionsMenu.addClass("is-visible")},destroy:function(){this.supr(),this.actionsMenu.removeClass("is-visible")}}),TD.components.TopbarMenu=TD.components.DropDown.extend(function(e){this.$node=$(TD.ui.template.render("menus/topbar_menu",{debug:Boolean(TD.config.debug_menu),tdAccount:TD.storage.store.getTweetdeckAccount()})),this.addToDisplay(),this.$find("a").on("click",this.handleClick.bind(this)),this.$node.on("click",this.handleNodeClick.bind(this)),this.boundParentClickHandler=this.handleParentClick.bind(this),e.on("click",this.boundParentClickHandler)}).methods({handleClick:function(e){var t=$(e.target),n=t.data("action");switch(n){case"signOut":TD.controller.init.signOut();break;case"url":TD.util.openURL(t.attr("href"));break;case"globalSettings":var r=new TD.components.GlobalSettings;break;case"do_debug":TD.sync.ui.dispatch_ui_event(t.data("type"));break;case"fileabug":this.sendBugReport();break;case"keyboardShortcutList":$(document).trigger("uiShowKeyboardShortcutList")}e.preventDefault(),this.destroy()},handleParentClick:function(e){e.stopPropagation(),this.destroy()},handleNodeClick:function(e){e.preventDefault(),e.stopPropagation()},sendBugReport:function(){var e,t=TD.config.fileabug,n;n={tdAccount:TD.storage.store.getTweetdeckAccount(),userAgent:navigator.userAgent,version:TD.version,buildID:TD.gitrevshort},e=TD.ui.template.render("emails/fileabug",n),TD.util.openEmail(t,"",e)},destroy:function(){this.$parent.off("click",this.boundParentClickHandler),this.supr()}}),TD.vo.Column=function(e,t){TD.sync.util.assert(e,"must provide sColumn to create aColumn");var n=this;this.model=e,TD.sync.util.assert(this.model.getKey(),"vo.Column will most likely fail if your column has no key"),this._feeds=[],this.filters=[],this.description="",this.updateArray=[],this.updateIndex={},this.scribedImpressionIDs=new TD.cache.LRUQueue(200),this._animating=!1,this._animationQueue=[],this._isUpdating=!0,this.feedSubscriptions={},this.deleteSubscriptions={},this.visible=!0,this.visibility={columnWidth:0,visibleWidth:0,visibleHeight:0,visibleFraction:0},this.temporary=!1,this.chirpContainerSelector=".js-chirp-container[data-column='"+this.model.getKey()+"']",this._$chirpContainer=null,this.detailViewComponent=null,this.feedsFetched=0,this.isFirstFetch=!0,this.isFetchingOlderUpdates=!1,this.lastInfiniteScrollTime=null,this.isShowingLoadMore=!1,this.isExhausted=!1,this.CHIRP_BLOCK_SIZE=20,this.model.getType()==="scheduled"?this.sortFunction=TD.util.chirpAscSort:this.sortFunction=TD.util.chirpDescSort,this.loadFeeds(),this.loadFilters(),t&&this.setFeeds(t),this.isFilterable()||this.updateSearchFilter(new TD.vo.SearchFilter),this.GLOBAL_TPM_ANIMATION_LIMIT=2e3,this.COLUMN_TPM_ANIMATION_LIMIT=120,this.COLUMN_MINIMALIST_TWEET_TPM_THRESHOLD=750,this.doAnimate=!0,this.streamRate=0;var r=this.updateStreamRate.bind(this);$(document).on("dataStreamRate",r),this.tpm=0;var i=this.updateTpm.bind(this),s="dataColumn"+this.model.getKey()+"Tpm";$(document).on(s,i),this.tpmCounter=new TD.util.TpmCounter(500,5e3,s),this.STREAM_ITEM_CONTENT_SELECTOR=".js-stream-item-content",this.STREAM_ITEM_SELECTOR=".js-stream-item",this.INFINITE_SPINNER_SELECTOR=".js-infinitespinner"},TD.vo.Column.CHIRP_STAGGERING_INTERVAL=400,TD.vo.Column.FADE_IN_CLASS="column-opacity-transition",TD.vo.Column.MEDIA_PREVIEW_OFF="off",TD.vo.Column.MEDIA_PREVIEW_SIZE_SMALL="small",TD.vo.Column.MEDIA_PREVIEW_SIZE_MEDIUM="medium",TD.vo.Column.MEDIA_PREVIEW_SIZE_LARGE="large",TD.vo.Column.prototype.reset=function(){this.updateArray=[],this.updateIndex={},this.feedsFetched=0,this.isFirstFetch=!0,this.isFetchingOlderUpdates=!1,this.lastInfiniteScrollTime=null,this.refreshSubscriptions()},TD.vo.Column.prototype.updateStreamRate=function(e,t){this.streamRate=t.itemsPerMinute},TD.vo.Column.prototype.updateTpm=function(e,t){this.tpm=t.itemsPerMinute},TD.vo.Column.prototype.loadFeeds=function(){if(!this.model.managed)return;var e=this.model.getFeedKeys();if(_.isUndefined(e)){TD.sync.util.stateLog("loadFeeds() not loading feeds for",this,"given",this.model.state);return}this._feeds=[];for(var t=0;t<e.length;t++){var n=TD.storage.feedController.get(e[t]);this._feeds.push(n)}this.refreshSubscriptions()},TD.vo.Column.prototype.getFeeds=function(){return this._feeds.concat()},TD.vo.Column.prototype.getFeedCount=function(){return this._feeds.length},TD.vo.Column.prototype.setFeeds=function(e){this._feeds=e;var t=[];for(var n=0;n<this._feeds.length;n++)t.push(this._feeds[n].getKey());this.model.setFeedKeys(t),this.refreshSubscriptions(),this.model.managed&&TD.storage.feedController.manageFeeds(this._feeds)},TD.vo.Column.prototype.addFeed=function(e){var t=[],n;for(var r=0;r<this._feeds.length;r++){n=_feeds[r].getKey();if(n===e.getKey())return;t.push(n)}this._feeds.push(e),t.push(e.getKey()),this.model.setFeedKeys(t),this.refreshSubscriptions(),this.model.managed&&TD.storage.feedController.manageFeeds(this._feeds)},TD.vo.Column.prototype.addFeeds=function(e){if(!e||e.length===0)return;var t=[],n={},r;e=this._feeds.concat(e);for(r=0;r<e.length;r++)n[e[r].getKey()]||(n[e[r].getKey()]=!0,t.push(e[r]));this.setFeeds(t)},TD.vo.Column.prototype.removeFeed=function(e){var t=[],n,r=0;for(var i=this._feeds.length-1;i>=0;i--)n=this._feeds[i].getKey(),n===e.getKey()?(this._feeds.splice(i,1),r++):t.push(n);return r>0&&(this.model.setFeedKeys(t),this.refreshSubscriptions(),this.checkChirpIndex()),r},TD.vo.Column.prototype.findChirp=function(e){var t=this.updateIndex[e];return!t&&this.detailViewComponent&&(t=this.detailViewComponent.findChirp(e)),t},TD.vo.Column.prototype.findMostInterestingChirp=function(e){var t=this.findChirp(e);return t&&t instanceof TD.services.TwitterAction&&(t=t.getRelatedTweet()||t),t},TD.vo.Column.prototype.getChirpContainer=function(){if(!this._$chirpContainer||this._$chirpContainer.length===0)this._$chirpContainer=$(this.chirpContainerSelector);return this._$chirpContainer},TD.vo.Column.prototype.checkChirpIndex=function(){var e=this.model.getFeedKeys(),t=_.map(e,TD.controller.feedManager.getPoller),n=_.filter(this.updateArray,function(e){return!_.find(t,function(t){return t.chirpIndex[e.id]})});this.removeFromIndex(null,n,!0)},TD.vo.Column.prototype.refreshSubscriptions=function(){var e,t={},n=this.model.getFeedKeys(),r=this;if(this.model.getType()==="me"){var i=!1,s=[];_.each(n,function(e){var t=TD.storage.feedController.get(e);if(!t)return;t.getType()==="interactions"&&(i=!0),t.getType()!=="mentions"&&s.push(e)}),i&&(n=s)}for(var o=0;o<n.length;o++)e=n[o],t[e]=!0,this.feedSubscriptions[e]||(this.feedSubscriptions[e]=$.subscribe("/feed/"+e,function(e,t,n){r.addToIndex(e,t,n)})),this.deleteSubscriptions[e]||(this.deleteSubscriptions[e]=$.subscribe("/delete/"+e,function(e,t){r.removeFromIndex(e,t,!0)}));for(e in this.feedSubscriptions)t[e]||($.unsubscribe(this.feedSubscriptions[e]),delete this.feedSubscriptions[e]);for(e in this.deleteSubscriptions)t[e]||($.unsubscribe(this.deleteSubscriptions[e]),delete this.deleteSubscriptions[e])},TD.vo.Column.prototype.removeSubscriptions=function(){var e;for(e in this.feedSubscriptions)$.unsubscribe(this.feedSubscriptions[e]),delete this.feedSubscriptions[e];for(e in this.deleteSubscriptions)$.unsubscribe(this.deleteSubscriptions[e]),delete this.deleteSubscriptions[e]},TD.vo.Column.prototype.fetchUpdatesFromPoller=function(e){if(this.isFetchingOlderUpdates)return;var t=this,n,r=this.updateArray.length,i=0,s=!1,o=0,u,a=function(){var e=t.getFeeds().map(function(e){var r=TD.controller.feedManager.getPoller(e.getKey()),u=r.fetchOlderChirps(n);return u.addCallback(function(n){var u;return n=_.select(n,function(e){return!t.updateIndex[e.id]}),t.lastInfiniteScrollTime=(new Date).getTime(),u=t.addItemsToIndex(n,!0,e,e.getLatestTime()),s=!r.isExhausted||s,i+=u,n.length&&(o=Math.max(o,n[n.length-1].created.getTime())),n}),u});return new TD.core.defer.DeferredList(e)},f=function(){t.feedsFetched=0,n=o,o=0;if(i===0){if(s)return a();t.isExhausted=!0}};return this.updateArray.length&&!e?n=this.updateArray[this.updateArray.length-1].created.getTime():n=Number.MAX_VALUE,this.isFetchingOlderUpdates=!0,this.addInfiniteScrollSpinner(),u=a(),u.addCallback(f),u.addCallback(function(){t.removeInfiniteScrollSpinner(),t.showLoadMoreButton(),t.isFetchingOlderUpdates=!1,t.truncate(r+t.CHIRP_BLOCK_SIZE)}),u},TD.vo.Column.prototype.addToIndex=function(e,t,n){var r;this._isUpdating&&(this.getChirpContainer().trigger("dataColumnFeedUpdated"),this.hideIsUpdatingMessage(),this._isUpdating=!1);if(t.length===0){this.updateArray.length===0&&this.temporary&&this.showNoResultsMessage();return}this.hideNoResultsMessage(),r=t.concat(),this.addItemsToIndex(r,this.updateArray.length,e.feed,n),this.isFirstFetch&&(this.feedsFetched++,this.feedsFetched==this.getFeedCount()&&(this.truncate(this.CHIRP_BLOCK_SIZE),this.feedsFetched=0,this.isFirstFetch=!1)),this.showLoadMoreButton()},TD.vo.Column.prototype.addItemsToIndex=function(e,t,n,r){var i,s=[],o,u=this.updateArray.length?this.updateArray[this.updateArray.length-1].created.getTime():0,a=this.model.getClearedTimestamp(),f=[],l=0;this.updateArray.length===0&&this.removeInfiniteScrollSpinner(),e.sort(this.sortFunction),i=e.length;for(var c=0;c<i;c++){o=e[c];if(!t&&o.created.getTime()<u)continue;if(o.created.getTime()<=a)continue;if(!o.passFilters(this.filters))continue;_.isUndefined(this.updateIndex[o.id])||(this.removeFromIndex(null,[o],!1),this.detailViewComponent&&this.detailViewComponent.changed(o)),this.updateIndex[o.id]=o,s.push(o),_.isUndefined(r)||(f=f.concat(o.getUnreadChirps(r)));if(s.length>this.CHIRP_BLOCK_SIZE)break}l=s.length;if(l){var h="",p=[],d=this.updateArray;while(s.length>0||d.length>0)if(s.length===0)p=p.concat(d),d=[];else if(d.length===0)p=p.concat(s),this.addToView(n,h,s),s=[];else{var v=[],m=s[0].created.getTime(),g=d[0].created.getTime();while(m>g&&s.length>0)o=s.shift(),v.push(o),s.length>0&&(m=s[0].created.getTime());v.length>0?(this.addToView(n,h,v),p=p.concat(v)):(o=d.shift(),p.push(o),o.passFilters(this.filters)&&(h=o.id))}this.updateArray=p}return $.publish("/notifications/new",[{column:this,feed:n,items:f}]),this.isMessageColumn()&&this.getChirpContainer().trigger("uiReadStateChange",{}),l},TD.vo.Column.prototype.removeFromIndex=function(e,t,n){for(var r=0;r<t.length;r++){var i=t[r];this.removeChirp(i),n&&this.detailViewComponent&&this.detailViewComponent.deleted(i)}},TD.vo.Column.prototype.removeChirp=function(e){var t=this.updateIndex[e.id];if(t){for(var n=0;n<this.updateArray.length;n++){e=this.updateArray[n];if(e===t){this.updateArray.splice(n,1);break}}delete this.updateIndex[e.id],$('[data-key="'+e.id+'"]',this.getChirpContainer()).remove(),$(document).trigger("uiColumnChirpsChanged",{id:this.model.getKey()})}},TD.vo.Column.prototype.clear=function(){if(this.updateArray.length===0)return;var e=this.updateArray[0].created.getTime();this.model.setClearedTimestamp(e),this.truncate(0)},TD.vo.Column.prototype.truncate=function(e){var t,n,r,i=-1,s=this.getFeeds(),o;this.feedsFetched=0;for(t=0;t<s.length;t++){n=TD.controller.feedManager.getPoller(s[t].getKey());if(!n)continue;r=n.getRangeStartTime(),r>i&&(i=r)}o=null;for(t=this.updateArray.length-1;t>=0;t--)if(this.updateArray[t].created.getTime()>=i){o=t;break}if(o!==null){o=Math.min(e,o+1);for(t=this.updateArray.length-1;t>=o;t--)this.annihilateChirp(this.updateArray[t].id.toString(),this.getChirpContainer()),this.isExhausted=!1;this.updateArray.splice(o,Number.MAX_VALUE)}},TD.vo.Column.prototype.trimUpdates=function(e){var t,n,r;if(this.lastInfiniteScrollTime){t=(new Date).getTime()-this.lastInfiniteScrollTime;if(!(t>1e4))return;r=Math.floor((this.updateArray.length-20)*(1-t/6e5)),this.maxUpdatesPerColumn=Math.max(20+r,20)}e=e||Math.max(this.maxUpdatesPerColumn||20,20),n=this.updateArray.splice(e,Math.max(this.updateArray.length-e,0));for(var i=0;i<n.length;i++)this.annihilateChirp(n[i].id.toString(),this.getChirpContainer())},TD.vo.Column.prototype.annihilateChirp=function(e,t){var n=this,r=this.findChirp(e);t.children('[data-key="'+e+'"]').remove(),delete this.updateIndex[e]},TD.vo.Column.prototype.addToView=function(e,t,n){var r,i=this.getChirpContainer(),s,o,u,a,f=TD.controller.columnManager.isStreaming(this.model.getKey());if(n.length===0)return;this.updateArray.length===0?(u=TD.util.getPreciseTime(),r=this.renderChirps(n),a=TD.util.getPreciseTime(),TD.util.logTimeToRenderColumn(a-u,n.length)):(f&&this.tpmCounter.incrementCounter(n.length),r=this.renderChirps(n)),s=$(r).filter(this.STREAM_ITEM_SELECTOR),o=i.children(this.STREAM_ITEM_SELECTOR).size()===0,t===""?o?(i.html(s),this.isShowingLoadMore=!1):(!TD.ui.columns.isFrozen(this.model.getKey())&&TD.controller.columnManager.isStreaming(this.model.getKey())&&this.trimUpdates(100-s.size()),i.prepend(s)):i.children('[data-key="'+t+'"]').after(s),o?this._fadeInContent(i):this._slideInChirps(s)},TD.vo.Column.prototype.getMediaPreviewSize=function(){var e,t=this.model.getMediaPreviewSize();return t||(this.isMessageColumn()&&(t=TD.vo.Column.MEDIA_PREVIEW_OFF),e=this.getSearchFilter(),e.content.hasActiveMediaFilter()?t=TD.vo.Column.MEDIA_PREVIEW_SIZE_MEDIUM:this.getColumnType()===TD.util.columnUtils.columnMetaTypes.INTERACTIONS?t=TD.vo.Column.MEDIA_PREVIEW_SIZE_SMALL:t=TD.vo.Column.MEDIA_PREVIEW_SIZE_MEDIUM),t},TD.vo.Column.prototype.renderChirps=function(e){var t=[],n,r,i=this.tpm>this.COLUMN_MINIMALIST_TWEET_TPM_THRESHOLD,s=this.getMediaPreviewSize();for(r=0;r<e.length;r++)n=i&&e[r].renderMinimalist?e[r].renderMinimalist(this.temporary,s):e[r].render(this.temporary,s),t.push(n);return t.join("")},TD.vo.Column.prototype._fadeInContent=function(e){var t=this;_.defer(function(){e.css("opacity",1),TD.ui.main.TRANSITION_END_EVENTS?e.one(TD.ui.main.TRANSITION_END_EVENTS,function(){e.removeClass(TD.vo.Column.FADE_IN_CLASS).removeAttr("style"),$(document).trigger("uiColumnChirpsChanged",{id:t.model.getKey()})}):(e.removeClass(TD.vo.Column.FADE_IN_CLASS).removeAttr("style"),$(document).trigger("uiColumnChirpsChanged",{id:t.model.getKey()}))})},TD.vo.Column.prototype._slideInChirps=function(e){var t,n,r=[],i=this.temporary&&this.getChirpContainer().closest(".is-hidden").length;this.doAnimate=!i&&this.streamRate<this.GLOBAL_TPM_ANIMATION_LIMIT&&this.tpm<this.COLUMN_TPM_ANIMATION_LIMIT,e&&(e.each(function(){r.push($(this).toggleClass("is-animating"))}),r.reverse(),this._animationQueue=this._animationQueue.concat(r));if(this._animating||this._animationQueue.length===0)return;n=TD.ui.columns.freezeScroll(this.model.getKey()),n?(this.isFetchingOlderUpdates||this.getChirpContainer().trigger("uiReadStateChange",{read:!1}),_.each(this._animationQueue,function(e){e.removeClass("is-animating")}),this._animationQueue=[]):TD.controller.columnManager.isStreaming(this.model.getKey())?(_.each(this._animationQueue,this._slideInChirp.bind(this)),this._animationQueue=[]):(this._animating=!0,t=this._animationQueue.shift(),this._slideInChirp(t),setTimeout(function(){this._animating=!1,this._slideInChirps()}.bind(this),TD.vo.Column.CHIRP_STAGGERING_INTERVAL)),this.isFetchingOlderUpdates||TD.ui.columns.unfreezeScroll(this.model.getKey()),$(document).trigger("uiColumnChirpsChanged",{id:this.model.getKey()})},TD.vo.Column.prototype._slideInChirp=function(e){var t,n=function(){e.removeClass("is-animating"),e.removeAttr("style"),$(document).trigger("uiColumnChirpsChanged",{id:this.model.getKey()})}.bind(this);this.doAnimate&&TD.ui.main.TRANSITION_END_EVENTS?(t=e.find(".js-stream-item-content").outerHeight(),e.css({opacity:1,height:t+"px"}),e.one(TD.ui.main.TRANSITION_END_EVENTS,n)):n()},TD.vo.Column.prototype.showLoadMoreButton=function(){return},TD.vo.Column.prototype.hideLoadMoreButton=function(){return},TD.vo.Column.prototype.addInfiniteScrollSpinner=function(){this.hideLoadMoreButton(),this.getChirpContainer().append(TD.ui.template.render("spinner_large"))},TD.vo.Column.prototype.removeInfiniteScrollSpinner=function(){$(this.INFINITE_SPINNER_SELECTOR,this.getChirpContainer()).remove()},TD.vo.Column.prototype.showIsUpdatingMessage=function(){this.$loadingMessage=$(TD.ui.template.render("column_loading_placeholder",{isUpdating:!0})),this.getChirpContainer().html(this.$loadingMessage)},TD.vo.Column.prototype.hideIsUpdatingMessage=function(){var e=this.getChirpContainer();e.css("opacity",0),_.defer(function(){e.addClass(TD.vo.Column.FADE_IN_CLASS)}),e.find(".js-column-loading-placeholder").remove(),this.showLoadMoreButton()},TD.vo.Column.prototype.showNoResultsMessage=function(){var e=this.getChirpContainer();e.css("opacity",1).removeClass(TD.vo.Column.FADE_IN_CLASS),this.$noResults=$(TD.ui.template.render("search_no_tweets_placeholder")),e.html(this.$noResults)},TD.vo.Column.prototype.hideNoResultsMessage=function(){this.$noResults&&this.$noResults.remove()},TD.vo.Column.prototype.getTitleHTML=function(){return TD.util.columnUtils.getColumnTitleHTML(this)},TD.vo.Column.prototype.getDetailTitleHTML=function(){return TD.util.columnUtils.getColumnTitleHTML(this)},TD.vo.Column.prototype.getColumnType=function(){return TD.util.columnUtils.getColumnType(this)},TD.vo.Column.prototype.getIconClass=function(){return TD.util.columnUtils.getColumnIconClassByColumnType(this.getColumnType())},TD.vo.Column.prototype.isMessageColumn=function(){return TD.util.columnUtils.isMessageColumn(this)},TD.vo.Column.prototype.isSearchColumn=function(){return this.getColumnType()===TD.util.columnUtils.columnMetaTypes.SEARCH},TD.vo.Column.prototype.isActionsColumn=function(){return TD.util.columnUtils.actionColumnTypes.indexOf(this.getColumnType())>-1},TD.vo.Column.prototype.isSingleActionTypeColumn=function(){return TD.util.columnUtils.singleActionColumnTypes.indexOf(this.getColumnType())>-1},TD.vo.Column.prototype.isActivityColumn=function(){return this.getColumnType()===TD.util.columnUtils.columnMetaTypes.ACTIVITY},TD.vo.Column.prototype.isEmbeddable=function(){return _.include(TD.util.columnUtils.embeddableColumnTypes,this.getColumnType())},TD.vo.Column.prototype.isClearable=function(){var e=this.getColumnType();return e!==TD.util.columnUtils.columnMetaTypes.SCHEDULED},TD.vo.Column.prototype.isOwnList=function(){var e=!1;return _.find(this.getFeeds(),function(t){if(t.getType()==="list"){var n=t.getMetadata();e=TD.cache.lists.find(n.listId,n.screenName,n.slug,!0)}return Boolean(e)}),e},TD.vo.Column.prototype.updateMetadata=function(e){var t,n=this.getFeeds()[0];this._isUpdating=!0,this.showIsUpdatingMessage(),e.term=null,t=TD.storage.feedController.getOrCreateFeed(n.getType(),n.getService(),n.getAccountKey(),e),this.getChirpContainer().trigger("dataColumnUpdatingFeed",{column:this,oldFeed:n,newFeed:t}),TD.controller.feedManager.replaceFeed(n,t,[this.model.getKey()])},TD.vo.Column.prototype.loadFilters=function(){var e=new TD.vo.SearchFilter(this.model.getFilters()),t=e.getFilters();_.isEqual(_.pluck(this.filters,"id"),_.pluck(t,"id"))||(this.filters=t,this.reapplyFilters())},TD.vo.Column.prototype.isFilterable=function(){return TD.util.columnUtils.filterableColumnTypes.indexOf(this.getColumnType())!==-1},TD.vo.Column.prototype.reapplyFilters=function(){this._isUpdating||(this.truncate(0),this.fetchUpdatesFromPoller(!0),this.showLoadMoreButton())},TD.vo.Column.prototype.getBaseQuery=function(){var e=null,t=this.getFeeds();if(this.isSearchColumn()&&t&&t.length>0){var n=t[0].getMetadata();n&&(n.baseQuery?e=n.baseQuery:e=n.term)}return e},TD.vo.Column.prototype.updateSearchFilter=function(e){var t,n,r,i,s;if(!e)return;this.isSearchColumn()?this.updateSearchFeedFilter(e):(r=this.getFeeds()[0],r&&this.isActionsColumn()&&!this.isActivityColumn()&&(n=r.getType(),t=TD.util.columnUtils.inferFeedTypeFromActionFilter(e.action),t!==n&&(s=_.clone(r.getMetadata()),i=TD.storage.feedController.getOrCreateFeed(t,r.getService(),r.getAccountKey(),s),this.getChirpContainer().trigger("dataColumnUpdatingFeed",{column:this,oldFeed:r,newFeed:i}),TD.controller.feedManager.replaceFeed(r,i,[this.model.getKey()]))),this.model.setFilters(e.toJSONObject()),this.getChirpContainer().trigger("dataColumnFiltersUpdated"))},TD.vo.Column.prototype.updateSearchFeedFilter=function(e){var t=!1,n=this.getFeeds()[0],r=_.clone(n.getMetadata());r.baseQuery||(r.baseQuery=r.term),e.content&&e.content.matching&&e.content.matching!==r.baseQuery&&(t=!0,r.baseQuery=e.content.matching);var i=new TD.vo.SearchFilter(r.searchFilterData);if(t||i.getQueryString()!==e.getQueryString())r.searchFilterData=e.toJSONObject(),this.updateMetadata(r)},TD.vo.Column.prototype.getSearchFilter=function(){var e,t;return this.isSearchColumn()?(t=this.getFeeds()[0].getMetadata(),e=new TD.vo.SearchFilter(t.searchFilterData),e.content.matching||e.content.setMatching(t.baseQuery||t.term)):e=new TD.vo.SearchFilter(this.model.getFilters()),e},TD.vo.Column.prototype.hasActiveSearchFilters=function(){var e=this.getSearchFilter(),t=this.hasActiveUserFilters()||this.hasActiveContentFilters()||this.hasActiveEngagementFilters()||this.hasActiveActionFilters()&&!this.isSingleActionTypeColumn();return this.isSearchColumn()||(t=e.content.matching||t),Boolean(t)},TD.vo.Column.prototype.hasActiveContentFilters=function(){var e=this.getSearchFilter(),t;return this.isSearchColumn()?t=e.content.getQueryString():t=e.content.matching||e.content.getQueryString(),Boolean(t)},TD.vo.Column.prototype.hasActiveUserFilters=function(){var e=this.getSearchFilter(),t=e.user.getQueryString();return Boolean(t)},TD.vo.Column.prototype.hasActiveActionFilters=function(){var e=this.getSearchFilter(),t=e.action.getFilters().length;return Boolean(t)},TD.vo.Column.prototype.hasActiveEngagementFilters=function(){var e=this.getSearchFilter(),t=e.engagement.getQueryString();return Boolean(t)},TD.vo.Column.prototype.hasFilterError=function(){var e=this.getSearchFilter(),t;return this.getColumnType()===TD.util.columnUtils.columnMetaTypes.ACTIVITY?t=e.action.getFilters().length===TD.vo.ActionFilter.MAX_ACTIVITY_FILTERS:t=e.action.getFilters().length===TD.vo.ActionFilter.MAX_INTERACTION_FILTERS,t},TD.vo.Column.prototype.markAllMessagesAsRead=function(){this.isMessageColumn()&&this.updateArray.forEach(function(e){e instanceof TD.services.TwitterMessageThread&&e.markAsRead()})},TD.vo.Column.prototype.hasUnreadMessages=function(){var e=!1;return this.isMessageColumn()&&(e=this.updateArray.some(function(e){return e.unread})),e},TD.vo.Filter=function(e,t,n){this.type=e,this.value=t,this.positive=n,_.isString(t)&&(this.value=t.toLowerCase());switch(this.type){case TD.vo.Filter.PHRASE:this.exact=!1;break;case TD.vo.Filter.SENDER:this.exact=!0,this.fuzzy=!0,this.filterTarget="parent";break;case TD.vo.Filter.SOURCE:this.exact=!0,this.fuzzy=!1;break;case TD.vo.Filter.FOLLOWERS:this.exact=!1,this.range=!0;break;case TD.vo.Filter.IS_RETWEET:this.exact=!0;break;case TD.vo.Filter.IS_FROM_VERIFIED:this.exact=!0;break;case TD.vo.Filter.CHIRP_TYPE:this.exact=!0,this.filterTarget="parent"}this.id=this.generateLocalID()},TD.vo.Filter.PHRASE="phrase",TD.vo.Filter.SENDER="sender",TD.vo.Filter.SOURCE="source",TD.vo.Filter.FOLLOWERS="followers",TD.vo.Filter.IS_RETWEET="is_retweet",TD.vo.Filter.IS_MENTION="is_mention",TD.vo.Filter.IS_FAVORITE="is_favorite",TD.vo.Filter.IS_FOLLOW="is_follow",TD.vo.Filter.HAS_IMAGE="has_image",TD.vo.Filter.HAS_VIDEO="has_video",TD.vo.Filter.HAS_MEDIA="has_media",TD.vo.Filter.HAS_LINK="has_link",TD.vo.Filter.IS_FROM_VERIFIED="verified",TD.vo.Filter.CHIRP_TYPE="chirp_type",TD.vo.Filter.prototype.id=null,TD.vo.Filter.prototype.value=null,TD.vo.Filter.prototype.type=TD.vo.Filter.PHRASE,TD.vo.Filter.prototype.positive=!0,TD.vo.Filter.prototype.exact=!0,TD.vo.Filter.prototype.fuzzy=!1,TD.vo.Filter.prototype.range=!1,TD.vo.Filter.prototype.filterTarget="child",TD.vo.Filter.prototype.generateLocalID=function(){return"filter"+TD.util.deterministicObjectHash(this.toBackendState())},TD.vo.Filter.prototype.pass=function(e){var t=this;e=this._getFilterTarget(e),text=e.getFilterableText(),text=text?text.toLowerCase():null,senders=e.getSenders(),senders=senders?_.map(senders,function(e){return e.toLowerCase()}):null,source=e.getSource(),source=source?source.toLowerCase():null;switch(this.type){case TD.vo.Filter.PHRASE:return this._testString(text);case TD.vo.Filter.SENDER:return this.positive?_.any(senders,function(e){return t._testString(e)}):_.every(senders,function(e){return t._testString(e)});case TD.vo.Filter.SOURCE:return this._testString(source);case TD.vo.Filter.FOLLOWERS:return this._testNumber(followers);case TD.vo.Filter.IS_RETWEET:return this._testBoolean(e.isRetweetedStatus());case TD.vo.Filter.IS_FROM_VERIFIED:return this._testBoolean(e.isFromVerifiedUser());case TD.vo.Filter.HAS_IMAGE:return this._testBoolean(e.hasImage());case TD.vo.Filter.HAS_VIDEO:return this._testBoolean(e.hasVideo());case TD.vo.Filter.HAS_MEDIA:return this._testBoolean(e.hasImage()||e.hasVideo());case TD.vo.Filter.HAS_LINK:return this._testBoolean(e.hasLink());case TD.vo.Filter.CHIRP_TYPE:return this._testString(e.getChirpType())}return!0},TD.vo.Filter.prototype.getDisplayType=function(){switch(this.type){case TD.vo.Filter.PHRASE:return"";case TD.vo.Filter.SENDER:return TD.i("user");case TD.vo.Filter.SOURCE:return TD.i("source");case TD.vo.Filter.FOLLOWERS:return TD.i("followers");case TD.vo.Filter.IS_RETWEET:return TD.i("retweets");case TD.vo.Filter.HAS_MEDIA:return TD.i("media");case TD.vo.Filter.HAS_LINK:return TD.i("links");case TD.vo.Filter.IS_FROM_VERIFIED:return TD.i("verified")}return""},TD.vo.Filter.prototype._getFilterTarget=function(e){return this.filterTarget!=="parent"&&e.targetTweet?e.targetTweet:e},TD.vo.Filter.prototype._testString=function(e){if(!e||!this.value)return!0;if(this.exact){if(e===this.value)return this.positive;if(this.fuzzy&&"@"+e===this.value)return this.positive}else if(e.indexOf(this.value)!==-1)return this.positive;return!this.positive},TD.vo.Filter.prototype._testNumber=function(e){if(!_.isNumber(e)||!_.isNumber(this.value))return!0;if(this.exact){if(e===this.value)return this.positive}else if(this.range&&e>=this.value)return this.positive;return!this.positive},TD.vo.Filter.prototype._testBoolean=function(e){return!_.isBoolean(e)||!_.isBoolean(this.value)?!0:e===this.value?this.positive:!this.positive},TD.vo.Filter.prototype.toBackendState=function(){return{type:this.type,value:this.value,positive:this.positive,exact:this.exact,fuzzy:this.fuzzy,range:this.range}},TD.vo.Filter.prototype.fromBackendState=function(e){this.type=e.type,this.value=e.value,this.positive=e.positive,this.exact=e.exact,this.fuzzy=e.fuzzy,this.range=e.range,this.id=this.generateLocalID()},TD.vo.SearchFilter=function(e){this.fromJSONObject(e)},TD.vo.SearchFilter.prototype.action=null,TD.vo.SearchFilter.prototype.content=null,TD.vo.SearchFilter.prototype.engagement=null,TD.vo.SearchFilter.prototype.user=null,TD.vo.SearchFilter.prototype.toJSONObject=function(){var e={action:this.action.toJSONObject(),content:this.content.toJSONObject(),engagement:this.engagement.toJSONObject(),user:this.user.toJSONObject()};return e},TD.vo.SearchFilter.prototype.fromJSONObject=function(e){e=e||{},this.action=new TD.vo.ActionFilter(e.action),this.content=new TD.vo.ContentFilter(e.content),this.engagement=new TD.vo.EngagementFilter(e.engagement),this.user=new TD.vo.UserFilter(e.user)},TD.vo.SearchFilter.prototype.getQueryString=function(){var e=[this.content.getQueryString(),this.engagement.getQueryString(),this.user.getQueryString()];return e.join(" ").trim()},TD.vo.SearchFilter.prototype.getFilters=function(){var e=this.action.getFilters();return e=e.concat(this.content.getFilters()),e=e.concat(this.engagement.getFilters()),e=e.concat(this.user.getFilters()),e},TD.vo.ActionFilter=function(e){this.fromJSONObject(e)},TD.vo.ActionFilter.prototype.showMentions=!0,TD.vo.ActionFilter.prototype.showRetweets=!0,TD.vo.ActionFilter.prototype.showFavorites=!0,TD.vo.ActionFilter.prototype.showFollowers=!0,TD.vo.ActionFilter.prototype.showLists=!0,TD.vo.ActionFilter.MAX_INTERACTION_FILTERS=6,TD.vo.ActionFilter.MAX_ACTIVITY_FILTERS=4,TD.vo.ActionFilter.prototype.setShowMentions=function(e){this.showMentions=Boolean(e)},TD.vo.ActionFilter.prototype.setShowRetweets=function(e){this.showRetweets=Boolean(e)},TD.vo.ActionFilter.prototype.setShowFavorites=function(e){this.showFavorites=Boolean(e)},TD.vo.ActionFilter.prototype.setShowFollowers=function(e){this.showFollowers=Boolean(e)},TD.vo.ActionFilter.prototype.setShowLists=function(e){this.showLists=Boolean(e)},TD.vo.ActionFilter.prototype.toJSONObject=function(){return{showMentions:this.showMentions,showRetweets:this.showRetweets,showFavorites:this.showFavorites,showFollowers:this.showFollowers,showLists:this.showLists}},TD.vo.ActionFilter.prototype.fromJSONObject=function(e){if(!e)return;this.setShowMentions(e.showMentions),this.setShowRetweets(e.showRetweets),this.setShowFavorites(e.showFavorites),this.setShowFollowers(e.showFollowers),this.setShowLists(e.showLists)},TD.vo.ActionFilter.prototype.getSummaryText=function(e){var t=[],n,r,i,s=e===TD.util.columnUtils.columnMetaTypes.ACTIVITY;s?i=TD.vo.ActionFilter.MAX_ACTIVITY_FILTERS:i=TD.vo.ActionFilter.MAX_INTERACTION_FILTERS;var o=this.getFilters();return o.length===i?n=TD.i("Filter error"):o.length===0?n=s?TD.i("All activity"):TD.i("All interactions"):o.length===1&&!s?this.showMentions?this.showRetweets?this.showFavorites?this.showFollowers?this.showLists||(n=TD.i("All except lists")):n=TD.i("All except followers"):n=TD.i("All except favorites"):n=TD.i("All except retweets"):n=TD.i("All except mentions"):(s||(this.showMentions&&t.push(TD.i("mentions")),this.showRetweets&&t.push(TD.i("retweets"))),this.showFavorites&&t.push(TD.i("favorites")),this.showFollowers&&t.push(TD.i("followers")),this.showLists&&t.push(TD.i("lists")),r=t.pop(),o.length===i-1?n=TD.i("{{actionType}} only",{actionType:r}):(t=t.join(", "),n=TD.i("{{actionTypes}} and {{lastActionType}}",{actionTypes:t,lastActionType:r}))),n},TD.vo.ActionFilter.prototype.getFilters=function(){var e=[],t;return this.showMentions||(t=new TD.vo.Filter(TD.vo.Filter.CHIRP_TYPE,TD.services.TwitterAction.MENTION,!1),e.push(t)),this.showRetweets||(t=new TD.vo.Filter(TD.vo.Filter.CHIRP_TYPE,TD.services.TwitterAction.RETWEET,!1),e.push(t)),this.showFavorites||(t=new TD.vo.Filter(TD.vo.Filter.CHIRP_TYPE,TD.services.TwitterAction.FAVORITE,!1),e.push(t)),this.showFollowers||(t=new TD.vo.Filter(TD.vo.Filter.CHIRP_TYPE,TD.services.TwitterAction.FOLLOW,!1),e.push(t)),this.showLists||(t=new TD.vo.Filter(TD.vo.Filter.CHIRP_TYPE,TD.services.TwitterAction.LIST_CREATED,!1),e.push(t),t=new TD.vo.Filter(TD.vo.Filter.CHIRP_TYPE,TD.services.TwitterAction.LIST_MEMBER_ADDED,!1),e.push(t)),e},TD.vo.ContentFilter=function(e){this.fromJSONObject(e)},TD.vo.ContentFilter.TYPE_ANYTHING="anything",TD.vo.ContentFilter.TYPE_IMG="img",TD.vo.ContentFilter.TYPE_VID="vid",TD.vo.ContentFilter.TYPE_IMG_AND_VID="img_vid",TD.vo.ContentFilter.TYPE_LINKS="links",TD.vo.ContentFilter.LANG_ANY="any",TD.vo.ContentFilter.prototype.matching="",TD.vo.ContentFilter.prototype.excluding="",TD.vo.ContentFilter.prototype.type="anything",TD.vo.ContentFilter.prototype.lang="any",TD.vo.ContentFilter.prototype.includeRTs=!0,TD.vo.ContentFilter.prototype.setMatching=function(e){this.matching=e||""},TD.vo.ContentFilter.prototype.setExcluding=function(e){this.excluding=e||""},TD.vo.ContentFilter.prototype.setType=function(e){this.type=e||TD.vo.ContentFilter.TYPE_ANYTHING},TD.vo.ContentFilter.prototype.setLanguage=function(e){this.lang=e||TD.vo.ContentFilter.LANG_ANY},TD.vo.ContentFilter.prototype.setIncludeRTs=function(e){this.includeRTs=e===undefined?!0:Boolean(e)},TD.vo.ContentFilter.prototype.toJSONObject=function(){return{matching:this.matching,excluding:this.excluding,type:this.type,lang:this.lang,includeRTs:this.includeRTs}},TD.vo.ContentFilter.prototype.fromJSONObject=function(e){if(!e)return;this.setMatching(e.matching),this.setExcluding(e.excluding),this.setType(e.type),this.setLanguage(e.lang),this.setIncludeRTs(e.includeRTs)},TD.vo.ContentFilter.prototype.getQueryString=function(){var e=[];switch(this.type){case TD.vo.ContentFilter.TYPE_IMG:e.push("(filter:images)");break;case TD.vo.ContentFilter.TYPE_VID:e.push("(filter:videos)");break;case TD.vo.ContentFilter.TYPE_IMG_AND_VID:e.push("(filter:images OR filter:videos)");break;case TD.vo.ContentFilter.TYPE_LINKS:e.push("filter:links")}return this.lang!==TD.vo.ContentFilter.LANG_ANY&&e.push("lang:"+this.lang),this.includeRTs||e.push("exclude:nativeretweets exclude:retweets"),this.excluding&&e.push(this.getExcludingQuery()),e.join(" ")},TD.vo.ContentFilter.prototype.getSummaryText=function(){var e=[],t;switch(this.type){case TD.vo.ContentFilter.TYPE_IMG:e.push(TD.i("showing images"));break;case TD.vo.ContentFilter.TYPE_VID:e.push(TD.i("showing videos"));break;case TD.vo.ContentFilter.TYPE_IMG_AND_VID:e.push(TD.i("showing images and videos"));break;case TD.vo.ContentFilter.TYPE_LINKS:e.push(TD.i("showing links"))}this.matching&&e.push(TD.i("matching â{{{matching}}}â",{matching:this.matching})),this.excluding&&e.push(TD.i("excluding â{{{excluding}}}â",{excluding:this.excluding}));if(this.lang!==TD.vo.ContentFilter.LANG_ANY){var n=TD.languages.getLanguageFromISOCode(this.lang);e.push(TD.i("written in {{{lang}}}",{lang:n.localized_name}))}return this.includeRTs||e.push(TD.i("retweets excluded")),e.length===0?t=TD.i("any"):t=e.join(", "),t},TD.vo.ContentFilter.prototype.getExcludingQuery=function(){if(!this.excluding)return"";var e=TD.services.TwitterSearchParser.extractPhrases(this.excluding,!0);return e=e.map(function(e){return"-"+e}),e.join(" ")},TD.vo.ContentFilter.prototype.getFilters=function(){var e=[],t,n;switch(this.type){case TD.vo.ContentFilter.TYPE_IMG:t=new TD.vo.Filter(TD.vo.Filter.HAS_IMAGE,!0,!0),e.push(t);break;case TD.vo.ContentFilter.TYPE_VID:t=new TD.vo.Filter(TD.vo.Filter.HAS_VIDEO,!0,!0),e.push(t);break;case TD.vo.ContentFilter.TYPE_IMG_AND_VID:t=new TD.vo.Filter(TD.vo.Filter.HAS_MEDIA,!0,!0),e.push(t);break;case TD.vo.ContentFilter.TYPE_LINKS:t=new TD.vo.Filter(TD.vo.Filter.HAS_LINK,!0,!0),e.push(t)}return this.matching&&(n=TD.services.TwitterSearchParser.extractPhrases(this.matching,!1),n.forEach(function(n){t=new TD.vo.Filter(TD.vo.Filter.PHRASE,n,!0),e.push(t)})),this.excluding&&(n=TD.services.TwitterSearchParser.extractPhrases(this.excluding,!1),n.forEach(function(n){t=new TD.vo.Filter(TD.vo.Filter.PHRASE,n,!1),e.push(t)})),this.includeRTs||(t=new TD.vo.Filter(TD.vo.Filter.IS_RETWEET,!1,!0),e.push(t)),e},TD.vo.ContentFilter.prototype.hasActiveMediaFilter=function(){return[TD.vo.ContentFilter.TYPE_IMG,TD.vo.ContentFilter.TYPE_VID,TD.vo.ContentFilter.TYPE_IMG_AND_VID].indexOf(this.type)>-1},TD.vo.EngagementFilter=function(e){this.fromJSONObject(e)},TD.vo.EngagementFilter.prototype.minReplies=0,TD.vo.EngagementFilter.prototype.minRetweets=0,TD.vo.EngagementFilter.prototype.minFavorites=0,TD.vo.EngagementFilter.prototype.setMinReplies=function(e){this.minReplies=parseInt(e,10)},TD.vo.EngagementFilter.prototype.setMinRetweets=function(e){this.minRetweets=parseInt(e,10)},TD.vo.EngagementFilter.prototype.setMinFavorites=function(e){this.minFavorites=parseInt(e,10)},TD.vo.EngagementFilter.prototype.toJSONObject=function(){return{minReplies:this.minReplies,minRetweets:this.minRetweets,minFavorites:this.minFavorites}},TD.vo.EngagementFilter.prototype.fromJSONObject=function(e){if(!e)return;this.setMinReplies(e.minReplies),this.setMinRetweets(e.minRetweets),this.setMinFavorites(e.minFavorites)},TD.vo.EngagementFilter.prototype.getQueryString=function(){if(!TD.decider.get(TD.decider.ENGAGEMENT_FILTER))return"";var e=[];return this.minReplies>0&&e.push("min_replies:"+this.minReplies),this.minRetweets>0&&e.push("min_retweets:"+this.minRetweets),this.minFavorites>0&&e.push("min_faves:"+this.minFavorites),e.join(" ")},TD.vo.EngagementFilter.prototype.getSummaryText=function(){var e=[],t;this.minReplies>0&&e.push({count:this.minReplies,label:TD.i("replies")}),this.minRetweets>0&&e.push({count:this.minRetweets,label:TD.i("retweets")}),this.minFavorites>0&&e.push({count:this.minFavorites,label:TD.i("favorites")});switch(e.length){case 0:t=TD.i("any");break;case 1:t=TD.i("at least {{#0}}{{count}} {{label}}{{/0}}",e);break;case 2:t=TD.i("at least {{#0}}{{count}} {{label}}{{/0}} and {{#1}}{{count}} {{label}}{{/1}}",e);break;case 3:t=TD.i("at least {{#0}}{{count}} {{label}}{{/0}}, {{#1}}{{count}} {{label}}{{/1}} and {{#2}}{{count}} {{label}}{{/2}}",e)}return t},TD.vo.EngagementFilter.prototype.getFilters=function(){return[]},TD.vo.UserFilter=function(e){this.fromJSONObject(e)},TD.vo.UserFilter.FROM_ALL="all",TD.vo.UserFilter.FROM_USER="user",TD.vo.UserFilter.FROM_VERIFIED="verified",TD.vo.UserFilter.FROM_LIST="list",TD.vo.UserFilter.prototype.from_type=null,TD.vo.UserFilter.prototype.from_name=null,TD.vo.UserFilter.prototype.mention_name=null,TD.vo.UserFilter.prototype.setFrom=function(e,t){if(!t||e===TD.vo.UserFilter.FROM_VERIFIED||e===TD.vo.UserFilter.FROM_ALL)t="";this.from_type=e,this.from_name=TD.util.deMentionify(t)},TD.vo.UserFilter.prototype.setMentioned=function(e){this.mention_name=e||"",this.mention_name=TD.util.deMentionify(this.mention_name)},TD.vo.UserFilter.prototype.toJSONObject=function(){return{from_type:this.from_type,from_name:this.from_name,mention_name:this.mention_name}},TD.vo.UserFilter.prototype.fromJSONObject=function(e){if(!e)return;this.setFrom(e.from_type,e.from_name),this.setMentioned(e.mention_name)},TD.vo.UserFilter.prototype.getQueryString=function(){var e=[];switch(this.from_type){case TD.vo.UserFilter.FROM_USER:e.push("from:"+this.from_name);break;case TD.vo.UserFilter.FROM_VERIFIED:e.push("filter:verified");break;case TD.vo.UserFilter.FROM_LIST:e.push("list:"+this.from_name)}return this.mention_name&&e.push("@"+this.mention_name),e.join(" ")},TD.vo.UserFilter.prototype.getSummaryText=function(){var e=[],t;switch(this.from_type){case TD.vo.UserFilter.FROM_USER:t=TD.storage.accountController.getAccountFromUsername(this.from_name).length>0,t?e.push(TD.i("by me (@{{{name}}})",{name:this.from_name})):e.push(TD.i("by @{{{name}}}",{name:this.from_name}));break;case TD.vo.UserFilter.FROM_VERIFIED:e.push(TD.i("by verified users"));break;case TD.vo.UserFilter.FROM_LIST:e.push(TD.i("by members of @{{{name}}}",{name:this.from_name}))}return this.mention_name&&(t=TD.storage.accountController.getAccountFromUsername(this.mention_name).length>0,t?e.push(TD.i("mentioning me (@{{{name}}})",{name:this.mention_name})):e.push(TD.i("mentioning @{{{name}}}",{name:this.mention_name}))),e.length===0&&e.push(TD.i("any")),e.join(", ")},TD.vo.UserFilter.prototype.getFilters=function(){var e=[],t;this.mention_name&&(t=new TD.vo.Filter(TD.vo.Filter.PHRASE,TD.util.atMentionify(this.mention_name),!0),e.push(t));switch(this.from_type){case TD.vo.UserFilter.FROM_USER:t=new TD.vo.Filter(TD.vo.Filter.SENDER,this.from_name,!0),e.push(t);break;case TD.vo.UserFilter.FROM_VERIFIED:t=new TD.vo.Filter(TD.vo.Filter.IS_FROM_VERIFIED,!0,!0),e.push(t)}return e},TD.util.columnUtils=function(){var e={};return e.storageColumnTypes={OTHER:"other",HOME:"home",ME:"me",INBOX:"privateMe",SCHEDULED:"scheduled"},e.feedTypes={HOME:"home",USERTIMELINE:"usertimeline",INTERACTIONS:"interactions",MENTIONS:"mentions",SEARCH:"search",LIST:"list",DIRECT:"direct",USERTWEETS:"usertweets",FAVORITES:"favorites",NETWORKACTIVITY:"networkactivity"},e.columnMetaTypes={TIMELINE:"col_timeline",INTERACTIONS:"col_interactions",MENTIONS:"col_mentions",FOLLOWERS:"col_followers",SEARCH:"col_search",LIST:"col_list",MESSAGES:"col_messages",USERTWEETS:"col_usertweets",FAVORITES:"col_favorites",ACTIVITY:"col_activity",HOME:"col_home",ME:"col_me",INBOX:"col_inbox",SCHEDULED:"col_scheduled",UNKNOWN:"col_unknown"},e.columnMetaTypeToScribeNamespace={},TD.util.extendObjectWith(e.columnMetaTypeToScribeNamespace,[[e.columnMetaTypes.TIMELINE,{page:"home",section:""}],[e.columnMetaTypes.INTERACTIONS,{page:"connect",section:"activity"}],[e.columnMetaTypes.MENTIONS,{page:"connect",section:"mentions"}],[e.columnMetaTypes.SEARCH,{page:"search",section:"tweets"}],[e.columnMetaTypes.LIST,{page:"list",section:"tweets"}],[e.columnMetaTypes.USERTWEETS,{page:"profile_tweets",section:""}],[e.columnMetaTypes.FAVORITES,{page:"favorites",section:""}],[e.columnMetaTypes.ACTIVITY,{page:"network_activity",section:""}],[e.columnMetaTypes.HOME,{page:"home",section:""}],[e.columnMetaTypes.ME,{page:"connect",section:"mentions"}]]),e.columnIconClasses={TWITTER:"icon-twitter",HOME:"icon-home",INTERACTIONS:"icon-interactions",ACTIVITY:"icon-activity",MENTIONS:"icon-mention",FOLLOWERS:"icon-new-followers",MESSAGES:"icon-message",SEARCH:"icon-search",LIST:"icon-list",TWEETS:"icon-tweets",FAVORITES:"icon-favorite",SCHEDULED:"icon-scheduled",TRENDS:"icon-trends"},e.columnMetaTypeToIconClass={},TD.util.extendObjectWith(e.columnMetaTypeToIconClass,[[e.columnMetaTypes.TIMELINE,e.columnIconClasses.HOME],[e.columnMetaTypes.INTERACTIONS,e.columnIconClasses.INTERACTIONS],[e.columnMetaTypes.MENTIONS,e.columnIconClasses.MENTIONS],[e.columnMetaTypes.FOLLOWERS,e.columnIconClasses.FOLLOWERS],[e.columnMetaTypes.SEARCH,e.columnIconClasses.SEARCH],[e.columnMetaTypes.LIST,e.columnIconClasses.LIST],[e.columnMetaTypes.MESSAGES,e.columnIconClasses.MESSAGES],[e.columnMetaTypes.USERTWEETS,e.columnIconClasses.TWEETS],[e.columnMetaTypes.FAVORITES,e.columnIconClasses.FAVORITES],[e.columnMetaTypes.ACTIVITY,e.columnIconClasses.ACTIVITY],[e.columnMetaTypes.HOME,e.columnIconClasses.HOME],[e.columnMetaTypes.ME,e.columnIconClasses.MENTIONS],[e.columnMetaTypes.INBOX,e.columnIconClasses.MESSAGES],[e.columnMetaTypes.SCHEDULED,e.columnIconClasses.SCHEDULED],[e.columnMetaTypes.UNKNOWN,e.columnIconClasses.TWITTER]]),e.columnMetaTypeToTitleTemplateData={},TD.util.extendObjectWith(e.columnMetaTypeToTitleTemplateData,[[e.columnMetaTypes.TIMELINE,{title:TD.i("Timeline",null,!0),needsUserAttribution:!0}],[e.columnMetaTypes.INTERACTIONS,{title:TD.i("Interactions",null,!0),needsUserAttribution:!0}],[e.columnMetaTypes.MENTIONS,{title:TD.i("Mentions",null,!0),needsUserAttribution:!0}],[e.columnMetaTypes.FOLLOWERS,{title:TD.i("Followers",null,!0),needsUserAttribution:!0}],[e.columnMetaTypes.SEARCH,{needsUserAttribution:!0}],[e.columnMetaTypes.LIST,{needsUserAttribution:!0}],[e.columnMetaTypes.MESSAGES,{title:TD.i("Messages",null,!0),needsUserAttribution:!0}],[e.columnMetaTypes.USERTWEETS,{title:TD.i("Tweets",null,!0),needsUserAttribution:!0}],[e.columnMetaTypes.FAVORITES,{title:TD.i("Favorites",null,!0),needsUserAttribution:!0}],[e.columnMetaTypes.ACTIVITY,{title:TD.i("Activity",null,!0),needsUserAttribution:!0}],[e.columnMetaTypes.HOME,{title:TD.i("Home",null,!0)}],[e.columnMetaTypes.ME,{title:TD.i("Me",null,!0)}],[e.columnMetaTypes.INBOX,{title:TD.i("Inbox",null,!0)}],[e.columnMetaTypes.SCHEDULED,{title:TD.i("Scheduled",null,!0),needsUserAttribution:!0}],[e.columnMetaTypes.UNKNOWN,{title:TD.i("Custom Column",null,!0)}]]),e.embeddableColumnTypes=[e.columnMetaTypes.FAVORITES,e.columnMetaTypes.USERTWEETS,e.columnMetaTypes.SEARCH,e.columnMetaTypes.LIST],e.filterableColumnTypes=[e.columnMetaTypes.TIMELINE,e.columnMetaTypes.INTERACTIONS,e.columnMetaTypes.MENTIONS,e.columnMetaTypes.FOLLOWERS,e.columnMetaTypes.SEARCH,e.columnMetaTypes.LIST,e.columnMetaTypes.MESSAGES,e.columnMetaTypes.USERTWEETS,e.columnMetaTypes.FAVORITES,e.columnMetaTypes.ACTIVITY,e.columnMetaTypes.HOME,e.columnMetaTypes.ME,e.columnMetaTypes.INBOX,e.columnMetaTypes.SCHEDULED],e.actionColumnTypes=[e.columnMetaTypes.INTERACTIONS,e.columnMetaTypes.MENTIONS,e.columnMetaTypes.ACTIVITY,e.columnMetaTypes.FOLLOWERS],e.singleActionColumnTypes=[e.columnMetaTypes.MENTIONS,e.columnMetaTypes.FOLLOWERS],e.getColumnType=function(t){var n=t.model.getType(),r=t.getFeeds();switch(n){case e.storageColumnTypes.HOME:return e.columnMetaTypes.HOME;case e.storageColumnTypes.ME:return e.columnMetaTypes.ME;case e.storageColumnTypes.INBOX:return e.columnMetaTypes.INBOX;case e.storageColumnTypes.SCHEDULED:return e.columnMetaTypes.SCHEDULED;default:return r.length===1?e._inferColumnTypeFromFeed(r[0],t):e.columnMetaTypes.UNKNOWN}},e.isMessageColumn=function(t){var n=e.getColumnType(t);return n===e.columnMetaTypes.MESSAGES},e._twitterFeedTypeToColumnMetaType={},TD.util.extendObjectWith(e._twitterFeedTypeToColumnMetaType,[[e.feedTypes.HOME,e.columnMetaTypes.TIMELINE],[e.feedTypes.USERTIMELINE,e.columnMetaTypes.TIMELINE],[e.feedTypes.INTERACTIONS,e.columnMetaTypes.INTERACTIONS],[e.feedTypes.MENTIONS,e.columnMetaTypes.MENTIONS],[e.feedTypes.SEARCH,e.columnMetaTypes.SEARCH],[e.feedTypes.LIST,e.columnMetaTypes.LIST],[e.feedTypes.DIRECT,e.columnMetaTypes.MESSAGES],[e.feedTypes.USERTWEETS,e.columnMetaTypes.USERTWEETS],[e.feedTypes.FAVORITES,e.columnMetaTypes.FAVORITES],[e.feedTypes.NETWORKACTIVITY,e.columnMetaTypes.ACTIVITY]]),e._inferColumnTypeFromFeed=function(t,n){var r=t.getService(),i=t.getType(),s=t.getMetadata(),o,u,a,f=e.columnMetaTypes.UNKNOWN;if(r==="twitter"){f=e._twitterFeedTypeToColumnMetaType[i]||f;switch(i){case e.feedTypes.SEARCH:var l=twttr.txt.extractMentionsWithIndices(s.term);if(l.length===1){var c=l[0];c.indices[0]===0&&c.indices[1]===s.term.length&&(f=e.columnMetaTypes.MENTIONS)}break;case e.feedTypes.INTERACTIONS:o=n.model.getFilters(),o&&(u=new TD.vo.ActionFilter(o.action),a=TD.vo.ActionFilter.MAX_INTERACTION_FILTERS,u.getFilters().length===a-1&&u.showFollowers&&(f=e.columnMetaTypes.FOLLOWERS))}}return f},e.getColumnIconClassByColumnType=function(t){return e.columnMetaTypeToIconClass[t]},e.getColumnTitleHTML=function(t){var n=!1,r=t.getColumnType(),i=t.getFeeds(),s=t.model.getTitle(),o,u,a,f,l,c=e.columnMetaTypeToTitleTemplateData[r],h={},p,d,v;for(var m=0;m<i.length;m++){o=i[m],u=o.getType(),a=o.getMetadata();if(a)switch(u){case e.feedTypes.LIST:p=TD.cache.names.getScreenName(a.ownerId),v=TD.cache.names.getListName(a.listId,a.ownerId),v?h.title=v:n=!0;break;case e.feedTypes.SEARCH:r===e.columnMetaTypes.MENTIONS?p=a.term:a.baseQuery?d=a.baseQuery:d=a.term,d?(h.title=d,d.indexOf('"')===-1&&(h.quote=!0)):!0;break;default:a.id?(p=TD.cache.names.getScreenName(a.id),p||(n=!0)):r===e.columnMetaTypes.SCHEDULED&&(p=TD.i("All accounts")),h.title=c.title}p||(f=TD.storage.accountController.get(o.getAccountKey()),l=f.getType(),l!=="tweetdeck"&&(p=f.getUsername(),l==="twitter"&&(p=TD.util.atMentionify(p))))}return c.needsUserAttribution&&(p?(h.needsUserAttribution=c.needsUserAttribution,h.screenName=p):n=!0),n?TD.util.escape(s):r===e.columnMetaTypes.UNKNOWN?s?TD.util.escape(s):TD.ui.template.render("column_title",h):TD.ui.template.render("column_title",h)},e.inferFeedTypeFromActionFilter=function(e){var t=this.feedTypes.INTERACTIONS;return e.getFilters().length===TD.vo.ActionFilter.MAX_INTERACTION_FILTERS-1&&e.showMentions&&(t=this.feedTypes.MENTIONS),t},e}(),TD.cache.lists=function(){function n(t){var n=e[t]||{};return e[t]=n,n}var e={},t={};return t.add=function(e){var t=n(e.account.getKey());t[e.id]=e,TD.controller.feedManager.fixListFeeds(),TD.cache.names.updateScreenName(e.user.id,e.user.screenName),TD.cache.names.updateListName(e.id,e.name)},t.unsubscribe=function(e){var t=n(e.account.getKey());delete t[e.id]},t.purge=function(t){var n;_.each(e,function(e,r){n=n||e[t],delete e[t]});if(n){var r=TD.storage.Feed.generateKeyFor(n.account.getKey(),"list",{listId:t});TD.controller.feedManager.deleteFeedsWhere(function(e){return e.getKey()===r})}},t.getListsFor=function(e){return _.values(n(e))},t.find=function(t,n,r,i,s){var o,u=undefined,a=undefined;return n&&r&&(o="@"+n.toLowerCase()+"/"+r.toLowerCase()),_.each(e,function(e,n){if(s&&s!==n)return;_.each(e,function(e,n){if(t&&e.id===t||e.fullName.toLowerCase()===o)e.isOwnList()?u=e:a=e})}),i?u:u||a},t.getAll=function(){var t={};return _.each(e,function(e,n){_.extend(t,e)}),_.values(t)},t}(),TD.cache.LRUQueue=klass(function(e){this.maxSize=e,this.length=0,this._first=undefined,this._last=undefined,this._index={},this._lefts={},this._rights={}}).methods({enqueue:function(e,t){this.dequeue(e),this.length==0?this._first=this._last=e:(this._lefts[this._first]=e,this._rights[e]=this._first,this._first=e),this._index[e]=t,this.length++,this.prune()},dequeue:function(e){if(_.isUndefined(this._index[e]))return;var t=this._lefts[e],n=this._rights[e];t?this._rights[t]=n:this._first=n,n?this._lefts[n]=t:this._last=t,delete this._index[e],delete this._rights[e],delete this._lefts[e],this.length--},prune:function(){while(this.maxSize&&this.length>this.maxSize)this.dequeue(this._last)},get:function(e){return this._index[e]},take:function(e){var t=[],n=this._first;e=Math.min(e,this.length);for(var r=0;r<e;r++)t.push(this._index[n]),n=this._rights[n];return t}}),TD.cache.names=function(){return self={SECONDS_IN_ONE_WEEK:604800,_cache:null},self.init=function(){self._cache=TD.settings.getNameCache(),$.subscribe("/storage/client/column_order_changed",function(){self.prune(),self.commit()}),$.subscribe("/storage/column/feeds_changed",function(e,t,n){var r=TD.storage.columnController.get(n.getKey());r&&!r.temporary&&self.commit()})},self.getScreenName=function(e){var t,n,r=TD.util.unixTime(new Date),i=TD.storage.Account.generateKeyFor("twitter",e),s=TD.storage.accountController.get(i);return s?(n=TD.util.atMentionify(s.getUsername()),self.addScreenName(e,n)):(t=self._cache.users[e],t&&(n=t.name),(!t||t.timestamp+self.SECONDS_IN_ONE_WEEK<r)&&self._fetchUser(e)),n},self.getListName=function(e,t){var n,r,i=TD.util.unixTime(new Date),s=TD.cache.lists.find(e,"","");return s?(n=s.name,self.addListName(e,n)):(r=self._cache.lists[e],r&&(n=r.name),(!r||r.timestamp+self.SECONDS_IN_ONE_WEEK<i)&&self._fetchList(e,t)),n},self.addScreenName=function(e,t){if(!self._cache)return;var n=self._cache.users[e]||{},r=TD.util.atMentionify(t),i=r!==n.name;n.name=r,n.timestamp=TD.util.unixTime(new Date),self._cache.users[e]=n,self.commit(),i&&TD.storage.notification.notify("/cache/names/change")},self.addListName=function(e,t){if(!self._cache)return;var n=self._cache.lists[e]||{},r=t!==n.name;n.name=t,n.timestamp=TD.util.unixTime(new Date),self._cache.lists[e]=n,self.commit(),r&&TD.storage.notification.notify("/cache/names/change")},self.updateScreenName=function(e,t){if(!self._cache)return;var n=self._cache.users[e];n&&self.addScreenName(e,t)},self.updateListName=function(e,t){if(!self._cache)return;var n=self._cache.lists[e];n&&self.addScreenName(e,t)},self._fetchUser=function(e){var t=TD.cache.twitterUsers.getById(e);t.addCallback(function(t){self.addScreenName(e,t.screenName)})},self._fetchList=function(e,t){var n=TD.storage.Account.generateKeyFor("twitter",t),r=TD.controller.clients.getClient(n);r=r||TD.controller.clients.getPreferredClient("twitter"),r.getList(e,null,null,function(t){self.addListName(e,t.name)})},self.commit=_.debounce(function(){TD.settings.setNameCache(self._getPrunedCache())},100),self.prune=function(){self._cache=self._getPrunedCache()},self._getPrunedCache=function(){var e={users:{},lists:{}},t=TD.storage.feedController.getAll();return _.each(t,function(t){var n=t.getMetadata();if(n){var r=n.id||n.ownerId;r&&self._cache.users[r]&&(e.users[r]=self._cache.users[r]);var i=n.listId;i&&self._cache.lists[i]&&(e.lists[i]=self._cache.lists[i])}}),e},self}(),TD.cache.twitterUsers=function(){function s(){_.each(r.splice(i),function(e){delete t[e.id],delete n[e.screenName.toLowerCase()]})}function o(e,r){var i=this,s,o,u,a;return e||r?(e?s=t[e]:s=n[r.toLowerCase()],s?a=TD.core.defer.succeed(s):(o=TD.storage.accountController.getPreferredAccount("twitter"),u=TD.controller.clients.getClient(o.getKey()),a=new TD.core.defer.Deferred,u.showUser(e,r,function(e){a.callback(e)},function(t,n,i){a.errback(new TD.core.defer.XMLHttpRequestError(t,i)),t&&t.errors&&t.errors.forEach(function(t){t===u.ERRORS.SUSPENDED_USER&&$.publish("/user/suspended",[e,r])})}))):a=TD.core.defer.fail("Must provide user ID or screen name"),a}var e={},t={},n={},r=[],i=500;return e.add=function(e){var i=t[e.id];i?delete n[i.screenName.toLowerCase()]:r.unshift(e),t[e.id]=e,n[e.screenName.toLowerCase()]=e,s()},e.getById=function(e){return o(e,null)},e.getByScreenName=function(e){return o(null,e)},e}(),TD.controller.clients=function(){var e={},t=function(e,t){switch(e){case"twitter":return new TD.services.TwitterClient(t);case"tweetdeck":return new TD.services.TweetDeckClient}};return{init:function(){$.subscribe("/storage/account/new",function(e){TD.controller.clients.initialiseClients()}),TD.controller.clients.initialiseClients()},initialiseClients:function(){var n,r=TD.storage.accountController.getPostingAccounts();for(var i=0;i<r.length;i++)n=e[r[i].getKey()],n||(n=t(r[i].getType(),r[i]),e[r[i].getKey()]=n);e.tweetdeck||(e.tweetdeck=new TD.services.TweetDeckClient),TD.controller.scheduler.schedulePeriodicTask(1200,TD.controller.clients.refreshRetweetBlockLists)},getClient:function(t){return e[t]},getTDClient:function(){return e.tweetdeck},getClientsByService:function(t){var n=[];for(var r in e)e[r].type==t&&n.push(e[r]);return n},getPreferredClient:function(e){var t=TD.storage.accountController.getPreferredAccount(e);return t?this.getClient(t.getKey()):undefined},addClient:function(e,t,n){var r=this,i,s,o=function(){TD.storage.accountController.manage(t),r.initialiseClients();return},u=this.getClientsByService(e).length>0;t?n?(s=TD.controller.auth.create(e,t),s.start(t,o,u)):o():(t=new TD.storage.Account,t.setType(e),s=TD.controller.auth.create(e,t),s.start(t,o,u))},removeClient:function(t){var n=TD.storage.accountController.get(t);e[t]&&e[t].cleanUp&&e[t].cleanUp(),delete e[t],TD.controller.feedManager.deleteFeedsWhere(function(e){return e.getAccountKey()===t}),TD.storage.accountController.blacklistAccount(n)},refreshRetweetBlockLists:function(){if(!TD.util.shouldStream())return;var e=TD.controller.clients.getClientsByService("twitter");_.each(e,function(e){e.populateRetweetBlockList()})}}}(),TD.controller.scheduler=function(){var e={};return e.QUERY_INTERVAL=10,e.SLEEP_THRESHOLD=20,e._tickInterval,e._tasks={},e._lastTickTime=null,e.init=function(){this._tickInterval=setInterval(this._handleTick,this.QUERY_INTERVAL*1e3),e._lastTickTime=Date.now(),this._jQueryCleanupTaskId=TD.controller.scheduler.schedulePeriodicTask(600,function(){jQuery.fragments={}}),TD.controller.feedScheduler.init()},e._handleTick=function(){var t=Date.now(),n=(t-e._lastTickTime)/1e3-e.QUERY_INTERVAL;e._lastTickTime=t,n>e.SLEEP_THRESHOLD&&$(document).trigger("dataAppWokenFromSleep",{lateness:n}),_.each(e._tasks,function(n){var r=t-n.cycleStartTime;r>n.period&&(e._fireTask(n),n.cycleStartTime=Date.now())})},e._fireTask=function(e){try{e.callback()}catch(t){console.log("Error in periodic task:",e,"Error:",t)}},e.schedulePeriodicTask=function(e,t,n){var r={id:_.uniqueId("sched_task_"),callback:t,period:e*1e3,cycleStartTime:Date.now()};return n&&this._fireTask(r),this._tasks[r.id]=r,r.id},e.updatePeriodicTask=function(e,t,n){var r=this._tasks[e];r&&(r.period=t*1e3,r.callback=n||r.callback)},e.restartPeriodicTask=function(e){var t=this._tasks[e];t&&(t.cycleStartTime=Date.now())},e.removePeriodicTask=function(e){delete this._tasks[e]},e}(),TD.controller.feedScheduler=function(){var e={};return e.DEFAULT_REFRESH_PERIOD=45,e._activeColumns={},e._temporaryColumns={},e._taskIndex={},e.init=function(){this._refreshTaskId=TD.controller.scheduler.schedulePeriodicTask(45,this._trimColumns.bind(this),!1),this._streamingTaskId=TD.controller.scheduler.schedulePeriodicTask(120,this._startStreams.bind(this),!1),$.subscribe("/storage/column/feeds_changed",function(t,n,r){var i=r.getKey(),s=TD.controller.columnManager.get(i);e.addColumn(s,!s.temporary)}),$.subscribe("/storage/column/change",function(t){var n=t.getKey(),r=TD.controller.columnManager.get(n),i=r.model.getFeedKeys(),s=t.getFeedKeys();_.isEqual(i,s)||e.addColumn(r,!r.temporary)}),$(document).on("dataRateLimit",this._handleRateLimitData.bind(this)),$(document).on("dataUserStreamStatus",this._handleStreamStatus.bind(this)),$(document).on("dataAppWokenFromSleep",this._handleAppWoken.bind(this))},e._getTask=function(e,t){if(this._taskIndex[e])return this._taskIndex[e][t]},e._setTask=function(e,t,n){this._taskIndex[e]=this._taskIndex[e]||{},this._taskIndex[e][t]=n},e._handleRateLimitData=function(e,t){var n=this._getTask(t.accountKey,t.feedType);n&&(n.rateLimitData=t.rateLimitData,this._setPeriodicTask(n))},e._handleStreamStatus=function(t,n){var r=this._taskIndex[n.accountKey];_.each(r,e._setPeriodicTask.bind(this))},e._handleAppWoken=function(e,t){_.each(this._taskIndex,function(e){_.each(e,function(e){e.doTask(!0,!0),TD.controller.scheduler.restartPeriodicTask(e.taskId)})}),TD.controller.stats.appWokenFromSleep(t.lateness)},e.addColumn=function(e,t){var n,r=e.getFeeds(),i=e.model.getKey();this._activeColumns[i]&&this.removeColumn(i),this._activeColumns[i]=e,e.temporary&&(this._temporaryColumns[i]=e);for(var s=0;s<r.length;s++)n=TD.controller.feedManager.addFeed(r[s]),n.publishChirpsOrFetch(),this._addFeed(r[s]);t&&this._startStreams()},e._addFeed=function(e){var t=e.getAccountKey(),n=e.getType(),r=e.getKey(),i;i=this._getTask(t,n)||{accountKey:t,feedType:n,feeds:{},taskId:null,rateLimitData:null,doTask:null},i.doTask||(i.doTask=this._doTaskFactory(i)),this._setTask(t,n,i),i.feeds[r]=e,this._setPeriodicTask(i)},e._setPeriodicTask=function(e){var t=this._calculatePeriod(e);e.taskId?TD.controller.scheduler.updatePeriodicTask(e.taskId,t):e.taskId=TD.controller.scheduler.schedulePeriodicTask(t,e.doTask,!1)},e._doTaskFactory=function(t){return function(n,r){var i=_.map(t.feeds,function(t,i){return e._refreshFeed(i,n,r)});return TD.core.defer.gatherResults(i)}},e._calculatePeriod=function(t){var n=this.DEFAULT_REFRESH_PERIOD,r,i,s,o,u,a,f;return t.rateLimitData&&(r=t.rateLimitData.rateLimitRemaining-10,i=t.rateLimitData.rateLimitTotal,s=t.rateLimitData.rateLimitReset+10,o=Date.now()/1e3,u=s-o,f=_.filter(t.feeds,function(t){var n=t.getKey(),r=Boolean(_.some(e._temporaryColumns,function(e){return e.model.getFeedKeys().indexOf(n)!==-1}));return r||!TD.controller.feedManager.isStreaming(n)}),u>0&&r>0&&f.length>0?(a=r/f.length,n=u/a,n=Math.min(n,u)):u<=0?n=this.DEFAULT_REFRESH_PERIOD:n=u),n=Math.round(n),n=Math.max(n,10),n=Math.min(n,900),n},e._refreshFeed=function(e,t,n){var t=t||Boolean(_.some(this._temporaryColumns,function(t){return t.model.getFeedKeys().indexOf(e)!==-1})),r=TD.controller.feedManager.getPoller(e);return n&&r.removeAll(),r.refresh(t,n)},e.removeColumn=function(e){delete this._activeColumns[e],delete this._temporaryColumns[e],this._rebuildTaskIndex(),TD.controller.feedManager.cleanupFeeds()},e._rebuildTaskIndex=function(){_.each(this._taskIndex,function(e){_.each(e,function(e){e.feeds={}})}),_.each(this._activeColumns,function(t){_.each(t.getFeeds(),function(t){e._addFeed(t)})}),_.each(this._taskIndex,function(e){_.each(e,function(e){_.isEmpty(e.feeds)&&(TD.controller.scheduler.removePeriodicTask(e.taskId),e.taskId=null)})})},e.refreshColumn=function(e){var t=this._activeColumns[e],n;if(t){n=t.getFeeds();for(var r=0;r<n.length;r++)this._refreshFeed(n[r].getKey())}},e.refreshAccountFeeds=function(e,t){_.each(this._taskIndex[e],function(e){e.doTask(t)})},e._startStreams=function(){var e=TD.storage.accountController.getAccountsForService("twitter");for(var t=0;t<e.length;t++)TD.controller.clients.getClient(e[t].getKey()).checkUserStream()},e._trimColumns=function(){_.each(this._activeColumns,function(e,t){e.trimUpdates()})},e}(),TD.controller.FeedPoller=function(e){var t=this;this.OPTIMUM_ARRAY_LENGTH=200,this.CLEANUP_WAIT_PERIOD=12e4,this.TWEET_ID_QUEUE_LENGTH=500,this.feed=e,this.mark="",this.chirpArray=[],this.chirpIndex={},this.seenTweetIDs=new TD.cache.LRUQueue(this.TWEET_ID_QUEUE_LENGTH),this.refreshLock=0,this.REFRESH_LOCK_EXPIRY=6e4,this.isExhausted=!1,this.lastInfiniteScrollTime=0,this.shouldSetLatestTime=!1,this._checkNotifications=function(){var t=this;this.shouldSetLatestTime=!1;if(this.feed.getService()==="twitter"&&this.feed.getType()==="direct")this.shouldSetLatestTime=!0;else{var n=TD.storage.columnController.getColumnsContainingFeed(e.getKey());this.shouldSetLatestTime=Boolean(_.find(n,function(e){return e.getHasSound()||e.getHasNotification()}))}};var n=function(t,n,r){if(t!=="has_notification"&&t!=="has_sound")return;r&&_.include(r.getFeedKeys(),e.getKey())&&this._checkNotifications()};this.subscription=$.subscribe("/storage/column/column_flags_changed",_.bind(n,this)),this._checkNotifications(),this.reorderChirp=function(e){var t=this.chirpIndex[e];t&&(this.removeChirp(e),this.acceptChirps([t]))},this.sortFunction=function(e,t){return t.created.getTime()-e.created.getTime()},this.removeChirp=function(e){var t=this.chirpIndex[e],n;if(t){for(var r=0;r<this.chirpArray.length;r++){n=this.chirpArray[r];if(n===t){this.chirpArray.splice(r,1);break}}delete this.chirpIndex[e],$.publish("/delete/"+this.feed.getKey(),[this,[t]])}},this.removeWhere=function(e){var t=_.filter(this.chirpArray,e),n=t.length;while(n--)this.removeChirp(t[n].id)},this.removeAll=function(){var e=this.chirpArray.length;while(e--)this.removeChirp(this.chirpArray[e].id)},this.getRangeStartTime=function(){var e,t,n=Number.MAX_VALUE,r=this.feed;return this.isExhausted?0:r.getService()==="twitter"&&r.getType()==="direct"?0:r.getService()==="tweetdeck"?0:(e=this.getOldestChirp(),e?e.created.getTime():0)},this.acceptChirps=function(t){var n;if(t){n=this.addChirpsToMemCache(t),this.publishChirps(n);var r=0;for(var i=0;i<n.length;i++)r=Math.max(r,n[i].created.getTime());this.shouldSetLatestTime&&e.setLatestTime(Math.max(e.getLatestTime(),r))}},this.refresh=function(e,t){var n=this,r=this.feed,i=n.chirpArray,s=(new Date).getTime();if(!(!this.refreshLock||s>this.refreshLock+this.REFRESH_LOCK_EXPIRY))return TD.core.defer.succeed();var o=TD.controller.clients.getClient(r.getAccountKey());if(!o)return TD.core.defer.fail();this.refreshLock=s;try{var u=new TD.core.defer.Deferred;return u.addCallback(function(e){n.refreshLock=0,n.acceptChirps(e)}),u.addErrback(function(){n.refreshLock=0}),o.refreshFeed(this,!1,_.bind(u.callback,u),_.bind(u.errback,u),e,t),u}catch(a){return console.log("Error refreshing",this,":",a),this.refreshLock=0,TD.core.defer.fail()}},this.publishChirpsOrFetch=function(){this.chirpArray&&this.chirpArray.length?this.publishAll():this.refresh()},this.getOldestChirp=function(){return this.chirpArray[this.chirpArray.length-1]},this.addChirpsToMemCache=function(e){var t,n,r=[],i=[],s,o,u,a;for(t=0;t<e.length;t++)n=e[t],s=this.chirpIndex[n.id],o=this.isRepeatedRetweet(n),s?s.update(n)&&i.push(s):o||(r.push(n),i.push(n),this.chirpIndex[n.id]=n);return r.sort(TD.util.chirpDescSort),this.chirpArray.length&&r.length&&(u=this.chirpArray[0].created.getTime(),a=r[r.length-1].created.getTime()),this.chirpArray=r.concat(this.chirpArray),u&&a&&a<u&&this.chirpArray.sort(TD.util.chirpDescSort),i},this.isRepeatedRetweet=function(e){var t=!1,n,r;return e instanceof TD.services.TwitterStatus&&(n=e.getMainTweet().id,r=this.seenTweetIDs.get(n)||0,t=e.isRetweetedStatus()&&r>0,this.seenTweetIDs.enqueue(n,r+1)),t},this.fetchOlderChirps=function(e){this.lastInfiniteScrollTime=(new Date).getTime();var t=this,n=t.feed,r=new TD.core.defer.Deferred;if(this.getRangeStartTime()<e)r.callback(this.chirpArray);else{var i=TD.controller.clients.getClient(n.getAccountKey());i.refreshFeed(this,!0,function(e){t.addChirpsToMemCache(e),e.length===0&&(t.isExhausted=!0),r.callback(t.chirpArray)},function(e){r.errback(e)})}return r},this.trimChirps=function(){if(this.chirpArray.length<this.OPTIMUM_ARRAY_LENGTH)return;var e=(new Date).getTime()-this.lastInfiniteScrollTime;if(e<this.CLEANUP_WAIT_PERIOD)return;var t=this.chirpArray.splice(this.OPTIMUM_ARRAY_LENGTH,Number.MAX_VALUE);for(var n=0;n<t.length;n++)delete this.chirpIndex[t[n].id];this.isExhausted=!1},this.addChirps=function(e){var t=this.addChirpsToMemCache(e);this.publishChirps(t)},this.publishAll=function(){this.publishChirps(this.chirpArray)},this.publishChirps=function(e){$.publish("/feed/"+this.feed.getKey(),[this,e,this.feed.getLatestTime()])},this.destroy=function(){var e,t=this.feed;this.chirpArray=[],this.chirpIndex={},$.unsubscribeAll("/feed/"+t.getKey()),$.unsubscribeAll("/delete/"+t.getKey()),$.unsubscribe(this.subscription)}},TD.controller.feedManager=function(){function n(){var e=TD.storage.accountController.getDefault(),t=e.getKey(),n;e.getType()==="twitter"&&(n=TD.storage.feedController.getAll(),n=_.filter(n,function(e){return e.getType()==="search"&&e.getAccountKey()!==t}),_.each(n,function(e){var n=TD.storage.feedController.getOrCreateFeed(e.getType(),e.getService(),t,e.getMetadata());TD.controller.feedManager.replaceFeed(e,n)}))}function r(e,t){var n=t&&t.toLowerCase(),r;t?r=TD.i("User @{{screenName}} has been suspended",{screenName:t}):r=TD.i("User has been suspended"),TD.controller.progressIndicator.addMessage(r),TD.controller.feedManager.deleteWhere(function(r){var i=r.getMainUser&&r.getMainUser();return i?e&&e==i.id||t&&n===i.screenName.toLowerCase():!1})}var e={},t={};return e.init=function(){var e=TD.storage.feedController.getAll(),i=this,s;for(s=0;s<e.length;s++){var o=e[s];t[o.getKey()]=new TD.controller.FeedPoller(o)}TD.controller.scheduler.schedulePeriodicTask(120,TD.controller.feedManager.trimPollers),$.subscribe("/user/removeTweets",function(e,t,n){i.deleteUserChirps(e,t,n)}),$.subscribe("/user/suspended",r),$.subscribe("/storage/client/default_account_changed",n)},e.getPoller=function(e){return t[e]},e.trimPollers=function(){for(var e in t)t[e].trimChirps()},e.addFeed=function(e){var n=e.getKey(),r=t[n];return r?r:(r=new TD.controller.FeedPoller(e),t[n]=r,r)},e.removeFeed=function(e){var n=e.getKey(),r=t[n];delete t[n],r.destroy(),e.getService()=="twitter"&&(client=TD.controller.clients.getClient(e.getAccountKey()),client&&client.checkUserStream())},e.cleanupFeeds=function(){var n=TD.controller.columnManager.getAll(),r={};for(var i in n){var s=n[i].getFeeds();for(var o=0;o<s.length;o++)r[s[o].getKey()]=!0}for(var u in t)if(!r[u]){var a=t[u].feed;e.removeFeed(a),TD.storage.feedController.remove(a.getKey())}},e.deleteChirp=function(t){e.deleteWhere(function(e){if(e.id===t)return!0;if(e.getRelatedTweet){var n=e.getRelatedTweet();return n&&n.id===t}return!1})},e.deleteWhere=function(e,n){var r,i;for(var s in t)r=t[s],i=r.feed.getType(),(!n||i==="home"||i==="networkactivity")&&r.removeWhere(e)},e.deleteUserChirps=function(t,n,r){t=t.toLowerCase();var i=function(e){try{var r=e.getCreator&&e.getCreator();return r&&r.screenName.toLowerCase()===t&&e.account.getUserID()==n}catch(i){}return!1};e.deleteWhere(i,r)},e.deleteFeedsWhere=function(e){var t=TD.storage.clientController.client.getColumnOrder(),n,r,i,s,o;for(s=0;s<t.length;s++){n=TD.controller.columnManager.get(t[s]),r=n.getFeeds();for(o=r.length-1;o>=0;o--)i=r[o],e(i)&&(TD.storage.feedController.remove(i),n.removeFeed(i));n.getFeedCount()===0&&TD.controller.columnManager.deleteColumn(n.model.getKey())}},e.replaceFeed=function(t,n,r){var i=TD.controller.columnManager.getAll();r&&(i=_.filter(i,function(e){return r.indexOf(e.model.getKey())!==-1})),_.each(i,function(e){e.removeFeed(t)>0&&e.addFeed(n)}),e.cleanupFeeds()},e.fixListFeeds=_.debounce(_.once(function(){var e=function(e,t){var n=TD.storage.feedController.getOrCreateFeed(e.getType(),e.getService(),e.getAccountKey(),{listId:t.id,ownerId:t.user.id});TD.controller.feedManager.replaceFeed(e,n)},t=[],n=TD.storage.feedController.getAll();n=_.filter(n,function(e){var t=e.getType(),n=e.getMetadata();if(e.getType()==="list")if(!n.listId||!n.ownerId)return!0;return!1}),_.each(n,function(n){var r=n.getMetadata(),i=TD.cache.lists.find(null,r.screenName,r.slug);i?e(n,i):t.push(n)}),_.each(t,function(t){var n=TD.controller.clients.getClient(t.getAccountKey()),r=t.getMetadata(),i=function(n){e(t,n)},s=function(){};n.getList(null,r.screenName,r.slug,i,s)})}),5e3),e.isStreaming=function(e){var t=this.getPoller(e),n=!1,r,i;return t&&(r=t.feed,i=TD.controller.clients.getClient(r.getAccountKey()),n=i.feedIsStreaming(e)),n},e}(),TD.controller.progressIndicator=function(){function h(){a=$(".js-progress-indicator"),a.on("click",".js-dismiss",d)}function p(){var n=null,i,o;(!a||!a.length)&&h();if(c)switch(c.state){case r:n=TD.i("Failed: {{1}}",{1:c.message});break;case e:n=TD.i("Success: {{1}}",{1:c.message});break;case t:case s:n=c.message}if(n){var u=TD.ui.template.render("topbar/alert_message",{message:n});a.html(u);var l=a.find(".js-status-message");i=f,f=l.height(),i!==f?(i||l.css("bottom",-f),l.animate({bottom:0},200)):l.css("bottom",0)}else d()}function d(){var e=a.find(".js-status-message");e.animate({bottom:-f},200,function(){a.empty(),c=null}),f=0}var e="complete",t="working",n="ok",r="failed",i="warning",s="message",o=7e3,u=3e3,a,f=0,l={},c=null;return l.addTask=function(e){var n=_.uniqueId("msg_");return c={key:n,message:e,state:t,timeout:null},p(),n},l.addMessage=function(e){var t=_.uniqueId("msg_");return c={key:t,message:e,state:s,timeout:null},c.timeout=setTimeout(function(){l.deleteTask(t)},o),p(),t},l.deleteTask=function(e){c&&c.key===e&&(c=null,p())},l.taskComplete=function(t,n){c&&c.key===t&&(c.state=e,c.message=n||c.message,c.timeout=setTimeout(function(){l.deleteTask(t)},u),p())},l.taskFailed=function(e,t){c&&c.key===e&&(c.state=r,c.message=t||c.message,c.timeout=setTimeout(function(){l.deleteTask(e)},o),p())},l.changeMessage=function(e,t){c&&c.key===e&&(c.message=t,p())},l}(),TD.controller.notifications=function(){var e=500,t={},n,r=!1,i,s=[],o={},u=!1,a,f=window.webkitNotifications,l=!1,c="growl",h="webkit",p=function(t){var r=t.feed,f=t.column,p=t.items;if(!r.managed)return;p=p.filter(function(e){return e.passFilters(f.filters)&&!e.isOwnChirp()});if(p.length===0)return;var m=[];if(f.model.getHasNotification()&&l)for(var g=0;g<p.length;g++){var y=p[g],b=o[y.id];if(b)v(f.type)>v(b.columnType)&&(b.columnKey=f.model.getKey(),b.columnTitle=f.getTitleHTML(),b.columnType=f.model.getType(),b.accountKey=y.account.getKey());else{var w={chirpID:y.messageThreadId||y.id,accountKey:y.account.getKey(),columnKey:f.model.getKey(),columnTitle:f.getTitleHTML(),columnType:f.model.getType()};if(l===c){var E=y.getGrowlData();if(!E)continue;E.img=E.img||"/web/assets/logos/32.png",_.extend(w,E)}else if(l===h){w.html=y.renderNotification();if(!w.html)continue}m.push(w),o[p[g].id]=w}}i?n.port.postMessage({updates:m}):(u=u||f.model.getHasSound(),s=s.concat(m),!a&&(s.length>0||u)&&(a=setTimeout(d,e)))},d=function(){var e;a=null,u&&(TD.util.getAppEnv()==="win"?deck.playSound("tweet.wav"):document.getElementById("update-sound").play(),u=!1);if(s.length!==0&&l)if(l===c){for(var n=0;n<Math.min(s.length,5);n++)e=s[n],deck.doGrowl(e.title,e.text,e.img,e.chirpID,e.columnKey);u=!1,o={},s=[]}else l===h&&(i=webkitNotifications.createHTMLNotification("/web/templates/notification.html"),i.onclose=t.reset,i.show())},v=function(e){switch(e){case"privateMe":return 5;case"direct":return 4;case"me":return 3;case"mentions":return 2;case"home":return 1;case"search":return-1;default:return 0}},m=function(e){var t=TD.controller.columnManager.get(e.info.columnKey),r=!1,i=!0,s,o,u;switch(e.action){case"url":TD.util.openURL(e.href),i=!1;break;case"user":u=_.last(e.href.split("/")),$(document).trigger("uiShowProfile",{id:u});break;case"hashtag":$(document).trigger("uiPerformSearch",{query:e.text});break;case"showColumn":r=!0;break;case"showChirp":r=!0,s=t.findMostInterestingChirp(e.info.chirpID),o=t.findChirp(e.info.chirpID),TD.ui.updates.showDetailView(t,s,o)}i&&(TD.util.isChromeApp()?chrome.extension.getBackgroundPage().TD.bg.utils.showTDTab():TD.util.isWrapperApp()&&deck.showPrimaryWindow()),r&&TD.ui.columns.scrollColumnToCenter(e.info.columnKey),n.port.postMessage("closeNotification")},g=function(){return TD.util.isWrapperApp()?!0:f.checkPermission()===0};return t.init=function(){if(!TD.settings.getShowStartupNotifications()){var e=(new Date).getTime();_.each(TD.storage.feedController.getAll(),function(t){var n=TD.storage.columnController.getColumnsContainingFeed(t.getKey()),r=Boolean(_.find(n,function(e){return e.getHasSound()||e.getHasNotification()}));r&&t.setLatestTime(e)})}TD.util.isWrapperApp()?deck.showNotification?l=h:l=c:f&&window.SharedWorker&&t.getPermission(),l===h&&t.setUpWorker(),$.subscribe("/notifications/new",p.bind(this))},t.hasNotifications=function(){return l!==!1},t.setUpWorker=function(){n=new SharedWorker("/web/scripts/unbundled/nfn_worker.js"),n.port.addEventListener("message",function(e){e.data==="ready"?(r=!0,n.port.postMessage({updates:s}),s=[]):e.data.action&&m(e.data)}),n.port.start()},t.reRender=function(e){var t=o[e.id];if(t){var i=e.renderNotification();t.html=i,r&&n.port.postMessage({replaceID:e.id,accountKey:e.account.getKey(),html:i})}},t.getPermission=function(){g()?l=h:f.requestPermission(function(){g()&&(l=h,t.setUpWorker())})},t.reset=function(){i=null,o={},u=!1},t}(),TD.controller.stats=function(){var e={},t="performance",n={INIT:"init",MAIN:"main_init",COLUMN_MANAGER:"column_manager_init",COLUMN_SCHEDULER:"column_scheduler_init",NOTIFICATIONS:"notifications_init",FILTER_MANAGER:"filter_manager_init",RENDER_TWEET:"render_tweet"},r="twid",i="interval",s="f",o="oid",u="tsn",a="spam_uid",f="token",l="tw",c=10,h={};TD.util.extendObjectWith(h,[[TD.util.columnUtils.columnMetaTypes.MENTIONS,{legacyId:2,namespace:{section:"twitter",component:"mention"}}],[TD.util.columnUtils.columnMetaTypes.FOLLOWERS,{legacyId:3,namespace:{section:"twitter",component:"followers"}}],[TD.util.columnUtils.columnMetaTypes.TIMELINE,{legacyId:3,namespace:{section:"twitter",component:"home"}}],[TD.util.columnUtils.columnMetaTypes.SEARCH,{legacyId:4,namespace:{section:"twitter",component:"search"}}],[TD.util.columnUtils.columnMetaTypes.MESSAGES,{legacyId:5,namespace:{section:"twitter",component:"inbox"}}],[TD.util.columnUtils.columnMetaTypes.FAVORITES,{legacyId:8,namespace:{section:"twitter",component:"favorites"}}],[TD.util.columnUtils.columnMetaTypes.LIST,{legacyId:22,namespace:{section:"twitter",component:"list"}}],[TD.util.columnUtils.columnMetaTypes.SCHEDULED,{legacyId:28,namespace:{section:"tweetdeck",component:"scheduledupdates"}}],[TD.util.columnUtils.columnMetaTypes.USERTWEETS,{legacyId:32,namespace:{section:"twitter",component:"usertweets"}}],[TD.util.columnUtils.columnMetaTypes.USERTIMELINE,{legacyId:33,namespace:{section:"twitter",component:"usertimeline"}}],[TD.util.columnUtils.columnMetaTypes.HOME,{legacyId:34,namespace:{section:"tweetdeck",component:"home"}}],[TD.util.columnUtils.columnMetaTypes.ME,{legacyId:35,namespace:{section:"tweetdeck",component:"me"}}],[TD.util.columnUtils.columnMetaTypes.INBOX,{legacyId:36,namespace:{section:"tweetdeck",component:"inbox"}}],[TD.util.columnUtils.columnMetaTypes.INTERACTIONS,{legacyId:37,namespace:{section:"twitter",component:"interactions"}}],[TD.util.columnUtils.columnMetaTypes.ACTIVITY,{legacyId:38,namespace:{section:"twitter",component:"networkactivity"}}]]);var p="http://tracking.tweetdeck.com/track/",d,v,m="Twitter-TweetDeck-{{{client_name}}}/{{{client_version}}} {{{platform}}}/{{{platform_version}}}",g="deck",y,b,w,E,S=function(){if(!v){var e=TD.storage.store.getTweetdeckAccount();e&&(v=TD.core.sha1(e))}return v},x=function(e,t){e=e||{},t=t||{},e.client=g,t.user_agent=b,t.guest_id=y,E.scribe(e,t),TD.config.scribe_debug_level>1&&console.log("Scribing:",e,t)},T=function(){var e=TD.storage.accountController.getPreferredAccount("twitter"),t={};return e&&(t[l]=e.getUserID()),t};return e.generateScribeUserAgent=function(e,t,n,r){var i={client_name:e,client_version:t,platform:n,platform_version:r},s=TD.ui.template.toHtml(m,i);return s},e.generateScribeGuestId=function(e,t){var n="tweetdeck:"+e+":"+t,r=TD.core.sha1(n),i=parseInt(r.substr(0,13),16);return i},e.flushScribeQueue=function(){w&&w.flush(w.getBuffer())},e.init=function(){var t=TD.util.getAppEnv();d=TD.config.client_name+"-"+t,b=e.generateScribeUserAgent(d,TD.version,t,"1"),y=e.generateScribeGuestId(b,S());var n={bufferEvents:!0,useAjax:!1,flushOnUnload:!0};w=new ScribeTransport(n),E=new ClientEvent(w),TD.config.scribe_debug_level>0&&this.setupDebugMode(),TD.controller.scheduler.schedulePeriodicTask(900,e.impression,!0),TD.controller.scheduler.schedulePeriodicTask(60,TD.controller.stats.flushScribeQueue)},e.setupDebugMode=function(){var e=!1,t={},n=function(n){var r,i=n.validationLevel==="error"&&n.parentFieldName==="event_namespace",s="scribe error",o="";if(i&&e){r=[n.fieldName,n.fieldValue].join(" ");if(t[r])return;t[r]=!0}n.validationLevel==="warning"&&(s="scribe warning"),i&&(o="Please add "+n.fieldName+" â"+n.fieldValue+"â to go/namespace"),console.error(s.toUpperCase(),o,n)};w.updateOptions({debug:!0,bufferEvents:!1,useAjax:!0,flushOnUnload:!0,debugHandler:function(e){e.errors.forEach(n),e.warnings.forEach(n)}}),w.options.url="https://twitter.com"+w.SCRIBE_API_ENDPOINT},e.impression=function(){var e={action:"impression",page:"main"},t=T();t[i]="900",t[s]=TD.controller.feather.latestFeatherId,x(e,t)},e.favorite=function(e,t,n){var i={page:"column",section:"tweet",action:"favorite"},s={};s[o]=e,s[r]=t,s[l]=n,x(i,s)},e.unfavorite=function(e,t,n){var i={page:"column",section:"tweet",action:"unfavorite"},s={};s[o]=e,s[r]=t,s[l]=n,x(i,s)},e.retweet=function(e,t,n){var i={page:"column",section:"tweet",action:"retweet"},s={};s[o]=e,s[r]=t,s[l]=n,x(i,s)},e.embedTweetDialogOpen=function(e){var t={page:"main",section:"embed_tweet_dialog",action:"open"},n={};n[r]=e,x(t,n)},e.translate=function(e,t,n,i,s){var u={page:"column",section:"tweet",action:"translate"},a={};a[o]=e,a[r]=t,a[l]=n,a.dest_lang=i,a.src_lang=s,x(u,a)},e.spam=function(e,t,n){var r={page:"column",section:"tweet",component:"screen_name",action:"report_as_spam"},i={};i[u]=e,i[a]=t,i[f]=TD.core.sha1(String(n)),x(r,i)},e._genericColumnEvent=function(e,t){var n=h[e],r={page:"column",section:"unknown",component:"unknown",action:t};n&&n.namespace?_.extend(r,n.namespace):console.log("Tracking: Unknown column type",e),x(r)},e.addColumn=function(t){e._genericColumnEvent(t,"add")},e.removeColumn=function(t){e._genericColumnEvent(t,"remove")},e.postTweet=function(e){var t={page:"compose",action:"send_tweet"},n={};e&&e.getType()==="twitter"&&(n[l]=e.getUserID()),x(t,n)},e.postReply=function(e){var t={page:"compose",action:"send_reply"},n={};e&&e.getType()==="twitter"&&(n[l]=e.getUserID()),x(t,n)},e.postMessage=function(e){var t={page:"compose",action:"send_dm"},n={};e&&e.getType()==="twitter"&&(n[l]=e.getUserID()),x(t,n)},e.messageBannerImpression=function(e){var t={page:"main",section:"message_banner",action:"impression"},n={message_id:e};x(t,n)},e.messageBannerDismiss=function(e){var t={page:"main",section:"message_banner",action:"dismiss"},n={message_id:e};x(t,n)},e.messageBannerClick=function(e,t){var n={page:"main",section:"message_banner",action:"click"},r={message_id:e,button_id:t};x(n,r)},e.searchboxFocus=function(){var e={page:"main",component:"search_box",action:"focus_field"};x(e)},e.searchboxPerformSearch=function(){var e={page:"main",component:"search_box",action:"search"};x(e)},e.typeaheadItemSelected=function(e,t,n){var r={page:"main",component:"search_box",element:"typeahead",action:"search"},i={queryLength:e,type:t,index:n};x(r,i)},e.typeaheadRecentItemSelected=function(e,t,n){var r={page:"main",component:"search_box",element:"recent",action:"search"},i={queryLength:e,type:t,index:n};x(r,i)},e.viewedTweetSocialProof=function(e){var t={page:"column",section:"social_proof",component:e,action:"impression"};switch(e){case"retweeters":t.component="retweeted_by";break;case"favoriters":t.component="favorited_by";break;default:throw"Social proof type â"+e+"â not recognised"}x(t)},e.setting=function(e,t){var n={page:"settings",section:e},r={section:{condensed:"narrow","full-size":"wide"}};_.isBoolean(t)?n.action=t?"on":"off":(n.component=r.section[t]||t,n.action="select"),x(n)},e.apiErrorResponse=function(e,t,n){var r={page:"api",action:"request"},i={status_code:e};if(!(TD.util.random(0,99)<c))return;t&&(i.event_info=t),n&&(i.url=n),x(r,i)},e.performance=function(){var e={},t=function(){return e[n.RENDER_TWEET]&&e[n.INIT]&&e[n.MAIN]&&e[n.COLUMN_MANAGER]&&e[n.COLUMN_SCHEDULER]&&e[n.FILTER_MANAGER]&&e[n.NOTIFICATIONS]};return{log:function(n,r){e[n]=r,t()&&(e={})},keys:n}}(),e.advancedSearchSettings=function(e,t,n,r){var i={section:{},component:{action:"interactions"},element:{written_in:"language"}},s={page:"main",section:i.section[e]||e,component:i.component[t]||t,element:i.element[n]||n,action:"change"},o={value:r};x(s,o)},e.actionFilterError=function(){var e={page:"main",section:"column_options",component:"interactions",action:"validation_error"},t={error:"No interaction types selected"};x(e,t)},e.columnActionClick=function(e,t){var n={page:"main",section:"column_options",element:e,action:"click"};t=t||{},x(n,t)},e.unknownStreamData=function(e){var t={page:"api",section:"userstream",action:"unrecognized_data"};x(t,e)},e.navbarListsClick=function(){var e={page:"main",section:"navbar",element:"lists",action:"click"};x(e)},e.navbarAddColumnClick=function(){var e={page:"main",section:"navbar",element:"add_column",action:"click"};x(e)},e.navbarPageLeft=function(){var e={page:"main",section:"navbar",component:"column_nav",element:"page_left",action:"click"};x(e)},e.navbarReorderColumns=function(){var e={page:"main",section:"navbar",component:"column_nav",action:"reorder"};x(e)},e.navbarJumpToColumn=function(){var e={page:"main",section:"navbar",component:"column_nav",element:"column_item",action:"click"};x(e)},e.navbarPageRight=function(){var e={page:"main",section:"navbar",component:"column_nav",element:"page_right",action:"click"};x(e)},e.navbarSettingsClick=function(){var e={page:"main",section:"navbar",element:"settings",action:"click"};x(e)},e.navbarComposeClick=function(){var e={page:"main",section:"navbar",element:"compose",action:"click"};x(e)},e.tweetStreamImpression=function(e,t){var n={component:"stream",action:"results"},r={items:t},i=TD.util.columnUtils.columnMetaTypeToScribeNamespace[e];i&&t.length>0&&(n=_.extend(n,i),x(n,r))},e.appWokenFromSleep=function(e){var t={page:"main",action:"wake"},n={secondsSinceSleep:e};x(t,n)},e.purgedServices=function(e){e.forEach(function(e){var t={page:"main",section:"service",action:"remove"};x(t,{service:e})})},e.purgedFeed=function(e){var t={page:"main",section:"feed",action:"remove"};x(t,e)},e}(),TD.controller.filterManager=function(){var e={},t=[],n=function(){var e=[];_.each(t,function(t){e.push(t.toBackendState())}),TD.settings.setGlobalFilter(e)};return e.init=function(){var n=TD.settings.getGlobalFilter();_.each(n,function(e){var n=new TD.vo.Filter;n.fromBackendState(e),t.push(n)}),e.reapplyAllFilters()},e.reapplyAllFilters=function(){_.each(TD.controller.columnManager.getAll(),function(e){e.reapplyFilters()})},e.pass=function(e,n){var r,i,s,o,u;for(r=0,i=t.length;r<i;r++)if(!t[r].pass(e))return!1;if(n)for(r=0,i=n.length;r<i;r++)if(!n[r].pass(e))return!1;return!0},e.getAll=function(e,n){return t},e.addFilter=function(r,i,s){var o=new TD.vo.Filter(r,i,Boolean(s));return t.push(o),e.reapplyAllFilters(),n(),o},e.validateFilter=function(e,n){return!e||!n?!1:_.trim(n).length==0?!1:_.any(t,function(t){return t.type===e&&t.value===n})?!1:!0},e.removeFilter=function(r){var i;_.each(t,function(e,t){e.id===r&&(i=t)}),t.splice(i,1),e.reapplyAllFilters(),n()},e}(),TD.decider=function(){var e=function(){var e={};this.DM_READ_STATE="dm_read_state",this.ENGAGEMENT_FILTER="engagement_filter",this.TRANSLATE_TWEET="machine_translated_tweets",this.updateFromBackend=function(t){e=t||{}},this.get=function(t){return e[t]},this.getAll=function(){return _.clone(e)}};return new e}(),TD.sync.util=function(e){var t={},n=0,r=2,i=4,s=8;t.maybe_log=function(e,t){var n=_.isUndefined(t)?1:t;TD.config.debug_level>=n&&console.log(e)},t.NotJsonable=function(e){_.extend(this,e),this.___=e.toString()},t.NotJsonable.prototype={};var o=function(e){console.log(_.map(e,function(e){if(_.isUndefined(e))return void 0;try{return JSON.parse(JSON.stringify(e))}catch(n){return new t.NotJsonable(e)}}))};return t.stateLog=function(){TD.config.debug_level>=r&&o(_.toArray(arguments))},t.verboseLog=function(){TD.config.debug_level>=i&&o(_.toArray(arguments))},t.warn=function(){TD.config.debug_level>=n&&console.log.apply(console,_.toArray(arguments))},t.trace=function(e,n){t.maybe_log("TRACE: "+e+": "+(n||""),1)},t.printStacktrace=function(){if(!TD.config.debug_menu)return;try{throw new Error("stack trace or gtfo")}catch(e){console.log(e.stack)}},t.getStack=function(){try{throw new Error("stack trace or gtfo")}catch(e){return TD.util.isChromeApp()?e.stack.split("\n").slice(2).join("\n"):""}},t.errmark=function(e,n){return e||(e=n,n="missing message"),console.log("---ERROR--->>>>>->>>>->>>->>->--"+n+"--<-<<--"),t.maybe_log(e),console.log(e.stack),e},t.assert=function(e,n,r){if(!e)throw console.log("------------------------------------------"),console.log(["ASSERT FAILURE",n,r]),t.printStacktrace(),console.log("------------------------------------------"),TD.sync.trace&&TD.sync.trace.assert(n,r),"AssertionError"},t.precondition=function(e,n,r){if(!e)throw console.log("------------------------------------------"),console.log(["PRECONDITION FAILURE",n,r]),t.printStacktrace(),console.log("------------------------------------------"),TD.sync.trace&&TD.sync.trace.assert("PRECONDITION "+n,r),"PreconditionAssertionError"},t._break=function(){console.log("you might want to set a breakpoint here ;-)")},t.warning=function(e){data=_.toArray(arguments).slice(1),console.log(["WARNING",e,t.pformat(data)])},t.error=function(e){data=_.toArray(arguments).slice(1),console.log(["ERROR",e,t.pformat(data)])},t.list_to_set=function(e){var t={};return _.each(e,function(e){t[e]=!0}),t},t.pprint=function(e){return t.maybe_log(JSON.stringify(e,null,"  "),r),e},t.pformat=function(e){return JSON.stringify(e,null,"  ")},t.repr=function(e){return JSON.stringify(e)},t.clone=function(e){if(e===null||_.isUndefined(e))return e;try{return JSON.parse(JSON.stringify(e))}catch(n){return t.stateLog("util.clone couldn't parse object",e,n),["<not jsonable>",e]}},t.dictMap=function(e,t,n){var r={};return _.each(_.map(e,t,n),function(e){r[e[0]]=e[1]}),r},t.stall=function(t,n){_.isUndefined(n)&&(n=0);var r=new e.Deferred;return _.delay(_.bind(r.callback,r),1e3*n,t),r},t.autoRetry=function(e,t,n){var r=e();return t.forEach(function(t){r.addErrback(function(r){if(!n||n(r)){var i=new TD.core.defer.Deferred;return i.addCallback(e),setTimeout(function(){i.callback()},t),i}return r})}),r},t.makeThingScheduler=function(n,r,i,o,u){var a=!1,f=!1;o=o||function(){return!0},u=_.isUndefined(u)?1:u;var l=[],c=function(){t.maybe_log(["_maybe_do_stuff",i,"want stuff done:",a,"am doing stuff:",f],s);if(!a){t.maybe_log("not doing stuff; someone else did stuff before us",s);return}if(f){t.maybe_log("am already doing stuff",s);return}f=!0,a=!1;var o=TD.controller.progressIndicator;if(r)var u=o.addTask(r);var h=e.maybeDeferred(n);h.addCallback(function(e){f=!1,r&&o.deleteTask(u);if(a)c();else{var t=l;l=[];for(var n=0;n<t.length;n++)try{t[n].callback(e)}catch(i){_.defer(_.bind(t[n].errback,t[n]),i)}}}),h.addErrback(function(e){t.errmark(e,'do_stuff for "'+i+'" yielded error when calling; '+n),f=!1,r&&o.taskFailed(u);var s=l;l=[];for(var a=0;a<s.length;a++)try{s[a].errback(e)}catch(c){_.defer(_.bind(s[a].errback,s[a]),c)}})};return function(n){if(!o())return t.maybe_log("not triggering (guarded): "+i,s),e.succeed();n=_.isUndefined(n)?u:n,t.maybe_log('trigger func called "'+i+'"',s),a=!0;var r=new e.Deferred;return l.push(r),setTimeout(c,n*1e3),r}},t}(TD.core.defer),TD.storage.store=function(e,t){var n={};n._storage=null;var r="TweetDeck",i=function(e){return e?e:n._storage?n._storage:new n.MemoryStore};n.getTweetdeckAccount=function(t){t=i(t);if(t){var n=t.getItem("tweetdeck_account");if(n){n=JSON.parse(n);if(n.email)return n.email;e.stateLog("store.getTweetdeckAccount(): tdacct invalid",n)}return null}},n.setTweetdeckAccount=function(t,n){n=i(n);if(!n)throw new Error("No storage given or configured");e.assert(t,"email must be given to set tweetdeck account");var r={email:t};n.setItem("tweetdeck_account",JSON.stringify(r))},t.isWrapperApp()&&!TD.config.suppress_keychain&&(n.getPasshash=function(e,t){var r=null,i=n.getSecret(e,t);return i&&(r=TD.core.sha1(i)),r},n.getTweetdeckAccountAndPasshash=function(t){t=i(t);if(!t)return null;var r=t.getItem("tweetdeck_account");if(r){r=JSON.parse(r);if(r.email){var s=n.getSecret(r.email,t);s&&(r.passhash=TD.core.sha1(s));if(r.passhash)return r}e.stateLog("store.getTweetdeckAccountAndPassword(): invalid",r)}return null},n.setTweetdeckAccountAndPassword=function(t,r,s){s=i(s);if(!s)throw new Error("No storage given or configured");e.assert(t,"email must be given to set tweetdeck account"),n.storeSecret(t,r);var o={email:t};s.setItem("tweetdeck_account",JSON.stringify(o))},n.storeSecret=function(e,t){var i=deck.storePassword(e,r,t);if(deck.osname()==="windows"){var s=n.get("hoard");s[e]=i,n.set("hoard",s)}},n.getSecret=function(t,i){var s;if(deck.osname()==="windows"){if(_.isUndefined(i))e.assert(n._storage!==null,"can't read hoard: storage is not set up!"),s=n.get("hoard");else{var o=i.getItem("hoard");if(!o)return"";s=JSON.parse(o)}var u=s[t];return deck.getPassword(t,r,u)}return deck.getPassword(t,r)},n.deleteSecrets=function(e){if(deck.osname()==="osx")_.each(e,function(e){deck.deletePassword(e,r)});else{var t=n.get("hoard");_.each(e,function(e){delete t[e]}),n.set("hoard",t)}}),n.init=function(e,t){var r;e&&TD.storage.storeUtils.localStorageOK&&(n._storage=localStorage,console.log("Using localStorage")),!n._storage&&TD.storage.storeUtils.sessionStorageOK&&(n._storage=sessionStorage,console.log("Using sessionStorage")),n._storage||(n._storage=new n.MemoryStore,console.log("Using memory store")),r=n.getTweetdeckAccount(),t!==r&&TD.storage.storeUtils.clearWebstorage()},n.reset=function(){n._storage=null},n.get=function(t){e.assert(n._storage!==null,"can't read ("+t+") storage is not set up!");var r=n._storage.getItem(t);try{return JSON.parse(r)||{}}catch(i){return console.log("ERROR: failed to parse store key ("+t+") value;"),console.log(r),console.log(i),r}},n.set=function(e,t){var r=JSON.stringify(t);try{n._storage.setItem(e,r)}catch(i){if(i.code===DOMException.QUOTA_EXCEEDED_ERR){try{$(document).trigger("dataStorageFull")}catch(i){}n._storage.setItem(e,r)}}},n.nonCriticalSet=function(e,t){n._storage.setItem(e,JSON.stringify(t))},n.size=function(){return n._storage.length},n.remove=function(e){n._storage.removeItem(e)},n.dumpAll=function(){_.each({local:localStorage,session:sessionStorage},function(e,t){console.log("--------------------------------",t,"storage");var n=e.length;for(var r=0;r<n;r++){var i=e.key(r);console.log(i,":");var s=e.getItem(i);try{TD.sync.util.pprint(JSON.parse(s))}catch(o){console.log("Not JSON:",s)}}}),console.log("------------------------------------------")},n.jsonDump=function(){var e={};return _.each({local:localStorage,session:sessionStorage},function(t,n){console.log("--------------------------------",n,"storage"),e[n]={};var r=t.length;for(var i=0;i<r;i++){var s=t.key(i);console.log(s,":");var o=t.getItem(s);e[n][s]=o}}),e},n.dbgCapture=function(e){var t={};_.isUndefined(e)&&(e=localStorage);var n=e.length;for(var r=0;r<n;r++){var i=e.key(r);console.log(i,":");var s=e.getItem(i);console.log(":",s),console.log("X",t),t[i]=s}return TD.core.base64.encode(JSON.stringify(t))},n.dbgImport=function(e,t){_.isUndefined(t)&&(t=localStorage);var n=JSON.parse(TD.core.base64.decode(e));_.each(n,function(e,n){t.setItem(n,e)})},n.storageKeys=function(e){var t=[],n=e.length;for(var r=0;r<n;r++)t.push(e.key(r));return t};var s="__upgrade__";return n.stashUpgrade=function(e,t,n,r){e.setItem(s,JSON.stringify({from:t,to:n,data:r}))},n.getUpgradeState=function(){var e=n._storage.getItem(s);return e===null&&n._storage===sessionStorage&&(e=localStorage.getItem(s)),e===null?null:JSON.parse(e)},n.flushUpgradeState=function(){n._storage===sessionStorage&&localStorage.getItem(s)!==null&&localStorage.removeItem(s),n._storage.getItem(s)!==null&&n._storage.removeItem(s)},n.checkVersion=function(e){var t=n._storage.getItem("__version__");if(t!==null&&Number(t)!==e)throw new Error("Wrong version number found in store (curr "+t+")")},n.recordVersion=function(e,t){var r=t?t:n._storage;r.setItem("__version__",e)},n.MemoryStore=function(){this.data={},this.length=0},n.MemoryStore.prototype.clear=function(){this.data={},this.length=0},n.MemoryStore.prototype.getItem=function(e){var t=this.data[e];return t!==undefined?t:null},n.MemoryStore.prototype.key=function(e){throw"MemoryStore.key not implemented"},n.MemoryStore.prototype.removeItem=function(e){this.getItem(e)!==null&&(delete this.data[e],this.length--)},n.MemoryStore.prototype.setItem=function(e,t){this.getItem(e)===null&&this.length++,this.data[e]=t},n}(TD.sync.util,TD.util),TD.storage.storeUtils=function(){var e={};return e.localStorageOK=!1,e.sessionStorageOK=!1,e.init=function(){e.localStorageOK=window.localStorage&&e._testStore(localStorage,!0),e.sessionStorageOK=window.sessionStorage&&e._testStore(sessionStorage,!0),console.log("localStorage:",e.localStorageOK?"OK":"BROKEN"),console.log("sessionStorage:",e.sessionStorageOK?"OK":"BROKEN"),e._upgradeWebstorage()},e.getSessionData=function(){var t={email:null,staySignedIn:!0,sessionExists:!1,passhash:null};try{e.localStorageOK&&(t=e._getSessionDataFromStore(localStorage)),!t.email&&e.sessionStorageOK&&(t=e._getSessionDataFromStore(sessionStorage),t.email&&(t.staySignedIn=!1))}catch(n){}return t},e._getSessionDataFromStore=function(e){var t,n={email:null,staySignedIn:!0,sessionExists:!1,passhash:null};try{t=TD.storage.store.getTweetdeckAccount(e),t&&(n.session=e.getItem("_session"),TD.sync.tdapi.setSession(n.session),n.email=t,n.sessionExists=TD.sync.tdapi.isLoggedIn(),TD.storage.store.getSecret&&(n.passhash=TD.storage.store.getSecret(n.email,e)))}catch(r){}return n},e._upgradeWebstorage=function(){TD.sync.util.trace("upgrading web storage");try{e.localStorageOK&&TD.storage.upgrade.doUpgrade(localStorage),e.sessionStorageOK&&TD.storage.upgrade.doUpgrade(sessionStorage)}catch(t){TD.sync.util.warn("ERROR in store upgrade:",t.message,t),e.clearWebstorage()}},e._testStore=function(t,n){var r=!1,i=!1,s="__test__",o="test",u=1024;while(o.length<u)o+=o;try{t.setItem(s,o),r=t.getItem(s)===o,t.removeItem(s)}catch(a){r=!1,i=a.code===DOMException.QUOTA_EXCEEDED_ERR,i&&t.length===0&&TD.sync.util.warn(a,"In Safari private browsing mode")}if(n&&i)try{e.flushDataFromStore(t),r=e._testStore(t,!1)}catch(a){r=!1}return r},e.clearWebstorage=function(t){TD.sync.util.trace("clearing web storage");try{e.flushDataFromStore(localStorage,t),e.flushDataFromStore(sessionStorage,t)}catch(n){}},e.flushDataFromStore=function(e,t){var n={};t=t||[],t.push("__version__"),t.forEach(function(t){var r=e.getItem(t);r&&(n[t]=r)}),e.clear(),_.each(n,function(t,n){e.setItem(n,t)})},e.hasAlreadyReloaded=function(){var t;return e.localStorageOK?t=Boolean(localStorage.getItem("__hasAlreadyReloaded")):t=!0,t},e.setReloadedFlag=function(){e.localStorageOK&&localStorage.setItem("__hasAlreadyReloaded",!0)},e.removeReloadedFlag=function(){e.localStorageOK&&localStorage.removeItem("__hasAlreadyReloaded")},e}(),TD.sync.trace=function(e){var t={},n=[];return t.record=function(){var t=(new Date).toLocaleTimeString();n.push([t].concat(_.toArray(arguments))),TD.config.debug_trace&&e.stateLog.apply(null,["-------- TRACE: "+t].concat(_.toArray(arguments))),TD.config.debug_menu||n.length>200&&n.splice(0,100)},t.request=function(e,n,r){t.record("request",e,r.type,n,_.clone(r))},t.response=function(e,n,r,i){t.record("response",e,n,_.clone(r),_.clone(i))},t.objInit=function(e,n,r){t.record("obj init",e,_.clone(n),_.clone(r))},t.manage=function(n,r){t.record("manage",n,r,e.clone(r.getStateForLocalstorage()))},t.update=function(e,n,r){t.record("update",e,n,_.clone(r))},t.push=function(n,r,i,s){t.record("push",n,r,_.clone(i),e.clone(s))},t.tsResults=function(e,n,r,i,s,o){t.record("t+s results",e,_.clone(n),_.clone(r),_.clone(i),_.clone(s),o)},t.tsResult=function(e,n,r,i,s,o){t.record("t+s result",e,_.clone(n),_.clone(r),i,_.clone(s),o)},t.conflicts=function(e,n,r,i,s){t.record("conflicts",e,_.clone(n),_.clone(r),_.clone(i),s)},t.conflict=function(e,n,r,i,s){t.record("conflict",e,_.clone(n),_.clone(r),_.clone(i),s)},t.assert=function(n,r){t.record("ASSERT",n,r,e.getStack())},t.clear=function(){n=[]},t.logDump=function(){var e="-------------------------------------------------------------";console.log(e+" TRACE dump "+e),_.each(n,function(e){console.log.call(console,e)}),console.log(e+"  END dump  "+e)},t.logSummarise=function(){var t="-------------------------------------------------------------";console.log(t+" TRACE dump "+t);var r=e.list_to_set(["obj init","update"]);_.each(n,function(e){r[e[1]]||console.log.call(console,e)}),console.log(t+"  END dump  "+t)},t}(TD.sync.util),TD.sync.tdapi=function(e,t,n,r){var i={},s=null,o=null,u=function(e,t){return"Basic "+r.encode(e+":"+t)},a=function(){if(!s)throw new Error("Not Logged In");return"X-TD-Session "+s};i.getAccounts=function(e){var t="/verify_user?accounts=true";return e&&(t="/verify_user?all=true"),i.drequest(t,i.getReq())};var f=function(e){return _.isUndefined(e.session)||(s=e.session),e},l=function(e){return s=null,e};i.login=function(e,t){var n="/login?session=true",r={type:"GET",headers:{Authorization:u(e,t)}},s=i.drequest(n,r,{});return s.addCallback(f),s},i.logout=function(){var e=i.drequest("/logout",i.getReq({method:"POST"}));return e.addCallback(l),e},i.isLoggedIn=function(){return Boolean(s)},i.setSession=function(e){var t=null;e&&(t=JSON.parse(e)),t&&(s=t)},i.saveSession=function(){TD.storage.store.set("_session",s)},i.onAuthFail=function(e,t){o=e},i.createAccount=function(e,t,n,r){var s=TD.util.iso8601(new Date),o="/user"+TD.config.td_create_key+s,a=new window.jsSHA(o,"ASCII"),l=a.getHMAC(TD.config.td_create_secret,"ASCII","SHA-256","B64"),c="/user?session=true&mail_list=False",h={type:"PUT",headers:{Authorization:u(e,t),"x-td-sig":l,"x-td-timestamp":s,"x-td-create":TD.config.td_create_key}},p=i.drequest(c,h);return p.addCallback(f),p},i.Conflict=function(e){this.body=e};var c=new RegExp("^([^:]*): (.*)$"),h=function(e,t){_.isUndefined(t)&&(t={});var n=e.getAllResponseHeaders(),r=n.split("\r\n");return r.length==1&&(r=n.split("\n")),_.each(r,function(e){var n=e.match(c);n&&(t[n[1].toLowerCase()]=n[2])}),t};return i.drequest=function(r,s,u,f){var l=_.uniqueId(s&&s.reqid?"["+s.reqid+"]rq:":"rq:");e.stateLog("drequest",l,r,s);if(s===null||_.isUndefined(s))s=i.getReq();n.request(l,r,s),r.charAt(0)=="/"&&(r=TD.config.api_root+r);if(!_.startsWith(r,"http://")&&!_.startsWith(r,"https://"))return t.fail(new Error("Malformed url"));var c=function(n,r){var i=jQuery.ajax(n,r),s=new t.Deferred;return i.done(function(e,t,n){s.callback(n)}),i.fail(function(n,r,i){n.status===409?(e.assert(i==="Conflict","409 should be Conflict"),s.callback(n)):s.errback(new t.XMLHttpRequestError(n,i))}),s},p=c(r,s);p.reqid=l;var d=function(e){var t=e.req;if(t.status===401&&!f){var n=h(t);if(n["www-authenticate"]==="X-TD-Session"){if(TD.storage.store.getTweetdeckAccountAndPasshash){var u=TD.storage.store.getTweetdeckAccountAndPasshash();if(u&&u.email&&u.passhash){var l=i.login(u.email,u.passhash);return l.addCallback(function(){return i.saveSession(),s.headers.Authorization=a(),c(r,s)}),l.addErrback(function(){o&&o()}),l}}if(o)throw o(),e}}throw e};p.addErrback(d);var v=function(t,o){var a,f,c=function(t){if(t==="")return t;try{return JSON.parse(t)}catch(n){return _.isEmpty(t)||e.warn(["failed to json parse drequest response;",t,"for request",r,s]),t}},p;return t.status===409?p=new i.Conflict(c(t.responseText)):p=c(t.responseText),u&&h(t,u),u&&u.date&&TD.storage.notification.notify("/date",u.date),e.stateLog("drequest ret",l,r,p,t.getAllResponseHeaders().split("\n")),n.response(l,r,p,u),p};return p.addCallback(v,l),p},i.requestWithBody=function(e,t,n,r,s,o,u){var a=i.getReq({type:t,reqid:o,headers:s||{},data:JSON.stringify(n),contentType:"application/json"});return i.drequest(e,a,r,u)},i.getReq=function(e){var t={type:"GET",headers:{}};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t.headers.Authorization=a(),e&&e.method&&(t.type=e.method),t},i}(TD.sync.util,TD.core.defer,TD.sync.trace,TD.core.base64),TD.storage.notification=function(e){var t={},n=[],r=function(){var e=n.splice(0,n.length);_.each(e,function(e){if(e.topic)try{jQuery.publish(e.topic,e.args)}catch(t){console.log("FAILURE publishing event",e,t)}else e.d&&e.d.callback()})};return t.notify=function(e){var t=Array.prototype.slice.call(arguments,1);n.push({topic:e,args:t}),_.defer(r)},t.flush=function(){var t=new e.Deferred;return n.push({d:t}),_.defer(r),t},t}(TD.core.defer),TD.storage.StoredObj=function(e,t,n,r,i,s,o){function u(e){this.controller=e}return u.prototype.controller=null,u.prototype.managed=!1,u.prototype.stateCache=null,u.prototype.state=null,u.prototype.privateState=null,u.prototype.eventname="/storage/object",u.prototype._init=function(n){n||(n={}),o.objInit(this,n),this.state={},this.privateState={},_.isEmpty(n)?(this.deltaQ=[],this.stateCache=null):(this.deltaQ=[new e.StoredDelta("init",n)],this.stateCache=_.clone(n)),t.verboseLog("StoredObj.init",this,n,this.deltaQ)},u.prototype.getApiid=function(){var e=this.getPrivate("apiid");return t.assert(e,"missing apiid",this),e},u.prototype.hasApiid=function(){return Boolean(this.getPrivate("apiid"))},u.prototype.setApiid=function(e){return o.update("set apiid",this,[e]),this.setPrivate("apiid",e)},u.prototype.getKey=function(){return this.getPrivate("key")},u.prototype.setKey=function(e){return this.setPrivate("key",e)},u.prototype._prepCache=function(){return this.stateCache===null&&(t.assert(this.deltaQ.length===0,"empty stateCache must coincide with empty ÎQ"),this.stateCache=_.clone(this.state)),this.stateCache},u.prototype.set=function(n,r){return o.update("set",this,[n,r]),t.assert(n!=="columns","you should be setting column_order, not columns"),this._prepCache(),this.deltaQ.push(new e.StoredDelta("set",n,r)),this.stateCache[n]=r,s.notify(this.eventname+"/change",this),this.controller.triggerPush()},u.prototype.setListPermutation=function(n,r){TD.config.debug_checks&&this.checkCache();var u=this.get(n);if(_.isEqual(r,u))return o.update("set null list permutation",this,[n,u,r]),t.stateLog("ignoring request to change list at",n),i.succeed();o.update("set list permutation",this,[n,u,r]);var a=e.StoredDelta.listPermutator(n,u,r);return t.verboseLog("set list permutation",u,"â",r,"Îs:",a),this.deltaQ=this.deltaQ.concat(a),this.stateCache=e.StoredDelta.applyMultiple(this.deltaQ,this.state),TD.config.debug_checks&&this.checkCache(),s.notify(this.eventname+"/change",this),this.controller.triggerPush()},u.prototype.listPrepend=function(t,n){o.update("list prepend",this,[t,n]);var r=this.get(t);return r||(r=[]),this._prepCache(),this.deltaQ.push(new e.StoredDelta("linsert",t,n,0)),this.stateCache[t]=[n].concat(r),s.notify(this.eventname+"/change",this),this.controller.triggerPush()},u.prototype.listAppend=function(t,n){o.update("list append",this,[t,n]);var r=this.get(t);return r||(r=[]),this._prepCache(),this.deltaQ.push(new e.StoredDelta("linsert",t,n,r.length)),this.stateCache[t]=r.concat([n]),s.notify(this.eventname+"/change",this),this.controller.triggerPush()},u.prototype.listTruncate=function(t,n){o.update("list truncate",this,[t,n]);var r=this.get(t);return r||(r=[]),this._prepCache(),this.deltaQ.push(new e.StoredDelta("ltrunc",t,n)),r.length>n&&r.splice(n,r.length-n),this.stateCache[t]=r,s.notify(this.eventname+"/change",this),this.controller.triggerPush()},u.prototype.listRemove=function(t,n){o.update("list remove",this,[t,n]);var r=this.get(t)||[];return this._prepCache(),this.deltaQ.push(new e.StoredDelta("ldel",t,n)),this.stateCache[t]=_.without(r,n),s.notify(this.eventname+"/change",this),this.controller.triggerPush()},u.prototype.dictSet=function(t,n,r){o.update("dict set",this,[t,n,r]),this._prepCache();var i=_.clone(this.get(t));return this.deltaQ.push(new e.StoredDelta("hset",t,n,r)),i||(i={}),i[n]=r,this.stateCache[t]=i,s.notify(this.eventname+"/change",this),this.controller.triggerPush()},u.prototype.setPrivate=function(e,t){return this.privateState[e]=t,i.succeed()},u.prototype.getPrivate=function(e){return this.privateState[e]},u.prototype.immutableSet=function(e,n){var r=this.state[e];if(n!=r)throw t.warn("ERROR: attempt to change",e,"of",this,"from",r,"to",n),new Error("attempt to modify immutable field "+e);return i.succeed()},u.prototype.setValueIffDifferent=function(e,n,r,o){var u=this.get(e);return _.isEqual(u,n)?i.succeed(null):(t.verboseLog(this,"setValueIffDifferent",e,"from",u,"to",n),r&&s.notify(r,n,u,this),o&&o(n,u),s.notify(this.eventname+"/change",this),this.set(e,n))},u.prototype.get=function(e){return this.stateCache===null?this.state[e]:this.stateCache[e]},u.prototype.latestDelta=function(){return _.isEmpty(this.deltaQ)?null:this.deltaQ[this.deltaQ.length-1].id},u.prototype.getStateForBackend=function(){TD.config.debug_checks&&(t.precondition(this.isDirty(),"don't call getStateForBackend unless isDirty"),this.checkCache());var e=_.clone(this.stateCache!==null?this.stateCache:this.state);return!e.mtime&&this.state.mtime&&(e.mtime=this.state.mtime),{"Îid":this.latestDelta(),state:this.transformForRemote(e,this.privateState)}},u.prototype.postProcessNewRemoteState=function(){},u.prototype.newRemoteState=function(n){o.update("new remote state",this,n),TD.config.debug_checks&&(t.stateLog("checking cache"),this.checkCache()),t.verboseLog("transforming to local:",this,t.clone(n)),this.state=this.transformToLocal(n),this.deltaQ.length!==0?(t.assert(this.stateCache!==null,"if we have Îs, we should have cache"),t.verboseLog("applying pending deltas",this,t.clone(this.deltaQ)),this.stateCache=e.StoredDelta.applyMultiple(this.deltaQ,this.state)):t.assert(this.stateCache===null,"if no Îs, should have no cache"),this.postProcessNewRemoteState(),TD.config.debug_checks&&(t.stateLog("checking cache"),this.checkCache()),s.notify(this.eventname+"/change",this)},u.prototype.commit=function(n,r){o.update("commit",this,[n+" : "+r]);var i=_.pluck(this.deltaQ,"id").indexOf(n);if(i===-1)throw t.stateLog("asked to commit "+n+" but it doesn't exist in "+_.map(this.deltaQ,function(e){return e.toString()})),new Error("invalid deltaId supplied");TD.config.debug_checks&&this.checkCache();if(i===this.deltaQ.length-1)this.deltaQ=[],this.state=_.clone(this.stateCache),this.state.mtime=r,this.stateCache=null,TD.config.debug_checks&&this.checkCache();else{var s=this.deltaQ.splice(0,i+1),u=e.StoredDelta.applyMultiple(s,this.state);this.state=u,this.state.mtime=r,this.stateCache.mtime=r,TD.config.debug_checks&&this.checkCache(),this.controller.triggerPush()}},u.prototype.checkCache=function(){var n=e.StoredDelta.checkStateCache(this.state,this.deltaQ,this.stateCache);t.assert(n,"cache != state+Îs")},u.prototype.checkInvariants=function(){this.hasApiid()||t.assert(_.isEmpty(this.state),'must have no "state" if no apiid'),t.assert(this.state&&_.isUndefined(this.state.apiid),"apiid in non-priv state, bad"),this.isDirty()?(t.assert(!_.isEmpty(this.deltaQ),"deltaQ must be non-empty if dirty"),t.assert(this.stateCache!==null,"cache must be present if dirty"),this.checkCache(),this.hasApiid()&&t.assert(this.latestDelta()!==null,"latestDelta() must not return null for Îid for dirty object")):(t.assert(_.isEmpty(this.deltaQ),"deltaQ must be empty if not dirty"),t.assert(this.stateCache===null,"cache must be absent if not dirty"))},u.prototype.isDirty=function(){return this.hasApiid()?this.deltaQ.length!==0:(t.assert(this.deltaQ.length!==0,"should be dirty if no apiid"),!0)},u}(TD.storage,TD.sync.util,TD.sync.tdapi,TD.util,TD.core.defer,TD.storage.notification,TD.sync.trace),TD.storage.StoredDelta=function(e,t,n,r,i){function s(t){this.type=t,e.assert(a[t]&&o,"unknown type "+t),this.args=_.toArray(arguments).slice(1),this.id="Î"+(new Date).getTime()+_.uniqueId(":"),u(t,this.args),t==="init"&&(e.verboseLog("initialisation delta",this.id,this.args[0]),"mtime"in this.args[0]&&(e.warn("WARNING init Î contains mtime!",e.clone(this.args[0])),e._break()))}var o={init:1,set:2,del:1,lmove:3,ldel:2,linsert:3,ladd:3,ltrunc:2,hset:3,other:0},u=function(t,n){var r=o[t];e.assert(n.length===r,"wrong no. args for "+t+", expected "+r+" got "+n.length);switch(t){case"ltrunc":e.assert(typeof n[1]=="number","ltrunc: length must be number");break;case"linsert":case"ladd":case"ldel":case"lmove":e.assert(typeof n[1]=="string","list elements must be strings")}};s.prototype.toString=function(){return"StoredDelta["+this.id+"]("+this.type+": "+JSON.stringify(this.args)+")"},s.prototype.serialise=function(){return[this.type].concat(this.args)};var a={init:function(t,n){if(!_.isEqual(t,{})){var r=e.clone(t),i=e.clone(n);delete r.mtime,delete i.mtime;if(_.isEqual(r,i))return e.warn("WARNING Î init_state === state",e.clone(t),"init:",n.mtime,"state:",t.mtime),t;e.warn("WARNING discarding init_state",e.clone(n),"in favour of",e.clone(t));return}return _.clone(n)},set:function(e,t,n){return e[t]=n,e},del:function(e,t){return delete e[t],e},lmove:function(e,t,n,r){var i=_.clone(e[t]),s=i.indexOf(n);if(s==-1)return;return i.splice(s,1),i.splice(s+r,0,n),e[t]=i,e},ldel:function(e,t,n){var r;return _.isUndefined(e[t])?r=[]:r=_.without(e[t],n),e[t]=r,e},linsert:function(e,t,n,r){var i;return _.isUndefined(e[t])?i=[]:i=_.clone(e[t]),i.splice(r,0,n),e[t]=i,e},ladd:function(e,t,n,r){if(_.include(e[t],n))return e;var i;return _.isUndefined(e[t])?i=[]:i=_.clone(e[t]),i.splice(r,0,n),e[t]=i,e},ltrunc:function(e,t,n){var r;return _.isUndefined(e[t])?r=[]:r=e[t],r.length>n&&r.splice(n,r.length-n),e[t]=r,e},hset:function(e,t,n,r){var i=_.clone(e[t]);return i||(i={}),i[n]=r,e[t]=i,e}};s.prototype.apply=function(t){var n=_.clone(t),r=a[this.type],i=r.apply(this,[n].concat(this.args));return i?i:(e.warn("WARNING: unable to apply Î",this.toString(),"to",e.clone(t)),_.clone(t))},s.listPermutator=function(t,n,r){var i=[],o=_.clone(n);e.verboseLog("StoredDelta.listPermutator",n,"â",r);if(n.length!=_.union(n).length||r.length!=_.union(r).length)throw e.stateLog("Duplicate error in listPermutator",{original:n,original_:_.union(n),target:r,targetu:_.union(r)}),new TypeError("lists must not contain duplicates");_.each(_.difference(n,r),function(e){i.push(new s("ldel",t,e)),o.splice(o.indexOf(e),1)});for(var u=0;u<r.length;u++)if(o[u]!=r[u]){var a=r[u],f=o.indexOf(a);f===-1?(i.push(new s("ladd",t,a,u)),o.splice(u,0,a)):(i.push(new s("lmove",t,a,u-f)),o.splice(f,1),o.splice(u,0,a))}return i},s.applyMultiple=function(e,t){return _.reduce(e,function(e,t){return t.apply(e)},t)};var f=function(e,t){function n(){return e.apply(this,t)}return n.prototype=e.prototype,new n};return s.deserialiseDeltas=function(e){return _.map(e,function(e){return f(s,e)})},s.checkStateCache=function(t,n,r){if(r===null&&n.length===0)return!0;ccache=_.clone(r),delete ccache.mtime;var i=s.applyMultiple(n,_.clone(t));return delete i.mtime,_.isEqual(ccache,i)?!0:(e.stateLog("cache",r,"!= goal",i,"for",t,"+",n),!1)},s}(TD.sync.util,TD.sync.tdapi,TD.util,TD.core.defer,TD.storage.notification),TD.storage.SobjController=function(e,t,n,r,i,s){var o=function(){var e=this;this._objects=null,this._objectsByApiid=null,this.reqsinflight=null,this.apiEndpoint=null,this._moduleName=null};return o.prototype.toString=function(){return"<SobjController["+(this._moduleName||"unknown")+"]>"},o.prototype.triggerPush=function(){throw t.printStacktrace(),new Error("NotImplemented")},o.prototype.bindTrigger=function(n){var r=t.makeThingScheduler,i=e.store.getTweetdeckAccount;this.triggerPush=r(_.bind(this.pushDirty,this),null,n,i)},o.prototype.remove=function(e){var t=this._objects[e];t&&(t.managed=!1,t.hasApiid()&&delete this._objectsByApiid[t.getApiid()]),delete this._objects[e]},o.prototype.getAll=function(){return _.values(this._objects)},o.prototype.getByApiid=function(e){return t.assert(e,"must provide apiid; "+t.repr(e)),t.assert(e!="undefined","huh? where did that come from?"),this._objectsByApiid[e]},o.prototype.pushPreflight=function(){return i.succeed(null)},o.prototype.pushDirty=function(){TD.config.debug_checks&&this.checkInvariants();var e=_.uniqueId("pD:");s.push(this,"pushDirty",null,e);var t=this,n=this.pushPreflight();return n.addCallback(function(){var n=_.filter(t._objects,function(e){return e.isDirty()});if(_.isEmpty(n))return s.push(t,"(not dirty)",null,e),i.succeed();var r=t.pushObjects(n,e);return r.addCallback(function(){return t.pushDirty()}),r}),n},o.prototype.prePushCheckInvariants=function(e){return},o.prototype.pushObjects=function(e,r){t.verboseLog(this.toString()+".pushObjects()",this,e),r||(r=_.uniqueId("pO:")),s.push(this,"pushObjects",e,r),t.assert(this.apiEndpoint,"api endpoint must be set");if(_.isEmpty(e))return s.push(this,"(empty)",e,r),i.succeed([]);TD.config.debug_checks&&this.prePushCheckInvariants(e);var o=_.map(e,function(e){return e.getStateForBackend()}),u=_.pluck(o,"Îid"),a=_.pluck(o,"state");s.push(this,"objs+Îs",e,u,r),TD.config.debug_checks&&(_.each(a,function(e){t.assert(e.mtime||!e.id,"for a test and set request, we expect (require) either mtime (modify) or absence of id (create) for every object")}),_.isEmpty(this.reqsinflight)||(t.warn("WARNING! called pushObjects",e,"when already have requests in flight",t.clone(this.reqsinflight)),t._break()));var f={},l=n.requestWithBody(this.apiEndpoint,"POST",a,f,{"x-td-mtime-check":"partial"},r);if(TD.config.debug_checks){this.reqsinflight.push(l.reqid);var c=this;l.addBoth(function(e){return c.reqsinflight=_.without(c.reqsinflight,l.reqid),e})}return l.addCallbackWith(this,this._processTSResults,e,u,f,r),l},o.prototype._processTSResults=function(e,r,i,o,u){s.tsResults(this,e,r,i,o,u),e instanceof n.Conflict&&(s.conflicts(this,e.body,r,o,u),e=e.body),t.assert(e.length==r.length,"wrong number of responses/objects!"),t.assert(e.length==i.length,"wrong number of responses/deltas!"),t.verboseLog("objects",r,"deltas",i),_.each(i,function(e){t.assert(e!==null,"Îid must not be null")});var a=o["x-td-mtime"];t.assert(a,"require x-td-mtime header in object PUT");var f,l=this,c=function(e,n){t.verboseLog("_processTSResults:check_set_apiid",e,n),e.hasApiid()?t.assert(e.getApiid()==n,"apiid mismatch"):(l._objectsByApiid[n]=e,e.setApiid(n))};for(var h=0;h<e.length;h++)f=e[h],_.isString(f)?(t.verboseLog("_processTSResults",r[h],e[h]),c(r[h],e[h]),r[h].commit(i[h],a)):(s.conflict(this,f,r[h],o,u),t.verboseLog("_processTSResults: not an apiid:",f),r[h].newRemoteState(e[h]))},o.prototype.pushObject=function(e,r){t.verboseLog(this.toString()+".pushObject()",this,e,r),s.push(this,"object",e);var i=e.getStateForBackend(),o=i["Îid"],u=i.state;t.assert(u.mtime,"for a test and set request, we expect (require) mtime");var a={},f=n.requestWithBody(r,"PUT",u,a,{"x-td-iff-mtime":u.mtime});return f.addCallbackWith(this,this._processTSResult,e,o,a),f},o.prototype._processTSResult=function(e,r,i,o){s.tsResult(this,e,r,i,o),t.verboseLog("object",r,"delta",i),t.assert(i!==null,"Îid must not be null");var u;if(e instanceof n.Conflict)t.verboseLog("_processTSResult: got a conflict:",e),u=r.newRemoteState(e.body);else{t.assert(_.isString(e),"don't know how to handle response");var a=o["x-td-mtime"];t.assert(a,"require x-td-mtime header in object PUT"),t.verboseLog("_processTSResult",r,e),u=r.commit(i,a)}return u},o.prototype.checkInvariants=function(){var e=this;_.each(this._objects,function(n){var r=n.checkInvariants;r&&r.call(n),n.hasApiid()&&t.assert(e._objectsByApiid[n.getApiid()],"all managed objects with apiid must be in _objectsByApiid")})},o}(TD.storage,TD.sync.util,TD.sync.tdapi,TD.storage.notification,TD.core.defer,TD.sync.trace),TD.storage.FeedController=function(e,t,n,r,i){var s=function(){var n=this;this.apiEndpoint="/feeds",this._moduleName="feeds",this.reqsinflight=[],this.bindTrigger("feedctr"),n._objects={},n._objectsByApiid={},this.toString=function(){return"<FeedController>"},this.init=function(){t.trace("feedController init"),TD.config.debug_checks&&this.checkInvariants()},this.reset=function(){this._objects={},this._objectsByApiid={}},this.updateFromBackend=function(n){var i=this;t.stateLog("feedController.updateFromBackend:",n),_.each(n,function(t,n){var s=i._objectsByApiid[n];s?(s.newRemoteState(t),r.notify("/storage/feed/updated",s)):(s=e.Feed.newFromBackendState(t),s.setApiid(n),i.manage(s),r.notify("/storage/feed/new",s))})},this.get=function(e){return this._objects[e]},this.manage=function(e){e.managed=!0;var r=this._objects[e.getKey()];return r&&e===r?n.triggerPush():(r&&(t.warn("WARNING replacing feed",r,"with",e,"please use feedController.getOrCreateFeed",[t.getStack().split("\n")]),r.getLatestTime()>e.getLatestTime()&&t.warn("Warning: latestTime weirdness:",r.getLatestTime(),e.getLatestTime()),r.hasApiid()&&e.setApiid(r.getApiid()),r.isDirty()&&(!!_.isEmpty(r.deltaQ)||r.deltaQ[0].type!="init")&&t.assert(!r.isDirty(),"houston, we have a problem")),this._objects[e.getKey()]=e,e.hasApiid()&&(this._objectsByApiid[e.getApiid()]=e),n.triggerPush())},this.manageFeeds=function(e){for(var t=0;t<e.length;t++)n.manage(e[t])},this._selfcheckapiids=function(){for(var e in this._objects){var t=this._objects[e];t.apiid&&_assert(t==n.getByApiid(t.apiid),"lookup failed")}},n.isEmpty=function(){return _.isEmpty(this._objects)},n.getOrCreateFeed=function(t,n,r,i,s){var o,u,a,f;t==="search"&&!i.term&&i.baseQuery&&i.searchFilterData&&(o="xq"+Math.floor(Math.random()*1e5),u=new TD.vo.SearchFilter(i.searchFilterData),i.term=[i.baseQuery,u.getQueryString(),"-"+o].join(" ")),f=e.Feed.generateKeyFor(r,t,i),a=this._objects[f],t==="list"&&(i.screenName=i.ownerId,i.slug=i.listId);if(!a){var l={type:t,service:n,accountkey:r,metadata:i,apiid:s};a=new e.Feed(l)}return s&&(a.apiid=s,this._objectsByApiid[s]=a),a}};return s.prototype=new e.SobjController,e.feedController=new s,s}(TD.storage,TD.sync.util,TD.sync.tdapi,TD.storage.notification,TD.core.defer),TD.storage.ColumnController=function(e,t,n,r,i){var s=function(){var n=this;this.apiEndpoint="/columns",this._moduleName="columns",this.reqsinflight=[],this.bindTrigger("colctr"),$.subscribe("/storage/account/new",function(e){n.addToCombinedColumns(e)}),this._objects={},this._objectsByApiid={},this.toString=function(){return"<ColumnController>"},this.init=function(){t.trace("columnController init"),TD.config.debug_checks&&this.checkInvariants()},this.reset=function(){this._objects={},this._objectsByApiid={}},this.updateFromBackend=function(n){var i=this;t.stateLog("columnController.updateFromBackend:",n),_.each(n,function(t,n){var s=i._objectsByApiid[n];s?s.newRemoteState(t):(s=e.Column.newFromBackendState(t),s.setApiid(n),i.manage(s),r.notify("/storage/column/new",s))})},this.get=function(e){return this._objects[e]},this.getColumnsContainingFeed=function(e){var t=[];return _.each(this._objects,function(n){_.each(n.getFeedKeys(),function(r){r==e&&t.push(n)})}),t},this.getColumnsByType=function(e){return _.filter(this._objects,function(t){return t.getType()===e})},this.manage=function(e){return e.managed=!0,t.assert(e.getKey(),"columns must have valid keys to be managed!"),this._objects[e.getKey()]=e,e.hasApiid()&&(this._objectsByApiid[e.getApiid()]=e),this.triggerPush()},this.remove=function(e){var t=this._objects[e];t&&(t.managed=!1),delete this._objects[e]},this.getAll=function(){return _.values(this._objects)},this.getByApiid=function(e){t.assert(e,"must provide apiid; "+t.repr(e)),t.assert(e!=="undefined","huh? where did that come from?");var n=this._objectsByApiid[e];return n||(t.warn("WARNING: col ",e," not found in cols_by_apiid ",_.keys(this._objectsByApiid)),t.stateLog("this._objects, apiids; ",t.pformat(_.map(this._objects,function(e,t){return[t,e.getApiid()]})))),n},this.isEmpty=function(){return _.isEmpty(this._objects)},this._selfcheckapiids=function(){for(var e in this._objects){var t=this._objects[e];t.hasApiid()&&_assert(t==this.getByApiid(t.getApiid()),"lookup failed")}},this.addToCombinedColumns=function(n){t.stateLog("ADDING ACCOUNT TO COMBINED COLS",n);var r=e.clientController.client.getColumnOrder(),i,s={home:!0,me:!0,privateMe:!0},o,u,a,f,l,c=function(e){return e.getKey()};for(var h=0;h<r.length;h++){i=this.get(r[h]);if(!i){t.warn("Warning: Column not found!"),t._break();continue}o=i.getType();if(s[o]){f=null;switch(o){case"me":f=this.getMeFeeds([n]);break;case"privateMe":f=this.getInboxFeeds([n])}f&&(l=_.map(f,c),i.setFeedKeys(i.getFeedKeys().concat(l)),i.managed&&e.feedController.manageFeeds(f))}}};var i=function(t,n){var r=e.feedController;return r.getOrCreateFeed(t,n.getType(),n.getKey(),{})};this.getMeFeeds=function(e){var t=[];for(var n=0;n<e.length;n++)e[n].getType()==="twitter"&&t.push(i("mentions",e[n]));return t},this.getInboxFeeds=function(e){var t=[];for(var n=0;n<e.length;n++)e[n].getType()==="twitter"&&t.push(i("direct",e[n]));return t},this.prePushCheckInvariants=function(n){_.each(n,function(n){_.each(n.getFeedKeys(),function(n){t.assert(e.feedController.get(n),"feeds must exist + be managed in columns push; "+n),t.assert(e.feedController.get(n).hasApiid(),"feeds must all have apiid in columns push; "+n)})})}};return s.prototype=new e.SobjController,s.prototype.pushPreflight=function(){return e.feedController.triggerPush(.05)},e.columnController=new s,s}(TD.storage,TD.sync.util,TD.sync.tdapi,TD.storage.notification,TD.core.defer),TD.storage.AccountController=function(e,t,n,r,i){var s=function(){var s=this;this._moduleName="accounts",this.LAST_VERIFIED_STORAGE_KEY="accounts_last_verified",this.reqsinflight=[],s.ACCEPTED_ACCOUNT_TYPES={twitter:!0,bitly:!0},this._objects={};var o={};s.blacklistAccount=function(n){t.stateLog("blacklisting",n);var i=n.getKey();e.clientController.client.addToAccountBlacklist(i),this._objects[i]&&s.remove(i),e.clientController.client.delFromAccountWhitelist(i),r.notify("/storage/account/blacklisted",n)},s.whitelistAccounts=function(n){t.stateLog("whitelisting",n),e.clientController.client?_.each(n,function(t){e.clientController.client.addToAccountWhitelist(t.getKey()),e.clientController.client.delFromAccountBlacklist(t.getKey())}):t.warn("Can't update whitelist: client not initialised")},s.isEmpty=function(){return _.isEmpty(this._objects)},s.getDefault=function(){var t=e.clientController.client.getDefaultAccount();return t&&this._objects[t]?this._objects[t]:s.isEmpty()?null:(s.setDefault(s.getAll()[0].getKey()),this._objects[e.clientController.client.getDefaultAccount()])},s.setDefault=function(t){e.clientController.client.setDefaultAccount(t)},s.getAccountsForService=function(e){return _.select(this._objects,function(t){return t.getType()===e})},s.getAccountFromUsername=function(e){var t=s.getAccountsForService("twitter");return e=e.toLowerCase(),_.select(t,function(t){return t.getUsername().toLowerCase()===e})},s.getPreferredAccount=function(e){var t=s.getDefault();return t&&(!e||t.getType()==e)?t:s.getAccountsForService(e)[0]},this.init=function(){t.trace("accountController init"),jQuery.subscribe("/storage/client/change",function(e){_.each(e.getAccountBlacklist(),function(e){s._objects[e]&&s.remove(e)})})},this.reset=function(){this._objects={}},this.triggerPush=function(){t.assert(!1,"triggerPush() should not be called on account controller")};var u=function(n,r){var i=t.list_to_set(r.settings.account_whitelist||[]),u=t.list_to_set(r.settings.account_blacklist||[]),a={},f=n||[],l=[],c=[];return _.each(f,function(t){var n=e.Account.generateKeyFor(t.service,t.uid);if(u[n])return;if(i[n]){if(!s.ACCEPTED_ACCOUNT_TYPES[t.service])return;a[t.service]=!0,l.push(t)}else{if(!s.ACCEPTED_ACCOUNT_TYPES[t.service])return;if(t.uid==1e3)return;if(t.service!=="bitly"&&(!t.key||!t.secret))return;if(t.service==="bitly"&&!t.key)return;c.push(t)}}),_.each(s.getAll(),function(e){u[e.getKey()]||(a[e.getType()]=!0)}),c.sort(s.accountComparator),c=_.select(c,function(t){var n=e.Account.generateKeyFor(t.service,t.uid);if(t.service==="twitter"||!a[t.service]){a[t.service]=!0;if(!s._objects[n])return!0}return!1}),o=_.map(c,function(t){return e.Account.newFromBackendState(t)}),l};this.updateFromBackend=function(n,r){t.stateLog("accountController.updateFromBackend:",n),n=u(n,r);var i=this;_.each(n,function(n){var r=e.Account.generateKeyFor(n.service,n.uid),s=i._objects[r];s?(t.stateLog("updating existing",s,"with",n),s.newRemoteState(n)):(t.stateLog("creating new Account with",n),s=e.Account.newFromBackendState(n),i.manage(s))})},this.get=function(e){return e==="tweetdeck"?{getKey:function(){return"tweetdeck"},getUserID:function(){return"tweetdeck"},getType:function(){return"tweetdeck"}}:this._objects[e]},this.manage=function(e){if(!e.getKey())throw{name:"TypeError",message:"account must have its .key set"};return e.managed=!0,this._objects[e.getKey()]||r.notify("/storage/account/new",e),this._objects[e.getKey()]=e,this.whitelistAccounts([e]),this.saveLastVerifiedTimestamp(e),this.pushAccount(e)},this.getLastVerifiedTimestamp=function(t){var n=e.store.get(this.LAST_VERIFIED_STORAGE_KEY),r=n[t.getKey()]||0,i=t.getUpdated()||0;return Math.max(r,i)},this.saveLastVerifiedTimestamp=function(t){var n=e.store.get(this.LAST_VERIFIED_STORAGE_KEY),r=n[t.getKey()]||0,i=t.getUpdated()||0,s=Math.max(r,i);s!==r&&(n[t.getKey()]=s,e.store.set(this.LAST_VERIFIED_STORAGE_KEY,n))},this.removeLastVerifiedTimestamp=function(t){var n=e.store.get(this.LAST_VERIFIED_STORAGE_KEY);delete n[t.getKey()],e.store.set(this.LAST_VERIFIED_STORAGE_KEY,n)},s.remove=function(e){var t=this._objects[e];t.managed=!1,delete this._objects[e],r.notify("/storage/account/removed",t),this.removeLastVerifiedTimestamp(t)},s.getAll=function(){var e=_.values(this._objects);return e.sort(s.accountComparator),e},s.getPostingAccounts=function(){return _.filter(s.getAll(),function(e){return e.getType()!=="bitly"})},s.accountComparator=function(e,t){var n=e.getType?e.getType():e.service,r=t.getType?t.getType():t.service,i=e.getUserID?e.getUserID():e.uid,s=t.getUserID?t.getUserID():t.uid,o=n=="twitter"?2:1,u=r=="twitter"?2:1;return o<u?1:o>u?-1:o==2&&u==2?i>s?1:-1:n>r?1:-1},s.getDefaults=function(){var e=s.getAll(),t=s.getDefault(),n=[],r={};t&&(r[t.getType()]=!0,n.push(t));for(var i=0;i<e.length;i++)r[e[i].getType()]||(r[e[i].getType()]=!0,n.push(e[i]));return n},s.loginTweetdeck=function(e,r,i){t.stateLog("aC.loginTweetdeck()",e,r,i),r!==null&&(i=TD.core.sha1(r));var s=n.login(e,i);return s.addCallback(function(t){return{tweetdeck_account:{email:e,password:i,plaintext_password:r},data:t}}),s},s.createTweetdeckAccount=function(e,r){t.stateLog("aC.createTweetdeckAccount()",e,r);var i=TD.core.sha1(r),s=n.createAccount(e,i);return s.addErrback(t.errmark,"accountController.js:createTweetDeckAccount():->tdapi.createAccount()"),s.addCallback(function(){return{tweetdeck_account:{email:e,password:i,plaintext_password:r},data:{accounts:[]}}}),s.addErrback(t.errmark,"accountController.js:createTweetDeckAccount()"),s},s.pushAccounts=function(){return i.gatherResults(_.map(this._objects,function(e){return s.pushAccount(e)}))},s.pushAccount=function(e){if(!n.isLoggedIn())return;var t=e.getKey();if(!t||!this._objects[t])return;var r=e.getStateForBackend(),i="/accounts/"+e.getType()+"/"+e.getUserID();return n.requestWithBody(i,"POST",r)},s.deleteAccount=function(e){t.stateLog("sync.controller.deleteAccount:",e);var r="/accounts/"+e.getType()+"/"+e.getUserID();return n.drequest(r,n.getReq({method:"DELETE"}))},s.verifyStoredAccounts=function(){var e=!0,t=!1,n=[],r=Date.now()-TD.constants.time.oneDay,u=s.getAll(),a=function(e,t){var n=TD.controller.auth.create(e.getType(),e),r=new i.Deferred;return n.verifyAccount(_.bind(r.callback,r),_.bind(r.errback,r)),t&&r.addErrback(function(){}),r.addCallback(function(){TD.storage.accountController.manage(e)}),r};return _.each(u,function(e){(t||this.getLastVerifiedTimestamp(e)<r||!e.getProfileImageURL()||!e.getUsername()||!e.getName())&&n.push(a(e,!0))}.bind(this)),e&&(_.each(o,function(e){if(!s.ACCEPTED_ACCOUNT_TYPES[e.getType()])return;n.push(a(e,!1))}),o=[]),new i.DeferredList(n)}};return s.prototype=new e.SobjController,e.accountController=new s,s}(TD.storage,TD.sync.util,TD.sync.tdapi,TD.storage.notification,TD.core.defer),TD.storage.ClientController=function(e,t,n,r,i,s,o){var u=function(){var n=this;this.apiEndpoint="/clients",_.defer(function(){var r=t.makeThingScheduler,i=e.store.getTweetdeckAccount;n.triggerPush=r(_.bind(n.pushIfDirty,n),null,"clisync",i)}),this._moduleName="clients",this.reqsinflight=[],this._objects={},this._objectsByApiid=this._objects,this.client=null,this.toString=function(){return"<ClientController>"},this.init=function(){t.stateLog("client controller init start",this.client),t.trace("clientController init"),TD.config.sync_name in this._objects?(this.client=this._objects[TD.config.sync_name],t.assert(this.client.getName(),"need name!"),t.stateLog("client controller new client:",this.client)):t.stateLog("no initial client state; deferring client creation"),t.stateLog("clientController.init: client: ",this.client)},this.reset=function(){this.client=null},this.createNewClient=function(){t.stateLog("clientController.createNewClient()");var n=this,i={name:TD.config.sync_name,columns:[],settings:{}},s={},o=r.requestWithBody("/clients","POST",i,s);return o.addCallback(function(){t.stateLog("createNewClient resp headers; ",s);var r=s["x-td-mtime"];return t.assert(r,"require x-td-mtime header in client POST"),i.mtime=r,n.client=e.Client.newFromBackendState(i),t.assert(n.client.getName(),"Client should have name at this point"),n._objects[n.client.getName()]=n.client,t.stateLog("clientController.createNewClient with",n.client.state),n.triggerPush()}),o},this.updateFromBackend=function(n){this.client===null?(this.client=e.Client.newFromBackendState(n),this._objects[this.client.getName()]=this.client,t.stateLog("client controller (ufb) new client:",this.client)):this.client.newRemoteState(n)},this.pushIfDirty=function(){TD.config.debug_checks&&this.checkInvariants(),o.push(this,"dirty",null);if(this.client.isDirty()){o.push(this,"dirty",this.client);var n=this,r=e.columnController.triggerPush();return r.addCallback(function(){return t.assert(n.client.isDirty(),"?!? push dirty, but not dirty"),n.pushObject(n.client,"/clients/"+n.client.getName())}),r.addCallback(function(){return n.pushIfDirty()}),r}return o.push(this,"not dirty",null),s.succeed()}};return u.prototype=new e.SobjController,e.clientController=new u,u}(TD.storage,TD.sync.util,TD.util,TD.sync.tdapi,TD.storage.notification,TD.core.defer,TD.sync.trace),TD.storage.Feed=function(e,t,n,r){var i=function(e,t){this._init(e),_.isUndefined(t)||(this.state=this.transformToLocal(t)),this.setKey(i.generateKeyFor(this.getAccountKey(),this.getType(),this.getMetadata()))};return i.prototype=new e.StoredObj(e.feedController),i.prototype.eventname="/storage/feed",i.generateKeyFor=function(e,n,r){r=r||{};var i=TD.util.deterministicObjectHash(r),s=[e,n,i];return t.assert(e,"accountkey not set in Feed.generateKey"),t.assert(n,"type not set in Feed.generateKey"),encodeURI(s.join(":"))},i.prototype.getType=function(){return this.get("type")},i.prototype.setType=function(e){return this.immutableSet("type",e)},i.prototype.getService=function(){return this.get("service")},i.prototype.setService=function(e){return this.immutableSet("service",e)},i.prototype.getAccountKey=function(){return this.get("accountkey")},i.prototype.setAccountKey=function(e){return this.immutableSet("accountkey",e)},i.prototype.getLatestTime=function(){var e=this.get("marks");if(!e||_.isEmpty(e))return 0;var t=e[0];return t.last_notification||0},i.prototype.setLatestTime=function(e){var t=this.get("marks");return!t||_.isEmpty(t)?this.set("marks",[{last_notification:e}]):(t[0].last_notification=e,this.set("marks",t))},i.prototype.getMetadata=function(){return _.clone(this.get("metadata"))},i.prototype.setMetadata=function(e){return this.immutableSet("metadata",e)},i.prototype.transformForRemote=function(n,r){var i=e.accountController.get(n.accountkey);t.assert(i&&i.getUserID(),"must have acct + uid for feed transform");var s=i.getUserID(),o={type:n.type,service:n.service,account:{userid:s.toString()},metadata:JSON.stringify(n.metadata),marks:n.marks};return n.mtime&&(o.mtime=n.mtime),r.apiid&&(o.id=r.apiid),o},i.prototype.reprocessNotificationMarks=function(e,t){var n=null,r=null;t&&t.marks&&!_.isEmpty(t.marks)&&(n=t.marks[0].last_notification,r=t.marks);if(e.marks&&!_.isEmpty(e.marks)){r=e.marks;var i=e.marks[0].last_notification;n&&i?n=Math.max(n,i):i&&(n=i)}return r?r[0].last_notification=n:n?r=[{last_notification:n}]:r=[],r},i.prototype.transformToLocal=function(t){var n={type:t.type,service:t.service,accountkey:e.Account.generateKeyFor(t.service,t.account.userid),metadata:JSON.parse(t.metadata),mtime:t.mtime,marks:t.marks};return n},i.newFromBackendState=function(e){return new i(null,e)},i}(TD.storage,TD.sync.util,TD.sync.tdapi,TD.util),TD.storage.Column=function(e,t,n,r,i){var s=function(e){this._init(e),this.privateState.key||(this.privateState.key="c"+(new Date).getTime()+_.uniqueId("s"))};s.prototype=new e.StoredObj(e.columnController),s.prototype.eventname="/storage/column",s.prototype.getTitle=function(){var e=this.get("title");return _.isUndefined(e)?"loadingâ¦":e},s.prototype.setTitle=function(e){return this.set("title",e)},s.prototype.getDescription=function(){return this.get("description")},s.prototype.setDescription=function(e){return this.set("description",e)},s.prototype.getType=function(){return this.get("type")},s.prototype.setType=function(e){return this.set("type",e)},s.prototype.getFilters=function(){return this.get("filters")},s.prototype.setFilters=function(e){return this.setValueIffDifferent("filters",e)},s.prototype.getHasSound=function(){var e=this.get("settings");return Boolean(e&&e.has_sound)},s.prototype.setHasSound=function(e){return e=Boolean(e),i.notify("/storage/column/column_flags_changed","has_sound",e,this),this.dictSet("settings","has_sound",e)},s.prototype.getHasNotification=function(){var e=this.get("settings");return Boolean(e&&e.has_notification)},s.prototype.setHasNotification=function(e){return e=Boolean(e),i.notify("/storage/column/column_flags_changed","has_notification",e,this),this.dictSet("settings","has_notification",e)},s.prototype.getMediaPreviewSize=function(){var e=this.get("settings");return e?e.media_preview_size:null},s.prototype.setMediaPreviewSize=function(e){return $(document).trigger("dataColumnSettings",{columnKey:this.getKey(),mediaPreviewSize:e}),this.dictSet("settings","media_preview_size",e)},s.prototype.getClearedTimestamp=function(){var e=this.get("settings");return e&&e.cleared_timestamp?e.cleared_timestamp:0},s.prototype.setClearedTimestamp=function(e){return i.notify("/storage/column/column_marks_changed","cleared_timestamp",e,this),this.dictSet("settings","cleared_timestamp",e)},s.prototype.getFeedKeys=function(){return this.get("feedkeys")},s.prototype.setFeedKeys=function(e){return this.setValueIffDifferent("feedkeys",_.isArray(e)?_.uniq(e.sort(),!0):e,"/storage/column/feeds_changed")};var o=["mtime","type","title","description","settings","position","bookmarks","filters"];return s.prototype.transformForRemote=function(n,r){var i=function(n){var r=e.feedController.get(n);return t.assert(r&&r.hasApiid(),"feeds must have apiid when transforming column for remote"),r.getApiid()},s={};return _.each(o,function(e){s[e]=n[e]}),s.feeds=_.map(n.feedkeys,i),n.mtime&&(s.mtime=n.mtime),r.apiid&&(s.id=r.apiid),s},s.prototype.transformToLocal=function(n){TD.config.debug_checks&&_.each(n.feeds,function(r){t.assert(e.feedController.getByApiid(r),"feed not found by apiid in "+t.pformat(n.feeds))});var r={};return _.each(o,function(e){r[e]=n[e]}),r.feedkeys=_.map(n.feeds,function(t){return e.feedController.getByApiid(t).getKey()}),r.apiid=n.id,r},s.newFromBackendState=function(e){var t=new s;return t.newRemoteState(e),t},s}(TD.storage,TD.sync.util,TD.sync.tdapi,TD.util,TD.storage.notification),TD.storage.Account=function(e,t,n,r,i){var s={oauth_token:"t",token_secret:"s"},o=function(n){n?(this.state=_.clone(n),this.privateState={}):(this.state={},this.privateState={});var r=this,i=function(){r.controller.pushAccount(r)},s=e.store.getTweetdeckAccount;this.triggerPush=t.makeThingScheduler(i,null,"account",s,.2)};o.prototype=new e.StoredObj(e.accountController),o.prototype.eventname="/storage/account",o.generateKeyFor=function(e,t){return e==="tweetdeck"?"tweetdeck":encodeURI(e+":"+t)},o.prototype.computeKey=function(){if(!this.getType()||!this.getUserID())throw{name:"NotReadyError",message:"cannot computeKey on account; insufficient data"};this.setKey(o.generateKeyFor(this.getType(),this.getUserID()))},o.prototype.set=function(e,t){return this.state[e]=t,n.notify(this.eventname+"/change",this),this.triggerPush()},o.prototype.checkInvariants=function(){t.assert(_.isEmpty(this.deltaQ),"Accounts must not have Îs"),t.assert(this.stateCache===null,"Accounts do not use stateCache")},o.prototype.getUsername=function(){return this.get("username")},o.prototype.setUsername=function(e){return this.set("username",e)},o.prototype.getName=function(){return this.get("name")},o.prototype.setName=function(e){return this.set("name",e)},o.prototype.getUserID=function(){return this.get("userId")},o.prototype.setUserID=function(e){return this.set("userId",e)},o.prototype.getType=function(){return this.get("type")},o.prototype.setType=function(e){return this.set("type",e)},o.prototype.getOAuthToken=function(){return this.get("oauth_token")},o.prototype.setOAuthToken=function(e){return this.set("oauth_token",e)},o.prototype.getTokenSecret=function(){return this.get("token_secret")},o.prototype.setTokenSecret=function(e){return this.set("token_secret",e)},o.prototype.getProfileImageURL=function(){return this.get("profileImageURL")},o.prototype.setProfileImageURL=function(e){return this.set("profileImageURL",e)},o.prototype.getIsPrivate=function(){return this.getPrivate("isPrivate")},o.prototype.setIsPrivate=function(e){return this.setPrivate("isPrivate",e)},o.prototype.getUpdated=function(){return this.getPrivate("updated")},o.prototype.setUpdated=function(e){return this.setPrivate("updated",e)},o.prototype.getStateForBackend=function(){var e={secret:this.getTokenSecret(),screen_name:this.getUsername(),name:this.getName(),avatar:this.getProfileImageURL(),key:this.getOAuthToken()};return e};var u={key:"oauth_token",token:"oauth_token",secret:"token_secret",screen_name:"username",service:"type",uid:"userId",avatar:"profileImageURL",name:"name"};return o.prototype.newRemoteState=function(e){var n=this;t.stateLog(this,".updateFromBackend(",e,")"),_.each(u,function(t,r){e[r]&&n.set(t,e[r])})},o.newFromBackendState=function(e){var t=new o;return t.newRemoteState(e),t.computeKey(),t},o.prototype.isSameUser=function(e){return this.getUsername().toLowerCase()===e.toLowerCase()},o}(TD.storage,TD.sync.util,TD.storage.notification,TD.util,TD.core.base64),TD.storage.Client=function(e,t,n,r,i,s,o){var u=10,a=function(e){t.trace("Client constructor:"),t.stateLog("Client constructor: ",e);var n=e&&e.column_order;n&&!_.isEqual(n,_.union(n))&&(t.warn("WARNING! removing duplicates in column_order",_.clone(n)),e.column_order=_.union(n)),t.assert(!e||!e.columns,'"columns" should not be in local client state'),this._init(e),this.managed=!0,TD.config.debug_checks&&this.checkInvariants()};a.prototype=new e.StoredObj(e.clientController),a.prototype.eventname="/storage/client",a.prototype.recent_searches_limit=u,a.prototype.getName=function(){return this.get("name")},a.prototype.getApiid=function(){return this.get("name")},a.prototype.hasApiid=function(){return!0},a.prototype.getColumnOrder=function(){return _.clone(this.get("column_order")||[])},a.prototype.setColumnOrder=function(e){_.each(e,function(e){t.precondition(typeof e=="string","must provide string column keys")});var n=this.get("column_order");if(!_.isEqual(e,_.union(e)))throw t.warn("ERROR: column_order contains duplicates:",e),new Error("column_order must not contain duplicates");return i.notify("/storage/client/column_order_changed"),this.setListPermutation("column_order",e)},a.prototype.removeColumn=function(e){return i.notify("/storage/client/column_order_changed"),this.listRemove("column_order",e)},a.prototype.appendColumn=function(e){return i.notify("/storage/client/column_order_changed"),this.listAppend("column_order",e)},a.prototype.getAccountBlacklist=function(){return _.clone(this.get("account_blacklist")||[])},a.prototype.addToAccountBlacklist=function(t){var n=this.get("account_blacklist")||[];if(_.include(n,t))return s.succeed(null);var r=this.listAppend("account_blacklist",t);return i.notify("/storage/client/account_blacklist_changed",n,this.get("account_blacklist"),this),e.accountController.remove(t),r},a.prototype.delFromAccountWhitelist=function(e){var t=this.get("account_whitelist")||[];if(!_.include(t,e))return s.succeed(null);var n=this.listRemove("account_whitelist",e);return i.notify("/storage/client/account_whitelist_changed",t,this.get("account_whitelist"),this),n},a.prototype.addToAccountWhitelist=function(e){var t=this.get("account_whitelist")||[];if(_.include(t,e))return s.succeed(null);var n=this.listAppend("account_whitelist",e);return i.notify("/storage/client/account_whitelist_changed",t,this.get("account_whitelist"),this),n},a.prototype.delFromAccountBlacklist=function(e){var t=this.get("account_blacklist")||[];if(!_.include(t,e))return s.succeed(null);var n=this.listRemove("account_blacklist",e);return i.notify("/storage/client/account_blacklist_changed",t,this.get("account_blacklist"),this),n},a.prototype.getAccountWhitelist=function(){return _.clone(this.get("account_whitelist"))},a.prototype.getDefaultAccount=function(){return this.get("default_account")},a.prototype.addRecentSearch=function(e){return s.gatherResults([this.listRemove("recent_searches",e),this.listPrepend("recent_searches",e),this.listTruncate("recent_searches",this.recent_searches_limit)])},a.prototype.getRecentSearches=function(){return this.get("recent_searches")||[]},a.prototype.clearRecentSearches=function(){this.set("recent_searches",[])},a.prototype.postProcessNewRemoteState=function(){var e=this.getColumnOrder(),n=_.union(e);_.isEqual(n,e)||(t.warn("WARNING! found duplicates in column order, collapsing",e),this.state.column_order=n)},a.prototype.setDefaultAccount=function(e){return t.assert(!_.isUndefined(e),"huh? you wanted to do what now?"),this.setValueIffDifferent("default_account",e,"/storage/client/default_account_changed")};var f=["account_blacklist","account_whitelist","default_account","settings","recent_searches"];return a.prototype.transformForRemote=function(n,r){t.stateLog("Client.transformToLocal L",n);var i={};_.each(f,function(e){n[e]&&(i[e]=n[e])});var s={settings:i,name:n.name};return s.columns=_.map(n.column_order||[],function(n){var r=e.columnController.get(n);return t.assert(r.hasApiid(),"Column "+n+" does not have apiid",r),r.getApiid()}),n.mtime&&(s.mtime=n.mtime),t.stateLog("Client.transformToLocal R",s),s},a.prototype.transformToLocal=function(n){t.stateLog("Client.transformToLocal R",n);var r={},i=!1;r.column_order=_.filter(_.map(n.columns,function(r){if(!r)return t.warn("WARNING: bogus data in rstate.columns!",t.pformat(n.columns)),null;var s=e.columnController.getByApiid(r);return s||(t.stateLog("allocating new empty local sColumn for",r),s=new e.Column,s.setApiid(r),e.columnController.manage(s),i=!0),s.getKey()}),Boolean),i&&TD.sync.controller.ueberpull();var s=n.settings||{};return _.each(f,function(e){s[e]&&(r[e]=s[e])}),r.mtime=n.mtime,r.name=n.name,t.stateLog("Client.transformToLocal L",r),r},a.prototype.setApiid=function(e){t.assert(!1,"no-one should ever set apiid on Client")},a.newFromBackendState=function(e){var t=new a;return t.newRemoteState(e),t},a}(TD.storage,TD.sync.util,TD.sync.tdapi,TD.util,TD.storage.notification,TD.core.defer,TD.sync.trace),TD.settings=function(e,t){function N(e,n){return t.notify(i+e,n),_.isEqual(n,C(e))?TD.core.defer.succeed():(T.indexOf(e)===-1&&(_.isString(n)||_.isBoolean(n)||_.isNumber(n))&&TD.controller.stats.setting(e,n),s.dictSet("settings",e,n))}function C(e){var t=s.get("settings"),n=void 0;t&&(n=t[e]),_.isUndefined(n)&&(n=r[e]);if(_.isArray(n)||_.isObject(n))n=TD.sync.util.clone(n);return n}var n={},r={},i="/storage/client/settings/",s,o="use_stream",u="use_notification_sound",a="language",f="check_for_updates",l="show_inline_media",c="use_narrow_columns",h="column_width",p="font_size",d="theme",v="scheduled_col_autoadded",m="link_shortener",g="use_jmp",y="global_filter",b="previous_splash_version",w="show_startup_notifications",E="name_cache",S="seen_message_ids",x="navbar_width",T=[b];return n.linkShorteners=[{id:"twitter",title:"Twitter"},{id:"bitly",title:"Bit.ly"}],n.init=function(){s=e.clientController.client},r[o]=!0,n.getUseStream=function(){return Boolean(C(o))},n.setUseStream=function(e){return N(o,Boolean(e))},r[u]=!0,n.getUseNotificationSound=function(){return Boolean(C(u))},n.setUseNotificationSound=function(e){return N(u,Boolean(e))},n.getLanguage=function(){return String(C(a))},n.setLanguage=function(e){return N(a,String(e))},r[f]=!0,n.getCheckForUpdates=function(){return Boolean(C(f))},n.setCheckForUpdates=function(e){return N(f,Boolean(e))},r[l]=!0,n.getShowInlineMedia=function(){return Boolean(C(l))},n.setShowInlineMedia=function(e){return N(l,Boolean(e))},r[c]=!1,r[h]="medium",n.getColumnWidth=function(){var e=C(c);if(_.isBoolean(e)){N(c,null);if(e)return n.setColumnWidth("narrow"),"narrow"}return C(h)},n.setColumnWidth=function(e){return N(h,e)},r[p]="medium",n.getFontSize=function(){return C(p)},n.setFontSize=function(e){return N(p,e)},r[d]="light",n.getTheme=function(){return C(d)},n.setTheme=function(e){return N(d,String(e))},r[m]="twitter",n.getLinkShortener=function(){return String(C(m))},n.setLinkShortener=function(e){return N(m,String(e))},r[g]=!1,n.getUseJmp=function(){return Boolean(C(g))},n.setUseJmp=function(e){return N(g,Boolean(e))},n.getGlobalFilter=function(){return C(y)},n.setGlobalFilter=function(e){return N(y,e)},r[w]=!0,n.getShowStartupNotifications=function(){return Boolean(C(w))},n.setShowStartupNotifications=function(e){return N(w,Boolean(e))},r[v]=!1,n.getScheduledColAdded=function(){return Boolean(C(v))},n.setScheduledColAdded=function(e){return N(v,Boolean(e))},r[b]="0",n.getPreviousSplashVersion=function(){return C(b)},n.setPreviousSplashVersion=function(e){return N(b,String(e))},r[E]={users:{},lists:{}},n.getNameCache=function(){return C(E)},n.setNameCache=function(e){return N(E,e)},r[S]=[],n.getIdsForSeenMessages=function(){return C(S)},n.setIdsForSeenMessages=function(e){return N(S,e)},r[x]="condensed",n.getNavbarWidth=function(){return C(x)},n.setNavbarWidth=function(e){return N(x,e)},n}(TD.storage,TD.storage.notification),TD.storage.upgrade=function(e,t,n,r){var i={};return i.CURRENT_VERSION=4,i.getVersion=function(e){var t=e.getItem("__version__");return t===null?i.guessVersion(e):Number(t)},i.guessVersion=function(e){var t=e.getItem("settings"),n=e.getItem("clients"),r=e.getItem("columns");if(n&&!t){n=JSON.parse(n);if(!_.isEmpty(n)){var i=_.values(n)[0];if("ÎQ"in i)return 2}}return!n&&t&&r?0:null},i.doUpgrade=function(e){fromVersion=i.getVersion(e),(!fromVersion||fromVersion<4)&&i._upgradeAllToV4(e)},i._upgradeAllToV4=function(t){console.log("Upgrading store to v4"),TD.storage.storeUtils.flushDataFromStore(t,TD.sync.controller.PERSISTENT_STORAGE_ITEMS),e.store.recordVersion(4,t)},i}(TD.storage,TD.config,TD.sync.util,TD.core.defer),TD.sync.controller=function(e,t,n){var r={};return r.PERSISTENT_STORAGE_ITEMS=["tweetdeck_account","_session","__hasAlreadyReloaded","hoard"],r.debugFlushAndReload=function(){TD.storage.storeUtils.clearWebstorage(),TD.util.isWrapperApp()&&deck.tearDown(),window.location.reload()},r.flushSyncDataAndReload=function(){TD.storage.storeUtils.setReloadedFlag(),TD.storage.storeUtils.clearWebstorage(r.PERSISTENT_STORAGE_ITEMS),TD.util.isWrapperApp()&&deck.tearDown(),window.location.reload()},r.debugInstallOldChromeData=function(){TD.storage.storeUtils.clearWebstorage();var e=/^[a-zA-Z0-9\+\/=]*$/,t=TD.debug.spoof_data;t.match(e)&&(t=TD.core.base64.decode(t));var n=JSON.parse(t);_.each(n,function(e,t){localStorage.setItem(t,e)})},r.debugQueryRemote=function(t,n){var i=r.fetchAllBackendData();return i.addCallback(e.pprint),i},r.fetchAllBackendData=function(){var r=t.drequest("/accounts"),i=TD.storage.clientController,s=i.client&&i.client.getName()||TD.config.sync_name,o="/clients/"+s+"/all",u=t.drequest(o),a=!1;u.addErrback(function(n){if(n.number==404){e.stateLog("Controller.fetchAllBackendData(): client didn't exist!");var r=i.createNewClient();return r.addCallback(function(){return a=!0,t.drequest(o)}),r}return n});var f=new n.gatherResults([r,u]);return f.addCallback(function(e){var t;return t=e[1],t.accounts=e[0],t.isNewClient=a,t}),f},r.ueberpull=function(){e.trace("Ã¼berpull");var t=n.succeed();return t.addCallback(function(){return TD.storage.columnController.triggerPush(.05)}),t.addErrback(e.errmark,"d.Eb:triggerPush"),t.addCallback(function(){return r.fetchAllBackendData()}),t.addErrback(e.errmark,"d.Eb:fetchAllBackendData"),t.addCallback(function(e){TD.storage.accountController.updateFromBackend(e.accounts,e.client),TD.storage.feedController.updateFromBackend(e.feeds),TD.storage.columnController.updateFromBackend(e.columns),TD.storage.clientController.updateFromBackend(e.client),TD.decider.updateFromBackend(e.decider),$(document).trigger("dataMessages",{messages:e.messages})}),t.addErrback(e.errmark,"d.Eb:sync.controller.updateFromBackend"),t},r.initFromTdLogin=function(t){var i=n.succeed(t),s=!1;return i.addCallback(r.init),i.addErrback(function(t){return e.warn("WARNING! sync.controller.init() failed",t),t}),i.addCallback(r.fetchAllBackendData),i.addErrback(function(t){return e.warn("WARNING! sync.controller get all sunc data failed",t),t}),i.addCallback(function(e){TD.storage.accountController.updateFromBackend(e.accounts,e.client),TD.storage.feedController.updateFromBackend(e.feeds),TD.storage.columnController.updateFromBackend(e.columns),TD.storage.clientController.updateFromBackend(e.client),TD.decider.updateFromBackend(e.decider),s=e.isNewClient}),i.addErrback(function(t){return e.warn("WARNING! sync.controller update all failed",t),t}),i.addCallback(function(e){return{isNewClient:s}}),i},r.debuggery=function(){jQuery.subscribe("/storage/object/change",function(){e.warn("ERROR; untyped StoredObj change notification",_.toArray(arguments)),e._break()})},r.checkInvariants=function(){var e=[TD.storage.feedController,TD.storage.columnController,TD.storage.accountController,TD.storage.clientController];_.each(e,function(e){var t=e.checkInvariants;t&&t.call(e)})},r.init=function(t){e.trace("sync controller init"),r.store=t,r.debuggery(),TD.storage.feedController.init(t),TD.storage.columnController.init(t),TD.storage.accountController.init(t),TD.storage.clientController.init(t);var n=TD.config.sync_period;_.isUndefined(n)&&(n=600),r.loop=setInterval(r.ueberpull,n*1e3)},r.reset=function(){r.loop&&(clearInterval(r.loop),delete r.loop),TD.storage.columnController.reset(),TD.storage.feedController.reset(),TD.storage.accountController.reset(),TD.storage.clientController.reset()},r}(TD.sync.util,TD.sync.tdapi,TD.core.defer),TD.sync.ui=function(e,t){var n={};return n.dispatch_ui_event=function(n){var r={flushreload:e.debugFlushAndReload,dumptrace:TD.sync.trace.logDump,cleartrace:TD.sync.trace.clear,queryremote:e.debugQueryRemote,ueberpull:e.ueberpull,junk:function(){console.log("junk fondled")}}[n];if(!r)alert('no handler for event "'+n+'"');else{var i;try{i=t.maybeDeferred(r)}catch(s){console.log(s);return}i.addCallback(function(e,t){util.stateLog('result for event "'+t+'": ',e)},n),i.addErrback(function(e,t){util.warn("ERROR for event",t,": ",e),console.log(e.stack)},n)}},n}(TD.sync.controller,TD.core.defer),TD.ui.template=function(){function u(e){var t;try{t=$.ajax(e,{async:!1,isLocal:TD.util.getAppEnv()!=="web"})}catch(n){return null}return t.status!==200?"":_.trim(t.responseText)}function a(s){s=s.replace(t,"/");var o=n[s];return o===undefined&&(o=e.getHogan(s),o=i.compile(o,r),n[s]=o),o}function f(e,t){var n=this.partials[e];return t=t||{},t[n.name]||(t[n.name]=a(n.name)),Hogan.Template.prototype.ep.call(this,e,t)}function l(e,t,n){var r=Hogan.parse.call(this,e,t,n),i="";for(var s=0;s<r.length;s++)if(r[s].tag==="_v"&&r[s].n.indexOf("%TRANSLATION-HINT")===0){var o=r.splice(s,1)[0];s--,i=o.n.substring(o.n.indexOf("mode=")+"mode=".length)}return c(r,i,t,n)}function c(e,t,n,r){var i=[];for(var s=0;s<e.length;s++)if(e[s].tag==="#"&&e[s].n==="_i"){var o=p(n.substring(e[s].i,e[s].end),t);o.tag==="raw"?i.push(o):Array.prototype.push.apply(i,Hogan.parse(Hogan.scan(o,r.delimiters),n,r))}else e[s].tag==="#"||e[s].tag==="^"||e[s].tag==="<"||e[s].tag==="$"?(e[s].nodes=c(e[s].nodes,t,n,r),i.push(e[s])):i.push(e[s]);return h(i)}function h(e){if(e.length===0)return e;var t=[e[0]];for(var n=1;n<e.length;n++)t[t.length-1].tag!=="_t"||e[n].tag!=="\n"&&e[n].tag!=="_t"?t.push(e[n]):t[t.length-1].text+=e[n].text||"\n";return t}function p(e,t){var n;return t!==""?n={text:e,mode:t}:n=e,TD.i(n,null,!0)}var e={},t=/\\/g,n={},r={sectionTags:[{o:"_i",c:"i"}]},i,s,o;return o=function(e,t,n,r){this.ep=f,Hogan.Template.call(this,e,t,n,r)},o.prototype=Hogan.Template.prototype,s=function(){},s.prototype=Hogan,i=new s,i.template=o,i.parse=l,e.getHogan=function(e){var t=TD.mustaches[e+".mustache"];return t===undefined&&(t=u("../mustaches/"+e+".mustache"),t===""&&(t=e),TD.mustaches[e+".mustache"]=t),t},e.render=function(e,t,n){var r=a(e),i=_.clone(TD.globalRenderOptions)||{};return _.extend(i,t),r.render(i,n)},e.toHtml=function(e,t,n){var s=i.compile(e,r);return s.render(t,n)},e}(),TD.ui.startflow=function(e,t,n,r){function C(e){e.preventDefault();var t=$(e.currentTarget),n=t.data("action");switch(n){case"url":var r=window.open(t.attr("href"));r.focus();break;case"signin":L();break;case"showRegister":F(a);break;case"login":F(u);break;case"forgotPassword":k();break;case"resetReload":TD.sync.controller.debugFlushAndReload();break;case"spoofData":TD.sync.controller.debugInstallOldChromeData()}}function k(){if(T)return;var e=$("#tdRegEmail",h).val();if(!e||!e.match(s)){B(TD.i("That doesn't seem to be a valid email address. Remember: TweetDeck accounts are different from Twitter accounts."),[v]);return}var t=new TD.services.TweetDeckClient;T=!0,B(TD.i("Sending password reset instructionsâ¦"),[v],!0);var n=t.forgotPassword(e);n.addCallback(function(){B(TD.i("We have sent an email to {{email}} with instructions to reset your password.",{email:e}),[],!0),T=!1}),n.addErrback(function(t){var n;t&&t.number===403?n=TD.i("We couldn't find a TweetDeck account associated with {{email}}.",{email:e}):n=TD.i("Sorry, something went wrong. It's not you, it's us. Please try again later."),B(n,[v]),T=!1})}function L(){var e=$("#tdRegEmail",h).val(),t=$("#tdRegPassword",h).val(),n=$("#tdRegRememberMe",h)[0].checked;A(e,t,n)}function A(e,t,r){if(e&&t!==""){F(f);var i=n.accountController.loginTweetdeck(e,t);i.addCallbacks(O,M,[r])}else F(u),B(TD.i("Please check your email & password."),[m,v])}function O(e,t){e.stay_signed_in=t,x.callback(e)}function M(e){F(u);var t,n=[],i,s;if(e.req.status===401)i=JSON.parse(e.req.responseText).error,i==TD.constants.TDApi.ERROR_ACCOUNT_DOESNT_EXIST?(s=$("#tdRegEmail",h).val(),t=TD.i("We couldn't find a TweetDeck account associated with: {{{email}}}",{email:s}),n=[v]):i==TD.constants.TDApi.ERROR_BAD_PASSWORD&&(t=TD.i("Please check your password. Remember: TweetDeck accounts are different from Twitter accounts."),n=[m]);else if(e.req.status===0)t=TD.i("Unable to connect. Please check your network.");else try{i=JSON.parse(e.req.responseText).error,t=TD.i("Unable to sign in: {{{1}}}",{1:i})}catch(o){t=TD.i("Sorry, something went wrong. It's not you, it's us. Please try again later."),console.log("An unknown error occurred at sign in"),console.log(e.req.responseText)}r.warn(e.message,e),B(t,n)}function D(){var e=$("#tdRegEmail",h).val(),t=$("#tdRegPassword",h).val(),n=$("#tdRegPasswordConfirm",h).val(),r=$("#tdRegRememberMe",h)[0].checked;if(!e||!e.match(s)){B(TD.i("That doesn't seem to be a valid email address. Remember: TweetDeck accounts are different from Twitter accounts."),[v]);return}if(t!==n){B(TD.i("Passwords must match!"),[m]);return}if(t.length<7){B(TD.i("Your password must be 7 characters or longer."),[m]);return}var i=P(e,t,r);i.addErrback(H),F(f)}function P(e,t,i){var s=n.accountController.loginTweetdeck(e,t);return s.addCallback(O,i),s.addErrback(function(){r.trace("register//login failed//going to try to create account");var s=n.accountController.createTweetdeckAccount(e,t);return s.addCallback(function(e){return e.created_account=!0,e}),s.addCallback(O,i),s}),s}function H(e){var t;F(a),e&&e.number&&e.number===401?t=TD.ui.template.render("text/already_registered"):t=TD.i("Registration unsuccessful. Please check your email & password"),e&&r.warn(e.message,e),B(t,[m,v])}function B(e,t,n){n?p.removeClass(E).addClass(S):p.removeClass(S).addClass(E),e&&(p.html(e),p.show()),t&&_.each(t,function(e){e.addClass("s-error")})}function j(){m.removeClass("s-error"),v.removeClass("s-error"),p.hide()}function F(e){l=e,j();switch(e){case u:b.fadeOut("fast"),$("#tdRegPasswordConfirm").attr("disabled",!0),g.attr("disabled",!1),h.addClass("s-login").removeClass("s-register is-loading");break;case a:b.fadeOut("fast"),$("#tdRegPasswordConfirm").attr("disabled",!1),y.attr("disabled",!1),h.addClass("s-register").removeClass("s-login is-loading");break;case f:b.fadeIn("fast"),g.attr("disabled",!0),y.attr("disabled",!0)}}var i={},s=/^[a-zA-Z0-9_\-\.+]+@[a-zA-Z0-9_\-\.]+\.[a-zA-Z]{2,4}$/,o=-1,u=0,a=1,f=2,l=o,c=null,h=null,p,d,v,m,g,y,b,w="form-error",E="srt-error-msg",S="srt-success-msg",x=null,T;i.doLogin=function(t,n,r){x=new e.Deferred;try{N(t,n),F(u),r&&B(r)}catch(i){var s="Unable to initialise login UI. Please contact your friendly dev team for assistance.";$("body").html(s),console.log("login UI init error:",[i]),TD.util.isChromeApp()&&console.log("stack trace:",[i.stack.split("\n")])}return x};var N=function(e,n){var r={email:e||"",spoofData:Boolean(TD.debug.spoof_data),debugMenu:Boolean(TD.config.debug_menu),version:TD.version,buildIDShort:TD.buildIDShort,appEnv:TD.util.getAppEnv()};TD.util.isWrapperApp()&&deck.getWrapperVersion&&(r.wrapperVersion=deck.getWrapperVersion());var i=t.render("startup/signin",r);$(".js-signin-ui").html(i),TD.util.isWrapperApp()&&deck.closeLoadingScreen&&deck.closeLoadingScreen(),h=$(".js-signin-form"),p=$(".js-start-message",h),v=$(".js-email"),m=$(".js-password"),g=$(".js-signin"),y=$(".js-register"),b=$(".js-loader"),$("#tdRegRememberMe",h)[0].checked=Boolean(n),$("#tdAccountForm").submit(function(e){return l===u?L():D(),e.preventDefault(),!1}),$("a",h).live("click",C),h.live("keypress",function(e){e.keyCode==13&&$("tdAccountForm").submit()})};return i}(TD.core.defer,TD.ui.template,TD.storage,TD.sync.util),TD.net.StreamRequest=function(e,t){var n=function(){console.log((new Date).toUTCString(),">",t.getUsername(),">",arguments)};this.receivedChars=0,this.readChars=0;var r=100,i=this,s,o,u,a,f,l=!1,c=function(e,t){var n=new XMLHttpRequest;return"withCredentials"in n?n.open(e,t,!0):n=null,n},h=function(e){n("Signer HTTP status:",e.xhr.status),e.xhr.status===200&&(u=e.data.headers.Authorization,p())},p=function(){f=c("GET",e);if(!f){g("CORS not supported",0);return}f.setRequestHeader("Authorization",u),f.setRequestHeader("X-User-Agent","TweetDeck Chrome "+TD.version),f.send(),d()},d=function(){v(),f.readyState!==XMLHttpRequest.DONE&&setTimeout(d,r)},v=function(){switch(f.readyState){case XMLHttpRequest.LOADING:var e=f.responseText.lastIndexOf("\r"),t;l||(n("Stream HTTP status:",f.status),l=!0),i.receivedChars=f.responseText.length;if(e>=i.readChars){t=f.responseText.substring(i.readChars,e+1),i.readChars+=t.length;try{m(t)}catch(r){console.log("Callback error:",r)}}break;case XMLHttpRequest.DONE:g("Stream interrupted",f.status)}},m=function(e){s&&s(e)},g=function(e,t){o&&o(e,t)};this.onStreaming={connect:function(e){s=e},disconnect:function(e){s===e&&(s=null)}},this.onFailure={connect:function(e){o=e},disconnect:function(e){o===e&&(o=null)}},this.goStreaming=function(){var n=TD.net.ajax.signRequest(t,e,"GET");n.addCallback(h),n.addErrback(function(e){g("Failed to sign request",0)})},this.deleteLater=function(){n("Closing stream connection"),a&&(a.onreadystatechange=null),f&&(f.onreadystatechange=null,f.abort()),m=null,g=null}},TD.net.util=function(){var e={},t=encodeURIComponent,n=/[!'()]/g,r=/\*/g;return encodeURIComponent=function(e){return t(e).replace(n,escape).replace(r,"%2A")},e.addURLParam=function(t,n,r){var i={};return i[n]=r,e.addURLParameters(t,i)},e.addURLParameters=function(t,n){var r=e.buildQueryString(n),i=t;return r?(t.indexOf("?")===-1?i+="?":i+="&",i+r):t},e.buildQueryString=function(e){var t=[],n;if(e)for(var r in e)n=r+"="+encodeURIComponent(e[r]),t.push(n);return t.join("&")},e.formDecode=function(e){var t=e.split("&"),n={},r,i;for(var s in t)i=t[s].split("="),i.length==2&&(n[decodeURIComponent(i[0])]=decodeURIComponent(i[1]));return n},e.decodeURL=function(t){var n=t.split("?");return n.length>1?e.formDecode(n[1]):{}},e.formEncode=function(e){var t=[];for(var n in e)t.push(n+"="+encodeURIComponent(e[n]));return t.join("&")},e.getQueryStringParams=function(){var e=window.location.href.split("?");if(e.length>=2){var t=e.slice(1).join("?");return this.formDecode(t)}return{}},e}(),TD.controller.init=function(e,t,n,r,i,s,o,u,a){var f={},l=null,c=!1,h=!1,p=2592e3;f.purgedServices=[],f.start=function(t,i){var s=TD.core.defer.succeed(),a=TD.util.getAppEnv(),l;if(a==="chrome"&&chrome.extension.getViews({type:"tab"}).length>1){r.warn("Duplicate Chrome App tab. Aborting init.");return}TD.util.isWrapperApp()&&(TD.util.isUnsupportedWebWrapperVersion()?(deck.closeLoadingScreen&&deck.closeLoadingScreen(),window.location.assign("https://web.tweetdeck.com/web/deprecated.html?appenv="+a)):TD.controller.scheduler.schedulePeriodicTask(p,function(){window.location.reload(!0)}));if(window.location.protocol==="http:"||window.location.protocol==="https:"){var d=window.location.protocol+"//"+window.location.host;d!==TD.config.api_root&&(console.log("NOTE: overwriting api_root of",TD.config.api_root,"with",d),TD.config.api_root=d)}return s.addCallback(function(){var e;return TD.util.getOSName()==="windows"&&$("html").addClass("os-windows"),l=TD.controller.feather.loadFeathers(!1),f.certCheck(),TD.storage.storeUtils.init(),e=TD.storage.storeUtils.getSessionData(),f.doLogin(e,i)}),s.addCallback(function(e){return l.addBoth(function(){return e}),l}),c=!1,s.addCallback(function(e){return c=e.created_account,e}),s.addCallback(v),h=!1,s.addCallback(function(e){return h=e.isNewClient,e}),s.addCallback(e.notification.flush),s.addCallback(m),s.addCallback(function(){return u.gatherResults([e.feedController.triggerPush(.05),e.columnController.triggerPush(.05)])}),s.addCallback(function(){e.store.checkVersion(e.upgrade.CURRENT_VERSION)}),s.addCallback(m),s.addCallback(function(){if(c){var t=e.clientController.client,r=n.upgrade.CURRENT_VERSION;return console.log("freshly created account; no upgrades, recording v",r),t.dictSet("settings","version",r)}return n.upgrade.doUpgrades()}),s.addCallback(function(){return h?e.accountController.verifyStoredAccounts():TD.core.defer.succeed()}),s.addCallback(function(){TD.storage.storeUtils.removeReloadedFlag()}),s.addErrback(function(e){throw TD.storage.storeUtils.hasAlreadyReloaded()||TD.sync.controller.flushSyncDataAndReload(),e}),s.addCallback(w),s.addErrback(function(t){r.warn(t,"controller.init.start failed, restarting",t.message);if(t.stackTrace)try{console.log(t.stackTrace.join("\n"))}catch(n){console.log("Unable to get stackTrace to report error:",n)}return e.store.reset(),o.controller.reset(),f.start(null,t.message)}),s},f.certCheck=function(){var e=TD.config.cert_reminder||TD.config.api_root==="https://smfd-akc-08-sr1.devel.twitter.com:8443";e&&i.isChromeApp()&&jQuery.ajax(TD.config.api_root+"/time").fail(function(){chrome.tabs.create({selected:!0,url:TD.config.api_root+"/time"})})},f.doLogin=function(n,i){r.trace("init.doLogin()");var s=n.email,o=n.passhash,f=n.sessionExists,l=n.staySignedIn,c=null;if(!s)return t.startflow.doLogin(null,l,i);if(i)return t.startflow.doLogin(s,l,i);if(s&&o){var h=function(){return e.accountController.loginTweetdeck(s,null,o)};c=TD.sync.util.autoRetry(h,[5e3,1e4],d),c.addCallback(function(e){return e.stay_signed_in=l,e})}else if(f){var p=function(){return a.drequest("/verify_user",null,null,!0)};c=TD.sync.util.autoRetry(p,[5e3,1e4],d),c.addCallback(function(e){var t={tweetdeck_account:{email:s},stay_signed_in:l};return t})}else c=u.fail(!1);return c.addErrback(function(e){var n;return r.warn("TD login of existing account/session failed",e),d(e)?n=TD.i("Unable to connect. Please check your network."):e.req.status!=401&&(n=TD.i("Sorry, something went wrong. It's not you, it's us. Please try again later.")),t.startflow.doLogin(s,l,n)}),c};var d=function(e){return e.req.status==0||e.req.status==12007},v=function(t){r.trace("init.initFromLogin()"),e.store.init(t.stay_signed_in,t.tweetdeck_account.email),a.saveSession(),a.onAuthFail(f.abort);var n=t.tweetdeck_account;return n.plaintext_password!==null&&(e.store.setTweetdeckAccountAndPassword?e.store.setTweetdeckAccountAndPassword(n.email,n.plaintext_password):e.store.setTweetdeckAccount(n.email)),o.controller.initFromTdLogin(e.store)},m=function(){r.trace("init.purgeDeprecatedAccounts()"),y("buzz"),y("foursquare"),y("facebook"),g(),f.purgedServices.length>0&&TD.controller.stats.purgedServices(f.purgedServices),b(function(e){var t=e.getService()==="twitter"&&e.getType()==="sentdirect";return t&&TD.controller.stats.purgedFeed({service:e.getService(),type:e.getType(),message:"Purged sentdirect feed (no longer supported)"}),t}),b(function(t){var n=_.isUndefined(e.accountController.get(t.getAccountKey()));return n&&TD.controller.stats.purgedFeed({service:t.getService(),type:t.getType(),accountKey:t.getAccountKey(),message:"Purged feed due to bad account key"}),n})},g=function(){e.columnController.getAll().forEach(function(e){if(e.getFeedKeys().length!==1)return;switch(e.getType()){case TD.util.columnUtils.storageColumnTypes.HOME:case TD.util.columnUtils.storageColumnTypes.INBOX:case TD.util.columnUtils.storageColumnTypes.ME:e.setType(TD.util.columnUtils.storageColumnTypes.OTHER);break;default:return}})},y=function(t){var n=e.accountController.getAccountsForService(t);_.isEmpty(n)||(f.purgedServices.push(t),_.each(n,function(t){e.accountController.blacklistAccount(t)})),b(function(e){return e.getService()===t})},b=function(t){var n,r,i,s;n=_.filter(e.feedController.getAll(),t),r=_.map(n,function(t){var n=t.getKey();return e.feedController.remove(n),n}),i=_.filter(e.columnController.getAll(),function(e){var t=_.difference(e.getFeedKeys(),r);return e.setFeedKeys(t),_.isEmpty(t)}),s=_.map(i,function(e){return e.getKey()});if(!_.isEmpty(s)){var o=e.clientController.client;o.setColumnOrder(_.difference(o.getColumnOrder(),s)),_.each(s,function(t){e.columnController.remove(t)})}},w=function(){TD.util.fnPerformanceWrapper(E,null,n.stats.performance.keys.INIT)()},E=function(){r.trace("init.initControllerAndUI()");var i;TD.settings.init(),$(document).trigger("uiNeedsSettings"),n.clients.init(),n.feedManager.init(),n.stats.init(),TD.cache.names.init(),TD.util.getAppEnv()==="web"&&delete TD.services.TwitterMedia.SERVICES.instagram,TD.util.fnPerformanceWrapper(t.main.init,t.main,n.stats.performance.keys.MAIN)(),TD.util.fnPerformanceWrapper(n.columnManager.init,n.columnManager,n.stats.performance.keys.COLUMN_MANAGER)(),TD.util.fnPerformanceWrapper(n.scheduler.init,n.scheduler,n.stats.performance.keys.COLUMN_SCHEDULER)(),TD.util.fnPerformanceWrapper(n.notifications.init,n.notifications,n.stats.performance.keys.NOTIFICATIONS)(),TD.util.fnPerformanceWrapper(n.filterManager.init,n.filterManager.init,n.stats.performance.keys.FILTER_MANAGER)(),e.accountController.isEmpty()?(new TD.components.GlobalSettings,TD.components.NewFeaturesSplash.updateSeenVersion()):TD.components.NewFeaturesSplash.shouldShow()&&new TD.components.NewFeaturesSplash,TD.ready=!0,r.trace("init: TD.ready"),$(document).trigger("TD.ready"),h||setTimeout(function(){var t=e.accountController.verifyStoredAccounts()},2e4),TD.controller.init.purgedServices.indexOf("facebook")!==-1&&$(document).trigger("dataFacebookAccountRemoved",{})};return f.signOut=function(){if(i.isWrapperApp()&&deck.osname()==="osx"){var t=e.store.getTweetdeckAccount();t&&e.store.deleteSecrets([t]);var n=_.map(TD.storage.accountController.getAll(),function(e){return e.getKey()});e.store.deleteSecrets(n)}TD.storage.storeUtils.clearWebstorage();var r=a.logout();return TD.util.isWrapperApp()&&r.addBoth(function(){deck.tearDown()}),r.addBoth(function(){window.location.reload()}),r},f.abort=function(){window.location.reload()},f}(TD.storage,TD.ui,TD.controller,TD.sync.util,TD.util,TD.net.util,TD.sync,TD.core.defer,TD.sync.tdapi),TD.controller.upgrade=function(e,t,n,r){var i={};return i.CURRENT_VERSION=1,i.doUpgrades=function(){var t=null,s=e.clientController.client.get("settings");_.isUndefined(s)||_.isUndefined(s.version)?t=0:t=Number(s.version);var o=function(t,n){return e.clientController.client.dictSet("settings","version",n)},u=r.succeed();for(var a=1;a<=i.CURRENT_VERSION;a++)if(t<a){var f="version_"+a.toString();i.hasOwnProperty(f)&&(console.log("performing upgrade to v",a,f),u.addCallback(i[f]),u.addCallback(o,a))}return u.addErrback(function(e){throw n.warn("WARNING: controller.upgrade failed!!!"),console.log(e),e}),u},i.version_1=function(){e.columnController.getAll().forEach(function(e){var t=TD.storage.feedController.get(e.getFeedKeys()[0]).getType(),n;t===TD.util.columnUtils.feedTypes.MENTIONS&&(n=new TD.vo.SearchFilter(e.getFilters()),n.action.fromJSONObject({showMentions:!0,showRetweets:!1,showFavorites:!1,showFollowers:!1,showLists:!1}),e.setFilters(n.toJSONObject()))})},i}(TD.storage,TD.config,TD.sync.util,TD.core.defer),TD.controller.columnManager=function(e,t,n){var r={},i={},s=[];r.TIMELINE="timeline",r.MENTIONS="mentions",r.FOLLOWERS="followers",r.SEARCH="search",r.LISTS="lists",r.MESSAGES="messages",r.TRENDS="trends",r.TWEETS="tweets",r.FAVORITES="favorites",r.HOME="home",r.ME="me",r.INBOX="privateMe",r.SCHEDULED="scheduled",r.NETWORKACTIVITY="networkactivity",r.INTERACTIONS="interactions",r.columnTypeToIconClass={},TD.util.extendObjectWith(r.columnTypeToIconClass,[[r.TIMELINE,TD.util.columnUtils.columnIconClasses.HOME],[r.INTERACTIONS,TD.util.columnUtils.columnIconClasses.INTERACTIONS],[r.MENTIONS,TD.util.columnUtils.columnIconClasses.MENTIONS],[r.FOLLOWERS,TD.util.columnUtils.columnIconClasses.FOLLOWERS],[r.SEARCH,TD.util.columnUtils.columnIconClasses.SEARCH],[r.LISTS,TD.util.columnUtils.columnIconClasses.LIST],[r.MESSAGES,TD.util.columnUtils.columnIconClasses.MESSAGES],[r.TWEETS,TD.util.columnUtils.columnIconClasses.TWEETS],[r.FAVORITES,TD.util.columnUtils.columnIconClasses.FAVORITES],[r.NETWORKACTIVITY,TD.util.columnUtils.columnIconClasses.ACTIVITY],[r.HOME,TD.util.columnUtils.columnIconClasses.HOME],[r.ME,TD.util.columnUtils.columnIconClasses.MENTIONS],[r.INBOX,TD.util.columnUtils.columnIconClasses.MESSAGES],[r.SCHEDULED,TD.util.columnUtils.columnIconClasses.SCHEDULED],[r.TRENDS,TD.util.columnUtils.columnIconClasses.TRENDS]]),r.SELF_ACCOUNTS_ONLY={},r.SELF_ACCOUNTS_ONLY[r.MESSAGES]=!0,r.SELF_ACCOUNTS_ONLY[r.NETWORKACTIVITY]=!0,r.SELF_ACCOUNTS_ONLY[r.INTERACTIONS]=!0,r.TWITTER_GENERIC={},r.TWITTER_GENERIC[r.TIMELINE]=!0,r.TWITTER_GENERIC[r.MENTIONS]=!0,r.TWITTER_GENERIC[r.FOLLOWERS]=!0,r.TWITTER_GENERIC[r.MESSAGES]=!0,r.TWITTER_GENERIC[r.TWEETS]=!0,r.TWITTER_GENERIC[r.FAVORITES]=!0,r.TWITTER_GENERIC[r.NETWORKACTIVITY]=!0,r.TWITTER_GENERIC[r.INTERACTIONS]=!0,r.SELF_FEED_TYPE={},r.SELF_FEED_TYPE[r.TIMELINE]="home",r.SELF_FEED_TYPE[r.MESSAGES]="direct",r.SELF_FEED_TYPE[r.TWEETS]="usertweets",r.SELF_FEED_TYPE[r.FOLLOWERS]="interactions",r.NON_SELF_FEED_TYPE={},r.NON_SELF_FEED_TYPE[r.TIMELINE]="usertimeline",r.NON_SELF_FEED_TYPE[r.TWEETS]="usertweets",r.NON_SELF_FEED_TYPE[r.MENTIONS]="search",r.MENU_TITLE={},r.MENU_TITLE[r.TIMELINE]=TD.i("Timeline"),r.MENU_TITLE[r.MENTIONS]=TD.i("Mentions"),r.MENU_TITLE[r.FOLLOWERS]=TD.i("Followers"),r.MENU_TITLE[r.SEARCH]=TD.i("Search"),r.MENU_TITLE[r.LISTS]=TD.i("Lists"),r.MENU_TITLE[r.MESSAGES]=TD.i("Messages"),r.MENU_TITLE[r.TRENDS]=TD.i("Trends"),r.MENU_TITLE[r.TWEETS]=TD.i("Tweets"),r.MENU_TITLE[r.FAVORITES]=TD.i("Favorites"),r.MENU_TITLE[r.HOME]=TD.i("Home"),r.MENU_TITLE[r.ME]=TD.i("Me"),r.MENU_TITLE[r.INBOX]=TD.i("Inbox"),r.MENU_TITLE[r.SCHEDULED]=TD.i("Scheduled"),r.MENU_TITLE[r.NETWORKACTIVITY]=TD.i("Activity"),r.MENU_TITLE[r.INTERACTIONS]=TD.i("Interactions"),r.DISPLAY_ORDER=[{type:r.TIMELINE,service:"twitter"},{type:r.INTERACTIONS,service:"twitter"},{type:r.MENTIONS,service:"twitter"},{type:r.FOLLOWERS,service:"twitter"},{type:r.MESSAGES,service:"twitter"},{type:r.SEARCH,service:"twitter"},{type:r.LISTS,service:"twitter"},{type:r.TWEETS,service:"twitter"},{type:r.FAVORITES,service:"twitter"},{type:r.TRENDS,service:"twitter"},{type:r.NETWORKACTIVITY,service:"twitter"}],r.DISPLAY_ORDER_SINGLETONS=[{type:r.ME},{type:r.INBOX},{type:r.SCHEDULED}],r.DISPLAY_ORDER_PROFILE=[{type:r.TWEETS,service:"twitter",profile:!0},{type:r.MENTIONS,service:"twitter",profile:!0},{type:r.LISTS,service:"twitter",profile:!0},{type:r.TIMELINE,service:"twitter",profile:!0},{type:r.FAVORITES,service:"twitter",profile:!0}];var o=r.DISPLAY_ORDER.concat(r.DISPLAY_ORDER_SINGLETONS).concat(r.DISPLAY_ORDER_PROFILE);_.each(o,function(e){e.title=r.MENU_TITLE[e.type],e.columnIconClass=r.columnTypeToIconClass[e.type]}),r.HELP_TEXT={},r.HELP_TEXT[r.TIMELINE]=TD.i("Add a Timeline column for your own accounts, or search for a user and add theirs"),r.HELP_TEXT[r.MENTIONS]=TD.i("Add a Mentions column for your own accounts, or search for a user and add theirs"),r.HELP_TEXT[r.SEARCH]=TD.i("Add a column for a saved or recent Search, or enter a new search in the box"),r.HELP_TEXT[r.LISTS]=TD.i("Create a new list, or select an existing list to edit or add a column"),r.HELP_TEXT[r.MESSAGES]=TD.i("Add a Direct Messages column for your accounts"),r.HELP_TEXT[r.TRENDS]=TD.i("Add a column to monitor Tweets for any Trend"),r.HELP_TEXT[r.TWEETS]=TD.i("Add a column for Tweets sent from your own accounts, or search for a user and add theirs"),r.HELP_TEXT[r.FAVORITES]=TD.i("Add a Favorites column for your own accounts, or search for a user and add theirs"),r.HELP_TEXT[r.INTERACTIONS]=TD.i("Add a column to monitor your mentions, retweets, favourites, follows and list additions in real time"),r.HELP_TEXT[r.NETWORKACTIVITY]=TD.i("Add a column to view favourites, follows and list additions by your friends in real time"),r.STREAMING_FULL="streaming_full",r.STREAMING_NONE="streaming_none",r.STREAMING_PARTIAL="streaming_partial",r.init=function(){u(),r.checkColumns(),$.subscribe("/storage/client/column_order_changed",u),$.subscribe("/storage/client/change",u),$.subscribe("/storage/column/feeds_changed",function(e,t,n){var i=r.get(n.getKey());i&&i.loadFeeds()}),$.subscribe("/storage/column/change",function(e){var n=r.get(e.getKey());if(n){var i=n.model.getFeedKeys(),s=e.getFeedKeys();_.isEqual(i,s)||n.loadFeeds();if(e.managed&&e.hasApiid()){var n=r.getByApiid(e.getApiid());TD.ui.columns.refreshTitle(n)}n.loadFilters()}else t.stateLog("loading new new column",e),u()}),$.subscribe("/cache/names/change",function(){_.each(r.getAll(),function(e){TD.ui.columns.refreshTitle(e)})}),$.subscribe("/storage/account/new",function(e){TD.storage.accountController.getAll().length===1&&r.checkColumns()})},r.checkColumns=function(){var t=TD.storage.accountController.getPreferredAccount("twitter");e.clientController.client.getColumnOrder().length===0&&t&&r.makeDefaultColumns(t)},r.get=function(e){return i[e]},r.getByApiid=function(e){return _.find(i,function(t){return t.model.hasApiid()&&t.model.getApiid()===e?t:null})},r.getAll=function(){return _.clone(i)},r.getAllOrdered=function(){var e=this.getAll(),t=[];for(var n=0;n<s.length;n++)t.push(e[s[n]]);return t},r.add=function(e){i[e.model.getKey()]=e},r.deleteColumn=function(t){var n=i[t];n&&!n.temporary&&TD.controller.stats.removeColumn(n.getColumnType());var r=e.clientController.client.removeColumn(t)},r.removeFromAppLayer=function(t){var n=i[t];n&&n.removeSubscriptions(),delete i[t],e.columnController.remove(t),TD.controller.feedScheduler.removeColumn(t),TD.ui.columns.removeColumn(t)},r.move=function(e,t){var n=s.indexOf(e),i,o=s.concat(),a;if(t==="right")a=Math.min(n+1,s.length-1);else{if(t!=="left")return;a=Math.max(n-1,0)}i=s[a],o[a]=o[n],o[n]=i,TD.storage.clientController.client.setColumnOrder(o),u(),r.showColumn(e)};var u=function(){var t=e.clientController.client.getColumnOrder(),n=!_.isEqual(s,t);n&&a(t),$(document).trigger("dataColumnsLoaded")},a=function(n){var i=_.difference(s,n),o=_.difference(n,s),u=[];_.each(i,function(e){r.removeFromAppLayer(e),TD.ui.columns.removeColumn(e)}),_.each(o,function(i){var s=r.get(i),o;if(!s){o=e.columnController.get(i);if(!o){t.stateLog("WARNING: column not found for",i,"all columns:",e.columnController.getAll(),"in column_order",n);return}s=new TD.vo.Column(o),r.add(s)}u.push(s)}),TD.ui.columns.addColumnsToView(u),TD.ui.columns.reorderColumns(n),s=n,$(document).trigger("dataColumnOrder",{columns:r.getAllOrdered()}),_.each(o,function(e){var t=r.get(e);TD.controller.feedScheduler.addColumn(t,!0)})};return r.addColumnToUI=function(t){var n=t.model.getKey(),i;return t.reset(),r.add(t),e.feedController.manageFeeds(t.getFeeds()),e.columnController.manage(t.model),i=e.clientController.client.appendColumn(n),u(),_.defer(r.showColumn,n),TD.controller.stats.addColumn(t.getColumnType()),i},r.makeColumnFor=function(t,n,i,s,o){var u={},a,f;if(n=="tweetdeck")switch(t){case"me":f=e.columnController.getMeFeeds(e.accountController.getAll()),a=r.makeColumn("me",f);break;case"privateMe":f=e.columnController.getInboxFeeds(e.accountController.getAll()),a=r.makeColumn("privateMe",f);break;case"scheduled":f=[e.feedController.getOrCreateFeed("scheduled","tweetdeck","tweetdeck",{})],a=r.makeColumn("scheduled",f)}else{switch(t){case"usertimeline":case"favorites":case"usertweets":s&&(u.id=parseInt(s,10));break;case"search":var o=new TD.vo.SearchFilter;u.searchFilterData=o.toJSONObject(),u.baseQuery=s;break;case"list":var l=s.split("/");TD.sync.util.assert(l.length===2,"List meta should contain both ownerId and listId",l),u.ownerId=l[0],u.listId=l[1];break;case"group":case"page":u.id=s}a||(a=r.makeOtherColumnAndFeeds(t,n,i,u,o))}return a.model.setTitle(TD.util.htmlToText(a.getTitleHTML())),a},r.makeDefaultColumns=function(e){var t=[];e.getType()==="twitter"&&(t=["home","interactions","direct","networkactivity"]),_.each(t,function(t){var n=r.makeColumnFor(t,e.getType(),e.getKey());r.addColumnToUI(n)})},r.makeColumn=function(t,n,r){var i={type:t,feedkeys:[],settings:{}};if(t==="me"||t==="privateMe")i.settings.has_notification=!0,i.settings.has_sound=!0;r&&(i.filters=r.toJSONObject());var s=new TD.vo.Column(new e.Column(i),n);return s},r.makeOtherColumnAndFeeds=function(t,n,i,s,o){var u=e.feedController,a=[];return a.push(u.getOrCreateFeed(t,n,i,s)),r.makeColumn("other",a,o)},r.showColumn=function(e){$(document).trigger("uiColumnFocus",{columnKey:e})},r.isStreaming=function(e){var t=r.getStreamingState(e);return t!==r.STREAMING_NONE},r.getStreamingState=function(e){var t=r.STREAMING_NONE,n=r.get(e),i=0,s;return n&&(s=n.model.getFeedKeys(),_.each(s,function(e){TD.controller.feedManager.isStreaming(e)&&i++}),i===0?t=r.STREAMING_NONE:i===s.length?t=r.STREAMING_FULL:t=r.STREAMING_PARTIAL),t},r}(TD.storage,TD.sync.util,TD.core.defer),TD.controller.auth=function(){var e={},t={twitter:"TwitterAuth",bitly:"BitlyValidate"};return e.create=function(e,n){return TD.sync.util.assert(t[e],'bad name for auth "'+e+'"'),new TD.controller.auth[t[e]](n)},e}(),TD.controller.auth.AuthorisationProcessor=function(){this.start=function(e,t,n){TD.util.isChromeApp()?this.start_chrome(e,t,n):TD.util.isWrapperApp()?this.start_wrapper(e,t,n):this.start_web(e,t,n)},this.start_wrapper=function(e,t,n){var r=deck.authenticateOn(this.getAuthURL(e,n)),i=this,s=function(n){var s=i.getTokenFromURL(e.getType(),n);s&&(s.access_token?i.updateAccount(s.access_token,t):i.updateAccount(s.oauth_token,s.oauth_token_secret,t),r.hide(),r.deleteLater())};r.loadedUrl.connect(s),r.show()},this.start_web=function(e,t,n){var r=window.open(this.getAuthURL(e,n),"mywindow","width=800,height=450"),i=this,s=function(){var n,o;try{r&&r.location&&r.location.href&&(n=r.location.href)}catch(u){console.log(u)}if(n){o=i.getTokenFromURL(e.getType(),n);if(o){o.access_token?i.updateAccount(o.access_token,t):i.updateAccount(o.oauth_token,o.oauth_token_secret,t),r.close();return}}setTimeout(s,100)};setTimeout(s,500)},this.getAuthURL=function(e,t){var n="oauth",r=e.getType(),i={};if(r==="twitter"){var s=Boolean(t),o=e.getUsername();s&&(i.force_login=s),o&&(i.screen_name=o)}return TD.net.util.addURLParameters(TD.config.api_root+"/"+n+"/authorize/"+r,i)},this.getTokenFromURL=function(e,t){var n,r;if(_.contains(t,"/oauth/success/"+e)||_.contains(t,"/oauth2/success/"+e))r=t.split("?")[1],n=TD.net.util.formDecode(r);return n},this.start_chrome=function(e,t,n){var r=this,i,s;chrome.tabs.getSelected(null,function(e){i=e.id}),s={url:this.getAuthURL(e,n)},chrome.tabs.create(s,function(n){var s=n.id;chrome.tabs.onUpdated.addListener(function(n,o,u){var a,f;n===s&&u.url&&u.status=="complete"&&(f=r.getTokenFromURL(e.getType(),u.url),f&&(f.access_token?r.updateAccount(f.access_token,t):r.updateAccount(f.oauth_token,f.oauth_token_secret,t),chrome.tabs.update(i,{selected:!0}),chrome.tabs.remove(n)))})})}},TD.controller.auth.TwitterAuth=function(e){var t=this;t.account=e,this.verifyAccount=function(e,n){var r=t.account,i=TD.config.TWITTER_API_ROOT||"https://api.twitter.com/1.1/",s=i+"account/verify_credentials.json",o=TD.net.ajax.request(s,{account:r,isSigned:!0});o.addCallback(function(t){var i=t.data,s=r.getUserID();s&&s!=i.id?(console.log("Attempting to update wrong account:",r,"Using data:",i),TD.sync.util.printStacktrace(),n()):(r.setUsername(i.screen_name),r.setName(i.name),r.setProfileImageURL(i.profile_image_url_https),r.setUserID(i.id),r.setIsPrivate(i["protected"]),r.setUpdated((new Date).getTime()),r.computeKey(),e(r))}),n&&o.addErrback(n)},this.updateAccount=function(e,n,r){var i=t.account;i.setUsername(""),i.setUserID(""),i.setType("twitter"),i.setOAuthToken(e),i.setTokenSecret(n),this.verifyAccount(r)}},TD.controller.auth.BitlyValidate=function(e){var t=this;t.account=e,this.updateAccount=function(e,t){this.verifyAccount(t)},this.verifyAccount=function(e,n){var r=t.account,i="https://api-ssl.bitly.com/v3/validate",s={x_login:r.get("userId"),x_apiKey:r.get("oauth_token"),apiKey:"R_b8032856b71a14fabfe64f6845689ddf",login:"tweetdeckapi",format:"json"},o=TD.net.ajax.jsonp(i,s);o.addCallback(function(t){var i=t.data;if(!i.data||i.data.valid!=1){n();return}r.setUpdated((new Date).getTime()),r.computeKey(),e(r)}),o.addErrback(n)}},TD.controller.auth.TwitterAuth.prototype=new TD.controller.auth.AuthorisationProcessor,TD.services.ChirpBase=function(e){this.account=e},TD.services.ChirpBase.kMEDIA_CLASS="s-media",TD.services.ChirpBase.RETWEET_CLASS="is-retweet",TD.services.ChirpBase.FAVORITE_CLASS="is-favorite",TD.services.ChirpBase.UNREAD_CLASS="is-unread",TD.services.ChirpBase.TWEET="tweet",TD.services.ChirpBase.MESSAGE="message",TD.services.ChirpBase.MESSAGE_THREAD="message_thread",TD.services.ChirpBase.SCHEDULED_STATUS="scheduled_status",TD.services.ChirpBase.SCHEDULED_GROUP="scheduled_group",TD.services.ChirpBase.prototype.id="",TD.services.ChirpBase.prototype.chirpType="unknown",TD.services.ChirpBase.prototype.text="",TD.services.ChirpBase.prototype.created=null,TD.services.ChirpBase.prototype.htmlText="",TD.services.ChirpBase.prototype.creatorAccount=null,TD.services.ChirpBase.prototype.embeds=null,TD.services.ChirpBase.prototype._hasImage=null,TD.services.ChirpBase.prototype._hasVideo=null,TD.services.ChirpBase.prototype.fromJSONObject=function(){throw"fromJSONObject Not Implemented"},TD.services.ChirpBase.prototype.isOwnChirp=function(){throw"isOwnChirp Not Implemented"},TD.services.ChirpBase.prototype.destroy=function(){throw"destroy Not Implemented"},TD.services.ChirpBase.prototype.render=function(){throw"render Not Implemented"},TD.services.ChirpBase.prototype.renderNotification=function(){return null},TD.services.ChirpBase.prototype.getGrowlData=function(){return null},TD.services.ChirpBase.prototype.email=function(){throw"email Not Implemented"},TD.services.ChirpBase.prototype.postComment=function(){throw"postComment Not Implemented"},TD.services.ChirpBase.prototype.getChirpURL=function(){throw"getChirpURL Not Implemented"},TD.services.ChirpBase.prototype.toHTML=function(e){return TD.util.transform(e)},TD.services.ChirpBase.prototype.isTranslatable=function(){return!1},TD.services.ChirpBase.prototype.translate=function(){throw"translate Not Implemented"},TD.services.ChirpBase.prototype.getChirpType=function(){return this.chirpType},TD.services.ChirpBase.prototype.getScribeItemData=function(){throw"getScribeItemData not implemented"},TD.services.ChirpBase.prototype._changed=function(){TD.controller.notifications.reRender(this)},TD.services.ChirpBase.prototype.getDOMChirps=function(){var e="[data-key$='"+this.id+"'][data-account-key='"+this.account.getKey()+"']";return $(e)},TD.services.ChirpBase.prototype.update=function(e){return!1},TD.services.ChirpBase.prototype.passFilters=function(e){return TD.controller.filterManager.pass(this,e)},TD.services.ChirpBase.prototype._generateHTMLText=function(){this.htmlText=this.toHTML(this.text)},TD.services.ChirpBase.prototype.createdPretty=function(){return TD.util.prettyDate(this.created)},TD.services.ChirpBase.prototype.createdPrettyFull=function(){return TD.util.prettyTimeString(this.created)},TD.services.ChirpBase.prototype.reorder=function(){TD.controller.feedManager.reorderChirp(this.id)},TD.services.ChirpBase.prototype.getSinceId=function(){return this.id},TD.services.ChirpBase.prototype.getUnreadChirps=function(e){return!this.isOwnChirp()&&this.created.getTime()>e?[this]:[]},TD.services.ChirpBase.prototype.getFilterableText=function(){return this.text},TD.services.ChirpBase.prototype.getSenders=function(){return null},TD.services.ChirpBase.prototype.getSource=function(){return null},TD.services.ChirpBase.prototype.isRetweetedStatus=function(){return null},TD.services.ChirpBase.prototype.getMedia=function(){return this._media?this._media:[]},TD.services.ChirpBase.prototype.hasMedia=function(){return this.getMedia().length>0},TD.services.ChirpBase.prototype.hasImage=function(){return this._hasImage===null&&(this._hasImage=this.getMedia().some(function(e){return!e.isVideo})),this._hasImage},TD.services.ChirpBase.prototype.hasVideo=function(){return this._hasVideo===null&&(this._hasVideo=this.getMedia().some(function(e){return e.isVideo})),this._hasVideo},TD.services.ChirpBase.prototype.hasLink=function(){return!1},TD.services.ChirpBase.prototype.isFromVerifiedUser=function(){return!1},TD.services.ChirpBase.msFudge=0,TD.services.ChirpBase.prototype.fudgeCreatedTime=function(e){var t=TD.services.ChirpBase.msFudge;e.setMilliseconds(t),t++,t%=1e3,TD.services.ChirpBase.msFudge=t},TD.services.TwitterComposer=function(e){this.message={},this.id=null,this.url="statuses/update.json",this.isDm=!1,this.isRT=!1,this.isReply=!1,this.client=e,this.retweetID=null},TD.services.TwitterComposer.prototype={Retweet:function(e){return this.url="statuses/retweet/:id.json".replace(":id",e),this.isRT=!0,this.retweetID=e,this},DirectlyTo:function(e){return this.url="direct_messages/new.json",this.isDm=!0,this.message.screen_name=e,this},InReplyTo:function(e){return e&&(this.message.in_reply_to_status_id=e,this.isReply=!0),this.isDm=!1,this},WithMessage:function(e){return this.isDm?this.message.text=e:this.message.status=e,this},WithMedia:function(e){this.file=e},toSchedulableObject:function(){var e={},t={};e.service="twitter",e.user={id:this.client.oauth.account.getUserID()},t.user={name:this.client.oauth.account.getUsername(),avatar_url:this.client.oauth.account.getProfileImageURL()};var n={};return this.isRT?(n.type="retweet",n.body=this.retweetID):this.isDm?(n.type="direct_message",n.screen_name=this.message.screen_name,n.body=this.message.text):(n.type="tweet",n.body=this.message.status,this.message.in_reply_to_status_id&&(n.in_reply_to_status_id=this.message.in_reply_to_status_id)),e.meta=t,e.update=n,e},post:function(e,t){var n,r=function(n){var r;n.error?t&&(n.errorMessage=n.error,t(n)):(this.isDm?(r=this.client.processDM(n),this.client.processMessages([r],!0)):(r=this.client.processTweet(n),this.client.processMiscTweet(r)),e&&e(r),this.isRT?TD.controller.stats.retweet(r.retweetedStatus.user.id,r.retweetedStatus.id,r.account.getUserID()):this.isDm?TD.controller.stats.postMessage(this.client.oauth.account):this.isReply?TD.controller.stats.postReply(this.client.oauth.account):TD.controller.stats.postTweet(this.client.oauth.account))}.bind(this);if(this.file){var i=this.client.oauth.account;url=TD.config.api_root+"/oauth/media/twitter";var s=new FormData;_.each(this.message,function(e,t){s.append(t,e)}),s.append("media[]",this.file),n=TD.net.ajax.upload(url,s,i),n.addCallback(function(e){r(e.data)}),n.addErrback(t)}else this.client.makeTwitterCall(this.client.API_BASE_URL+this.url,this.message,"POST",null,r,t)}},TD.services.TwitterStatus=function(e){this.account=e},TD.services.TwitterStatus.prototype=new TD.services.ChirpBase,TD.services.TwitterStatus.prototype.chirpType=TD.services.ChirpBase.TWEET,TD.services.TwitterStatus.prototype.user=null,TD.services.TwitterStatus.prototype.inReplyToID="",TD.services.TwitterStatus.prototype.inReplyToUserID="",TD.services.TwitterStatus.prototype.inReplyToScreenName="",TD.services.TwitterStatus.prototype.isFavorite=!1,TD.services.TwitterStatus.prototype.isRetweeted=!1,TD.services.TwitterStatus.prototype.retweetCount=0,TD.services.TwitterStatus.prototype.retweetedStatus=null,TD.services.TwitterStatus.prototype.entities=null,TD.services.TwitterStatus.prototype.source="",TD.services.TwitterStatus.prototype.sourceNoHTML="",TD.services.TwitterStatus.prototype.cards=null,TD.services.TwitterStatus.prototype._media=null,TD.services.TwitterStatus.prototype._filterableText=null,TD.services.TwitterStatus.prototype.fromJSONObject=function(e){var t,n,r,i,s=this,o=!1,u;return this.id=e.id_str||e.id,e.user&&(this.user=(new TD.services.TwitterUser(this.account)).fromJSONObject(e.user),this.creatorAccount=TD.storage.accountController.get(TD.storage.Account.generateKeyFor("twitter",this.user.id))),e.source&&(u=$("<div>"+e.source+"</div>"),u.find("a").attr("rel","url").attr("target","_blank"),this.source=u.html(),this.sourceNoHTML=u.text()),this.inReplyToUserID=e.in_reply_to_user_id,this.inReplyToScreenName=e.in_reply_to_screen_name,this.isFavorite=e.favorited,this.isRetweeted=e.retweeted,this.retweetCount=e.retweet_count,this.currentUserRetweet=e.current_user_retweet,this.inReplyToID=e.in_reply_to_status_id_str||e.in_reply_to_status_id,e.retweeted_status?(this.text=e.retweeted_status.text,this.retweetedStatus=(new TD.services.TwitterStatus(this.account)).fromJSONObject(e.retweeted_status),e.retweeted_status.entities&&(this.entities=e.retweeted_status.entities)):(this.text=e.text,e.entities&&(this.entities=e.entities)),this.entities=this.entities||{},this._media=TD.services.TwitterMedia.getMediaFromEntities(this.entities),e.cards&&(this.cards={},_.each(TD.services.TwitterCard.SUPPORTED_CARD_TYPES,function(t){if(e.cards[t]){s.cards[t]=[];for(r=0;r<e.cards[t].length;r++)s.cards[t].push((new TD.services.TwitterCard(s.account)).fromJSONObject(e.cards[t][r]));o=!0}}),o||(this.cards=null)),this.lang=e.lang,i=TD.util.parseDateString(e.created_at),this.fudgeCreatedTime(i),this.created=e.created=i,this._generateHTMLText(),this},TD.services.TwitterStatus.prototype.toHTML=function(e){return TD.util.transform(e,this.entities)},TD.services.TwitterStatus.prototype.getMainUser=function(){return this.retweetedStatus?this.retweetedStatus.user:this.user},TD.services.TwitterStatus.prototype.getCreator=function(){return this.user},TD.services.TwitterStatus.prototype.getMainTweet=function(){return this.retweetedStatus?this.retweetedStatus:this},TD.services.TwitterStatus.prototype.hasLocationData=function(){var e=this.getMainTweet();return e.coordinates||e.place},TD.services.TwitterStatus.prototype.isOwnChirp=function(){return Boolean(this.creatorAccount)},TD.services.TwitterStatus.prototype.isRetweetedStatus=function(){return Boolean(this.retweetedStatus)},TD.services.TwitterStatus.prototype.isTranslatable=function(){var e=this.getMainTweet();return TD.decider.get(TD.decider.TRANSLATE_TWEET)&&e.lang&&e.lang!==TD.languages.getSystemLanguageCode(!0)&&TD.languages.isSupportedTranslationSourceLanguage(e.lang)&&TD.languages.isSystemLangSupportedDestinationLanguage()&&!e.isOwnChirp()&&!e.user.isProtected&&!e.getTranslation()},TD.services.TwitterStatus.prototype.translate=function(){var e=TD.controller.clients.getClient(this.account.getKey()),t=this.getMainTweet().lang,n=TD.languages.getSupportedDestinationSystemLanguage(),r=function(e){var t=this.getDOMChirps(),n=t.find(".js-translate-call-to-action"),r=t.find(".js-tweet-text"),i=t.find(".js-tweet-translation"),s;e.htmltext=TD.util.transform(e.text,e.entities),e.localizedLanguageName=this.getLocalizedLanguageName(),i.length||(r.after(TD.ui.template.render("status/tweet_translation",e)),i=t.find(".js-tweet-translation")),s=i.find(".js-tweet-translation-text"),r.addClass("tweet-translation-original-text margin-bn"),s.html(e.htmltext),n.remove(),this.setTranslation(e)}.bind(this),i=function(e){TD.controller.progressIndicator.addMessage(TD.i("Translation failed"))}.bind(this);e.translateTweet(this.getMainTweet().id,n,r,i),TD.controller.stats.translate(this.getMainUser().id,this.id,this.account.getUserID(),n,t)},TD.services.TwitterStatus.prototype.setTranslation=function(e){this.getMainTweet().translation=e},TD.services.TwitterStatus.prototype.getTranslation=function(){return this.getMainTweet().translation},TD.services.TwitterStatus.prototype.getChirpURL=function(){var e=this.getMainTweet();return"https://twitter.com/"+e.user.screenName+"/status/"+e.id},TD.services.TwitterStatus.prototype.getLocalizedLanguageName=function(){var e=TD.languages.getLanguageFromISOCode(this.getMainTweet().lang);return e?e.localized_name:""},TD.services.TwitterStatus.prototype.destroy=function(){if(!this.isOwnChirp()){TD.controller.progressIndicator.addMessage(TD.i("You don't own this account - can't delete"));return}this._action("delete",function(e){TD.controller.feedManager.deleteChirp(e.id)})},TD.services.TwitterStatus.prototype.getQuoteText=function(){var e={username:this.user.screenName,text:TD.util.removeHTMLCodes(this.text)};return TD.ui.template.toHtml("RT @{{username}}: {{{text}}}",e)},TD.services.TwitterStatus.prototype.renderMinimalist=function(e,t){var n=t!==TD.vo.Column.MEDIA_PREVIEW_OFF;return TD.ui.template.render("status/tweet_in_stream",{tweet:this,withMediaPreview:n,mediaPreviewSize:t,withTweetActions:!0,withFooter:!0,isMinimalist:!0,withAvatar:!1})},TD.services.TwitterStatus.prototype.render=function(e,t){var n=t!==TD.vo.Column.MEDIA_PREVIEW_OFF;return TD.ui.template.render("status/tweet_in_stream",{tweet:this,withMediaPreview:n,mediaPreviewSize:t,withTweetActions:!0,withFooter:!0,withAvatar:!0,withLinebreaks:!0})},TD.services.TwitterStatus.prototype.renderInMediaGallery=function(){return TD.ui.template.render("status/tweet_in_box",{tweet:this,withTweetActions:!0,withTweetActionsVisible:!0,withFooter:!0,withAvatar:!0})},TD.services.TwitterStatus.prototype.renderNotification=function(){return TD.ui.template.render("status/tweet_in_box",{tweet:this,withAvatar:!0})},TD.services.TwitterStatus.prototype.getGrowlData=function(){var e=this.getMainTweet(),t={};return e.sender?t.title=e.sender.screenName+" > "+e.recipient.screenName:e.user&&e.user.screenName&&(t.title=e.user.screenName),t.img=e.getMainUser().profileImageURL,t.text=$("<div>"+e.htmlText+"</div>").text(),t},TD.services.TwitterStatus.prototype.renderAsReply=function(e){var t=e!==TD.vo.Column.MEDIA_PREVIEW_OFF;return TD.ui.template.render("status/tweet_in_stream",{tweet:this,isInConvo:!0,withTweetActions:!0,withMediaPreview:t,mediaPreviewSize:e,withFooter:!0,withAvatar:!0})},TD.services.TwitterStatus.prototype.favorite=function(e){function u(){TD.controller.progressIndicator.taskFailed(n)}function a(e){e.error?u():(t.setFavorite(!t.isFavorite),TD.controller.progressIndicator.taskComplete(n))}var t=this,n,r=t.getMainUser(),i=t.getMainTweet(),s,o;this.isFavorite?(o=TD.i("Unfavoriting"),TD.controller.clients.getClient(t.account.getKey()).unfavorite(t.id,a,u),s=TD.controller.stats.unfavorite):(o=TD.i("Favoriting"),TD.controller.clients.getClient(t.account.getKey()).favorite(t.id,a,u),s=TD.controller.stats.favorite),n=TD.controller.progressIndicator.addTask(o),s(r.id,i.id,t.account.getUserID())},TD.services.TwitterStatus.prototype.email=function(){var e=TD.i("Tweet forwarded by @{{1}}",{1:this.account.getUsername()}),t=[],n;t.push(this.text),t.push(TD.i("Original Tweet: {{1}}",{1:this.getChirpURL()})),t.push(TD.i("Sent via TweetDeck")),n=t.join("\n\n"),TD.util.openEmail(null,e,n)},TD.services.TwitterStatus.prototype.reply=function(){TD.ui.compose.reply(this,this.account.getKey())},TD.services.TwitterStatus.prototype.retweet=function(){var e=new TD.components.ActionDialog(this)},TD.services.TwitterStatus.prototype.referenceTo=function(){var e=this.account.getKey();TD.ui.compose.referenceTo(this.getChirpURL(),e)},TD.services.TwitterStatus.prototype._action=function(e,t){function u(){TD.controller.progressIndicator.taskFailed(i)}function a(e){e.error?(TD.controller.progressIndicator.changeMessage(i,s+" - "+e.error),u()):(TD.controller.progressIndicator.taskComplete(i),t&&t(n))}var n=this,r=TD.controller.clients.getClient(this.account.getKey()),i,s,o;switch(e){case"delete":this.retweetedStatus?s=TD.i("Undoing Retweet"):s=TD.i("Deleting"),r=TD.controller.clients.getClient(this.creatorAccount.getKey()),r.destroy(this.id,a,u);break;case"deleteDM":s=TD.i("Deleting"),this.creatorAccount&&(r=TD.controller.clients.getClient(this.creatorAccount.getKey())),r.destroyDM(this.id,a,u)}i=TD.controller.progressIndicator.addTask(s)},TD.services.TwitterStatus.prototype._entitySort=function(e,t){return t.indices[0]-e.indices[0]},TD.services.TwitterStatus.prototype.getFilterableText=function(){var e="",t;return this._filterableText?e=this._filterableText:this.entities.urls.length===0&&this.entities.media.length===0?e=this.text:(t=[this.text],t=t.concat(_.pluck(this.entities.urls,"expanded_url")),t=t.concat(_.pluck(this.entities.media,"expanded_url")),t=_.compact(t),e=t.join(" "),this._filterableText=e),e},TD.services.TwitterStatus.prototype.getSenders=function(){var e=[this.user.screenName];return this.isRetweetedStatus()&&e.push(this.retweetedStatus.user.screenName),e},TD.services.TwitterStatus.prototype.getSource=function(){return this.sourceNoHTML},TD.services.TwitterStatus.prototype.setRetweeted=function(e){this.isRetweeted=e,this.getDOMChirps().toggleClass(TD.services.ChirpBase.RETWEET_CLASS,e),this._changed()},TD.services.TwitterStatus.prototype.setFavorite=function(e){this.isFavorite=e,this.getDOMChirps().toggleClass(TD.services.ChirpBase.FAVORITE_CLASS,e).find('a[rel="favorite"]').attr("title",TD.ui.template.render("text/favorite_action",this)),this._changed()},TD.services.TwitterStatus.prototype.isMention=function(){var e=String(this.account.getUserID()),t=this.account.getUsername().toLowerCase(),n=this.entities.user_mentions.length,r;for(var i=0;i<n;i++){r=this.entities.user_mentions[i];if(r.id_str){if(r.id_str===e)return!0}else if(r.screen_name.toLowerCase()===t)return!0}return!1},TD.services.TwitterStatus.prototype.getMedia=function(){return this.retweetedStatus?this.retweetedStatus.getMedia():this._media||[]},TD.services.TwitterStatus.prototype.getUniqueMedia=function(){var e=this.getMedia(),t={},n=[],r=this;return this.cards&&_.each(TD.services.TwitterCard.SUPPORTED_CARD_TYPES,function(e){var n=r.cards[e];n&&_.each(n,function(e){t[e.url]=!0})}),_.each(e,function(e){t[e.shortUrl]||n.push(e)}),n},TD.services.TwitterStatus.prototype.getCardsForGallery=function(){var e=this.getMedia(),t={},n=[],r=this;return _.each(e,function(e){t[e.shortUrl]=!0}),this.cards&&_.each(["photos","players"],function(e){var i=r.cards[e];i&&_.each(i,function(e){t[e.url]||n.push(e)})}),n},TD.services.TwitterStatus.prototype.hasLink=function(){var e=this.entities.media||[],t=this.entities.urls||[];return Boolean(e.length||t.length)},TD.services.TwitterStatus.prototype.isFromVerifiedUser=function(){return this.getMainTweet().user.isVerified},TD.services.TwitterStatus.prototype.hasImage=function(){return this._hasImage===null&&(this._hasImage=TD.services.ChirpBase.prototype.hasImage.call(this)||TD.services.TwitterMedia.entitiesContainImage(this.entities)),this._hasImage},TD.services.TwitterStatus.prototype.hasVideo=function(){return this._hasVideo===null&&(this._hasVideo=TD.services.ChirpBase.prototype.hasVideo.call(this)||TD.services.TwitterMedia.entitiesContainVideo(this.entities)),this._hasVideo},TD.services.TwitterStatus.prototype.getScribeItemData=function(){var e;return this.isRetweetedStatus()?(e=this.getMainTweet().getScribeItemData(),e.retweeting_tweet_id=this.id):(e={item_type:0,id:this.id},this.cards&&(this.cards.photos?e.card_type=2:this.cards.players?e.card_type=3:this.cards.summaries&&(e.card_type=4))),e},TD.services.TwitterCard=function(e){this.account=e},TD.services.TwitterCard.prototype={url:null,title:null,description:null,author:null,site:null,images:null,players:null},TD.services.TwitterCard.SUPPORTED_CARD_TYPES=["summaries","photos","players"],TD.services.TwitterCard.prototype.fromJSONObject=function(e){return this.url=e.url,this.title=e.title,this.description=e.description,e.author_user&&(this.author=(new TD.services.TwitterUser(this.account)).fromJSONObject(e.author_user)),e.site_user&&(this.site=(new TD.services.TwitterUser(this.account)).fromJSONObject(e.site_user)),e.images&&(this.images=e.images),e.players&&(this.players=e.players.filter(function(e){return e.aspectRatio=e.height/e.width*100,e.source_type==="text/html"})),this},TD.services.TwitterCard.prototype.shouldDisable=function(){return TD.util.getAppEnv()==="win"&&this.players},TD.services.TwitterCard.prototype.renderGallery=function(){var e;return this.players?e=TD.ui.template.render("cards/media_player_gallery",this):(params={url:this.url,imageSrc:this.images.web.image_url,thumbClass:TD.services.TwitterMedia.IMAGE_CLASS},e=TD.ui.template.render("status/media_thumb",params)),e},TD.services.TwitterMedia=function(){},TD.services.TwitterMedia.TWITPIC_RE=/(http:\/\/|www.)?twitpic.com\/\w+/,TD.services.TwitterMedia.YFROG_RE=/(http:\/\/|www.)?yfrog.com\/\w+/,TD.services.TwitterMedia.PLIXI_RE=/(http:\/\/|www.)?plixi.com\/p\/[0-9]+/,TD.services.TwitterMedia.LOCKERZ_RE=/(http:\/\/|www.)?lockerz.com\/s\/[0-9]+/,TD.services.TwitterMedia.INSTAGRAM_RE=/(http:\/\/|www.)?instagr.am\/p\/[\w-]+(\/)/,TD.services.TwitterMedia.YOUTUBE_LONG_RE=/(?:(?:https?\:\/\/)?(?:www\.)?)?youtube\.com\/watch[a-zA-Z0-9_\-\?\&\=\/]+/,TD.services.TwitterMedia.YOUTUBE_TINY_RE=/(http:\/\/|www.)?youtu\.be\/([a-zA-Z0-9_\-\?\&\=\/]+)/,TD.services.TwitterMedia.YOUTUBE_RE=new RegExp(TD.services.TwitterMedia.YOUTUBE_LONG_RE.source+"|"+TD.services.TwitterMedia.YOUTUBE_TINY_RE.source),TD.services.TwitterMedia.VIMEO_RE=/https?:\/\/(www\.|player\.)?vimeo\.com\/(.+)/i,TD.services.TwitterMedia.VINE_RE=/https?:\/\/(www\.)?vine\.co\/v\/(.+)/i,TD.services.TwitterMedia.FLICKR_RE=/https?:\/\/(www\.)?(flic.kr|flickr.com\/photos)\/(.+)/i,TD.services.TwitterMedia.IMGUR_RE=/https?:\/\/([a-z0-9]+\.)?imgur.com\/(.+)/i,TD.services.TwitterMedia.PHOTOZOU_RE=/https?:\/\/photozou\.jp\/photo\/(show|photo_only)\/(.+)/i,TD.services.TwitterMedia.FILTERABLE_VIDEO_SERVICES=[TD.services.TwitterMedia.VIMEO_RE,TD.services.TwitterMedia.VINE_RE],TD.services.TwitterMedia.FILTERABLE_IMAGE_SERVICES=[TD.services.TwitterMedia.FLICKR_RE,TD.services.TwitterMedia.IMGUR_RE,TD.services.TwitterMedia.PHOTOZOU_RE],TD.services.TwitterMedia.YOUTUBE_GALLERY_WIDTH=640,TD.services.TwitterMedia.YOUTUBE_GALLERY_HEIGHT=390,TD.services.TwitterMedia.MAX_THUMB_WIDTH=90,TD.services.TwitterMedia.MAX_THUMB_HEIGHT=65,TD.services.TwitterMedia.THUMBNAIL_CONTAINER_CLASS="media-thumb-container",TD.services.TwitterMedia.THUMBNAIL_IMG_CLASS="media-thumb-img",TD.services.TwitterMedia.IMAGE_CLASS="media-img",TD.services.TwitterMedia.SERVICES={twitpic:TD.services.TwitterMedia.TWITPIC_RE,yfrog:TD.services.TwitterMedia.YFROG_RE,lockerz:TD.services.TwitterMedia.LOCKERZ_RE,instagram:TD.services.TwitterMedia.INSTAGRAM_RE,youtube:TD.services.TwitterMedia.YOUTUBE_RE},TD.services.TwitterMedia.getMediaFromEntities=function(e){var t=[],n=this,r={};_.each(e.media,function(e){t.push((new TD.services.TwitterMedia).fromMediaEntity(e))});var i=_.map(e.urls,function(e){var t=e.expanded_url||e.url;return r[t]=e.url,_.startsWith(t,"http")||(t="http://"+t),t});return _.each(i,function(e){var n;for(var i in TD.services.TwitterMedia.SERVICES)n=e.match(TD.services.TwitterMedia.SERVICES[i]),n&&n[0]==e&&t.push((new TD.services.TwitterMedia).fromURL(i,r[e],e))}),t},TD.services.TwitterMedia.entitiesContainImage=function(e){return TD.services.TwitterMedia.FILTERABLE_IMAGE_SERVICES.some(function(t){return e.urls.some(function(e){return t.test(e.expanded_url)})})},TD.services.TwitterMedia.entitiesContainVideo=function(e){return TD.services.TwitterMedia.FILTERABLE_VIDEO_SERVICES.some(function(t){return e.urls.some(function(e){return t.test(e.expanded_url)})})},TD.services.TwitterMedia.prototype={flaggedNSFW:!1,isVideo:!1},TD.services.TwitterMedia.prototype.fromMediaEntity=function(e){return this.entity=e,this.service="twitter",this.url=this.shortUrl=e.url,this},TD.services.TwitterMedia.prototype.fromURL=function(e,t,n){return this.url=n,this.shortUrl=t,this.service=e,this.service==="instagram"&&_.endsWith(this.url,"/")?this.url=this.url.substring(0,this.url.length-1):this.service==="youtube"&&(this.isVideo=!0,this.url.match(TD.services.TwitterMedia.YOUTUBE_LONG_RE)?this.mediaId=TD.net.util.decodeURL(this.url).v:this.mediaId=this.url.split("/").pop().split("?")[0]),this},TD.services.TwitterMedia.prototype.thumb=function(e){switch(this.service){case"twitter":return this.entity.media_url_https+":thumb";case"twitpic":return"https://twitpic.com/show/thumb/"+this.url.split("/").pop();case"yfrog":return this.url.replace("http://","https://")+":small";case"lockerz":return"https://api.plixi.com/api/tpapi.svc/imagefromurl?size=thumbnail&url="+this.url;case"instagram":return"https://instagr.am/p/"+this.url.split("/").pop()+"/media/?size=t";case"youtube":return"https://img.youtube.com/vi/"+this.mediaId+"/1.jpg"}},TD.services.TwitterMedia.prototype.small=function(e){switch(this.service){case"twitter":return this.entity.media_url_https+":small";case"twitpic":case"yfrog":case"lockerz":return this.large();case"instagram":return"https://instagr.am/p/"+this.url.split("/").pop()+"/media/?size=m";case"youtube":return"https://img.youtube.com/vi/"+this.mediaId+"/1.jpg"}},TD.services.TwitterMedia.prototype.large=function(e){switch(this.service){case"twitter":return this.entity.media_url_https+":large";case"twitpic":return"https://twitpic.com/show/full/"+this.url.split("/").pop();case"yfrog":return this.url.replace("http://","https://")+":iphone";case"lockerz":return"https://api.plixi.com/api/tpapi.svc/imagefromurl?size=medium&url="+this.url;case"instagram":return"https://instagr.am/p/"+this.url.split("/").pop()+"/media/?size=l";case"youtube":return"https://img.youtube.com/vi/"+this.mediaId+"/1.jpg"}},TD.services.TwitterMedia.prototype.calculateThumbSize=function(){if(this.thumbWidth&&this.thumbHeight)return;this.thumbWidth=TD.services.TwitterMedia.MAX_THUMB_WIDTH,this.thumbHeight=TD.services.TwitterMedia.MAX_THUMB_HEIGHT;switch(this.service){case"twitter":this.entity.sizes&&this.entity.sizes.thumb&&(thumbRatio=this.entity.sizes.thumb.w/this.entity.sizes.thumb.h,this.thumbWidth=thumbRatio*this.thumbHeight);break;case"instagram":case"twitpic":this.thumbWidth=this.thumbHeight;break;case"youtube":thumbRatio=120/90,this.thumbWidth=thumbRatio*this.thumbHeight}},TD.services.TwitterMedia.prototype.renderThumb=function(){this.calculateThumbSize();var e={url:this.url,imageSrc:this.thumb(),isVideo:this.isVideo,thumbContainerClass:TD.services.TwitterMedia.THUMBNAIL_CONTAINER_CLASS,thumbClass:TD.services.TwitterMedia.THUMBNAIL_IMG_CLASS,height:this.thumbHeight,width:this.thumbWidth};return TD.ui.template.render("status/media_thumb",e)},TD.services.TwitterMedia.prototype.renderDetailView=function(){var e;return this.service==="youtube"&&!TD.settings.getUseNarrowColumns()?(e={id:this.mediaId,width:"100%",height:"auto"},TD.ui.template.render("media/youtube",e)):(e={url:this.url,imageSrc:this.small(),isVideo:this.isVideo,thumbClass:TD.services.TwitterMedia.IMAGE_CLASS},TD.ui.template.render("status/media_thumb",e))},TD.services.TwitterMedia.prototype.renderGallery=function(){var e,t;if(this.service==="youtube"){var t={id:this.mediaId,width:TD.services.TwitterMedia.YOUTUBE_GALLERY_WIDTH,height:TD.services.TwitterMedia.YOUTUBE_GALLERY_HEIGHT};e=TD.ui.template.render("media/youtube",t)}else t={url:this.url,imageSrc:this.large(),thumbClass:TD.services.TwitterMedia.IMAGE_CLASS},e=TD.ui.template.render("status/media_thumb",t);return e},TD.services.TwitterDirectMessage=function(e){this.account=e},TD.services.TwitterDirectMessage.prototype=new TD.services.TwitterStatus,TD.services.TwitterDirectMessage.prototype.chirpType=TD.services.ChirpBase.MESSAGE,TD.services.TwitterDirectMessage.prototype.messageThreadId=null,TD.services.TwitterDirectMessage.prototype.fromJSONObject=function(e){return this.id=e.id_str||String(e.id),this.text=e.text,this.sender=(new TD.services.TwitterUser(this.account)).fromJSONObject(e.sender),this.recipient=(new TD.services.TwitterUser(this.account)).fromJSONObject(e.recipient),this.creatorAccount=TD.storage.accountController.get(TD.storage.Account.generateKeyFor("twitter",this.sender.id)),this.created=TD.util.parseDateString(e.created_at),this.createdDate=TD.util.prettyDate(this.created),this.entities=e.entities||{},this.htmlText=TD.util.transform(this.text,this.entities),this.read=e.read||this.sender.isMe(),this},TD.services.TwitterDirectMessage.prototype.hasLocationData=function(){return!1},TD.services.TwitterDirectMessage.prototype.getMainUser=function(){return this.sender},TD.services.TwitterDirectMessage.prototype.isOwnChirp=function(){return Boolean(this.creatorAccount)},TD.services.TwitterDirectMessage.prototype.dm=function(){var e=this.sender;this.isOwnChirp()&&(e=this.recipient),TD.ui.compose.directMessage(e.screenName,this.account.getKey())},TD.services.TwitterDirectMessage.prototype.getChirpURL=function(){return""},TD.services.TwitterDirectMessage.prototype.destroy=function(){var e=this;this._action("deleteDM",function(){var t=TD.controller.clients.getClient(e.account.getKey());t.deleteMessage(e.id)})},TD.services.TwitterDirectMessage.prototype.render=function(){return TD.ui.template.render("status/message_in_stream",{message:this,withFooter:!0,withAvatar:!0})},TD.services.TwitterDirectMessage.prototype.renderNotification=function(){return TD.ui.template.render("status/message_in_box",{message:this,withAvatar:!0})},TD.services.TwitterDirectMessage.prototype.getSenders=function(){return[this.sender.screenName]},TD.services.TwitterDirectMessage.prototype.getCorrespondent=function(){var e=this.account.getUserID();return this.sender.id==e?this.recipient:this.sender},TD.services.TwitterMessageThread=function(e,t){this.account=e,this.correspondent=t,this.id="messagethread-"+e.getUserID()+"-"+t.id,this.messages=[],this.messageIndex={}},TD.services.TwitterMessageThread.prototype=new TD.services.ChirpBase,TD.services.TwitterMessageThread.prototype.chirpType=TD.services.ChirpBase.MESSAGE_THREAD,TD.services.TwitterMessageThread.prototype.correspondent=null,TD.services.TwitterMessageThread.prototype.unread=!1,TD.services.TwitterMessageThread.prototype.replied=!1,TD.services.TwitterMessageThread.prototype.messages=null,TD.services.TwitterMessageThread.prototype.messageIndex=null,TD.services.TwitterMessageThread.prototype.addMessages=function(e){var t,n,r=!1,i=this.account.getUserID(),s=TD.config.internal_build||TD.decider.get(TD.decider.DM_READ_STATE);if(e.length===0)return;for(t=0,n=e.length;t<n;t++){var o=e[t];if(this.messageIndex[o.id])continue;r=!0;if(o.recipient.id!=i||o.sender.id!=this.correspondent.id)if(o.recipient.id!=this.correspondent.id||o.sender.id!=i)throw new Error("Wrong thread!");o.messageThreadId=this.id,this.messages.push(o),this.messageIndex[o.id]=o,s&&!o.read&&(this.unread=!0)}return this.messages.sort(TD.util.chirpDescSort),this.calculateAttributes(),r},TD.services.TwitterMessageThread.prototype.removeMessage=function(e){var t=this.messageIndex[e];return t?(delete this.messageIndex[e],this.messages=_.select(this.messages,function(t){return t.id!==e}),this.calculateAttributes(),this.getDOMChirps().trigger("uiReadStateChange",{}),!0):!1},TD.services.TwitterMessageThread.prototype.getMainUser=function(){return this.correspondent},TD.services.TwitterMessageThread.prototype.calculateAttributes=function(){var e=this.account.getUserID();if(this.messages.length===0)return;this.messages[0].sender.id==e&&(this.replied=!0,this.unread=!1),this.created=this.messages[0].created;var t=_.detect(this.messages,function(t){return t.recipient.id==e});this.messages.length>0&&(this.text=this.messages[0].text,this.htmlText=this.messages[0].htmlText)},TD.services.TwitterMessageThread.prototype.render=function(e){return TD.ui.template.render("status/message_thread",{chirp:this,withAvatar:!0})},TD.services.TwitterMessageThread.prototype.renderThread=function(){var e=[];return this.messages.forEach(function(t){e.push(t.render())}),e.join("")},TD.services.TwitterMessageThread.prototype.update=function(e){return!0},TD.services.TwitterMessageThread.prototype.getSinceId=function(){var e="",t=_.first(this.messages);return t&&(e=t.id),e},TD.services.TwitterMessageThread.prototype.getUnreadChirps=function(e){var t,n=[],r=TD.config.internal_build||TD.decider.get(TD.decider.DM_READ_STATE),i;if(r){for(i=0;i<this.messages.length;i++)t=this.messages[i],t.isOwnChirp()||(t.read||(t.unread=!0,n.push(t)),i===0&&(this.replied=!1));this.replied&&(n=[])}else for(i=0;i<this.messages.length;i++){t=this.messages[i];if(t.created.getTime()<=e)break;t.isOwnChirp()||(n.push(t),i===0&&(this.unread=!0,this.replied=!1))}return n},TD.services.TwitterMessageThread.prototype.postComment=function(e,t,n){function o(e){TD.controller.progressIndicator.taskComplete(s),t&&t()}function u(e){TD.controller.progressIndicator.taskFailed(s,e.errors[0].message),n&&n()}var r=TD.controller.clients.getClient(this.account.getKey()),i=r.create(),s;if(!e.length){n();return}i.DirectlyTo(this.correspondent.screenName),i.WithMessage(e),s=TD.controller.progressIndicator.addTask(TD.i("Sending...")),i.post(o,u)},TD.services.TwitterMessageThread.prototype.markAsRead=function(){var e=TD.controller.clients.getClient(this.account.getKey()),t=TD.config.internal_build||TD.decider.get(TD.decider.DM_READ_STATE),n=!1,r=0;this.unread=!1,this.getDOMChirps().removeClass(TD.services.ChirpBase.UNREAD_CLASS).trigger("uiReadStateChange",{});var i=function(){},s=function(e){this.unread=!0,TD.controller.progressIndicator.addMessage(TD.i("Failed to mark message as read.")),this.getDOMChirps().addClass(TD.services.ChirpBase.UNREAD_CLASS),this._changed()};t&&(n=this.messages.some(function(e){return!e.read}),n&&e.markMessagesAsRead(this.messages[0].id,this.correspondent.id,i,s.bind(this))),this._changed()},TD.services.TwitterMessageThread.prototype.getSenders=function(){return[this.correspondent.screenName]},TD.services.TwitterUser=function(e){this.account=e},TD.services.TwitterUser.MINI_SUFFIX="_mini",TD.services.TwitterUser.NORMAL_SUFFIX="_normal",TD.services.TwitterUser.BIGGER_SUFFIX="_bigger",TD.services.TwitterUser.REASONABLY_SMALL_SUFFIX="_reasonably_small",TD.services.TwitterUser.NORMAL_SUFFIX_REGEXP=new RegExp(TD.services.TwitterUser.NORMAL_SUFFIX+"(?!.*"+TD.services.TwitterUser.NORMAL_SUFFIX+")"),TD.services.TwitterUser.BIGGER_SUFFIX_REGEXP=new RegExp(TD.services.TwitterUser.BIGGER_SUFFIX+"(?!.*"+TD.services.TwitterUser.BIGGER_SUFFIX+")"),TD.services.TwitterUser.prototype.fromJSONObject=function(e){return this.id=e.id_str,this.screenName=e.screen_name,this.profileImageURL=e.profile_image_url_https,this.avatarSuffixRegex=TD.services.TwitterUser.NORMAL_SUFFIX_REGEXP,TD.util.isRetina()&&(this.profileImageURL=this.profileImageURL.replace(this.avatarSuffixRegex,TD.services.TwitterUser.BIGGER_SUFFIX),this.avatarSuffixRegex=TD.services.TwitterUser.BIGGER_SUFFIX_REGEXP),this.name=e.name,this.location=e.location,this.description=e.description,this.entities=e.entities,this.friendsCount=e.friends_count,this.listedCount=e.listed_count,this.followersCount=e.followers_count,this.statusesCount=e.statuses_count,this.favoritesCount=e.favourites_count,this.listedCount=e.listed_count,this.url=e.url,this.isProtected=e["protected"],this.isVerified=e.verified,this.isTranslator=e.is_translator,this.following=e.following,this.lang=e.lang,this._profileBannerURL=e.profile_banner_url?e.profile_banner_url+"/web":null,TD.util.isRetina()&&this._profileBannerURL&&(this._profileBannerURL+="_retina"),e.status&&(this.lastStatus=(new TD.services.TwitterStatus(this.account)).fromJSONObject(e.status),this.lastStatus.user=this),TD.cache.twitterUsers.add(this),this},TD.services.TwitterUser.prototype.isSameUser=function(e){var t;return e instanceof TD.services.TwitterUser?t=e.screenName.toLowerCase():t=e.toLowerCase(),this.screenName.toLowerCase()===t},TD.services.TwitterUser.prototype.isMe=function(){return this.account.getUserID()==this.id},TD.services.TwitterUser.prototype.reasonablySmallProfileImageURL=function(){return this.profileImageURL.replace(this.avatarSuffixRegex,TD.services.TwitterUser.REASONABLY_SMALL_SUFFIX)},TD.services.TwitterUser.prototype.biggerProfileImageURL=function(){return TD.util.isRetina()?this.reasonablySmallProfileImageURL():this.profileImageURL.replace(this.avatarSuffixRegex,TD.services.TwitterUser.BIGGER_SUFFIX)},TD.services.TwitterUser.prototype.miniProfileImageURL=function(){return TD.util.isRetina()?this.profileImageURL.replace(this.avatarSuffixRegex,TD.services.TwitterUser.NORMAL_SUFFIX):this.profileImageURL.replace(this.avatarSuffixRegex,TD.services.TwitterUser.MINI_SUFFIX)},TD.services.TwitterUser.prototype.prettyFollowersCount=function(){return TD.util.prettyNumber(this.followersCount)},TD.services.TwitterUser.prototype.prettyFriendsCount=function(){return TD.util.prettyNumber(this.friendsCount)},TD.services.TwitterUser.prototype.prettyListedCount=function(){return TD.util.prettyNumber(this.listedCount)},TD.services.TwitterUser.prototype.prettyStatusesCount=function(){return TD.util.prettyNumber(this.statusesCount)},TD.services.TwitterUser.prototype.follow=function(e,t,n,r){var i=TD.controller.clients.getClient(e.getKey()),s=this,o,u=function(e){s.following=!0,r&&(o=TD.i("Successfully followed @{{screenName}}",s),TD.controller.progressIndicator.addMessage(o)),t&&t(e)},a=function(e){r&&(o=TD.i("Unable to follow @{{screenName}}",s),TD.controller.progressIndicator.addMessage(o)),n&&n()};i.followUser(this.screenName,u,a)},TD.services.TwitterUser.prototype.unfollow=function(e,t,n,r){var i=TD.controller.clients.getClient(e.getKey()),s=this,o,u=function(n){s.removeFromView(e,!0),s.following=!1,r&&(o=TD.i("Successfully unfollowed @{{screenName}}",s),TD.controller.progressIndicator.addMessage(o)),t&&t(n)},a=function(){r&&(o=TD.i("Unable to unfollow @{{screenName}}",s),TD.controller.progressIndicator.addMessage(o)),n&&n()};i.unfollowUser(this.screenName,u,a)},TD.services.TwitterUser.prototype.unblock=function(e,t,n){var r=TD.controller.clients.getClient(e.getKey());r.unfollowUser(this.screenName,t,n),$.publish("/user/"+this.screenName+"/unblock",[this.account])},TD.services.TwitterUser.prototype.block=function(e,t,n,r){var i=this,s=TD.controller.clients.getClient(e.getKey()),o=function(n){TD.controller.progressIndicator.addMessage(u),i.following=!1,$.publish("/user/"+i.screenName+"/blocked",[i.account]),i.removeFromView(e,!1),t&&TD.controller.stats.spam(i.screenName,i.id,i.account.getUserID())},u;$.publish("/user/"+this.screenName+"/block",[this.account]),t?(s.blockAndReportUser(this.screenName,o,r),u=TD.i("Successfully blocked and reported @{{screenName}}",{screenName:this.screenName})):(s.blockUser(this.screenName,o,r),u=TD.i("Successfully blocked @{{screenName}}",{screenName:this.screenName}))},TD.services.TwitterUser.prototype.removeFromView=function(e,t){$.publish("/user/removeTweets",[this.screenName,e.getUserID(),t])},TD.services.TwitterUser.prototype.bio=function(){var e=this.entities&&this.entities.description||{};return TD.util.transform(this.description,e)},TD.services.TwitterUser.prototype.htmlLocation=function(){var e=this.entities&&this.entities.location||{};return TD.util.transform(this.location,e)},TD.services.TwitterUser.prototype.hasLocation=function(){return Boolean(this.htmlLocation())},TD.services.TwitterUser.prototype.getFollowerURL=function(){return"http://twitter.com/"+this.screenName+"/followers"},TD.services.TwitterUser.prototype.getFriendURL=function(){return"http://twitter.com/"+this.screenName+"/following"},TD.services.TwitterUser.prototype.getProfileURL=function(){return"http://twitter.com/"+this.screenName},TD.services.TwitterUser.prototype.getListedURL=function(){return"http://twitter.com/"+this.screenName+"/lists/memberships"},TD.services.TwitterUser.prototype.getDisplayURL=function(){var e=this.entities;return e&&e.url&&e.url.urls&&e.url.urls.length&&e.url.urls[0].display_url?e.url.urls[0].display_url:this.url},TD.services.TwitterUser.prototype.profileBannerURL=function(){return this._profileBannerURL||"/web/assets/global/backgrounds/td_profile_empty"+(TD.util.isRetina()?"@2x.jpg":".jpg")},TD.services.TrendingTopic=function(){},TD.services.TrendingTopic.prototype.name="",TD.services.TrendingTopic.prototype.query="",TD.services.TrendingTopic.prototype.url="",TD.services.TrendingTopic.prototype.description="",TD.services.TrendingTopic.prototype.attribution="",TD.services.TrendingTopic.prototype.created=0,TD.services.TrendingTopic.prototype.promotedContent=null,TD.services.TrendingTopic.prototype.events=null,TD.services.TrendingTopic.prototype.fromJSONObject=function(e){return this.name=e.name,this.query=e.query,this.promotedContent=e.promoted_content,this.events=e.events,this.created=(new Date).getTime(),this.query=encodeURIComponent(this.name),this.url||(this.url="http://search.twitter.com/search?q="+this.query),this.promotedContent&&this.promotedContent.description&&(this.description=TD.util.escape(this.promotedContent.description)),this},TD.services.TrendLocation=function(){},TD.services.TrendLocation.prototype.PLACE_TYPE_SUPERNAME=19,TD.services.TrendLocation.prototype.PLACE_TYPE_COUNTRY=12,TD.services.TrendLocation.prototype.PLACE_TYPE_TOWN=7,TD.services.TrendLocation.prototype.placeType=null,TD.services.TrendLocation.prototype.name="",TD.services.TrendLocation.prototype.woeid=-1,TD.services.TrendLocation.prototype.url="",TD.services.TrendLocation.prototype.countryCode="",TD.services.TrendLocation.prototype.country="",TD.services.TrendLocation.prototype.label="",TD.services.TrendLocation.prototype.sortString="",TD.services.TrendLocation.prototype.isTown=!1,TD.services.TrendLocation.prototype.fromJSONObject=function(e){this.name=e.name,this.woeid=e.woeid,this.url=e.url,this.countryCode=e.countryCode,this.country=e.country,this.placeType=e.placeType;switch(this.placeType.code){case this.PLACE_TYPE_TOWN:this.label="â"+this.name,this.sortString=this.country+this.name,this.isTown=!0;break;case this.PLACE_TYPE_SUPERNAME:this.label=this.name.toUpperCase(),this.sortString="";break;default:this.label=this.name,this.sortString=this.name}return this},TD.services.TwitterList=function(e){this.account=e},TD.services.TwitterList.prototype.fromJSONObject=function(e){return this.id=e.id_str,this.name=e.name,this.description=e.description,this.slug=e.slug,this.fullName=e.full_name,this.memberCount=e.member_count,this.isPrivate=e.mode==="private",this.user=(new TD.services.TwitterUser(this.account)).fromJSONObject(e.user),this},TD.services.TwitterList.prototype.isOwnList=function(){var e=TD.storage.Account.generateKeyFor("twitter",this.user.id),t=TD.storage.accountController.get(e);return Boolean(t)},TD.services.TwitterSearchParser=function(e){this.query=e,this.terms=[],this.init()},TD.services.TwitterSearchParser.PUNCT=new RegExp("["+twttr.txt.regexen.punct.source+"]","g"),TD.services.TwitterSearchParser.ALLOWED_CHARS=["@","#",'"',"-"],TD.services.TwitterSearchParser.isStreamable=function(e){var t=e.match(TD.services.TwitterSearchParser.PUNCT),n=_.difference(t,TD.services.TwitterSearchParser.ALLOWED_CHARS);return n.length===0},TD.services.TwitterSearchParser.prototype.PHRASE="phrase",TD.services.TwitterSearchParser.prototype.NEGATIVE_PHRASE="negPhrase",TD.services.TwitterSearchParser.prototype.AND="and",TD.services.TwitterSearchParser.prototype.OR="or",TD.services.TwitterSearchParser.prototype.query="",TD.services.TwitterSearchParser.prototype.trackQuery="",TD.services.TwitterSearchParser.prototype.thePhrase="",TD.services.TwitterSearchParser.prototype.type="",TD.services.TwitterSearchParser.prototype.init=function(){if(this.trackQuery)return;var e,t;typeof this.query=="string"?t=TD.services.TwitterSearchParser.extractPhrases(this.query,!1):t=this.query;if(t.length!==0)if(t.length===1)this.thePhrase=t[0].toLowerCase(),this.thePhrase.charAt(0)==="-"&&this.thePhrase.indexOf(" ")===-1?(this.type=this.NEGATIVE_PHRASE,this.thePhrase=this.thePhrase.slice(1),this.trackQuery=""):(this.type=this.PHRASE,this.trackQuery=this.thePhrase);else{var n=[[]],r=!0,i;for(i=0;i<t.length;i++){e=t[i];if(e==="OR"){_.last(n).push(e),r=!0;continue}if(e==="AND")continue;r?_.last(n).push(e):n.push([e]),r=!1}n=_.reject(n,function(e){return _.isEmpty(e)});if(n.length>1){this.type=this.AND;for(i=0;i<n.length;i++){var s=n[i];s.length>0&&this.terms.push(new TD.services.TwitterSearchParser(s))}this.trackQuery=this.calculateANDTrackQuery(n)}else{this.type=this.OR;for(i=0;i<n[0].length;i++)e=n[0][i],e!="OR"&&(this.terms.push(new TD.services.TwitterSearchParser([e])),e.charAt(0)!="-"&&(this.trackQuery&&(this.trackQuery+=","),this.trackQuery+=e))}}},TD.services.TwitterSearchParser.prototype.calculateANDTrackQuery=function(e){var t=[""];for(var n=0;n<e.length;n++){var r=e[n],i=[];for(var s=0;s<r.length;s++){var o=r[s];if(o=="OR")continue;if(o.charAt(0)=="-")i=t;else for(var u=0;u<t.length;u++){var a=t[u],f=a?a+" ":"";f+=o,i.push(f)}}t=i}return t.join(",")},TD.services.TwitterSearchParser.extractPhrases=function(e,t){var n,r=[],i=e.split('"');for(var s=0;s<i.length;s++){if(!i[s])continue;if(s%2==1&&s<i.length-1)n=i[s].trim(),n&&(t&&(n='"'+n+'"'),r.push(n));else{var o=i[s].split(" ");for(var u=0;u<o.length;u++)n=o[u],n=n.trim(),n&&r.push(n)}}return r},TD.services.TwitterSearchParser.prototype.match=function(e,t){var n,r;t||(e=e.toLowerCase());switch(this.type){case this.PHRASE:return e.indexOf(this.thePhrase)!==-1;case this.NEGATIVE_PHRASE:return e.indexOf(this.thePhrase)===-1;case this.AND:for(n=0;n<this.terms.length;n++){r=this.terms[n];if(!r.match(e,!0))return!1}return!0;case this.OR:for(n=0;n<this.terms.length;n++){r=this.terms[n];if(r.match(e,!0))return!0}return!1;default:return!1}},TD.services.StreamEngine=klass(function(e,t){this._account=e,this._callback=t,this._url="",this._state=TD.services.StreamEngine.DISCONNECTED,this._stream=null,this._backoffLimit=0,this._backoffTimeout=null,this._keepaliveTimeout=null,this._handleData=TD.util.bind(this._handleData,this),this._handleStreamInterruption=TD.util.bind(this._handleStreamInterruption,this),this.connect=_.debounce(this._connect,50)}).statics({BACKOFF_PERIOD_MIN:2e4,BACKOFF_PERIOD_MAX:24e4,BACKOFF_PERIOD_MAX_EXTENDED:72e4,KEEPALIVE_PERIOD:9e4,XHR_BYTE_LIMIT:5e7,DISCONNECTED:"disconnected",CONNECTING:"connecting",STREAMING:"streaming",DEBUG:!1}).methods({log:function(){TD.services.StreamEngine.DEBUG&&(console.log((new Date).toUTCString(),">",this._account.getUsername(),">",arguments),TD.util.insertLogDivider())},_connect:function(e){if(e===this._url){this.log("Connect",e,"Already connecting/connected. Do nothing");return}e?(this.log("Connect",e),this.disconnect(),this._url=e,this._startNewStream()):(this.log("Connect",e,"Nothing to stream. Disconnecting"),this.disconnect())},disconnect:function(){this.log("Disconnect completely"),this._setState(TD.services.StreamEngine.DISCONNECTED),this._disconnectStream(),this._url="",this._backoffLimit=0},isStreaming:function(){var e=this._state===TD.services.StreamEngine.STREAMING;return this.log("isStreaming",e),e},_setState:function(e){var t=this._state===TD.services.StreamEngine.STREAMING,n=e===TD.services.StreamEngine.STREAMING;this._state=e,t!==n&&$(document).trigger("dataUserStreamStatus",{accountKey:this._account.getKey(),streaming:n})},_startNewStream:function(){this._disconnectStream(),this.log("Start stream"),this._setState(TD.services.StreamEngine.CONNECTING),this._stream=this._createStreamRequest(),this._stream.goStreaming()},_disconnectStream:function(){this._stream&&(this.log("Disconnect stream"),this._stream.onStreaming.disconnect&&(this._stream.onStreaming.disconnect(this._handleData),this._stream.onFailure.disconnect(this._handleStreamInterruption)),this._stream.deleteLater(),this._stream=null),clearTimeout(this._backoffTimeout),clearTimeout(this._keepaliveTimeout),this._backoffTimeout=null,this._keepaliveTimeout=null},_handleData:function(e){var t=this;switch(this._state){case TD.services.StreamEngine.DISCONNECTED:return;case TD.services.StreamEngine.CONNECTING:this._setState(TD.services.StreamEngine.STREAMING),this._backoffLimit=0,this.log("Stream is functioning")}this._processDataString(e),clearTimeout(this._keepaliveTimeout),this._keepaliveTimeout=setTimeout(function(){t._handleStreamInterruption("Keepalive timeout",0)},TD.services.StreamEngine.KEEPALIVE_PERIOD),TD.util.isWrapperApp()||this._stream.receivedChars>TD.services.StreamEngine.XHR_BYTE_LIMIT&&(this.log("Reached XHR byte limit, reconnecting"),this._startNewStream())},_processDataString:function(e){var t,n,r=0;if(!e)return;t=e.split("\r");for(var i=0;i<t.length;i++)n=_.strip(t[i]),n.length&&(r++,this._callback(JSON.parse(n)));$(document).trigger("dataReceivedStreamData",{numStreamItems:r})},_handleStreamInterruption:function(e,t){this.log("Stream interrupted",e,t);switch(this._state){case TD.services.StreamEngine.DISCONNECTED:break;case TD.services.StreamEngine.CONNECTING:this._disconnectStream(),this._setBackoffTimeout(t);break;case TD.services.StreamEngine.STREAMING:this._startNewStream()}},_setBackoffTimeout:function(e){var t=this;this._backoffLimit=Math.max(this._backoffLimit,TD.services.StreamEngine.BACKOFF_PERIOD_MIN),this._backoffLimit*=2,String(e)==="420"?this._backoffLimit=Math.min(this._backoffLimit,TD.services.StreamEngine.BACKOFF_PERIOD_MAX_EXTENDED):this._backoffLimit=Math.min(this._backoffLimit,TD.services.StreamEngine.BACKOFF_PERIOD_MAX);var n=this._backoffLimit/2,r=n+Math.ceil(Math.random()*n);this.log("Set backoff timeout",(r/1e3).toString()+"s"),this._setState(TD.services.StreamEngine.CONNECTING),this._backoffTimeout=setTimeout(function(){t.log("Backoff complete, attempting reconnect"),t._startNewStream()},r)},_createStreamRequest:function(){var e;return TD.util.isWrapperApp()?e=deck.signedRequestFactory("GET",this._url,"","","",this._account.getOAuthToken(),this._account.getTokenSecret()):e=new TD.net.StreamRequest(this._url,this._account),e.onStreaming.connect(this._handleData),e.onFailure.connect(this._handleStreamInterruption),e}}),TD.services.TwitterAction=function(e){this.account=e},TD.services.TwitterAction.FAVORITE="favorite",TD.services.TwitterAction.RETWEET="retweet",TD.services.TwitterAction.MENTION="mention",TD.services.TwitterAction.REPLY="reply",TD.services.TwitterAction.FOLLOW="follow",TD.services.TwitterAction.LIST_MEMBER_ADDED="list_member_added",TD.services.TwitterAction.LIST_CREATED="list_created",TD.services.TwitterAction.UNFAVORITE="unfavorite",TD.services.TwitterAction.LIST_MEMBER_REMOVED="list_member_removed",TD.services.TwitterAction.LIST_DESTROYED="list_destroyed",TD.services.TwitterAction.UNFOLLOW="unfollow",TD.services.TwitterAction.processStreamAction=function(e,t){var n=TD.services.TwitterAction._getActionConstructor(e.event);return(new n(t)).fromJSONObject(e,null,!0)},TD.services.TwitterAction.processRESTAction=function(e,t){var n=TD.services.TwitterAction._getActionConstructor(e.action),r=e.sources,i=e.targets_size>0?e.targets:[undefined],s=e.target_objects_size>0?e.target_objects:[undefined],o=[];for(var u=0;u<r.length;u++){if(e.action===TD.services.TwitterAction.RETWEET){if(s[0].user.id!=t.getUserID())continue;o.push([e,r[u],i[u],s[0]]);continue}for(var a=0;a<i.length;a++)for(var f=0;f<s.length;f++){if(e.action===TD.services.TwitterAction.LIST_MEMBER_ADDED&&r[u].id!==s[f].user.id)continue;o.push([e,r[u],i[a],s[f]])}}var l=_.map(o,function(r){return(new n(t)).fromJSONObject(e,r,!1)});return l},TD.services.TwitterAction._getActionConstructor=function(e){switch(e){case TD.services.TwitterAction.MENTION:case TD.services.TwitterAction.REPLY:return TD.services.TwitterActionMention;case TD.services.TwitterAction.FAVORITE:case TD.services.TwitterAction.UNFAVORITE:return TD.services.TwitterActionFavorite;case TD.services.TwitterAction.RETWEET:return TD.services.TwitterActionRetweet;case TD.services.TwitterAction.FOLLOW:case TD.services.TwitterAction.UNFOLLOW:return TD.services.TwitterActionFollow;case TD.services.TwitterAction.LIST_MEMBER_ADDED:case TD.services.TwitterAction.LIST_MEMBER_REMOVED:return TD.services.TwitterActionListMemberAdded;case TD.services.TwitterAction.LIST_CREATED:case TD.services.TwitterAction.LIST_DESTROYED:return TD.services.TwitterActionListCreated;default:return TD.services.TwitterAction}},TD.services.TwitterAction.prototype=new TD.services.ChirpBase,TD.services.TwitterAction.prototype.getChirpType=function(){return this.action},TD.services.TwitterAction.prototype.action=null,TD.services.TwitterAction.prototype.maxPosition=null,TD.services.TwitterAction.prototype.minPosition=null,TD.services.TwitterAction.msFudge=0,TD.services.TwitterAction.prototype.fromJSONObject=function(e,t,n){return n?this.fromStreamData(e):this.fromRESTData.apply(this,t),this.created=TD.util.parseDateString(e.created_at),this.fudgeCreatedTime(this.created),this.maxPosition=e.max_position||this.created.getTime().toString(),this.minPosition=e.min_position||this.created.getTime().toString(),this.generateInternalID(),this.generateText(),this},TD.services.TwitterAction.prototype.fromRESTData=function(e,t,n,r){throw"TwitterAction.fromRESTData not implemented"},TD.services.TwitterAction.prototype.fromStreamData=function(e){throw"TwitterAction.fromStreamData not implemented"},TD.services.TwitterAction.prototype.generateInternalID=function(){throw"TwitterAction.generateInternalID not implemented"},TD.services.TwitterAction.prototype.generateText=function(){},TD.services.TwitterAction.prototype.render=function(){throw"TwitterAction.render not implemented"},TD.services.TwitterAction.prototype.renderNotification=function(){throw"TwitterAction.renderNotification not implemented"},TD.services.TwitterAction.prototype.isAboutYou=function(){throw"TwitterAction.isAboutYou not implemented"},TD.services.TwitterAction.prototype.isOwnChirp=function(){throw"TwitterAction.isOwnChirp not implemented"},TD.services.TwitterAction.prototype.getChirpURL=function(){return"http://twitter.com/activity"},TD.services.TwitterAction.prototype.getCreator=function(){throw"TwitterAction.getCreator not implemented"},TD.services.TwitterAction.prototype.getRelatedTweet=function(){return null},TD.services.TwitterAction.prototype.getSenders=function(){return[this.getCreator().screenName]},TD.services.TwitterActionOnTweet=function(e){this.account=e},TD.services.TwitterActionOnTweet.prototype=new TD.services.TwitterAction,TD.services.TwitterActionOnTweet.prototype.sourceUser=null,TD.services.TwitterActionOnTweet.prototype.targetTweet=null,TD.services.TwitterActionOnTweet.prototype.generateInternalID=function(){this.id=[this.action,this.sourceUser.id,this.targetTweet.id].join("_")},TD.services.TwitterActionOnTweet.prototype.isAboutYou=function(){return this.targetTweet.user.id==this.account.getUserID()},TD.services.TwitterActionOnTweet.prototype.isOwnChirp=function(){return this.sourceUser.id==this.account.getUserID()},TD.services.TwitterActionOnTweet.prototype.getRelatedTweet=function(){return this.targetTweet},TD.services.TwitterActionOnTweet.prototype.getCreator=function(){return this.sourceUser},TD.services.TwitterActionOnTweet.prototype.render=function(e,t){var n=t!==TD.vo.Column.MEDIA_PREVIEW_OFF;return TD.ui.template.render("status/tweet_activity_in_stream",{chirp:this,icon:this.iconClass,withTweetActions:!0,withFooter:!0,withAvatar:!0,withMediaPreview:n,mediaPreviewSize:t,withLinebreaks:!0})},TD.services.TwitterActionOnTweet.prototype.renderNotification=function(){return TD.ui.template.render("status/tweet_activity_in_box",{chirp:this,icon:this.iconClass,withAvatar:!0})},TD.services.TwitterActionOnTweet.prototype.getGrowlData=function(){return{title:this.text,img:this.targetTweet.user.profileImageURL,text:$("<div>"+this.targetTweet.htmlText+"</div>").text()}},TD.services.TwitterActionOnTweet.prototype.getMedia=function(){return this.getRelatedTweet().getMedia()},TD.services.TwitterActionRetweet=function(e){this.account=e},TD.services.TwitterActionRetweet.prototype=new TD.services.TwitterActionOnTweet,TD.services.TwitterActionRetweet.prototype.action=TD.services.TwitterAction.RETWEET,TD.services.TwitterActionRetweet.prototype.iconClass="icon-retweeted",TD.services.TwitterActionRetweet.prototype.retweet=null,TD.services.TwitterActionRetweet.prototype.fromRESTData=function(e,t,n,r){this.sourceUser=(new TD.services.TwitterUser(this.account)).fromJSONObject(t),this.retweet=(new TD.services.TwitterStatus(this.account)).fromJSONObject(n),this.targetTweet=(new TD.services.TwitterStatus(this.account)).fromJSONObject(r)},TD.services.TwitterActionRetweet.prototype.fromStreamData=function(e){this.sourceUser=(new TD.services.TwitterUser(this.account)).fromJSONObject(e.source),this.retweet=(new TD.services.TwitterStatus(this.account)).fromJSONObject(e.target),this.targetTweet=this.retweet.retweetedStatus},TD.services.TwitterActionRetweet.prototype.fromRetweet=function(e){return this.sourceUser=e.user,this.retweet=e,this.targetTweet=e.retweetedStatus,this.created=new Date(e.created),this.fudgeCreatedTime(this.created),this.generateInternalID(),this.generateText(),this.maxPosition=this.minPosition=this.created.getTime().toString(),this},TD.services.TwitterActionRetweet.prototype.generateText=function(){var e=TD.i("{{{user}}} retweeted",null,!0);this.text=TD.ui.template.toHtml(e,{user:this.sourceUser.name}),this.htmlText=TD.ui.template.toHtml(e,{user:TD.ui.template.render("text/user_link_fullname",this.sourceUser)})},TD.services.TwitterActionMention=function(e){this.account=e},TD.services.TwitterActionMention.prototype=new TD.services.TwitterActionOnTweet,TD.services.TwitterActionMention.prototype.action=TD.services.TwitterAction.MENTION,TD.services.TwitterActionMention.prototype.iconClass="icon-mentioned",TD.services.TwitterActionMention.prototype.fromRESTData=function(e,t,n,r){e.action==="reply"?this.targetTweet=(new TD.services.TwitterStatus(this.account)).fromJSONObject(n):this.targetTweet=(new TD.services.TwitterStatus(this.account)).fromJSONObject(r),this.sourceUser=(new TD.services.TwitterUser(this.account)).fromJSONObject(t)},TD.services.TwitterActionMention.prototype.fromStreamData=function(e){return this.sourceUser=e.user,this.targetTweet=e,this.created=new Date(e.created),this.fudgeCreatedTime(this.created),this.generateInternalID(),this.generateText(),this.maxPosition=this.minPosition=this.created.getTime().toString(),this},TD.services.TwitterActionMention.prototype.generateText=function(){var e=TD.i("{{{user}}} mentioned you",null,!0);this.text=TD.ui.template.toHtml(e,{user:this.sourceUser.name}),this.htmlText=TD.ui.template.toHtml(e,{user:TD.ui.template.render("text/user_link_fullname",this.sourceUser)})},TD.services.TwitterActionListCreated=function(e){this.account=e},TD.services.TwitterActionListCreated.prototype=new TD.services.TwitterAction,TD.services.TwitterActionListCreated.prototype.action=TD.services.TwitterAction.LIST_CREATED,TD.services.TwitterActionListCreated.prototype.owner=null,TD.services.TwitterActionListCreated.prototype.list=null,TD.services.TwitterActionListCreated.prototype.fromRESTData=function(e,t,n){this.owner=(new TD.services.TwitterUser(this.account)).fromJSONObject(t),this.list=(new TD.services.TwitterList(this.account)).fromJSONObject(n)},TD.services.TwitterActionListCreated.prototype.fromStreamData=function(e){this.owner=(new TD.services.TwitterUser(this.account)).fromJSONObject(e.source),this.list=(new TD.services.TwitterList(this.account)).fromJSONObject(e.target_object)},TD.services.TwitterActionListCreated.prototype.generateInternalID=function(){this.id=[this.action,this.owner.id,this.list.id].join("_")},TD.services.TwitterActionListCreated.prototype.generateText=function(){var e=TD.i("{{{owner}}} created the list {{{list}}}.",null,!0);this.text=TD.ui.template.toHtml(e,{owner:this.owner.name,list:this.list.fullName}),this.htmlText=TD.ui.template.toHtml(e,{owner:TD.ui.template.render("text/user_link_fullname",this.owner),list:TD.ui.template.render("text/list_link",this.list)})},TD.services.TwitterActionListCreated.prototype.isOwnChirp=function(){return this.owner.id==this.account.getUserID()},TD.services.TwitterActionListCreated.prototype.isAboutYou=function(){return!1},TD.services.TwitterActionListCreated.prototype.getCreator=function(){return this.owner},TD.services.TwitterActionListCreated.prototype.render=function(){var e={chirp:this};return TD.ui.template.render("status/list_activity",e)},TD.services.TwitterActionListCreated.prototype.renderNotification=function(){return this.render(null)},TD.services.TwitterActionListCreated.prototype.getGrowlData=function(){return{title:this.text,img:null,text:this.list.description}},TD.services.TwitterActionListMemberAdded=function(e){this.account=e},TD.services.TwitterActionListMemberAdded.prototype=new TD.services.TwitterAction,TD.services.TwitterActionListMemberAdded.prototype.action=TD.services.TwitterAction.LIST_MEMBER_ADDED,TD.services.TwitterActionListMemberAdded.prototype.owner=null,TD.services.TwitterActionListMemberAdded.prototype.added=null,TD.services.TwitterActionListMemberAdded.prototype.list=null,TD.services.TwitterActionListMemberAdded.prototype.fromRESTData=function(e,t,n,r){this.owner=(new TD.services.TwitterUser(this.account)).fromJSONObject(t),this.added=(new TD.services.TwitterUser(this.account)).fromJSONObject(n),this.list=(new TD.services.TwitterList(this.account)).fromJSONObject(r)},TD.services.TwitterActionListMemberAdded.prototype.fromStreamData=function(e){this.owner=(new TD.services.TwitterUser(this.account)).fromJSONObject(e.source),this.added=(new TD.services.TwitterUser(this.account)).fromJSONObject(e.target),this.list=(new TD.services.TwitterList(this.account)).fromJSONObject(e.target_object)},TD.services.TwitterActionListMemberAdded.prototype.generateInternalID=function(){this.id=[this.action,this.owner.id,this.added.id,this.list.id].join("_")},TD.services.TwitterActionListMemberAdded.prototype.generateText=function(){var e;this.isAboutYou()?e=TD.i("{{{owner}}} added you to the list {{{list}}}.",null,!0):e=TD.i("{{{owner}}} added {{{added}}} to the list {{{list}}}.",null,!0),this.text=TD.ui.template.toHtml(e,{owner:this.owner.name,added:this.added.name,list:this.list.fullName}),this.htmlText=TD.ui.template.toHtml(e,{owner:TD.ui.template.render("text/user_link_fullname",this.owner),added:TD.ui.template.render("text/user_link_fullname",this.added),list:TD.ui.template.render("text/list_link",this.list)})},TD.services.TwitterActionListMemberAdded.prototype.isOwnChirp=function(){return this.owner.id==this.account.getUserID()},TD.services.TwitterActionListMemberAdded.prototype.isAboutYou=function(){return this.added.id==this.account.getUserID()},TD.services.TwitterActionListMemberAdded.prototype.getCreator=function(){return this.owner},TD.services.TwitterActionListMemberAdded.prototype.render=function(){var e={chirp:this};return TD.ui.template.render("status/list_activity",e)},TD.services.TwitterActionListMemberAdded.prototype.renderNotification=function(){return this.render(null)},TD.services.TwitterActionListMemberAdded.prototype.getGrowlData=function(){return{title:this.text,img:null,text:this.list.description}},TD.services.TwitterActionMultiListMemberAdded=function(e){this.account=e},TD.services.TwitterActionMultiListMemberAdded.prototype=new TD.services.TwitterAction,TD.services.TwitterActionMultiListMemberAdded.prototype.action="multi_list_member_added",TD.services.TwitterActionMultiListMemberAdded.prototype.owner=null,TD.services.TwitterActionMultiListMemberAdded.prototype.added=null,TD.services.TwitterActionMultiListMemberAdded.prototype.lists=null,TD.services.TwitterActionMultiListMemberAdded.prototype.fromRESTData=function(e){this.owner=(new TD.services.TwitterUser(this.account)).fromJSONObject(e.sources[0]),this.added=_.map(e.targets,function(e){return(new TD.services.TwitterUser(this.account)).fromJSONObject(e)}),this.lists=_.map(e.target_objects,function(e){return(new TD.services.TwitterList(this.account)).fromJSONObject(e)})},TD.services.TwitterActionMultiListMemberAdded.prototype.generateInternalID=function(){var e=_.pluck(this.added,"id").sort().join("-"),t=_.pluck(this.lists,"id").sort().join("-");this.id=[this.action,this.owner.id,e,t].join("_")},TD.services.TwitterActionMultiListMemberAdded.prototype.generateText=function(){var e=TD.i("{{{owner}}} added {{{added}}} to the lists {{{lists}}}.",null,!0),t=[],n=[],r=[],i=[];_.each(this.added,function(e){t.push(e.name),n.push(TD.ui.template.render("text/user_link_fullname",e))}),_.each(this.lists,function(e){r.push(e.fullName),i.push(TD.ui.template.render("text/list_link",e))}),this.text=TD.ui.template.toHtml(e,{owner:this.owner.name,added:t.join(", "),lists:r.join(", ")}),this.htmlText=TD.ui.template.toHtml(e,{owner:TD.ui.template.render("text/user_link_fullname",this.owner),added:n.join(", "),lists:i.join(", ")})},TD.services.TwitterActionMultiListMemberAdded.prototype.isOwnChirp=function(){return!1},TD.services.TwitterActionMultiListMemberAdded.prototype.isAboutYou=function(){return!1},TD.services.TwitterActionMultiListMemberAdded.prototype.getCreator=function(){return this.owner},TD.services.TwitterActionMultiListMemberAdded.prototype.render=function(){var e={chirp:this};return TD.ui.template.render("status/action_list",e)},TD.services.TwitterActionMultiListMemberAdded.prototype.renderNotification=function(){return this.render(null)},TD.services.TwitterActionMultiListMemberAdded.prototype.getGrowlData=function(){return{title:null,img:null,text:this.text}},TD.services.TwitterActionFavorite=function(e){this.account=e},TD.services.TwitterActionFavorite.prototype=new TD.services.TwitterActionOnTweet,TD.services.TwitterActionFavorite.prototype.action=TD.services.TwitterAction.FAVORITE,TD.services.TwitterActionFavorite.prototype.iconClass="icon-favorited",TD.services.TwitterActionFavorite.prototype.fromRESTData=function(e,t,n,r){this.sourceUser=(new TD.services.TwitterUser(this.account)).fromJSONObject(t),this.targetTweet=(new TD.services.TwitterStatus(this.account)).fromJSONObject(n)},TD.services.TwitterActionFavorite.prototype.fromStreamData=function(e){this.sourceUser=(new TD.services.TwitterUser(this.account)).fromJSONObject(e.source),this.targetTweet=(new TD.services.TwitterStatus(this.account)).fromJSONObject(e.target_object)},TD.services.TwitterActionFavorite.prototype.generateText=function(){var e;this.isAboutYou()?e=TD.i("{{{user}}} favorited",null,!0):e=TD.i("{{{user}}} favorited",null,!0),this.text=TD.ui.template.toHtml(e,{user:this.sourceUser.name}),this.htmlText=TD.ui.template.toHtml(e,{user:TD.ui.template.render("text/user_link_fullname",this.sourceUser)})},TD.services.TwitterActionFollow=function(e){this.account=e},TD.services.TwitterActionFollow.prototype=new TD.services.TwitterAction,TD.services.TwitterActionFollow.prototype.action=TD.services.TwitterAction.FOLLOW,TD.services.TwitterActionFollow.prototype.following=null,TD.services.TwitterActionFollow.prototype.followed=null,TD.services.TwitterActionFollow.prototype.fromRESTData=function(e,t,n,r){this.following=(new TD.services.TwitterUser(this.account)).fromJSONObject(t),this.followed=(new TD.services.TwitterUser(this.account)).fromJSONObject(n)},TD.services.TwitterActionFollow.prototype.fromStreamData=function(e){this.following=(new TD.services.TwitterUser(this.account)).fromJSONObject(e.source),this.followed=(new TD.services.TwitterUser(this.account)).fromJSONObject(e.target)},TD.services.TwitterActionFollow.prototype.generateInternalID=function(){this.id=[this.action,this.following.id,this.followed.id].join("_")},TD.services.TwitterActionFollow.prototype.generateText=function(){var e;this.isAboutYou()?e=TD.i("{{{user}}} followed you",null,!0):e=TD.i("{{{user}}} followed",null,!0),this.text=TD.ui.template.toHtml(e,{user:this.following.name}),this.htmlText=TD.ui.template.toHtml(e,{user:TD.ui.template.render("text/user_link_fullname",this.following)})},TD.services.TwitterActionFollow.prototype.render=function(){return TD.ui.template.render("status/follow_activity_in_stream",{data:this,withUserMenu:!0,withUserBio:!0})},TD.services.TwitterActionFollow.prototype.renderNotification=function(){return TD.ui.template.render("status/follow_activity_in_box",{isAboutYou:this.isAboutYou(),data:this})},TD.services.TwitterActionFollow.prototype.isAboutYou=function(){return this.followed.id==this.account.getUserID()},TD.services.TwitterActionFollow.prototype.isOwnChirp=function(){return this.following.id==this.account.getUserID()},TD.services.TwitterActionFollow.prototype.getGrowlData=function(){var e=this.getRelatedUser();return{title:this.text,img:e.profileImageURL,text:"@"+e.screenName+"\n"+e.description}},TD.services.TwitterActionFollow.prototype.getRelatedUser=function(){return this.isAboutYou()?this.following:this.followed},TD.services.TwitterActionFollow.prototype.getCreator=function(){return this.following},TD.services.TwitterActionFollow.prototype.getFilterableText=function(){return this.followed.screenName},TD.services.TwitterList=function(e){this.account=e},TD.services.TwitterList.prototype.fromJSONObject=function(e){return this.id=e.id_str,this.name=e.name,this.description=e.description,this.slug=e.slug,this.fullName=e.full_name,this.memberCount=e.member_count,this.isPrivate=e.mode==="private",this.user=(new TD.services.TwitterUser(this.account)).fromJSONObject(e.user),this},TD.services.TwitterList.prototype.isOwnList=function(){var e=TD.storage.Account.generateKeyFor("twitter",this.user.id),t=TD.storage.accountController.get(e);return Boolean(t)},TD.services.TweetDeckClient=function(){var e={},t=TD.core.defer,n=TD.sync.tdapi;e.type="tweetdeck",e.statusMenuTemplate="",e.scheduledUpdates=[];var r,i=function(){var t=e.scheduledUpdates.length;for(var n=0;n<t;n++)TD.controller.feedManager.deleteChirp(e.scheduledUpdates[n].id);e.scheduledUpdates=[]},s=function(e){var t=new TD.services.ScheduledStatus;return t.fromJSONObject(e),t},o=function(e){var t,n,r,i,o={};for(t=0,i=e.length;t<i;t++){n=s(e[t]);if(!n.update)continue;o[n.token]||(o[n.token]=new TD.services.ScheduledGroup(n.token));try{o[n.token].addUpdate(n)}catch(u){console.log("Error processing scheduled update",n,u);continue}}return r=_.values(o),r=_.select(r,function(e){return e.pendingCount||e.retryingCount||e.failedCount}),r},u=function(){var e=TD.storage.columnController.getColumnsByType("scheduled"),t=e[0];if(t)TD.controller.feedScheduler.refreshColumn(t.getKey());else if(!TD.settings.getScheduledColAdded()){var n=TD.controller.columnManager.makeColumnFor("scheduled","tweetdeck");TD.controller.columnManager.addColumnToUI(n),TD.settings.setScheduledColAdded(!0)}},a=function(){return n.isLoggedIn()?n.drequest("/scheduled_update"):t.fail()};return e.removeScheduleGroup=function(e){return n.isLoggedIn()?n.drequest("/scheduled_update/"+e,n.getReq({method:"DELETE"})):t.fail()},e.scheduleGroup=function(r,i,s){if(!n.isLoggedIn())return t.fail();var o=TD.util.iso8601(i);for(var a=0;a<r.length;a++)r[a].timestamp=o;var f=n.requestWithBody("/scheduled_update","POST",r);return s&&f.addCallback(function(){return e.removeScheduleGroup(s)}),f.addCallback(u),f},e.refreshFeed=function(t,r,s,o){if(!n.isLoggedIn()){o&&o();return}if(r)return[];var u=e.getScheduledUpdates();return u.addCallback(function(t){return i(),e.scheduledUpdates=t,e.scheduledUpdates}),u.addCallback(s),o&&u.addErrback(o),u},e.getScheduledUpdates=function(){var e=a();return e.addCallback(function(e){if(e)return o(e)}),e},e.forgotPassword=function(e,t,r){var i={type:"DELETE",headers:{Authorization:"Basic "+TD.core.base64.encode(e+":junk")}};return n.drequest("/password",i)},e.feedIsStreaming=function(e){return!1},e},TD.services.ScheduledStatus=function(){},TD.services.ScheduledStatus.prototype.chirpType=TD.services.ChirpBase.SCHEDULED_STATUS,TD.services.ScheduledStatus.prototype.status=null,TD.services.ScheduledStatus.prototype.service="",TD.services.ScheduledStatus.prototype.token="",TD.services.ScheduledStatus.prototype.created="",TD.services.ScheduledStatus.prototype.timestamp="",TD.services.ScheduledStatus.prototype.uid="",TD.services.ScheduledStatus.prototype.update=null,TD.services.ScheduledStatus.prototype.meta=null,TD.services.ScheduledStatus.prototype.resultID=null,TD.services.ScheduledStatus.prototype.profileUrl="",TD.services.ScheduledStatus.prototype.isTwitter=!1,TD.services.ScheduledStatus.prototype.username="",TD.services.ScheduledStatus.prototype.avatar="",TD.services.ScheduledStatus.prototype.errorReason="",TD.services.ScheduledStatus.prototype.fromJSONObject=function(e){return this.status=e.status,this.service=e.service,this.token=e.token,this.created=e.created,this.timestamp=e.timestamp,this.uid=e.uid,this.update=e.update,this.meta=e.meta,this.resultID=e.result_id,this.username=e.meta.user.name,this.errorReason=e.reason,e.meta.user.avatar_url&&(this.avatar=TD.util.transformTwitterAvatar(e.meta.user.avatar_url,"mini")),e.service==="twitter"&&(this.isTwitter=!0),this._generateProfileUrl(),this},TD.services.ScheduledStatus.prototype._generateProfileUrl=function(){switch(this.service){case"twitter":this.meta&&this.meta.user&&(this.profileUrl="http://twitter.com/"+this.meta.user.name);break;case"facebook":this.profileUrl="http://facebook.com/profile.php?id="+this.uid;break;case"foursquare":case"foursquare2":this.profileUrl="http://foursquare.com/user/"+this.uid}},TD.services.ScheduledGroup=function(e){this.token=e,this.id=e,this.updates=[],this.errorReason="",this.reasonText=null},TD.services.ScheduledGroup.prototype=new TD.services.ChirpBase,TD.services.ScheduledGroup.prototype.chirpType=TD.services.ChirpBase.SCHEDULED_GROUP,TD.services.ScheduledGroup.prototype.token="",TD.services.ScheduledGroup.prototype.updates=null,TD.services.ScheduledGroup.prototype.time=null,TD.services.ScheduledGroup.prototype.pendingCount=0,TD.services.ScheduledGroup.prototype.failedCount=0,TD.services.ScheduledGroup.prototype.retryingCount=0,TD.services.ScheduledGroup.prototype.avatarURL=null,TD.services.ScheduledGroup.prototype.service=null,TD.services.ScheduledGroup.prototype.title="",TD.services.ScheduledGroup.prototype.location="",TD.services.ScheduledGroup.prototype.latitude=NaN,TD.services.ScheduledGroup.prototype.longitude=NaN,TD.services.ScheduledGroup.prototype.mapURL=null,TD.services.ScheduledGroup.prototype.htmlText="",TD.services.ScheduledGroup.prototype.twitterInReplyToStatusID=null,TD.services.ScheduledGroup.prototype.twitterDMTargetScreenName=null,TD.services.ScheduledGroup.prototype.twitterPlaceID=null,TD.services.ScheduledGroup.prototype.facebookWallPostTargetID=null,TD.services.ScheduledGroup.prototype.facebookPageID=null,TD.services.ScheduledGroup.prototype.foursquareVenueID=null,TD.services.ScheduledGroup.prototype.buzzRequest=null,TD.services.ScheduledGroup.prototype.addUpdate=function(e){if(!this.time){var t=e.timestamp;t.indexOf("+")===-1&&(t+="+00:00"),this.time=TD.util.parseISO8601(t),this.created=this.time}switch(e.service){case"twitter":this.twitterPlaceID=this.twitterPlaceID||e.update.place_id,this.twitterInReplyToStatusID=this.twitterInReplyToStatusID||e.update.in_reply_to_status_id,e.update.type==="direct_message"&&(this.twitterDMTargetScreenName=this.twitterDMTargetScreenName||e.update.screen_name);break;case"facebook":this.facebookWallPostTargetID=this.facebookWallPostTargetID||e.update.target_id;break;case"fbpage":this.facebookPageID=this.facebookPageID||e.update.uid;break;case"foursquare":this.foursquareVenueID=this.foursquareVenueID||e.update.vid,this.foursquareVenueID=this.foursquareVenueID||e.update.venueId}if(!this.text)if(e.service==="twitter"&&e.update.type==="direct_message")this.text=e.update.body,this.title=TD.i("Direct message to {{1}}",{1:e.update.screen_name});else if(e.service==="facebook"||e.service==="fbpage")this.text=e.update.message,e.update.type==="stream"&&e.update.target_id&&(e.meta&&e.meta.target&&e.meta.target.name?this.title=TD.i("Wall post to {{1}}",{1:e.meta.target.name}):this.title=TD.i("Wall post to {{1}}",{1:"#"+e.update.target_id}));else if(e.service==="foursquare")this.text=e.update.shout,e.meta&&e.meta.location?this.title=TD.i("Check-in to {{1}}",{1:e.meta.location}):this.foursquareVenueID&&(this.title=TD.i("Check-in to {{1}}",{1:"#"+this.foursquareVenueID}));else if(e.service==="buzz"){try{this.buzzRequest=JSON.parse(e.update.body)}catch(n){var r=$(e.update.body).find("content").text();this.buzzRequest={data:{object:{content:r}}}}this.text=this.buzzRequest.data.object.content}else this.text=e.update.body;this.text&&(this.htmlText=TD.util.transform(this.text)),!this.location&&e.meta&&(this.latitude=e.meta.geolat,this.longitude=e.meta.geolong,e.meta.location&&(this.location=e.meta.location,this.mapURL="http://maps.google.com/?q="+encodeURIComponent(this.location)),this.latitude&&this.longitude&&(this.location||(this.location=this.latitude.toPrecision(6)+","+this.longitude.toPrecision(6)),this.mapURL="http://maps.google.com/?q="+this.latitude+","+this.longitude)),e.meta&&e.meta.user&&(this.avatarURL=e.meta.user.avatar_url),this.service=e.service,e.status==="pending"?this.pendingCount++:e.status==="retrying"?this.retryingCount++:e.status==="failed"&&(this.errorReason=e.errorReason,this.failedCount++),this.updates.push(e)},TD.services.ScheduledGroup.prototype.render=function(){return this.errorReason&&(this.reasonText=this.getErrorMessageFromReason(this.errorReason)),TD.ui.template.render("status/tweet_scheduled",{items:[this]})},TD.services.ScheduledGroup.prototype.edit=function(){TD.ui.compose.editScheduledUpdate(this)},TD.services.ScheduledGroup.prototype.destroy=function(e){var t=this,n=_.uniqueId(),r={id:n,title:TD.i("Deleting scheduled update!"),message:TD.i("Are you sure you want to delete this scheduled update?"),okLabel:TD.i("Delete"),cancelLabel:TD.i("Cancel")},i=function(e,r){if(r.id!==n)return;$(document).off("uiConfirmationAction",i);if(r.result){TD.controller.feedManager.deleteChirp(t.id);var s=TD.controller.clients.getTDClient().removeScheduleGroup(t.token);s.addBoth(function(){var e=TD.storage.columnController.getColumnsByType("scheduled"),t=e[0];t&&TD.controller.feedScheduler.refreshColumn(t.getKey())})}};$(document).on("uiConfirmationAction",i).trigger("uiShowConfirmationDialog",r)},TD.services.ScheduledGroup.prototype.prettyTime=function(){return TD.util.prettyTimeString(this.time)},TD.services.ScheduledGroup.prototype.isOwnChirp=function(){return!0},TD.services.ScheduledGroup.prototype.getErrorMessageFromReason=function(e){var t=TD.i("Tweet not sent: ");switch(e){case"duplicate":t+=TD.i("You already tweeted that.");break;default:t+=TD.i("Unknown error.")}return t},TD.services.ScheduledGroup.prototype.getSenders=function(){return _.pluck(this.updates,"username")},TD.services.TwitterClient=function(e){var t=this;this.type="twitter",this.STREAMING_BASE_URL="https://userstream.twitter.com/1.1/user.json",this.streamEngine=new TD.services.StreamEngine(e,_.bind(this.processStreamData,this)),this.firstStreamConnect=!0,this.cachedStreamingQueries={},this.friends={},this.blocks={},this.retweetBlocks={},this.messageThreadCache={},this.publishQueue={},this.flushPending=!1,this.searches=[],this.FEED_TYPES={home:"home",mentions:"mentions",direct:"direct",favorites:"favorites",list:"list",search:"search",usertweets:"usertweets",usertimeline:"usertimeline",interactions:"interactions",networkactivity:"networkactivity",useractivity:"useractivity"},this.streamingFeeds={},this.STREAMING_FEED_TYPES={home:!0,mentions:!0,direct:!0,favorites:!0,search:!0,interactions:!0,networkactivity:!0},this.ACTIVITY_FEED_TYPES={interactions:!0,networkactivity:!0,useractivity:!0},this.ACTIVITY_EVENT_TYPES={favorite:!0,follow:!0,list_member_added:!0,list_created:!0,retweet:!0},this.DELETE_ACTIVITY_EVENT_TYPES={unfavorite:!0,unfollow:!0,list_member_removed:!0,list_destroyed:!0},this.STREAM_LIST_EVENTS={list_created:!0,list_updated:!0,list_destroyed:!0,list_member_added:!0,list_member_removed:!0,list_user_subscribed:!0,list_user_unsubscribed:!0},this.ERRORS={AUTHENTICATION_FAILED:{twitterErrorCode:32,message:TD.i("Could not authenticate you")},404:{twitterErrorCode:34,message:TD.i("We could not complete your request because the tweet may be protected or deleted")},SUSPENDED_USER:{twitterErrorCode:63,message:TD.i("This user has been suspended")},SUSPENDED_ACCOUNT:{twitterErrorCode:64,message:TD.i("Your account is suspended and is not permitted to access this feature")},RATE_LIMITED:{twitterErrorCode:88,message:TD.i("Sorry, you've made too many requests so Twitter has temporarily limited your access. Try again in a few minutes")},OVER_CAPACITY:{twitterErrorCode:130,message:TD.i("Twitter is temporarily over capacity. Please try again later")},INTERNAL_ERROR:{twitterErrorCode:131,message:TD.i("There's something wrong at Twitter. Please try again later")},USER_AUTHENTICATION_FAILED:{twitterErrorCode:135,message:TD.i("Could not authenticate you")},NOT_FOLLOWING:{twitterErrorCode:150,message:TD.i("You can't send a message to a user who is not following you")},DUPLICATE_MESSAGE:{twitterErrorCode:151,message:TD.i("Whoops! You already said that...")},DUPLICATE_TWEET:{twitterErrorCode:187,message:TD.i("You already tweeted that")},INVALID_SEARCH_QUERY:{twitterErrorCode:195,message:TD.i("Invalid search query")},PROTECTED_TWEET:{message:TD.i("Sorry, we could not perform your retweet because the tweet is protected")},DUPLICATE_RETWEET:{message:TD.i("Whoops! You've already retweeted that...")},USER_DOES_NOT_EXIST:{message:TD.i("That user does not exist")},UNKNOWN:{message:TD.i("An unknown error occurred. Please try again shortly.")}},this.streamWarningCodes={FOLLOWS_OVER_LIMIT:"FOLLOWS_OVER_LIMIT"},this.getError=function(e,t,n,r){var i;return e.code?e.code===34?r.status&&r.status.indexOf("DM")===0?i=this.ERRORS.USER_DOES_NOT_EXIST:n.indexOf("show.json")>-1?i=this.ERRORS.USER_DOES_NOT_EXIST:i=this.ERRORS[404]:e.code===89?$(document).trigger("dataTwitterAccountAccessDenied",{account:this.oauth.account}):e.code===64?($(document).trigger("dataTwitterAccountSuspended",{account:this.oauth.account}),i=this.ERRORS.SUSPENDED_ACCOUNT):i=_.find(this.ERRORS,function(t){return t.twitterErrorCode===e.code}):t.status===403&&(e.indexOf("retweet")>-1?i=this.ERRORS.DUPLICATE_RETWEET:e.indexOf("Share validations failed")>-1&&(i=this.ERRORS.PROTECTED_TWEET)),i||(i=this.ERRORS.UNKNOWN),TD.controller.stats.apiErrorResponse(t.status,e.code,n),i},this.oauth=TD.controller.auth.create("twitter",e),this.getLists(null,function(e){_.each(e,TD.cache.lists.add)}),this.getSavedSearches(function(e){t.searches=e}),this.populateBlockList(),this.populateRetweetBlockList(),this.refreshFeed=function(e,n,r,i,s,o){var u=1,a=null,f=e.feed,l=f.getMetadata(),c=this.streamEngine.isStreaming(),h=this.ACTIVITY_FEED_TYPES[f.getType()],p,d,v,m=function(e,t,n){return t>e.length-1?e:e.substr(0,t)+n+e.substr(t+1)};if(o)u=1;else if(e.chirpArray&&e.chirpArray.length)if(n){a=e.getOldestChirp().id;if(h)a=e.getOldestChirp().minPosition||e.getOldestChirp().created.getTime().toString(),a-=1;else if(typeof a=="string")for(var g=a.length-1;g>=0;g--){p=a.charAt(g);if(p!=="0"){p=String(Number(p)-1),a=m(a,g,p);break}a=m(a,g,9)}else a--}else h?u=e.chirpArray[0].maxPosition||e.chirpArray[0].created.getTime().toString():u=e.chirpArray[0].getSinceId();var y=t.STREAMING_FEED_TYPES[f.getType()];switch(f.getType()){case"favorites":y=!l.id||l.id===this.oauth.account.getUserID();break;case"search":y=TD.services.TwitterSearchParser.isStreamable(l.term)}var b=s||!c||u===1;if(y){this.streamingFeeds[f.getKey()]=f;if(!b)return i(),this}switch(f.getType()){case this.FEED_TYPES.home:t.getHomeTimeline(u,a,null,r,i);break;case this.FEED_TYPES.direct:t.getMessageTimelines(u,a,null,r,i);break;case this.FEED_TYPES.favorites:t.getFavoritesTimeline(u,l.id,a,null,r,i);break;case this.FEED_TYPES.list:t.getListTimeline(l.listId,l.screenName,l.slug,u,a,null,r,i);break;case this.FEED_TYPES.search:l.baseQuery&&l.searchFilterData?(d=new TD.vo.SearchFilter(l.searchFilterData),v=[l.baseQuery,d.getQueryString()].join(" ")):v=l.term,t.getSearchTimeline(v,u,a,null,r,i);break;case this.FEED_TYPES.usertweets:t.getProfileTimeline(l.id,null,u,a,r,i);break;case this.FEED_TYPES.usertimeline:t.getUserTimeline(l.id,u,a,null,r,i);break;case this.FEED_TYPES.mentions:t.getMentionsTimeline(u,a,null,r,i);break;case this.FEED_TYPES.interactions:t.getInteractionsTimeline(u,a,null,r,i);break;case this.FEED_TYPES.networkactivity:t.getNetworkActivityTimeline(u,a,null,r,i);break;case this.FEED_TYPES.useractivity:t.getUserActivityTimeline(l.screenName,u,a,null,r,i);break;default:i()}return this},this.feedIsStreaming=function(e){return this.streamingFeeds[e]&&this.streamEngine.isStreaming()},this.create=function(){return new TD.services.TwitterComposer(this)},this._checkUserStream=_.bind(this.checkUserStream,this),this.subscription=$.subscribe("/storage/client/settings/use_stream",this._checkUserStream)},TD.services.TwitterClient.prototype.INTERNAL_API_BASE_URL=TD.config.TWITTER_INTERNAL_API_ROOT||"https://api.twitter.com/i/",TD.services.TwitterClient.prototype.API_BASE_URL=TD.config.TWITTER_API_ROOT||"https://api.twitter.com/1.1/",TD.services.TwitterClient.prototype.API_V1_BASE_URL=TD.config.TWITTER_API_V1_ROOT||"https://api.twitter.com/1/",TD.services.TwitterClient.prototype.makeTwitterCall=function(e,t,n,r,i,s,o){var u=this;t=t||{},t.include_entities=1,t.include_user_entities=1,t.include_cards=1,t.send_error_codes=1;var a=TD.net.ajax.request(e,{params:t,account:this.oauth.account,method:n});return a.addCallback(function(e){var t=e.data;if(r)try{t=r.call(u,t)}catch(n){console.log("Error processing Twitter data",t,n),s(n);return}i(t),this.processRateLimitData(o,e.xhr)}.bind(this)),a.addErrback(function(i){var a,f=[],l=i.req||{};l.responseText&&(a=JSON.parse(l.responseText),a&&a.errors&&(typeof a.errors=="string"?f.push(u.getError(a.errors,l,e,t)):_.each(a.errors,function(n){f.push(u.getError(n,l,e,t))}))),$(document).trigger("dataTwitterApiError",{request:{url:e,params:t,method:n,processor:r},response:{xhr:l,ts:"",error:i.msg},errors:f}),s&&(l.errors=f,s(l,"",i.msg,f)),this.processRateLimitData(o,l)}.bind(this)),a},TD.services.TwitterClient.prototype.processRateLimitData=function(e,t){if(!e)return;var n={rateLimitRemaining:parseInt(t.getResponseHeader("x-rate-limit-remaining"),10),rateLimitTotal:parseInt(t.getResponseHeader("x-rate-limit-limit"),10),rateLimitReset:parseInt(t.getResponseHeader("x-rate-limit-reset"),10)};n.rateLimitTotal&&n.rateLimitReset&&$(document).trigger("dataRateLimit",{feedType:e,accountKey:this.oauth.account.getKey(),rateLimitData:n})},TD.services.TwitterClient.prototype.processTweet=function(e){return(new TD.services.TwitterStatus(this.oauth.account)).fromJSONObject(e)},TD.services.TwitterClient.prototype.processDM=function(e){return(new TD.services.TwitterDirectMessage(this.oauth.account)).fromJSONObject(e)},TD.services.TwitterClient.prototype.processMessages=function(e,t){var n={},r=[],i=this;return _.each(e,function(e){var t=e.getCorrespondent(),r=i.messageThreadCache[t.id],s=n[t.id];r||(r=new TD.services.TwitterMessageThread(i.oauth.account,t),i.messageThreadCache[t.id]=r),s||(s=[],n[t.id]=s),s.push(e)}),_.each(n,function(e,t){var n=i.messageThreadCache[t],s=n.addMessages(e);s&&r.push(n)}),t&&this.publishChirpsInternal("publish","direct",r),r.sort(TD.util.chirpDescSort)},TD.services.TwitterClient.prototype.deleteMessage=function(e){var t=[],n=[],r=[],i=this;_.each(this.messageThreadCache,function(t,i){t.removeMessage(e)&&(t.messages.length===0?r.push(t):n.push(t))}),_.each(r,function(e){delete i.messageThreadCache[e.id],TD.controller.feedManager.deleteChirp(e.id)}),this.publishChirpsInternal("publish","direct",n)},TD.services.TwitterClient.prototype.processPlaces=function(e){return e.result.places},TD.services.TwitterClient.prototype.processTimeline=function(e){var t,n;if(!e.length)return[];for(t=e.length;t--;)n=e[t],n.sender?n=this.processDM(n):n=this.processTweet(n),e[t]=n;return e},TD.services.TwitterClient.prototype.processTrends=function(e){var t={locations:e[0].locations,trends:[]},n=e[0].trends,r;for(var i=0;i<n.length;i++)r=(new TD.services.TrendingTopic).fromJSONObject(n[i]),t.trends.push(r);return t},TD.services.TwitterClient.prototype.processTrendLocations=function(e){function i(e,t){var n=e.sortString,r=t.sortString;return n<r?-1:n>r?1:0}var t=[],n,r;for(r=0;r<e.length;r++)n=(new TD.services.TrendLocation).fromJSONObject(e[r]),t.push(n);return t.sort(i)},TD.services.TwitterClient.prototype.processList=function(e){return(new TD.services.TwitterList(this.oauth.account)).fromJSONObject(e)},TD.services.TwitterClient.prototype.processLists=function(e){return _.map(e,_.bind(this.processList,this))},TD.services.TwitterClient.prototype.processUser=function(e){return(new TD.services.TwitterUser(this.oauth.account)).fromJSONObject(e)},TD.services.TwitterClient.prototype.processUsers=function(e){var t=[];for(var n=0;n<e.length;n++)t.push(this.processUser(e[n]));return t},TD.services.TwitterClient.prototype.processActions=function(e){var t=[],n=this;for(var r=0;r<e.length;r++){var i=e[r];if(i.action==="list_member_added"&&i.targets_size>1&&i.target_objects_size>1){var s=new TD.services.TwitterActionMultiListMemberAdded(this.oauth.account);s.fromJSONObject(i,[i],!1),t.push(s)}else t=t.concat(TD.services.TwitterAction.processRESTAction(i,this.oauth.account))}return t},TD.services.TwitterClient.prototype.showUser=function(e,t,n,r){var i={};e?i.user_id=e:i.screen_name=t,this.makeTwitterCall(this.API_BASE_URL+"users/show.json",i,"GET",this.processUser,n,r)},TD.services.TwitterClient.prototype.getUsersByIds=function(e,t,n){var r={user_id:e.join(",")};this.makeTwitterCall(this.API_BASE_URL+"users/lookup.json",r,"POST",this.processUsers,t,n)},TD.services.TwitterClient.prototype.followUser=function(e,t,n){this.makeTwitterCall(this.API_BASE_URL+"friendships/create.json",{screen_name:e},"POST",this.processUser,t,n)},TD.services.TwitterClient.prototype.unfollowUser=function(e,t,n){this.makeTwitterCall(this.API_BASE_URL+"friendships/destroy.json",{screen_name:e},"POST",this.processUser,t,n)},TD.services.TwitterClient.prototype.typeaheadSearch=function(e,t,n){var r=function(n){t(n,e)};if(!e.query&&!e.prefetch)throw new Error("Typeahead API needs a query");this.makeTwitterCall(this.INTERNAL_API_BASE_URL+"search/typeahead.json",{q:e.query,count:e.count||10,prefetch:e.prefetch?!0:!1},"GET",null,r,n)},TD.services.TwitterClient.prototype.userSearch=function(e,t,n){var r=this,i=function(t){var n,i=e.toLowerCase(),s;t=r.processUsers(t);for(n=0;n<t.length;n++){s=t[n];if(s.screenName.toLowerCase()==i&&n!==0){t.splice(n,1),t=[s].concat(t);break}}return t};this.makeTwitterCall(this.API_BASE_URL+"users/search.json",{q:e},"GET",i,t,n)},TD.services.TwitterClient.prototype.getRetweetedBy=function(e,t,n,r,i){var s={count:t||12,page:n||1};this.makeTwitterCall(this.API_BASE_URL+"statuses/"+e+"/retweeted_by.json",s,"GET",this.processUsers,r,i)},TD.services.TwitterClient.prototype.showFriendship=function(e,t,n,r,i){var s={source_id:e};t!==null?s.target_id=t:n!==null&&(s.target_screen_name=n),this.makeTwitterCall(this.API_BASE_URL+"friendships/show.json",s,"GET",null,r,i)},TD.services.TwitterClient.prototype.showFriendshipForScreenName=function(e,t,n,r){this.makeTwitterCall(this.API_BASE_URL+"friendships/show.json",{source_id:e,target_screen_name:t},"GET",null,n,r)},TD.services.TwitterClient.prototype.blockUser=function(e,t,n){this.makeTwitterCall(this.API_BASE_URL+"blocks/create.json",{screen_name:e},"POST",this.processUser,t,n)},TD.services.TwitterClient.prototype.unblockUser=function(e,t,n){var r=this;this.makeTwitterCall(this.API_BASE_URL+"blocks/destroy.json",{screen_name:e},"DELETE",this.processUser,t,n)},TD.services.TwitterClient.prototype.blockAndReportUser=function(e,t,n){this.makeTwitterCall(this.API_BASE_URL+"users/report_spam.json",{screen_name:e},"POST",this.processUser,t,n)},TD.services.TwitterClient.prototype.flagTweet=function(e,t,n){this.makeTwitterCall(this.API_BASE_URL+"statuses/flag_possibly_sensitive.json",{id:e},"POST",null,t,n)},TD.services.TwitterClient.prototype.getList=function(e,t,n,r,i){var s={};e?s.list_id=e:(s.slug=n,s.owner_screen_name=t),this.makeTwitterCall(this.API_BASE_URL+"lists/show.json",s,"GET",this.processList,r,i)},TD.services.TwitterClient.prototype.createList=function(e,t,n,r,i){var s=this,o={name:e,description:t||"",mode:n?"private":"public"},u=function(e){TD.cache.lists.add(e),r(e)};this.makeTwitterCall(this.API_BASE_URL+"lists/create.json",o,"POST",this.processList,u,i)},TD.services.TwitterClient.prototype.updateList=function(e,t,n,r,i,s){var o=this,u={list_id:e,name:t,description:n||"",mode:r?"private":"public"},a=function(e){TD.cache.lists.add(e),i(e)};this.makeTwitterCall(this.API_BASE_URL+"lists/update.json",u,"POST",this.processList,a,s)},TD.services.TwitterClient.prototype.destroyList=function(e,t,n){var r=this,i=function(e){TD.cache.lists.purge(e.id),t(e)};this.makeTwitterCall(this.API_BASE_URL+"lists/destroy.json",{list_id:e},"POST",this.processList,i,n)},TD.services.TwitterClient.prototype.getListMembers=function(e,t,n,r){var i=this,s=function(e){e.users=i.processUsers(e.users),n(e)};_.isUndefined(t)&&(t=-1),this.makeTwitterCall(this.API_BASE_URL+"lists/members.json",{list_id:e,skip_status:1,cursor:t},"GET",null,s,r)},TD.services.TwitterClient.prototype.subscribeToList=function(e,t,n){var r=function(e){TD.cache.lists.add(e),t(e)};this.makeTwitterCall(this.API_BASE_URL+"lists/subscribers/create.json",{list_id:e},"POST",!0,this.processList,r,n)},TD.services.TwitterClient.prototype.addUserToList=function(e,t,n,r){var i=function(e){TD.cache.lists.add(e),n(e)};this.makeTwitterCall(this.API_BASE_URL+"lists/members/create.json",{screen_name:t,list_id:e},"POST",this.processList,i,r)},TD.services.TwitterClient.prototype.addUsersToList=function(e,t,n,r){var i=function(e){TD.cache.lists.add(e),n(e)};this.makeTwitterCall(this.API_BASE_URL+"lists/members/create_all.json",{screen_name:t.join(","),list_id:e},"POST",this.processList,i,r)},TD.services.TwitterClient.prototype.removeUserFromList=function(e,t,n,r){var i=function(e){TD.cache.lists.add(e),n(e)};this.makeTwitterCall(this.API_BASE_URL+"lists/members/destroy.json",{screen_name:t,list_id:e},"POST",this.processList,i,r)},TD.services.TwitterClient.prototype.getBlockIDs=function(e,t){this.makeTwitterCall(this.API_BASE_URL+"blocks/ids.json",{stringify_ids:!0},"GET",null,e,t)},TD.services.TwitterClient.prototype.getNoRetweetIDs=function(e,t){this.makeTwitterCall(this.API_BASE_URL+"friendships/no_retweets/ids.json",null,"GET",null,e,t)},TD.services.TwitterClient.prototype.getTweetSummary=function(e,t,n){var r={};this.makeTwitterCall(this.INTERNAL_API_BASE_URL+"statuses/"+e+"/activity/summary.json",r,"GET",null,t,n)},TD.services.TwitterClient.prototype.getEmbeddedTweet=function(e,t,n,r,i,s){var o;if(!e)throw new Error("getEmbeddedTweet: tweetID is a required parameter");o={id:e,partner:"tweetdeck"},t&&(o.hide_thread=t),n&&(o.hide_media=n),r&&(o.maxwidth=r),this.makeTwitterCall(this.API_BASE_URL+"statuses/oembed.json",o,"GET",null,i,s)},TD.services.TwitterClient.prototype.translateTweet=function(e,t,n,r){var i;if(!e)throw new Error("translateTweet: tweetID is a required parameter");if(!t)throw new Error("translateTweet: destLang is a required parameter");i={id:e,dest:t},this.makeTwitterCall(this.API_BASE_URL+"translations/show.json",i,"GET",null,n,r)},TD.services.TwitterClient.prototype.getFollowingFollowersOf=function(e,t,n){var r;if(!e)throw new Error("getFollowingFollowersOf: screenName is a required parameter");r={screen_name:e},this.makeTwitterCall("https://api.twitter.com/users/following_followers_of.json",r,"GET",null,t,n)},TD.services.TwitterClient.prototype.getHomeTimeline=function(e,t,n,r,i){this.getTimeline("statuses/home_timeline.json",e,t,n,r,i,{},this.FEED_TYPES.home)},TD.services.TwitterClient.prototype.getUserTimeline=function(e,t,n,r,i,s){var o={user_id:e};this.getTimeline(this.API_V1_BASE_URL+"statuses/following_timeline.json",t,n,r,i,s,o,this.FEED_TYPES.usertimeline)},TD.services.TwitterClient.prototype.getMentionsTimeline=function(e,t,n,r,i){this.getTimeline("statuses/mentions_timeline.json",e,t,n,r,i,{},this.FEED_TYPES.mentions)},TD.services.TwitterClient.prototype.getInteractionsTimeline=function(e,t,n,r,i){this.getActivityTimeline("activity/about_me.json",e,t,n,r,i,{},this.FEED_TYPES.interactions)},TD.services.TwitterClient.prototype.getNetworkActivityTimeline=function(e,t,n,r,i){this.getActivityTimeline("activity/by_friends.json",e,t,n,r,i,{},this.FEED_TYPES.networkactivity)},TD.services.TwitterClient.prototype.getUserActivityTimeline=function(e,t,n,r,i,s){var o={screen_name:e};this.getActivityTimeline(this.TWITTER_API_V1_ROOT+"activity/by_user.json",t,n,r,i,s,o,this.FEED_TYPES.useractivity)},TD.services.TwitterClient.prototype.getActivityTimeline=function(e,t,n,r,i,s,o){o=o||{},n&&(o.max_id=n),t&&(o.min_id=t),o.count=r||200,o.skip_aggregation=!0,this.makeTwitterCall(this.INTERNAL_API_BASE_URL+e,o,"GET",this.processActions,i,s)},TD.services.TwitterClient.prototype.getMessageTimelines=function(e,t,n,r,i){function f(e){s++,o++,u=u.concat(e),s===2&&r(a.processMessages(u,!1))}function l(){s++,s===2&&(o>0?r(a.processMessages(u,!1)):i.apply(null,arguments))}var s=0,o=0,u=[],a=this;e==1&&(this.messageThreadCache={}),this.getDMTimeline(e,t,null,f,l),this.getSentDMTimeline(e,t,null,f,l)},TD.services.TwitterClient.prototype.getDMTimeline=function(e,t,n,r,i){this.getTimeline("direct_messages.json",e,t,n,r,i,{},this.FEED_TYPES.direct)},TD.services.TwitterClient.prototype.getSentDMTimeline=function(e,t,n,r,i){this.getTimeline("direct_messages/sent.json",e,t,n,r,i)},TD.services.TwitterClient.prototype.getFavoritesTimeline=function(e,t,n,r,i,s){var o={};t&&(o.user_id=t),this.getTimeline("favorites/list.json",e,n,r,i,s,o,this.FEED_TYPES.favorites)},TD.services.TwitterClient.prototype.getListTimeline=function(e,t,n,r,i,s,o,u){var a="lists/statuses.json",f={include_rts:1};e?f.list_id=e:(f.owner_screen_name=t,f.slug=n),this.getTimeline(a,r,i,s,o,u,f,this.FEED_TYPES.list)},TD.services.TwitterClient.prototype.getProfileTimeline=function(e,t,n,r,i,s){var o="statuses/user_timeline.json",u={include_rts:1};e&&e!==this.oauth.account.getUserID()&&(u.user_id=e),this.getTimeline(o,n,r,t,i,s,u,this.FEED_TYPES.usertweets)},TD.services.TwitterClient.prototype.getSearchTimeline=function(e,t,n,r,i,s){var o={count:r||200,q:e,result_type:"recent"},u=this,a;_.contains(e,"near:")||_.contains(e,"within:")?a=u.INTERNAL_API_BASE_URL+"search.json":a=u.API_BASE_URL+"search/tweets.json";var f=function(e){return u.processTimeline(e.statuses)},l=function(e,t,n){e&&e.errors&&e.errors[0]===this.ERRORS.INVALID_SEARCH_QUERY?i([]):s.apply(null,arguments)}.bind(this);n&&(o.max_id=n),t&&t!=1&&(o.since_id=t),this.makeTwitterCall(a,o,"GET",f,i,l,this.FEED_TYPES.search)},TD.services.TwitterClient.prototype.getTimeline=function(e,t,n,r,i,s,o,u){var a={since_id:t||1,count:r||200,include_my_retweet:1},f="";_.startsWith(e,"https://")?f=e:f=this.API_BASE_URL+e,n&&(a.max_id=n),o&&_.extend(a,o),this.makeTwitterCall(f,a,"GET",this.processTimeline,i,s,u)},TD.services.TwitterClient.prototype.pendingConversation={},TD.services.TwitterClient.prototype.getConversation=function(e){var t=this;if(this.pendingConversation[e])return;var n=function(n){delete t.pendingConversation[e];var r={ancestors:[],descendants:[]},i=!1;n.forEach(function(t){i?r.descendants.push(t):t.id===e?i=!0:r.ancestors.push(t)}),$.publish("/tweets/conversation/"+e,[r])},r=function(){delete t.pendingConversation[e];var n={ancestors:[],descendants:[]};$.publish("/tweets/conversation/"+e,[n])};this.pendingConversation[e]=!0,this.makeTwitterCall(this.API_BASE_URL+"conversation/show.json",{id:e},"GET",this.processTimeline,n,r)},TD.services.TwitterClient.prototype.destroy=function(e,t,n){this.makeTwitterCall(this.API_BASE_URL+"statuses/destroy/:id.json".replace(":id",e),{},"POST",this.processTweet,t,n)},TD.services.TwitterClient.prototype.show=function(e,t,n){this.makeTwitterCall(this.API_BASE_URL+"statuses/show.json",{id:e},"GET",this.processTweet,t,n)},TD.services.TwitterClient.prototype.update=function(e,t,n,r,i,s,o){var u={status:e};u.in_reply_to_status_id=t,u.lat=n,u["long"]=r,u.place_id=i,this.makeTwitterCall(this.API_BASE_URL+"statuses/update.json",u,"POST",this.processTweet,s,o)},TD.services.TwitterClient.prototype.getLists=function(e,t,n){var r={};e&&(r.screen_name=e),this.makeTwitterCall(this.API_BASE_URL+"lists/list.json",r,"GET",this.processLists,t,n)},TD.services.TwitterClient.prototype.getListMemberships=function(e,t,n,r){var i={},s=this;e&&(i.screen_name=e),t&&(i.filter_to_owned_lists=1);var o=function(e){return s.processLists(e.lists)};this.makeTwitterCall(this.API_BASE_URL+"lists/memberships.json",i,"GET",o,n,r)},TD.services.TwitterClient.prototype.getSavedSearches=function(e,t){var n={};this.makeTwitterCall(this.API_BASE_URL+"saved_searches/list.json",n,"GET",null,e,t)},TD.services.TwitterClient.prototype.favorite=function(e,t,n){var r=this,i=function(e){r.updateFavoriteInternal(e,!0),t(e)};this.makeTwitterCall(this.API_BASE_URL+"favorites/create.json",{id:e},"POST",this.processTweet,i,n)},TD.services.TwitterClient.prototype.unfavorite=function(e,t,n){var r=this,i=function(e){r.updateFavoriteInternal(e,!1),t(e)};this.makeTwitterCall(this.API_BASE_URL+"favorites/destroy.json",{id:e},"POST",this.processTweet,i,n)},TD.services.TwitterClient.prototype.destroyDM=function(e,t,n){this.makeTwitterCall(this.API_BASE_URL+"direct_messages/destroy.json",{id:e},"POST",this.processDM,t,n)},TD.services.TwitterClient.prototype.markMessagesAsRead=function(e,t,n,r){var i={last_message_id:e};t&&(i.sender_id=t),this.makeTwitterCall(this.API_BASE_URL+"direct_messages/read.json",i,"POST",null,n,r)},TD.services.TwitterClient.prototype.geoSearch=function(e,t,n,r,i,s,o){var u={};t&&(u.lat=t),n&&(u["long"]=n),r&&(u.accuracy=r),e&&(u.query=e),u.granularity=i||"neighborhood",this.makeTwitterCall(this.API_BASE_URL+"geo/search.json",u,"GET",this.processPlaces,s,o)},TD.services.TwitterClient.prototype.getTrends=function(e,t,n){e=e||1,this.makeTwitterCall(this.API_BASE_URL+"trends/place.json",{id:e},"GET",this.processTrends,t,n)},TD.services.TwitterClient.prototype.getTrendLocations=function(e,t){this.makeTwitterCall(this.API_BASE_URL+"trends/available.json",null,"GET",this.processTrendLocations,e,t)},TD.services.TwitterClient.prototype.updateFavoriteInternal=function(e,t){e=e.retweetedStatus?e.retweetedStatus:e,e.setFavorite(t);var n=t?"publish":"remove";this.publishChirpsInternal(n,"favorites",[e])},TD.services.TwitterClient.prototype.removeAction=function(e){var t=TD.services.TwitterAction.processStreamAction(e,this.oauth.account);return t.isAboutYou()?this.publishChirpsInternal("remove","interactions",[t]):t.isOwnChirp()||this.publishChirpsInternal("remove","networkactivity",[t]),t},TD.services.TwitterClient.prototype.publishAction=function(e){var t=TD.services.TwitterAction.processStreamAction(e,this.oauth.account);t.isAboutYou()?this.publishChirpsInternal("publish","interactions",[t]):t.isOwnChirp()||this.publishChirpsInternal("publish","networkactivity",[t])},TD.services.TwitterClient.prototype.queueChirpsForDispatch=function(e,t){var n=this;this.publishQueue[e]=(this.publishQueue[e]||[]).concat(t),this.flushPending||(this.flushPending=!0,_.defer(function(){_.each(n.publishQueue,function(e,t){var n=TD.controller.feedManager.getPoller(t);n&&n.acceptChirps(e)}),n.publishQueue={},n.flushPending=!1}))},TD.services.TwitterClient.prototype.publishChirpsInternal=function(e,t,n,r){var i,s;i=TD.storage.Feed.generateKeyFor(this.oauth.account.getKey(),t,r),e=="publish"?this.queueChirpsForDispatch(i,n):e=="remove"&&(s=TD.controller.feedManager.getPoller(i),s&&_.each(n,function(e){s.removeChirp(e.id)}))},TD.services.TwitterClient.prototype.populateBlockList=function(){this.getBlockIDs(function(e){var t=e.ids,n;this.blocks={};for(n=0;n<t.length;n++)this.blocks[t[n]]=!0}.bind(this))},TD.services.TwitterClient.prototype.populateRetweetBlockList=function(){var e=this;this.getNoRetweetIDs(function(e){var t;this.retweetBlocks={};for(t=0;t<e.length;t++)this.retweetBlocks[e[t]]=!0}.bind(this))},TD.services.TwitterClient.prototype.constructStreamingUrl=function(){var e=this,t={},n=!1,r=!0;_.each(this.streamingFeeds,function(i,s){var o=i.getMetadata(),u=TD.controller.feedManager.getPoller(s);if(u){r=!1;if(i.managed&&i.getType()=="search"){var a=o.term,f=a.toLowerCase(),l=new TD.services.TwitterSearchParser(a);t[f]=l}else i.getType()=="home"&&(n=!0)}else delete e.streamingFeeds[s]});var i=[];for(var s in t)i.push(t[s].trackQuery);i=_.uniq(i.join(",").split(","));var o=i.join(","),u={};o&&(u.track=o),n||(u["with"]="user");var a=!1;return _.each(TD.storage.feedController.getAll(),function(t){t.getType()==="networkactivity"&&t.getService()==="twitter"&&e.oauth.account.getKey()===t.getAccountKey()&&(a=!0)}),a&&(u.include_followings_activity=!0),r?null:TD.net.util.addURLParameters(this.STREAMING_BASE_URL,u)},TD.services.TwitterClient.prototype.checkUserStream=function(){TD.util.shouldStream()?this.streamEngine.connect(this.constructStreamingUrl()):this.streamEngine.disconnect()},TD.services.TwitterClient.prototype.processDeleteChirpEvent=function(e){e["delete"].status?TD.controller.feedManager.deleteChirp(e["delete"].status.id_str):e["delete"].direct_message&&this.deleteMessage(e["delete"].direct_message.id_str)},TD.services.TwitterClient.prototype.processStreamData=function(e){var t=this;if(e.friends){for(var n=0;n<e.friends.length;n++)this.friends[e.friends[n]]=!0;try{this.firstStreamConnect||TD.controller.feedScheduler.refreshAccountFeeds(this.oauth.account.getKey(),!0)}finally{this.firstStreamConnect=!1}}else if(e.warning)switch(e.warning.code){case this.streamWarningCodes.FOLLOWS_OVER_LIMIT:}else if(e.event)this.processStreamEvent(e);else if(!e.limit)if(e["delete"])this.processDeleteChirpEvent(e);else if(e.direct_message){var r=this.processDM(e.direct_message);this.processMessages([r],!0)}else if(e.id_str&&e.text){var i=this.processTweet(e);this.processMiscTweet(i)}else TD.controller.stats.unknownStreamData(e)},TD.services.TwitterClient.prototype.processMiscTweet=function(e){var t=this,n=Boolean(this.friends[e.user.id]),r=e.user.id==this.oauth.account.getUserID(),i=e.isMention(),s=Boolean(e.retweetedStatus),o=s&&e.retweetedStatus.user.id==this.oauth.account.getUserID(),u=s&&(e.retweetedStatus.user.following||this.friends[e.retweetedStatus.user.id]),a,f,l,c,h;l=e.entities&&e.entities.user_mentions&&e.entities.user_mentions.some(function(e){if(e.indices&&e.indices[0]===0)return h=e.id,!0}),c=l&&Boolean(this.friends[h]);if(this.blocks[e.user.id]||s&&this.blocks[e.retweetedStatus.user.id])return;if(s&&this.retweetBlocks[e.user.id]&&!o)return;r&&s&&(e.setRetweeted(!0),e.retweetedStatus.setRetweeted(!0)),(r||n&&(!l||c||i))&&!o&&!u&&this.publishChirpsInternal("publish","home",[e]),o?(f=(new TD.services.TwitterActionRetweet(this.oauth.account)).fromRetweet(e),this.publishChirpsInternal("publish","interactions",[f])):i&&!s&&(this.publishChirpsInternal("publish","mentions",[e]),a=(new TD.services.TwitterActionMention(this.oauth.account)).fromStreamData(e),this.publishChirpsInternal("publish","interactions",[a])),_.each(this.streamingFeeds,function(n,r){var i=n.getMetadata();if(n.managed&&n.getType()=="search"){var s=i.term,o=t.cachedStreamingQueries[s];o||(o=t.cachedStreamingQueries[s]=new TD.services.TwitterSearchParser(s)),o.match(e.getFilterableText())&&t.queueChirpsForDispatch(r,[e])}}),this.publishChirpsInternal("publish","usertweets",[e],{id:parseInt(e.user.id,10)}),r&&this.publishChirpsInternal("publish","usertweets",[e],{})},TD.services.TwitterClient.prototype.processStreamEvent=function(e){var t,n,r=!1;this.STREAM_LIST_EVENTS[e.event]&&(t=(new TD.services.TwitterList(this.oauth.account)).fromJSONObject(e.target_object));if(e.source.id==this.oauth.account.getUserID())switch(e.event){case"favorite":r=e.source.id===e.target_object.user.id,n=this.processTweet(e.target_object),this.updateFavoriteInternal(n,!0);break;case"unfavorite":n=this.processTweet(e.target_object),this.updateFavoriteInternal(n,!1);break;case"follow":this.friends[e.target.id]=!0;break;case"unfollow":delete this.friends[e.target.id];break;case"block":this.blocks[e.target.id]=!0,delete this.friends[e.target.id];break;case"unblock":delete this.blocks[e.target.id];break;case"list_created":case"list_updated":case"list_member_added":case"list_member_removed":case"list_user_subscribed":TD.cache.lists.add(t);break;case"list_destroyed":TD.cache.lists.purge(t.id);break;case"list_user_unsubscribed":TD.cache.lists.unsubscribe(t)}else e.event==="favorite"&&(e.target_object.favorited=!1,e.target_object.retweeted=!1);this.ACTIVITY_EVENT_TYPES[e.event]&&!r?this.publishAction(e):this.DELETE_ACTIVITY_EVENT_TYPES[e.event]&&this.removeAction(e)},TD.services.TwitterClient.prototype.cleanUp=function(){$.unsubscribe(this.subscription),this.streamEngine.disconnect()},TD.ui.main=function(){var e={},t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};e.TRANSITION_END_EVENTS=t[Modernizr.prefixed("transition")];var n=function(e,t){$(".js-app-add-column").removeClass("is-hidden")},r=function(e,t){$(".js-app-add-column").addClass("is-hidden")};return e.init=function(){var t=$("body"),i=$(TD.ui.template.render("topbar/app_header",{searchInputClassName:"js-app-search-input app-search-input",searchInputPlaceholder:TD.i("Search")})),s=$(TD.ui.template.render("app_container"));$(".js-app").append(i),$(".js-app").append(s),$(".js-app-loading").hide(),TD.util.isWrapperApp()&&deck.closeLoadingScreen&&deck.closeLoadingScreen(),t.on("click","a",function(e){var t=TD.util.maybeOpenClickExternally(e)}),TD.ui.columns.init(),TD.ui.updates.init(),TD.ui.compose.init(),TD.ui.openColumn.init(),t.tooltip({selector:".js-show-tip",container:"body",delay:{show:500},suppressFadeOut:!0}),t.on("click","a",function(e){var t=$(e.currentTarget),n=t.attr("rel"),r=!1;switch(n){case"user":var i=t.data("user-name")||_.last(t.attr("href").split("/"));$(document).trigger("uiShowProfile",{id:i}),r=!0;break;case"hashtag":$(document).trigger("uiPerformSearch",{query:t.text()}),r=!0}r&&e.preventDefault(),e.isDefaultPrevented()===!1&&(TD.util.openURL(t.attr("href")),e.preventDefault())}),t.on("click","button",function(e){e.preventDefault()}),t.on("submit",function(e){e.preventDefault()}),$.subscribe("/storage/client/settings/column_width",e.updateColumnSize),e.updateColumnSize(),$.subscribe("/storage/client/settings/font_size",e.updateFontSize),e.updateFontSize();var o=_.debounce(function(e){$(document).trigger("uiMainWindowResized")},50);$(window).on("resize",o),$(document).on("uiColumnNavSizeOverflow",n.bind(this)),$(document).on("uiColumnNavSizeNormal",r.bind(this))},e.updateColumnSize=function(){var e=TD.settings.getColumnWidth(),t=$("html");t.removeClass("is-narrow-columns is-wide-columns");switch(e){case"narrow":t.addClass("is-narrow-columns");break;case"wide":t.addClass("is-wide-columns")}$(document).trigger("uiColumnWidthChange",{columnWidth:e})},e.updateFontSize=function(){var e=TD.settings.getFontSize(),t=$("html");t.removeClass("txt-base-smallest txt-base-small txt-base-large txt-base-largest");switch(e){case"smallest":t.addClass("txt-base-smallest");break;case"small":t.addClass("txt-base-small");break;case"large":t.addClass("txt-base-large");break;case"largest":t.addClass("txt-base-largest")}},e}(),TD.ui.compose=function(){function G(e){_.defer(mt)}function Y(e){!e.target.disabled&&e.which===13&&Z(e)}function Z(e){var t=$(e.target);t.attr("rel")||(t=$(e.target).parent());var n=t.attr("rel");e.target.id==="compose-modal"&&(n="dismiss");if(!n)return;e.preventDefault();if(t.prop("disabled")||t.hasClass("is-disabled"))return;if(d&&n!=="account"&&n!=="edit")return;switch(n){case"dismiss":lt();break;case"send":ut();break;case"message":O?it():nt();break;case"enterSchedule":tt();break;case"message":}}function tt(){var e=$("#compose-schedule"),t=function(e){var t,n;e===null?(S.$node.hide(),P.removeClass("set-content")):(t=TD.util.prettyTime(e),n=TD.ui.template.toHtml("{{hours12}}:{{minutes}} {{amPm}} {{date}} {{month}}",t),P.addClass("set-content"),$("b",P).text(n)),b=e},n=function(){U.removeClass("js-show-tip is-disabled").attr("title","")};U.addClass("js-show-tip is-disabled").attr("title",TD.i("Scheduled Tweets cannot contain images")),S?(S.$node.toggle(),b||S.setDate(new Date)):($.subscribe("/change/date",t),$.subscribe("/removed/date",n),S=new TD.components.ScheduledDatePicker(e))}function st(e){ot(e)}function ot(e){var t=i.val();t.length&&(e=t+" "+e),i.val(e),K()}function ut(){gt(),bt();var e=ct(),t=[],n=0,r=function(){if(t.length+n>=e.length){var r=i.val();_.each(t,function(e){r=r.replace(e.long_url,e.url)}),at(r)}},s=function(e){e.data?t.push(e.data):n++,r()},o=function(){n++,r()};TD.settings.getLinkShortener()==="bitly"&&e.length>0?_.each(e,function(e){TD.services.bitly.shorten(e,s,o)}):at(i.val())}function at(t){function s(e){var o=e.account,u=TD.controller.clients.getClient(e.account),a=u.create(),f;O?a=a.DirectlyTo(D).WithMessage(t):(n!=""&&a.InReplyTo&&a.InReplyTo(n),a=a.WithMessage(t),W&&a.WithMedia(W),a.WithLocation&&g&&a.WithLocation(g,y)),a.WithLocation&&x&&x.twitterPlaceID&&a.WithLocation(x.twitterPlaceID,x.twitterPlaceName);if(b){f=TD.i("Scheduling update");if(!a.toSchedulableObject){TD.controller.progressIndicator.taskFailed(E,f);return}var l=a.toSchedulableObject();if(!l){TD.controller.progressIndicator.taskFailed(E,f);return}i.push(l);if(r.length>0)s(r.pop());else{TD.controller.progressIndicator.changeMessage(E,f);var c=w?w.token:null,h=TD.controller.clients.getTDClient().scheduleGroup(i,b,c);h.addCallback(function(){TD.controller.progressIndicator.taskComplete(E),w&&TD.controller.feedManager.deleteChirp(w.id),w=null,lt()}),h.addErrback(function(e){var t=f;e.req&&e.req.responseText&&(t+=": "+e.req.responseText),TD.controller.progressIndicator.taskFailed(E,t),mt(),wt()})}}else f=TD.i("Sending update to {{1}}",{1:_.capitalize(e.service)}),TD.controller.progressIndicator.changeMessage(E,f),a.post(function(){xt();if(r.length>0)s(r.pop());else{TD.controller.progressIndicator.taskComplete(E);if(w){var e=w.token,t=TD.controller.clients.getTDClient().removeScheduleGroup(e);t.addCallback(function(){TD.controller.feedManager.deleteChirp(e)})}w=null,lt()}},function(e,t,n){e.errors?e.errors.forEach(function(e){f+=" - "+e.message}):e&&e.errorMessage?f+=" - "+e.errorMessage+"":f+=" - "+TD.controller.clients.getPreferredClient("twitter").ERRORS.UNKNOWN.message,TD.controller.progressIndicator.taskFailed(E,f),mt(),wt()})}var n=v,r=c.getSelectedAccounts(),i=[];if(O&&D==""){TD.controller.progressIndicator.addMessage(TD.i("Message has no recipient!")),wt();return}if(e.getTextLength(t)===0){TD.controller.progressIndicator.addMessage(TD.i("Sorry, empty updates are not allowed")),wt();return}if(p.is(":visible")&&parseInt(p.val())<0){wt();return}E&&(TD.controller.progressIndicator.deleteTask(E),E=null),r.length>0?(E=TD.controller.progressIndicator.addTask("Sending update"),s(r.pop())):TD.controller.progressIndicator.addMessage(TD.i("Please select at least one account before sending"))}function ft(){i.val(""),j={},mt(),v=undefined,m=undefined,s&&(s.empty(),s=null),N.removeClass("s-inreply"),c.updateSelectedAccounts(),wt(),xt(),U.removeClass("js-show-tip is-disabled").attr("title",""),S&&S.setDate(null),O&&it(),w=null}function lt(){var n=function(){ft(),$(document).off("uiCloseModal",lt),t.find("input").blur(),t.hide(),t.trigger("uiFocusRelease",{id:e.focusId}),clearInterval(X)};if(w){var r=_.uniqueId(),s={id:r,title:TD.i("Stop editing?"),message:TD.i("If you close your edits now you will lose any changes made. Are you sure you want to stop editing?"),okLabel:TD.i("Yes"),cancelLabel:TD.i("No")},o=function(e,t){if(t.id!==r)return;$(document).off("uiConfirmationAction",o),t.result&&n()};$(document).on("uiConfirmationAction",o).trigger("uiShowConfirmationDialog",s)}else n();i.get(0).blur()}function ct(){return ht(twttr.txt.extractUrls(i.val()))}function ht(e){return _.filter(e,function(e){return!e.match(/^https?:\/\/t.co\/\w+$/)})}function pt(e){var t=TD.i("Links will be shortened by bit.ly"),n=TD.i("Link will be shortened by bit.ly");return e>1?t:n}function dt(){var e=TD.settings.getLinkShortener()==="bitly",t=ct().length;if(t===k)return;e&&t>0?(L.text(pt(t)).show(),N.addClass("s-link-added")):(L.hide(),N.removeClass("s-link-added")),k=t}function vt(){var e=i.val().toLowerCase();(e==="d "||e==="dm "||e==="m ")&&!O&&(i.val(""),nt())}function mt(){var t=140,n=i.val(),r=e.getTextLength(n),s="over-char-count";if(N.hasClass("s-sending"))return;dt();var o=Math.min(t-r,t);p.val(o),o<0?(p.addClass(s),gt()):o===t?(gt(),p.removeClass(s)):(p.removeClass(s),yt())}function gt(){l.attr("disabled","disabled")}function yt(){l.removeAttr("disabled")}function bt(){N.addClass("s-sending"),i.attr("disabled","disabled"),gt()}function wt(){N.removeClass("s-sending"),i.removeAttr("disabled"),yt()}function Et(){U.click(function(){U.hasClass("is-disabled")||$(document).trigger("uiCameraButtonClick")}),$("a",z).live("click",function(e){e.stopPropagation(),xt()}),$("#compose-modal").on("uiComposeAddPhoto",St)}function St(e,t){var n;for(var r=0;r<t.files.length;r++)W=t.files[r],n=TD.ui.template.render("compose/media_bar"),z.html(n).show(),N.addClass("s-photo-added"),P.addClass("js-show-tip is-disabled").attr("title",TD.i("Tweets with images cannot be scheduled"))}function xt(){W=null,$(document).trigger("uiResetImageUpload"),z.empty().hide(),N.removeClass("s-photo-added"),P.removeClass("js-show-tip is-disabled").attr("title","")}function Tt(){return N.css("position")==="absolute"&&(parseInt(N.css("left"),10)+N.outerWidth()/2>$("body").outerWidth()||parseInt(N.css("top"),10)+N.outerHeight()/3>$("body").outerHeight())}function Nt(){t.removeClass(q),N.attr("style","")}function Ct(){N.css({position:"absolute",top:N.offset().top,left:N.offset().left}),t.addClass(q)}var e={},t,n,r,i,s,o,u,a,f,l,c,h,p,d=!1,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O=!1,M,D,P,H,B,j={},F,I,q="is-dragging",R=window.File&&window.FormData,U,z,W,X,V=50,J=22;e.init=function(){};var K=function(){i.get(0).focus()},Q=function(e){C.isCompletionsOpen?e.stopPropagation():i.get(0).blur()};e.setUp=function(){if(t){Tt()&&Nt();return}t=$("#compose-modal"),t.html(TD.ui.template.render("compose/compose",{isMac:TD.util.getOSName()==="osx"})),N=$(".js-compose",t),n=$("#composeBox"),r=$("#autocomplete-container"),o=$("h3",t),T=$(".js-accounts-toggle",t),F=$("span",T),i=$(".js-compose-input",t),u=$("#hiddenDiv"),a=$('button[rel="addLocation"]',t),f=$(".removeLocationButton",t),H=$('button[rel="message"]',t),P=$('button[rel="enterSchedule"]'),l=$('button[rel="send"]',t),h=$("#overlay"),p=$("#character-count"),L=$(".js-links-added"),U=$('button[rel="addPhoto"]',t),z=$(".js-media-added",t),A=$(".js-inreply",t),M=$(".js-dm-recipient").bind("blur",function(e){_.defer(function(){rt(M.val())})}),I=$(".js-drag-handle",N),i.bind("paste",G),N.draggable({boundary:t,handle:I}),N.on("start.draggable",Ct),i.blur(function(){$(".cmp-input-container").removeClass("focus")}),i.focus(function(){$(".cmp-input-container").addClass("focus")}),t.focus(),t.on("click",Z),l.on("keydown",Y),C=new TD.components.Autocomplete(i),R?Et():U.remove(),TD.components.LocationPicker.canHazGeolocation()||a.hide();var s=new TD.components.ActionHeader;t.find(".mdl-header").prepend(s.$node),c=s.accountSelector,c.$node.bind(TD.components.AccountSelector.CHANGE,function(){K()}),et(),c.selectDefaultAccount(),i.on("uiInputBlur",Q),$(document).on("uiSendTweetAction",ut),e.hasFocus=!1,e.focusId=_.uniqueId("focus"),e._boundHandleFocus=e.handleFocus.bind(this),$(document).on("uiFocus",e._boundHandleFocus),$(document).on("uiComposeAddFile",e.addFile)},e.handleFocus=function(t,n){n.id===e.focusId?e.hasFocus=!0:e.hasFocus=!1},e.showComposeWindow=function(e,n,r,s){if(!t||t.is(":hidden")){var o,u;this.setUp(),t.show(),t.trigger("uiFocusRequest",{id:this.focusId}),X=setInterval(function(){vt(),mt()},V),e!==null&&e!==undefined&&(i.val(e),r=r===undefined?e.length:r,s=s===undefined?e.length:s,u=i[0],u.setSelectionRange?(K(),u.selectionStart=r,u.selectionEnd=s):u.createTextRange&&(o=u.createTextRange(),o.collapse(!0),o.moveStart("character",r),o.moveEnd("character",s),o.select())),n?c.selectAccounts(n):c.selectDefaultAccount(),mt(),K(),t.trigger("uiCloseModal"),$(document).on("uiCloseModal",lt)}else t&&K()},e.referenceTo=function(e,t){this.setUp(),this.showComposeWindow("RE "+e+" ",[t])},e.mention=function(e,t){this.setUp(),this.showComposeWindow("@"+e+" ",[t])},e.replyToTweet=function(e,t,n,r,i){var o,u,a,f=e;this.setUp(),!t&&e&&(o=TD.util.getReplyUsers(e),o.length&&(t=o.join(" ")+" ",u=o[0].length+1,a=t.length)),this.showComposeWindow(t,[n],u,a),v=i||e.id,m="@"+(r||e.user.screenName.toLowerCase()),f&&(f.withAvatar=!0,N.addClass("s-inreply"),A.html(TD.ui.template.render("status/tweet_single",e)).show(),s=$("#replyto"))},e.directMessage=function(e,t,n,r){var i=n?[n]:null;this.setUp(),r=r||"",this.showComposeWindow("",i),st(r),O&&it(),nt(),e&&(rt(e,t),K())},e.editScheduledUpdate=function(t){var n,r,i,s=[],o=0,u,a,f,l,h=_.uniqueId("scheduledUpdateError"),p=function(){ft();if(t.twitterDMTargetScreenName)e.directMessage(t.twitterDMTargetScreenName,null,i,t.text);else if(t.twitterInReplyToStatusID){var n=twttr.txt.extractMentions(t.text)[0]||"";e.replyToTweet(null,t.text,null,n,t.twitterInReplyToStatusID)}else e.showComposeWindow(t.text);t.twitterPlaceID,c.selectAccounts(s),tt(),S.setDate(t.created),w=t};e.setUp();for(n=0,r=t.updates.length;n<r;n++)u=!1,a=t.updates[n].service,i=TD.storage.Account.generateKeyFor(a,t.updates[n].uid),u=Boolean(TD.storage.accountController.get(i)),u?s.push(i):o++;if(o>0){f=TD.util.pluralise(TD.i("This scheduled update is associated with an account which has been removed from your TweetDeck. This account will therefore not be available during this edit unless you re-add it from the accounts panel."),TD.i("This scheduled update is associated with {{1}} accounts which have been removed from your TweetDeck. These accounts will therefore not be available during this edit unless you re-add them from the settings panel.",{1:o}),o),f+="\n\n",f+=TD.i("Are you sure you want to continue editing?"),l={id:h,title:TD.i("Warning!"),message:f,okLabel:TD.i("Continue"),cancelLabel:TD.i("Cancel")};var d=function(e,t){if(t.id!==h)return;$(document).off("uiConfirmationAction",d),t.result&&p()};$(document).on("uiConfirmationAction",d).trigger("uiShowConfirmationDialog",l)}else p()},e.selectAccounts=function(e){c.selectAccounts(e)},e.displayLength=function(e){if(typeof e!="string")throw new Error("displayLength() requires a single input of type string");var t=0,n=0,r=function(e,t){var n=e.charCodeAt(t),r="",i="";if(55296<=n&&n<=56319){if(e.length<=t+1)throw"High surrogate without following low surrogate";r=e.charCodeAt(t+1);if(56320>r||r>57343)throw"High surrogate without following low surrogate";return e.charAt(t)+e.charAt(t+1)}if(56320<=n&&n<=57343){if(t===0)throw"Low surrogate without preceding high surrogate";i=e.charCodeAt(t-1);if(55296>i||i>56319)throw"Low surrogate without preceding high surrogate";return!1}return e.charAt(t)};for(t=0,n=0;t<e.length;t++){if(r(e,t)===!1)continue;n++}return n},e.getTextLength=function(t){var n=e.displayLength(t),r=twttr.txt.extractUrls(t);for(var i=0;i<r.length;i++)n+=J-r[i].length,_.startsWith(r[i],"https://")&&n++;return W&&(n=n+1+J),n};var et=function(){var e=!1;return function(){e?(F.text(TD.i("Change")),c.hide()):(F.text(TD.i("Hide")),c.show()),e=!e,K()}}(),nt=function(){O=!0,N.addClass("s-message-to"),l.text(TD.i("Send")),U.hide(),a.hide(),xt(),B=new TD.components.Autocomplete(M,{dmMode:!0}),B.$node.bind(TD.components.Autocomplete.SELECT,function(e,t,n){rt(t,n),K()}),M.focus()},rt=function(e,t){e&&(e=_.trim(e));if(e===D)return;D=e,M.val(e||""),t?t=TD.util.transformTwitterAvatar(t,"mini"):t="http://a1.twimg.com/sticky/default_profile_images/default_profile_6_mini.png",$(".js-msg-to-avatar").attr("src",t)},it=function(){O=!1,N.removeClass("s-message-to"),l.text(TD.i("Tweet")),B.destroy(),B=null,rt(null,null),R&&U.show(),K()};return e.resetAndCloseInput=lt,e}(),TD.ui.openColumn=function(){function n(e,n){var r=e.split("?"),i=r[0].split("/").slice(1),s=r[1]||"",o=TD.net.util.formDecode(s),u=i.shift();switch(u){case"add":if(i[0]!=="search"){var a=TD.components.OpenColumn.instance;a&&!a.canGo(u,i)&&(a.destroy(),a=null),a||(a=new TD.components.OpenColumn),a.go(u,i,o,n),t.append(a.$node).show()}else $(document).trigger("uiAppSearchFocus")}}var e={},t;return e.init=function(){t=$("#open-modal"),$.subscribe(TD.components.OpenColumn.GO_EVENT,function(e){n(e.data,e.history)})},e.showOpenColumn=function(){n("/add/home")},e.showTwitterProfile=function(e){n("/profile/twitter/"+e)},e.showLists=function(){n("/add/lists")},e.showList=function(e,t){n("/add/lists?screenName="+TD.util.deMentionify(e)+"&slug="+t)},e}(),TD.ui.template=function(){function u(e){var t;try{t=$.ajax(e,{async:!1,isLocal:TD.util.getAppEnv()!=="web"})}catch(n){return null}return t.status!==200?"":_.trim(t.responseText)}function a(s){s=s.replace(t,"/");var o=n[s];return o===undefined&&(o=e.getHogan(s),o=i.compile(o,r),n[s]=o),o}function f(e,t){var n=this.partials[e];return t=t||{},t[n.name]||(t[n.name]=a(n.name)),Hogan.Template.prototype.ep.call(this,e,t)}function l(e,t,n){var r=Hogan.parse.call(this,e,t,n),i="";for(var s=0;s<r.length;s++)if(r[s].tag==="_v"&&r[s].n.indexOf("%TRANSLATION-HINT")===0){var o=r.splice(s,1)[0];s--,i=o.n.substring(o.n.indexOf("mode=")+"mode=".length)}return c(r,i,t,n)}function c(e,t,n,r){var i=[];for(var s=0;s<e.length;s++)if(e[s].tag==="#"&&e[s].n==="_i"){var o=p(n.substring(e[s].i,e[s].end),t);o.tag==="raw"?i.push(o):Array.prototype.push.apply(i,Hogan.parse(Hogan.scan(o,r.delimiters),n,r))}else e[s].tag==="#"||e[s].tag==="^"||e[s].tag==="<"||e[s].tag==="$"?(e[s].nodes=c(e[s].nodes,t,n,r),i.push(e[s])):i.push(e[s]);return h(i)}function h(e){if(e.length===0)return e;var t=[e[0]];for(var n=1;n<e.length;n++)t[t.length-1].tag!=="_t"||e[n].tag!=="\n"&&e[n].tag!=="_t"?t.push(e[n]):t[t.length-1].text+=e[n].text||"\n";return t}function p(e,t){var n;return t!==""?n={text:e,mode:t}:n=e,TD.i(n,null,!0)}var e={},t=/\\/g,n={},r={sectionTags:[{o:"_i",c:"i"}]},i,s,o;return o=function(e,t,n,r){this.ep=f,Hogan.Template.call(this,e,t,n,r)},o.prototype=Hogan.Template.prototype,s=function(){},s.prototype=Hogan,i=new s,i.template=o,i.parse=l,e.getHogan=function(e){var t=TD.mustaches[e+".mustache"];return t===undefined&&(t=u("../mustaches/"+e+".mustache"),t===""&&(t=e),TD.mustaches[e+".mustache"]=t),t},e.render=function(e,t,n){var r=a(e),i=_.clone(TD.globalRenderOptions)||{};return _.extend(i,t),r.render(i,n)},e.toHtml=function(e,t,n){var s=i.compile(e,r);return s.render(t,n)},e}(),TD.ui.updates=function(){function i(t,n,r,i){var u=$(t.target),a,f,l=!1,c,h,p,d,v;if($(".js-stream-item",t.target).length>0)return;u.attr("rel")||(u=u.closest("a,button")),n||(a=e.findParentArticle(u),r||(r=TD.controller.columnManager.get(a.column)),r&&(i=r.findChirp(a.statusKey),n=r.findMostInterestingChirp(a.statusKey)));if(!n)return;f=u.attr("rel");switch(f){case"list":TD.ui.openColumn.showList(u.data("screen-name"),u.data("slug"));break;case"actionsMenu":case"userActionsMenu":c=u.data("user-id").toString(),h=TD.cache.twitterUsers.getById(c),p=f==="actionsMenu"?n:null,h.addCallback(function(e){var t=new TD.components.ProfileMenu(u,e,p,!0);return t.setPosition(TD.components.DropDown.POSITION_LEFT),t});break;case"mediaPreview":l=s(n,u.attr("href"),r);break;case"retweet":case"like":case"favorite":case"destroy":case"edit":case"reply":case"viewDetails":case"followStatus":case"dm":o(f,n,i,r);break;case"tweet":d=u.attr("data-tweet-id"),v=TD.controller.clients.getClient(n.account.getKey()),v.show(d,function(e){o("viewDetails",e,i,r)},function(){TD.util.openURL(u.attr("href"))});break;default:l=!0}return l||(t.preventDefault(),t.stopPropagation()),!1}function s(e,t,n){return n.temporary?(TD.util.openURL(t),!0):(new TD.components.MediaGallery(e,t,n),!1)}function o(t,n,r,i){var s;switch(t){case"retweet":case"like":case"favorite":case"destroy":case"edit":t in n&&n[t]();break;case"reply":n instanceof TD.services.TwitterMessageThread||n instanceof TD.services.TwitterDirectMessage?TD.ui.compose.mention(n.getMainUser().screenName,n.account.getKey()):TD.ui.compose.replyToTweet(n,"",n.account.getKey());break;case"viewDetails":e.showDetailView(i,n,r);break;case"followStatus":s=new TD.components.FollowDialog(n);break;case"dm":TD.ui.compose.directMessage(n.getMainUser().screenName,n.getMainUser().profileImageURL,n.getMainUser().account.getKey())}}function u(e){var t=".js-media";if(e){$(t).show();var n=TD.controller.columnManager.getAll();_.each(n,function(e,n){_.each(e.updateArray,function(e){e.hasMedia()&&e.getDOMChirps()&&e.getDOMChirps().each(function(){var n=$(this).find(t),r="";e.getMedia().forEach(function(e){r+=e.renderThumb()}),n.children().length||n.html(r)})})})}else $(t).hide()}var e={currentlyDisplayedProfile:null},t=110,n="2s",r;return e.init=function(){$(".js-show-detail").live("click",function(t){var n,r,i,s=window.getSelection(),o=s.rangeCount===0?!1:s.getRangeAt(0),u;if(!o||o.endOffset===o.startOffset)n=e.findParentArticle($(this)),r=TD.controller.columnManager.get(n.column),r&&(i=r.findMostInterestingChirp(n.statusKey),u=r.findChirp(n.statusKey),e.showDetailView(r,i,u));return!1}),$("body").delegate(".js-stream-item a, .js-stream-item button","click",i),$(".form-comment").live("click",i),$.subscribe("chirp/click",function(e,t,n){i(e,t,n)}),$.subscribe("chirp/action",o),TD.controller.scheduler.schedulePeriodicTask(30,TD.ui.updates.refreshTimestamps),$.subscribe("/storage/client/settings/show_inline_media",u)},e.statusAction=function(e,t){var n=TD.controller.columnManager.get(t.column),r;if(!n)return;r=n.findMostInterestingChirp(t.statusKey),r[e](t)},e.refreshTimestamps=function(){var e=TD.util.prettyDate;$(".js-timestamp").each(function(t,n){var r,i,s=$(this),o;r=s.attr("data-time"),o=new Date(Number(r)),i=e(o),$("a,span",s).text(i)})},e.findParentArticle=function(e){var t=e.closest(".js-stream-item");return{element:t,statusKey:t.attr("data-key"),column:t.closest(".js-chirp-container, .js-column").data("column")}},e.showDetailView=function(e,t,n){var r=e.model.getKey(),i=TD.ui.columns.getColumnElementByKey(r);TD.ui.columns.exitEditMode(r),e.detailViewComponent&&e.detailViewComponent.destroy(),t instanceof TD.services.TwitterStatus?e.detailViewComponent=new TD.components.TweetDetailView(e,i):t instanceof TD.services.TwitterMessageThread&&(e.detailViewComponent=new TD.components.MessageDetailView(e,i)),e.detailViewComponent.showChirp(t,n)},e}(),TD.ui.startflow=function(e,t,n,r){function C(e){e.preventDefault();var t=$(e.currentTarget),n=t.data("action");switch(n){case"url":var r=window.open(t.attr("href"));r.focus();break;case"signin":L();break;case"showRegister":F(a);break;case"login":F(u);break;case"forgotPassword":k();break;case"resetReload":TD.sync.controller.debugFlushAndReload();break;case"spoofData":TD.sync.controller.debugInstallOldChromeData()}}function k(){if(T)return;var e=$("#tdRegEmail",h).val();if(!e||!e.match(s)){B(TD.i("That doesn't seem to be a valid email address. Remember: TweetDeck accounts are different from Twitter accounts."),[v]);return}var t=new TD.services.TweetDeckClient;T=!0,B(TD.i("Sending password reset instructionsâ¦"),[v],!0);var n=t.forgotPassword(e);n.addCallback(function(){B(TD.i("We have sent an email to {{email}} with instructions to reset your password.",{email:e}),[],!0),T=!1}),n.addErrback(function(t){var n;t&&t.number===403?n=TD.i("We couldn't find a TweetDeck account associated with {{email}}.",{email:e}):n=TD.i("Sorry, something went wrong. It's not you, it's us. Please try again later."),B(n,[v]),T=!1})}function L(){var e=$("#tdRegEmail",h).val(),t=$("#tdRegPassword",h).val(),n=$("#tdRegRememberMe",h)[0].checked;A(e,t,n)}function A(e,t,r){if(e&&t!==""){F(f);var i=n.accountController.loginTweetdeck(e,t);i.addCallbacks(O,M,[r])}else F(u),B(TD.i("Please check your email & password."),[m,v])}function O(e,t){e.stay_signed_in=t,x.callback(e)}function M(e){F(u);var t,n=[],i,s;if(e.req.status===401)i=JSON.parse(e.req.responseText).error,i==TD.constants.TDApi.ERROR_ACCOUNT_DOESNT_EXIST?(s=$("#tdRegEmail",h).val(),t=TD.i("We couldn't find a TweetDeck account associated with: {{{email}}}",{email:s}),n=[v]):i==TD.constants.TDApi.ERROR_BAD_PASSWORD&&(t=TD.i("Please check your password. Remember: TweetDeck accounts are different from Twitter accounts."),n=[m]);else if(e.req.status===0)t=TD.i("Unable to connect. Please check your network.");else try{i=JSON.parse(e.req.responseText).error,t=TD.i("Unable to sign in: {{{1}}}",{1:i})}catch(o){t=TD.i("Sorry, something went wrong. It's not you, it's us. Please try again later."),console.log("An unknown error occurred at sign in"),console.log(e.req.responseText)}r.warn(e.message,e),B(t,n)}function D(){var e=$("#tdRegEmail",h).val(),t=$("#tdRegPassword",h).val(),n=$("#tdRegPasswordConfirm",h).val(),r=$("#tdRegRememberMe",h)[0].checked;if(!e||!e.match(s)){B(TD.i("That doesn't seem to be a valid email address. Remember: TweetDeck accounts are different from Twitter accounts."),[v]);return}if(t!==n){B(TD.i("Passwords must match!"),[m]);return}if(t.length<7){B(TD.i("Your password must be 7 characters or longer."),[m]);return}var i=P(e,t,r);i.addErrback(H),F(f)}function P(e,t,i){var s=n.accountController.loginTweetdeck(e,t);return s.addCallback(O,i),s.addErrback(function(){r.trace("register//login failed//going to try to create account");var s=n.accountController.createTweetdeckAccount(e,t);return s.addCallback(function(e){return e.created_account=!0,e}),s.addCallback(O,i),s}),s}function H(e){var t;F(a),e&&e.number&&e.number===401?t=TD.ui.template.render("text/already_registered"):t=TD.i("Registration unsuccessful. Please check your email & password"),e&&r.warn(e.message,e),B(t,[m,v])}function B(e,t,n){n?p.removeClass(E).addClass(S):p.removeClass(S).addClass(E),e&&(p.html(e),p.show()),t&&_.each(t,function(e){e.addClass("s-error")})}function j(){m.removeClass("s-error"),v.removeClass("s-error"),p.hide()}function F(e){l=e,j();switch(e){case u:b.fadeOut("fast"),$("#tdRegPasswordConfirm").attr("disabled",!0),g.attr("disabled",!1),h.addClass("s-login").removeClass("s-register is-loading");break;case a:b.fadeOut("fast"),$("#tdRegPasswordConfirm").attr("disabled",!1),y.attr("disabled",!1),h.addClass("s-register").removeClass("s-login is-loading");break;case f:b.fadeIn("fast"),g.attr("disabled",!0),y.attr("disabled",!0)}}var i={},s=/^[a-zA-Z0-9_\-\.+]+@[a-zA-Z0-9_\-\.]+\.[a-zA-Z]{2,4}$/,o=-1,u=0,a=1,f=2,l=o,c=null,h=null,p,d,v,m,g,y,b,w="form-error",E="srt-error-msg",S="srt-success-msg",x=null,T;i.doLogin=function(t,n,r){x=new e.Deferred;try{N(t,n),F(u),r&&B(r)}catch(i){var s="Unable to initialise login UI. Please contact your friendly dev team for assistance.";$("body").html(s),console.log("login UI init error:",[i]),TD.util.isChromeApp()&&console.log("stack trace:",[i.stack.split("\n")])}return x};var N=function(e,n){var r={email:e||"",spoofData:Boolean(TD.debug.spoof_data),debugMenu:Boolean(TD.config.debug_menu),version:TD.version,buildIDShort:TD.buildIDShort,appEnv:TD.util.getAppEnv()};TD.util.isWrapperApp()&&deck.getWrapperVersion&&(r.wrapperVersion=deck.getWrapperVersion());var i=t.render("startup/signin",r);$(".js-signin-ui").html(i),TD.util.isWrapperApp()&&deck.closeLoadingScreen&&deck.closeLoadingScreen(),h=$(".js-signin-form"),p=$(".js-start-message",h),v=$(".js-email"),m=$(".js-password"),g=$(".js-signin"),y=$(".js-register"),b=$(".js-loader"),$("#tdRegRememberMe",h)[0].checked=Boolean(n),$("#tdAccountForm").submit(function(e){return l===u?L():D(),e.preventDefault(),!1}),$("a",h).live("click",C),h.live("keypress",function(e){e.keyCode==13&&$("tdAccountForm").submit()})};return i}(TD.core.defer,TD.ui.template,TD.storage,TD.sync.util),TD.globalRenderOptions={styledScrollbar:TD.util.hasFixedScrollBars()};var TD,jQuery;TD.net.ajax=function(){var e={},t=function(e,t,n){var r=TD.config.api_root+"/oauth/"+t;return r+="/"+n.getType()+"/",r+=encodeURIComponent(e),r},n=function(e,t){e["x-td-oauth-key"]=t.getOAuthToken(),e["x-td-oauth-secret"]=t.getTokenSecret(),e["x-td-oauth-service"]=t.getType()},r=function(e,t,n,r,i){var s=new TD.core.defer.Deferred,o,u,a={url:t,global:!1,type:e,dataType:"text json"};return i&&_.extend(a,i),n&&(a.beforeSend=function(e){_.each(n,function(t,n){n.toLowerCase()!=="content-type"&&e.setRequestHeader(n,t)})}),r&&(a.data=r),u=n["Content-Type"]||n["content-type"],u&&(a.contentType=u),o=jQuery.ajax(a),o.done(function(e,t,n){s.callback({data:e,xhr:n})}),o.fail(function(e,t,n){s.errback(new TD.core.defer.XMLHttpRequestError(e,n))}),s};return e.jsonp=function(e,t){var n=r("GET",e,{},t,{dataType:"jsonp",timeout:1e4});return n},e.upload=function(e,t,i){var s={},o;return n(s,i),o=r("POST",e,s,t,{timeout:12e4,processData:!1,contentType:!1}),o},e.signRequest=function(e,i,s,o,u){var a,f,l,c;return u=u||{},n(u,e),s==="GET"?l="echo":l="sign",f=t(i,l,e),a=r(s,f,u,o),a},e.request=function(i,s){var s=s||{},o=s.headers||{},u=s.method||"GET",a=s.account,f=s.params||null,l,c;return(u==="GET"||!TD.util.isWrapperApp())&&s.params&&(i=TD.net.util.addURLParameters(i,f),f={}),TD.util.isChromeApp()?u==="GET"?(n(o,a),l=t(i,"sign",a),c=r(u,l,o)):(c=e.signRequest(a,i,u,f,o),c.addCallback(function(e){var t=e.data,n=t.headers||{};return o&&o["Content-Type"]&&(n["Content-Type"]=o["Content-Type"]),r(u,t.url,n,t.body)})):(n(o,a),l=t(i,"proxy",a),c=r(u,l,o,f)),c},e}(),function(e){function s(e,t){return 32-(new Date(e,t,32)).getDate()}function o(e,t){e=""+e,t=t||2;while(e.length<t)e="0"+e;return e}function f(e,t,n){var r=e.getDate(),s=e.getDay(),f=e.getMonth(),l=e.getFullYear(),c={d:r,dd:o(r),ddd:i[n].shortDays[s],dddd:i[n].days[s],m:f+1,mm:o(f+1),mmm:i[n].shortMonths[f],mmmm:i[n].months[f],yy:String(l).slice(2),yyyy:l},h=t.replace(u,function(e){return e in c?c[e]:e.slice(1,e.length-1)});return a.html(h).html()}function l(e){return parseInt(e,10)}function c(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()==t.getMonth()&&e.getDate()==t.getDate()}function h(e){if(!e)return;if(e.constructor==Date)return e;if(typeof e=="string"){var t=e.split("-");if(t.length==3)return new Date(l(t[0]),l(t[1])-1,l(t[2]));if(!/^-?\d+$/.test(e))return;e=l(e)}var n=new Date;return n.setDate(n.getDate()+e),n}function p(n,o){function P(t,r,i){x=t,w=t.getFullYear(),E=t.getMonth(),S=t.getDate(),i=i||e.Event("api"),i.type="change",L.trigger(i,[t]);if(i.isDefaultPrevented())return;n.val(f(t,r.format,r.lang)),n.data("date",t),u.hide(i)}function H(e){e.type="onShow",L.trigger(e)}var u=this,a=new Date,p=o.css,d=i[o.lang],v=e("#"+p.root),m=v.find("#"+p.title),g,y,b,w,E,S,x=n.attr("data-value")||o.value||n.val(),T=n.attr("min")||o.min,N=n.attr("max")||o.max,C;T===0&&(T="0"),x=h(x)||a,T=h(T||o.yearRange[0]*365),N=h(N||o.yearRange[1]*365);if(!d)throw"Dateinput: invalid language: "+o.lang;if(n.attr("type")=="date"){var k=e("<input/>");e.each("class,disabled,id,maxlength,name,readonly,required,size,style,tabindex,title,value".split(","),function(e,t){k.attr(t,n.attr(t))}),n.replaceWith(k),n=k}n.addClass(p.input);var L=n.add(u);if(!v.length){v=e("<div><div><div/></div><div><div/><div/></div></div>").hide().css({position:"relative"}).attr("id",p.root),v.children().eq(0).attr("id",p.head).end().eq(1).attr("id",p.body).children().eq(0).attr("id",p.days).end().eq(1).attr("id",p.weeks).end().end().end(),m=v.find("#"+p.head).find("div").attr("id",p.title);if(o.selectors){var A=e("<select/>").attr("id",p.month),O=e("<select/>").attr("id",p.year);m.html(A.add(O))}var M=v.find("#"+p.days);for(var _=0;_<7;_++)M.append(e("<span/>").text(d.shortDays[(_+o.firstDay)%7]));e("#calendar").append(v)}var D=v.find("#"+p.weeks);O=v.find("#"+p.year),A=v.find("#"+p.month),e.extend(u,{show:function(r){if(n.attr("readonly")||n.attr("disabled")||C)return;r=r||e.Event(),r.type="onBeforeShow",L.trigger(r);if(r.isDefaultPrevented())return;e.each(t,function(){this.hide()}),C=!0,A.unbind("change").change(function(){u.setValue(O.val(),e(this).val())}),O.unbind("change").change(function(){u.setValue(e(this).val(),A.val())}),y=v.find("#"+p.prev).unbind("click").click(function(e){return y.hasClass(p.disabled)||u.addMonth(-1),!1}),b=v.find("#"+p.next).unbind("click").click(function(e){return b.hasClass(p.disabled)||u.addMonth(),!1}),u.setValue(x);var i=n.offset();return/iPad/i.test(navigator.userAgent)&&(i.top-=e(window).scrollTop()),o.speed?v.show(o.speed,function(){H(r)}):(v.show(),H(r)),u},setValue:function(t,n,r){var i=l(n)>=-1?new Date(l(t),l(n),l(r||1)):t||x;i<T?i=T:i>N&&(i=N),t=i.getFullYear(),n=i.getMonth(),r=i.getDate(),n==-1?(n=11,t--):n==12&&(n=0,t++);if(!C)return P(i,o),u;E=n,w=t,S=r;var f=new Date(t,n,1-o.firstDay),h=f.getDay(),v=s(t,n),g=s(t,n-1),k;if(o.selectors){A.empty(),e.each(d.months,function(n,r){T<new Date(t,n+1,-1)&&N>new Date(t,n,0)&&A.append(e("<option/>").html(r).attr("value",n))}),O.empty();var L=a.getFullYear();for(var M=L+o.yearRange[0];M<L+o.yearRange[1];M++)T<=new Date(M+1,-1,1)&&N>new Date(M,0,0)&&O.append(e("<option/>").text(M));A.val(n),O.val(t)}else m.html(d.months[n]+" "+t);D.empty(),y.add(b).removeClass(p.disabled);for(var _=h?0:-7,H,B;_<(h?42:35);_++)H=e("<a/>"),_%7===0&&(k=e("<div/>").addClass(p.week),D.append(k)),_<h?(H.addClass(p.off),B=g-h+_+1,i=new Date(t,n-1,B)):_>=h+v?(H.addClass(p.off),B=_-v-h+1,i=new Date(t,n+1,B)):(B=_-h+1,i=new Date(t,n,B),c(x,i)?H.attr("id",p.current).addClass(p.focus):c(a,i)&&H.attr("id",p.today)),T&&i<T&&H.add(y).addClass(p.disabled),N&&i>N&&H.add(b).addClass(p.disabled),H.attr("href","#"+B).text(B).data("date",i),k.append(H);return D.find("a").click(function(t){var n=e(this);return n.hasClass(p.disabled)||(e("#"+p.current).removeAttr("id"),n.attr("id",p.current),P(n.data("date"),o,t)),!1}),p.sunday&&D.find(p.week).each(function(){var t=o.firstDay?7-o.firstDay:0;e(this).children().slice(t,t+1).addClass(p.sunday)}),u},setMin:function(e,t){return T=h(e),t&&x<T&&u.setValue(T),u},setMax:function(e,t){return N=h(e),t&&x>N&&u.setValue(N),u},today:function(){return u.setValue(a)},addDay:function(e){return this.setValue(w,E,S+(e||1))},addMonth:function(e){return this.setValue(w,E+(e||1),S)},addYear:function(e){return this.setValue(w+(e||1),E,S)},hide:function(t){if(C){t=e.Event(),t.type="onHide",L.trigger(t),e(document).unbind("click.d").unbind("keydown.d");if(t.isDefaultPrevented())return;v.hide(),C=!1}return u},getConf:function(){return o},getInput:function(){return n},getCalendar:function(){return v},getValue:function(e){return e?f(x,e,o.lang):x},isOpen:function(){return C}}),e.each(["onBeforeShow","onShow","change","onHide"],function(t,n){e.isFunction(o[n])&&e(u).bind(n,o[n]),u[n]=function(t){return t&&e(u).bind(n,t),u}}),n.bind("focus click",u.show).keydown(function(t){var n=t.keyCode;return!C&&e(r).index(n)>=0?(u.show(t),t.preventDefault()):t.shiftKey||t.ctrlKey||t.altKey||n==9?!0:t.preventDefault()}),h(n.val())&&P(x,o)}e.tools=e.tools||{version:"1.2.5"};var t=[],n,r=[75,76,38,39,74,72,40,37],i={};n=e.tools.dateinput={conf:{format:"mm/dd/yy",selectors:!1,yearRange:[-5,5],lang:"en",offset:[0,0],speed:0,firstDay:0,min:undefined,max:undefined,trigger:!1,css:{prefix:"cal",input:"date",root:0,head:0,title:0,prev:0,next:0,month:0,year:0,days:0,body:0,weeks:0,today:0,current:0,week:0,off:0,sunday:0,focus:0,disabled:0,trigger:0}},localize:function(t,n){e.each(n,function(e,t){n[e]=t.split(",")}),i[t]=n}},n.localize("en",{months:"January,February,March,April,May,June,July,August,September,October,November,December",shortMonths:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec",days:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday",shortDays:"S,M,T,W,T,F,S"});var u=/d{1,4}|m{1,4}|yy(?:yy)?|"[^"]*"|'[^']*'/g,a=e("<a/>");e.expr[":"].date=function(t){var n=t.getAttribute("type");return n&&n=="date"||!!e(t).data("dateinput")},e.fn.dateinput=function(r){if(this.data("dateinput"))return this;r=e.extend(!0,{},n.conf,r),e.each(r.css,function(e,t){!t&&e!="prefix"&&(r.css[e]=(r.css.prefix||"")+(t||e))});var i;return this.each(function(){var n=new p(e(this),r);t.push(n);var s=n.getInput().data("dateinput",n);i=i?i.add(s):s}),i?i:this}}(jQuery),function(e){e.createElement=function(t){return e(document.createElement(t))}}(jQuery),!function(e){"use strict";e(function(){e.support.transition=function(){var e=function(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},n;for(n in t)if(e.style[n]!==undefined)return t[n]}();return e&&{end:e}}()})}(window.jQuery),!function(e){"use strict";var t=function(e,t){this.init("tooltip",e,t)};t.prototype={constructor:t,init:function(t,n,r){var i,s,o,u,a;this.type=t,this.$element=e(n),this.options=this.getOptions(r),this.enabled=!0,o=this.options.trigger.split(" ");for(a=o.length;a--;)u=o[a],u=="click"?this.$element.on("click."+this.type,this.options.selector,e.proxy(this.toggle,this)):u!="manual"&&(i=u=="hover"?"mouseenter":"focus",s=u=="hover"?"mouseleave":"blur",this.$element.on(i+"."+this.type,this.options.selector,e.proxy(this.enter,this)),this.$element.on(s+"."+this.type,this.options.selector,e.proxy(this.leave,this)));this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(t){return t=e.extend({},e.fn[this.type].defaults,t,this.$element.data()),t.delay&&typeof t.delay=="number"&&(t.delay={show:t.delay,hide:t.delay}),t},enter:function(t){var n=e(t.currentTarget)[this.type](this._options).data(this.type);if(!n.options.delay||!n.options.delay.show)return n.show();clearTimeout(this.timeout),n.hoverState="in",this.timeout=setTimeout(function(){n.hoverState=="in"&&n.show()},n.options.delay.show)},leave:function(t){var n=e(t.currentTarget)[this.type](this._options).data(this.type);this.timeout&&clearTimeout(this.timeout);if(!n.options.delay||!n.options.delay.hide)return n.hide();n.hoverState="out",this.timeout=setTimeout(function(){n.hoverState=="out"&&n.hide()},n.options.delay.hide)},show:function(){var t,n,r,i,s,o,u=e.Event("show");if(this.hasContent()&&this.enabled){this.$element.trigger(u);if(u.isDefaultPrevented())return;t=this.tip(),this.setContent(),this.options.animation&&t.addClass("fade"),s=typeof this.options.placement=="function"?this.options.placement.call(this,t[0],this.$element[0]):this.options.placement,t.detach().css({top:0,left:0,display:"block"}),this.options.container?t.appendTo(this.options.container):t.insertAfter(this.$element),n=this.getPosition(),r=t[0].offsetWidth,i=t[0].offsetHeight,this.interval=setInterval(function(){var e=this.$element.closest("body").length>0,t=this.elementOffset&&(this.elementOffset.top!=this.$element.offset().top||this.elementOffset.left!=this.$element.offset().left);(!e||t)&&this.hide(),this.elementOffset=this.$element.offset()}.bind(this),500);switch(s){case"bottom":o={top:n.top+n.height,left:n.left+n.width/2-r/2};break;case"top":o={top:n.top-i,left:n.left+n.width/2-r/2};break;case"left":o={top:n.top+n.height/2-i/2,left:n.left-r};break;case"right":o={top:n.top+n.height/2-i/2,left:n.left+n.width}}this.applyPlacement(o,s),this.$element.trigger("shown")}},applyPlacement:function(e,t){var n=this.tip(),r=n[0].offsetWidth,i=n[0].offsetHeight,s,o,u,a;n.offset(e).addClass(t).addClass("in"),s=n[0].offsetWidth,o=n[0].offsetHeight,t=="top"&&o!=i&&(e.top=e.top+i-o,a=!0),t=="bottom"||t=="top"?(u=0,e.left<0&&(u=e.left*-2,e.left=0,n.offset(e),s=n[0].offsetWidth,o=n[0].offsetHeight),this.replaceArrow(u-r+s,s,"left")):this.replaceArrow(o-i,o,"top"),a&&n.offset(e)},replaceArrow:function(e,t,n){this.arrow().css(n,e?50*(1-e/t)+"%":"")},setContent:function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.options.html?"html":"text"](t),e.removeClass("fade in top bottom left right")},hide:function(){function i(){var t=setTimeout(function(){n.off(e.support.transition.end).detach()},500);n.one(e.support.transition.end,function(){clearTimeout(t),n.detach()})}var t=this,n=this.tip(),r=e.Event("hide");this.$element.trigger(r);if(r.isDefaultPrevented())return;return n.removeClass("in"),!this.options.suppressFadeOut&&e.support.transition&&this.$tip.hasClass("fade")?i():n.detach(),clearInterval(this.interval),this.$element.trigger("hidden"),this},fixTitle:function(){var e=this.$element;(e.attr("title")||typeof e.attr("data-original-title")!="string")&&e.attr("data-original-title",e.attr("title")||"").attr("title","")},hasContent:function(){return this.getTitle()},getPosition:function(){var t=this.$element[0];return e.extend({},typeof t.getBoundingClientRect=="function"?t.getBoundingClientRect():{width:t.offsetWidth,height:t.offsetHeight},this.$element.offset())},getTitle:function(){var e,t=this.$element,n=this.options;return e=t.attr("data-original-title")||(typeof n.title=="function"?n.title.call(t[0]):n.title),e},tip:function(){return this.$tip=this.$tip||e(this.options.template)},arrow:function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(t){var n=t?e(t.currentTarget)[this.type](this._options).data(this.type):this;n.tip().hasClass("in")?n.hide():n.show()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}};var n=e.fn.tooltip;e.fn.tooltip=function(n){return this.each(function(){var r=e(this),i=r.data("tooltip"),s=typeof n=="object"&&n;i||r.data("tooltip",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.tooltip.Constructor=t,e.fn.tooltip.defaults={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1},e.fn.tooltip.noConflict=function(){return e.fn.tooltip=n,this}}(window.jQuery),jQuery.easing.jswing=jQuery.easing.swing,jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(e,t,n,r,i){return jQuery.easing[jQuery.easing.def](e,t,n,r,i)},easeInQuad:function(e,t,n,r,i){return r*(t/=i)*t+n},easeOutQuad:function(e,t,n,r,i){return-r*(t/=i)*(t-2)+n},easeInOutQuad:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t+n:-r/2*(--t*(t-2)-1)+n},easeInCubic:function(e,t,n,r,i){return r*(t/=i)*t*t+n},easeOutCubic:function(e,t,n,r,i){return r*((t=t/i-1)*t*t+1)+n},easeInOutCubic:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t+n:r/2*((t-=2)*t*t+2)+n},easeInQuart:function(e,t,n,r,i){return r*(t/=i)*t*t*t+n},easeOutQuart:function(e,t,n,r,i){return-r*((t=t/i-1)*t*t*t-1)+n},easeInOutQuart:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t*t+n:-r/2*((t-=2)*t*t*t-2)+n},easeInQuint:function(e,t,n,r,i){return r*(t/=i)*t*t*t*t+n},easeOutQuint:function(e,t,n,r,i){return r*((t=t/i-1)*t*t*t*t+1)+n},easeInOutQuint:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t*t*t+n:r/2*((t-=2)*t*t*t*t+2)+n},easeInSine:function(e,t,n,r,i){return-r*Math.cos(t/i*(Math.PI/2))+r+n},easeOutSine:function(e,t,n,r,i){return r*Math.sin(t/i*(Math.PI/2))+n},easeInOutSine:function(e,t,n,r,i){return-r/2*(Math.cos(Math.PI*t/i)-1)+n},easeInExpo:function(e,t,n,r,i){return t==0?n:r*Math.pow(2,10*(t/i-1))+n},easeOutExpo:function(e,t,n,r,i){return t==i?n+r:r*(-Math.pow(2,-10*t/i)+1)+n},easeInOutExpo:function(e,t,n,r,i){return t==0?n:t==i?n+r:(t/=i/2)<1?r/2*Math.pow(2,10*(t-1))+n:r/2*(-Math.pow(2,-10*--t)+2)+n},easeInCirc:function(e,t,n,r,i){return-r*(Math.sqrt(1-(t/=i)*t)-1)+n},easeOutCirc:function(e,t,n,r,i){return r*Math.sqrt(1-(t=t/i-1)*t)+n},easeInOutCirc:function(e,t,n,r,i){return(t/=i/2)<1?-r/2*(Math.sqrt(1-t*t)-1)+n:r/2*(Math.sqrt(1-(t-=2)*t)+1)+n},easeInElastic:function(e,t,n,r,i){var s=1.70158,o=0,u=r;if(t==0)return n;if((t/=i)==1)return n+r;o||(o=i*.3);if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return-(u*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o))+n},easeOutElastic:function(e,t,n,r,i){var s=1.70158,o=0,u=r;if(t==0)return n;if((t/=i)==1)return n+r;o||(o=i*.3);if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return u*Math.pow(2,-10*t)*Math.sin((t*i-s)*2*Math.PI/o)+r+n},easeInOutElastic:function(e,t,n,r,i){var s=1.70158,o=0,u=r;if(t==0)return n;if((t/=i/2)==2)return n+r;o||(o=i*.3*1.5);if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return t<1?-0.5*u*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o)+n:u*Math.pow(2,-10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o)*.5+r+n},easeInBack:function(e,t,n,r,i,s){return s==undefined&&(s=1.70158),r*(t/=i)*t*((s+1)*t-s)+n},easeOutBack:function(e,t,n,r,i,s){return s==undefined&&(s=1.70158),r*((t=t/i-1)*t*((s+1)*t+s)+1)+n},easeInOutBack:function(e,t,n,r,i,s){return s==undefined&&(s=1.70158),(t/=i/2)<1?r/2*t*t*(((s*=1.525)+1)*t-s)+n:r/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+n},easeInBounce:function(e,t,n,r,i){return r-jQuery.easing.easeOutBounce(e,i-t,0,r,i)+n},easeOutBounce:function(e,t,n,r,i){return(t/=i)<1/2.75?r*7.5625*t*t+n:t<2/2.75?r*(7.5625*(t-=1.5/2.75)*t+.75)+n:t<2.5/2.75?r*(7.5625*(t-=2.25/2.75)*t+.9375)+n:r*(7.5625*(t-=2.625/2.75)*t+.984375)+n},easeInOutBounce:function(e,t,n,r,i){return t<i/2?jQuery.easing.easeInBounce(e,t*2,0,r,i)*.5+n:jQuery.easing.easeOutBounce(e,t*2-i,0,r,i)*.5+r*.5+n}}),function(e){e.fn.draggable=function(t){var n={translateY:!0,translateX:!0,boundary:"body"};e(this).each(function(){function c(){if(!s||s.length===0)typeof r.boundary=="function"?s=r.boundary():s=e(r.boundary)}function h(){return s[0].scrollHeight}function p(){return s[0].scrollWidth}function d(e,t,n){var r,o,u,a,f,l,c,d,v,m,g,y,b,w,E;n==="x"?(t=t.x,a=i.outerWidth(),r=i.offset().left,f=s.offset().left,l=s.outerWidth(),d=e.pageX<r,v=e.pageX>r+a,w="left",E=p()):(t=t.y,a=i.outerHeight(),r=i.offset().top,f=s.offset().top,l=s.outerHeight(),d=e.pageY<r,v=e.pageY>r+a,w="top",E=h()),y=t>0,b=t<0,o=parseInt(i.css(w),10),m=r<f,u=o+a,g=r+a>f+l,d&&y||v&&b||m&&b||g&&y||(b?o+t<0?c=0:c=o+t:u+t>E?c=E-a-1:c=o+t,i.css(w,c))}function v(e){var t={y:e.pageY-a,x:e.pageX-f},n=!1;a=e.pageY,f=e.pageX,e.preventDefault(),r.translateY&&(d(e,t,"y"),n=!0),r.translateX&&(d(e,t,"x"),n=!0),n&&i.trigger("drag.draggable",[t,{y:e.pageY,x:e.pageX}])}function m(){e(document).unbind("mousemove",g).unbind("mousemove",v).unbind("mouseup",m),l&&i.trigger("drop.draggable").removeClass("draggable-dragging"),l=!1}function g(t){l=!0,e(document).unbind("mousemove",g).bind("mousemove",v),a=t.pageY,f=t.pageX,c(),o=h(),u=p(),i.trigger("start.draggable",[t.offsetY,t.offsetX]).addClass("draggable-dragging")}function y(t){t.preventDefault(),e(document).bind("mousemove",g).bind("mouseup",m)}var r,i=e(this),s,o,u,a,f,l=!1;i.data("draggable")?r=e.extend({},i.data("draggable").settings,t):r=e.extend({},n,t),r.handle===undefined&&(r.handle=i),typeof r.handle=="string"?i.off("mousedown",r.handle,y).on("mousedown",r.handle,y):r.handle.unbind("mousedown",y).bind("mousedown",y),i.data("draggable",{settings:r})})}}(jQuery),function(e){var t=function(t){function d(){var t=e(this).position().top+s.scrollTop(),n=e(this).position().left+s.scrollLeft(),i=e(this).innerWidth();r.top.unshift(t),r.left.unshift(n),e(this).css({position:"absolute",top:t,left:n,width:i})}function v(i){r={top:[],left:[]},e.fn.reverse=[].reverse,u=function(){var n=0;return s.find(t.contentSelector).each(function(){n+=e(this).outerHeight()}),n}(),a=function(){var n=0;return s.find(t.contentSelector).each(function(){n+=e(this).outerWidth()}),n}(),e(this).append(e("<"+t.tagName+"/>",{"class":"placeholder",height:e(this).height(),width:e(this).width()})),s.css("z-index",2).find(t.selector).each(function(t){e(this).data("draggable-index",t)}).reverse().each(d),n=e(i.target),n.css({"z-index":10})}function m(e,i){var s=n.data("draggable-index"),o=e.data("draggable-index"),u=e.outerHeight()-n.outerHeight(),a=e.outerWidth()-n.outerWidth(),p=parseInt(n.css("margin-left"),10),d=parseInt(n.css("margin-top"),10),v=parseInt(e.css("margin-right"),10),m=parseInt(e.css("margin-bottom"),10),g,y;switch(i){case f:g=r.top[s]-u;break;case l:g=r.top[s],r.top[o]=g+e.outerHeight()+m+d;break;case c:y=r.left[s]-a;break;case h:y=r.left[s],r.left[o]=y+e.outerWidth()+v+p}t.orientation==="vertical"?e.stop().animate({top:g},"fast"):e.stop().animate({left:y},"fast"),n.data("draggable-index",o),e.data("draggable-index",s)}function g(e){var r,i=n.position().top,s=n.outerHeight(),o=n.position().left,u=n.outerWidth(),a,p,d,v;e===f||e===c?r=n.prev(t.selector):r=n.next(t.selector);if(r.length){a=r.position().top,p=r.outerHeight(),d=r.position().left,v=r.outerWidth();switch(e){case f:i<a+p/2&&(n.insertBefore(r),m(r,e));break;case l:i+s>a+p/2&&(n.insertAfter(r),m(r,e));break;case c:o<d+v/2&&(n.insertBefore(r),m(r,e));break;case h:o+u>d+v/2&&(n.insertAfter(r),m(r,e))}}}function y(e){var r=(new Date).getTime()-o,i=s.scrollTop(),f=parseInt(n.css("top"),10),c=f+n.outerHeight(),p=s.scrollLeft(),d=parseInt(n.css("left"),10),v=d+n.outerWidth(),m=1+r/1e3,y=Math.min(m*t.scroll_speed,t.scroll_speed*3);y=e===l||e===h?y:-y,t.orientation==="vertical"?i+y<0?w():i+y>u-s.innerHeight()?w():(s.scrollTop(s.scrollTop()+y),f+y>0&&c+y<u&&n.css({top:f+y}),g(e)):p+y<0?w():p+y>a-s.innerWidth()?w():(s.scrollLeft(s.scrollLeft()+y),d+y>0&&v+y<a&&n.css({left:d+y}),g(e))}function b(e){o=(new Date).getTime(),w(),i=setInterval(_.bind(y,this,e),p)}function w(){clearInterval(i),i=null}function E(e,r,o){if(n){var u,a=parseInt(n.css("top"),10),p=a+n.outerHeight(),d=parseInt(n.css("left"),10),v=d+n.outerWidth(),m=s.scrollTop()+s.innerHeight(),y=s.scrollLeft()+s.innerWidth(),E,S;if(r)if(t.orientation==="vertical"){u=r.y<0?f:l,E=r.y;while(E<0)g(u),E+=n.outerHeight();E=r.y;while(E>0)g(u),E-=n.outerHeight()}else{u=r.x<0?c:h,S=r.x;while(S<0)g(u),S+=n.outerWidth();S=r.x;while(S>0)g(u),S-=n.outerWidth()}o?(o.y>s.offset().top||o.y<s.offset().top+s.outerHeight())&&w():w(),i||(t.orientation==="vertical"?p>m?b(l):a<s.scrollTop()?b(f):w():v>y?b(h):d<s.scrollLeft()?b(c):w())}}function S(){e(this).find(".placeholder").remove(),s.css("height","").find(t.selector).attr("style",""),n.trigger("dropped.dragdroplist")}function x(){w(),t.orientation==="vertical"?n.animate({top:r.top[n.data("draggable-index")]},"fast",S.bind(this)):n.animate({left:r.left[n.data("draggable-index")]},"fast",S.bind(this)),n.trigger("drop.dragdroplist")}var n,r,i,s=t.$boundary,o,u,a,f="up",l="down",c="left",h="right",p=30;return{handleDragStart:v,handleDrop:x,handleDrag:E}};e.fn.dragdroplist=function(n){var r={orientation:"vertical",tagName:"li",selector:".draggable",contentSelector:"> *",scroll_speed:8};return e(this).each(function(){var i,s,o=function(e){e.draggable({translateX:s.orientation==="horizontal",translateY:s.orientation==="vertical",handle:s.handle?s.handle:s.tagName,boundary:s.$boundary})};e(this).data("dragdroplist")||(s=e.extend({},r,n),s.$boundary=s.$boundary||e(this),e(this).data("dragdroplist",{settings:s}),i=new t(s),e(this).find(s.tagName).each(function(){o(e(this))}),e(this).bind("start.draggable",i.handleDragStart).bind("drop.draggable",i.handleDrop).bind("drag.draggable",i.handleDrag)),e(this).on("itemadded.dragdroplist",function(t){o(e(t.target))})}),e(this)}}(jQuery),function(e){function t(t,n){this.el=e(t),this.options=n||{},this.x=!1!==this.options.x||this.options.forceHorizontal,this.y=!1!==this.options.y||this.options.forceVertical,this.autoHide=!1!==this.options.autoHide,this.padding=undefined==this.options.padding?2:this.options.padding,this.inner=this.el.find(".antiscroll-inner"),this.inner.css({right:this.y?-s():0,bottom:this.x?-s():0}),this.refresh()}function n(t){this.pane=t,this.pane.el.append(this.el),this.innerEl=this.pane.inner.get(0),this.dragging=!1,this.enter=!1,this.shown=!1,this.pane.el.mouseenter(e.proxy(this,"mouseenter")),this.pane.el.mouseleave(e.proxy(this,"mouseleave")),this.el.mousedown(e.proxy(this,"mousedown")),this.innerPaneScrollListener=e.proxy(this,"scroll"),this.pane.inner.scroll(this.innerPaneScrollListener),this.innerPaneMouseWheelListener=e.proxy(this,"mousewheel"),this.pane.inner.bind("mousewheel",this.innerPaneMouseWheelListener);var n=this.pane.options.initialDisplay;n!==!1&&(this.show(),this.pane.autoHide&&(this.hiding=setTimeout(e.proxy(this,"hide"),parseInt(n,10)||3e3)))}function r(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n}function s(){if(i===undefined){var t=e('<div class="antiscroll-inner" style="width:50px;height:50px;overflow-y:scroll;position:absolute;top:-200px;left:-200px;"><div style="height:100px;width:100%"></div>');e("body").append(t);var n=e(t).innerWidth(),r=e("div",t).innerWidth();e(t).remove(),i=n-r}return i}e.fn.antiscroll=function(t){return this.each(function(){e(this).data("antiscroll")&&e(this).data("antiscroll").destroy(),e(this).data("antiscroll",new e.Antiscroll(this,t))})},e.Antiscroll=t,t.prototype.refresh=function(){var e=this.inner.get(0).scrollWidth>this.el.width()+(this.y?s():0),t=this.inner.get(0).scrollHeight>this.el.height()+(this.x?s():0);this.x&&(!this.horizontal&&e?this.horizontal=new n.Horizontal(this):this.horizontal&&!e?(this.horizontal.destroy(),this.horizontal=null):this.horizontal&&this.horizontal.update()),this.y&&(!this.vertical&&t?this.vertical=new n.Vertical(this):this.vertical&&!t?(this.vertical.destroy(),this.vertical=null):this.vertical&&this.vertical.update())},t.prototype.destroy=function(){return this.horizontal&&(this.horizontal.destroy(),this.horizontal=null),this.vertical&&(this.vertical.destroy(),this.vertical=null),this},t.prototype.rebuild=function(){return this.destroy(),this.inner.attr("style",""),t.call(this,this.el,this.options),this},n.prototype.destroy=function(){return this.el.remove(),this.pane.inner.unbind("scroll",this.innerPaneScrollListener),this.pane.inner.unbind("mousewheel",this.innerPaneMouseWheelListener),this},n.prototype.mouseenter=function(){this.enter=!0,this.show()},n.prototype.mouseleave=function(){this.enter=!1,this.dragging||this.pane.autoHide&&this.hide()},n.prototype.scroll=function(){this.shown||(this.show(),!this.dragging&&this.pane.autoHide&&(this.hiding=setTimeout(e.proxy(this,"hide"),1e3))),this.update()},n.prototype.mousedown=function(t){t.preventDefault(),this.dragging=!0,this.startPageY=t.pageY-parseInt(this.el.css("top"),10),this.startPageX=t.pageX-parseInt(this.el.css("left"),10),this.el[0].ownerDocument.onselectstart=function(){return!1};var n=this.pane,r=e.proxy(this,"mousemove"),i=this;e(this.el[0].ownerDocument).mousemove(r).mouseup(function(){i.dragging=!1,this.onselectstart=null,e(this).unbind("mousemove",r),i.enter||i.hide()})},n.prototype.show=function(e){this.hiding&&(clearTimeout(this.hiding),this.hiding=null),!this.shown&&this.update()&&(this.el.addClass("antiscroll-scrollbar-shown"),this.shown=!0)},n.prototype.hide=function(){this.pane.autoHide!==!1&&this.shown&&(this.el.removeClass("antiscroll-scrollbar-shown"),this.shown=!1)},n.Horizontal=function(t){this.el=e('<div class="antiscroll-scrollbar antiscroll-scrollbar-horizontal">',t.el),n.call(this,t)},r(n.Horizontal,n),n.Horizontal.prototype.update=function(){var e=this.pane.el.width(),t=e-this.pane.padding*2,n=this.pane.inner.get(0);return this.el.css("width",t*e/n.scrollWidth).css("left",t*n.scrollLeft/n.scrollWidth),e<n.scrollWidth},n.Horizontal.prototype.mousemove=function(e){var t=this.pane.el.width()-this.pane.padding*2,n=e.pageX-this.startPageX,r=this.el.width(),i=this.pane.inner.get(0),s=Math.min(Math.max(n,0),t-r);i.scrollLeft=(i.scrollWidth-this.pane.el.width())*s/(t-r)},n.Horizontal.prototype.mousewheel=function(e,t,n,r){if(n<0&&0==this.pane.inner.get(0).scrollLeft||n>0&&this.innerEl.scrollLeft+Math.ceil(this.pane.el.width())==this.innerEl.scrollWidth)return e.preventDefault(),!1},n.Vertical=function(t){this.el=e('<div class="antiscroll-scrollbar antiscroll-scrollbar-vertical">',t.el),n.call(this,t)},r(n.Vertical,n),n.Vertical.prototype.update=function(){var e=this.pane.el.height(),t=e-this.pane.padding*2,n=this.innerEl,r=t*e/n.scrollHeight;r=r<20?20:r;var i=t*n.scrollTop/n.scrollHeight;if(i+r>t){var s=i+r-t;i=i-s-3}return this.el.css("height",r).css("top",i),e<n.scrollHeight},n.Vertical.prototype.mousemove=function(e){var t=this.pane.el.height(),n=t-this.pane.padding*2,r=e.pageY-this.startPageY,i=this.el.height(),s=this.innerEl,o=Math.min(Math.max(r,0),n-i);s.scrollTop=(s.scrollHeight-t)*o/(n-i)},n.Vertical.prototype.mousewheel=function(e,t,n,r){if(r>0&&0==this.innerEl.scrollTop||r<0&&this.innerEl.scrollTop+Math.ceil(this.pane.el.height())==this.innerEl.scrollHeight)return e.preventDefault(),!1};var i}(jQuery),TD.debug=function(){var e={};return e.spoof_data=null,e}(),TD.minWrapperVersionMac="2.8.0",TD.minWrapperVersionWin="2.8.0";var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-4790629-1"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.src="https://ssl.google-analytics.com/ga.js",e.setAttribute("async","true");var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();